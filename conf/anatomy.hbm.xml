<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<!-- Alwyas include the full package in each class.name attribute. This allows refactoring to identify
     the class and include them. Otherwise a refactoring of a class reference here is not recognized and
     could potentially break the code (e.g. moving a clas  into a different package. -->
<hibernate-mapping package="org.zfin.anatomy">

    <typedef class="org.zfin.database.StringEnumUserType" name="statisticsType">
        <param name="enumClassname">org.zfin.anatomy.AnatomyStatistics$Type</param>
    </typedef>

    <typedef class="org.zfin.database.StringEnumUserType" name="dataAliasGroup">
        <param name="enumClassname">org.zfin.infrastructure.DataAlias$Group</param>
    </typedef>

    <class name="org.zfin.anatomy.DevelopmentStage" table="stage">
        <id name="zdbID">
            <column name="stg_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">STAGE</param>
            </generator>
        </id>

        <property name="name">
            <column name="stg_name" not-null="false"/>
        </property>

        <property name="hoursStart">
            <column name="stg_hours_start" not-null="true"/>
        </property>

        <property name="hoursEnd">
            <column name="stg_hours_end" not-null="false"/>
        </property>

        <property name="otherFeature">
            <column name="stg_other_features" not-null="false"/>
        </property>

        <property name="abbreviation">
            <column name="stg_abbrev" not-null="false"/>
        </property>

    </class>

    <class name="org.zfin.anatomy.AnatomyItem" table="anatomy_item">
        <id name="zdbID">
            <column name="anatitem_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">ANAT</param>
            </generator>
        </id>

        <property name="name">
            <column name="anatitem_name" not-null="false"/>
        </property>

        <property name="oboID">
            <column name="anatitem_obo_id" not-null="false"/>
        </property>

        <property name="definition">
            <column name="anatitem_definition" not-null="false"/>
        </property>

        <property name="obsolete">
            <column name="anatitem_is_obsolete" not-null="false"/>
        </property>

        <property name="lowerCaseName">
            <column name="anatitem_name_lower" not-null="false"/>
        </property>

        <property name="nameOrder">
            <column name="anatitem_name_order"/>
        </property>

        <many-to-one name="start" column="anatitem_start_stg_zdb_id" class="org.zfin.anatomy.DevelopmentStage"
                     not-null="true"/>

        <many-to-one name="end" column="anatitem_end_stg_zdb_id" class="org.zfin.anatomy.DevelopmentStage"
                     not-null="true"/>

        <set name="synonyms">
            <key column="dalias_data_zdb_id"/>
            <one-to-many class="org.zfin.anatomy.AnatomySynonym"/>
            <filter name="noSecondaryAliasesForAO"/>
        </set>

    </class>

    <class name="org.zfin.anatomy.AnatomyStatistics" table="anatomy_stats">
        <composite-id>
            <key-property name="zdbID" column="anatstat_anatitem_zdb_id"/>
            <key-property name="type" column="anatstat_object_type" type="statisticsType" access="field"/>
        </composite-id>

        <property name="numberOfObjects">
            <column name="anatstat_object_count" not-null="false"/>
        </property>

        <property name="numberOfTotalDistinctObjects">
            <column name="anatstat_total_distinct_count" not-null="false"/>
        </property>

        <property name="numberOfSynonyms">
            <column name="anatstat_synonym_count" not-null="false"/>
        </property>

        <!-- do not do fetch="join" -->
        <many-to-one name="anatomyItem" class="org.zfin.anatomy.AnatomyItem"
                     column="anatstat_anatitem_zdb_id" insert="false" update="false" fetch="join" lazy="false"/>

    </class>

    <class name="org.zfin.anatomy.AnatomyStageStatistics" table="anatomy_stage_stats">
        <id name="zdbID">
            <column name="anatstgstat_anatitem_zdb_id" not-null="true"/>
            <generator class="native"/>
        </id>

        <property name="type">
            <column name="anatstgstat_object_type" not-null="false"/>
        </property>

        <property name="numberOfObjects">
            <column name="anatstgstat_object_count" not-null="false"/>
        </property>

        <property name="numberOfTotalDistinctObjects">
            <column name="anatstgstat_total_distinct_count" not-null="false"/>
        </property>

        <one-to-one name="anatomyItem" cascade="all" constrained="true" fetch="join"/>

    </class>

    <class name="org.zfin.anatomy.repository.AnatomyRelationshipTypePersistence" table="anatomy_relationship_type">
        <id name="typeID">
            <column name="areltype_dagedit_id" not-null="true"/>
            <generator class="native"/>
        </id>

        <property name="relationOneToTwo">
            <column name="areltype_1_to_2_display" not-null="true"/>
        </property>

        <property name="relationTwoToOne">
            <column name="areltype_2_to_1_display" not-null="true"/>
        </property>

    </class>

    <class name="org.zfin.anatomy.repository.AnatomyRelationshipOne" table="anatomy_relationship">
        <composite-id >
            <key-many-to-one name="anatomyItemOne" column="anatrel_anatitem_1_zdb_id" lazy="false" />
            <key-many-to-one name="anatomyItemTwo" column="anatrel_anatitem_2_zdb_id" lazy="false"/>
        </composite-id>

        <many-to-one name="type" class="org.zfin.anatomy.repository.AnatomyRelationshipTypePersistence"
                     column="anatrel_dagedit_id" fetch="join" lazy="no-proxy"/>

    </class>

    <class name="org.zfin.anatomy.repository.AnatomyRelationshipTwo" table="anatomy_relationship">
        <composite-id>
            <key-many-to-one name="anatomyItemOne" column="anatrel_anatitem_1_zdb_id" lazy="false"/>
            <key-many-to-one name="anatomyItemTwo" column="anatrel_anatitem_2_zdb_id" lazy="false"/>
        </composite-id>

        <many-to-one name="type" class="org.zfin.anatomy.repository.AnatomyRelationshipTypePersistence"
                     column="anatrel_dagedit_id" fetch="join"/>

    </class>

    <class name="org.zfin.anatomy.AnatomySynonym" table="data_alias">
        <id name="zdbID">
            <column name="dalias_zdb_id"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">DALIAS</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>
        <property name="name">
            <column name="dalias_alias"/>
        </property>
        <property name="aliasLowerCase">
            <column name="dalias_alias_lower"/>
        </property>
        <property name="group" type="dataAliasGroup">
            <column name="dalias_group"/>
        </property>
        <many-to-one name="item" column="dalias_data_zdb_id" class="org.zfin.anatomy.AnatomyItem"/>
        <filter name="noSecondaryAliasesForAO"/>
    </class>


    <class name="org.zfin.anatomy.AnatomyTreeInfo" table="anatomy_display">
        <composite-id>
            <key-property name="zdbID" column="anatdisp_stg_zdb_id"/>
            <key-many-to-one name="item" class="org.zfin.anatomy.AnatomyItem" column="anatdisp_item_zdb_id"/>
        </composite-id>

        <property name="indent">
            <column name="anatdisp_indent" not-null="true"/>
        </property>

        <property name="sequenceNumber">
            <column name="anatdisp_seq_num" not-null="true"/>
        </property>

    </class>


    <class name="org.zfin.audit.AuditLogItem" table="updates">
        <id name="auditLogID" type="long">
            <column name="upd_pk_id" not-null="false"/>
            <generator class="native"/>
        </id>

        <property name="zdbID">
            <column name="rec_id" not-null="false"/>
        </property>

        <property name="oldValue">
            <column name="old_value" not-null="false"/>
        </property>

        <property name="newValue">
            <column name="new_value" not-null="true"/>
        </property>

        <property name="fieldName">
            <column name="field_name" not-null="true"/>
        </property>

        <property name="comment">
            <column name="comments" not-null="true"/>
        </property>

        <property name="dateUpdated">
            <column name="when" not-null="true"/>
        </property>

        <many-to-one name="owner" class="org.zfin.people.User" column="submitter_id" insert="false"
                     update="false"/>
    </class>

    <class name="org.zfin.anatomy.CanonicalMarker" table="anatomy_canonical_marker">
        <id name="zdbID">
            <column name="anatcmrkr_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">ANATCMK</param>
            </generator>
        </id>

        <many-to-one name="gene" column="anatcmrkr_mrkr_zdb_id" class="org.zfin.marker.Marker"
                     not-null="true" insert="true"/>

        <many-to-one name="item" column="anatcmrkr_anatitem_zdb_id" class="org.zfin.anatomy.AnatomyItem"
                     not-null="true" insert="true"/>

        <set name="publications" lazy="true" table="record_attribution">
            <key column="recattrib_data_zdb_id"/>
            <many-to-many class="org.zfin.publication.Publication" column="recattrib_source_zdb_id"/>
        </set>
    </class>

    <filter-def name="noSecondaryAliasesForAO" condition="  dalias_group != :group">
        <filter-param name="group" type="string"/>
    </filter-def>

</hibernate-mapping>

