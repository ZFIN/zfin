<?xml version="1.0" encoding="UTF-8"?>

<project name="Shipper" basedir="../">

    <property name="shipper.src" value="${SOURCEROOT}/server_apps/logstash_shipper"/>
    <property name="shipper" value="${TARGETROOT}/server_apps/logstash_shipper"/>


    <target name="deploy-shipper">
        <copyShipper from="${shipper.src}" to="${shipper}"/>
        <exec executable="cp">
            <arg value="server_apps/logstash_shipper/shipper.sh"/>
            <arg value="${TARGETROOT}/server_apps/logstash_shipper/shipper.sh"/>
        </exec>
    </target>

    <macrodef name="copyShipper">
        <attribute name="from"/>
        <attribute name="to"/>
        <attribute name="overwrite" default="false"/>
        <sequential>
            <echo message="@{from}"/>
            <copy todir="@{to}" overwrite="@{overwrite}">
                <fileset dir="@{from}">
                    <include name="**/*.conf"/>
                    <exclude name="**/shipper.sh"/>
                    <exclude name="**/*.svn"/>
                </fileset>
                <filterset refid="allfilters"/>
            </copy>
            <copy todir="@{to}" overwrite="@{overwrite}">
                <fileset dir="@{from}">
                    <include name="**"/>
                    <exclude name="**/*.conf"/>
                    <exclude name="**/shipper.sh"/>
                    <exclude name="**/*.svn"/>
                </fileset>
            </copy>
        </sequential>

    </macrodef>


    <target name="start-shipper" description="Start up Logstash Shipper ">
        <echo message="Source: ${shipper}"/>
        <exec executable="${shipper}/shipper.sh">
            <arg value="start"/>
        </exec>
    </target>

    <target name="stop-shipper" description="Stop Logstash Shipper">
        <exec executable="${shipper}/shipper.sh">
            <arg value="stop"/>
        </exec>
    </target>

    <target name="restart-shipper" description="Restart up Logstash Shipper">
        <exec executable="${shipper}/shipper.sh">
            <arg value="restart"/>
        </exec>
    </target>

    <target name="pid-shipper" description="Display the PID of the Logstash Shipper">
        <loadfile property="shipper-pid" srcFile="${shipper}/shipper.pid"/>
        <echo>
            shipper server PID: ${shipper-pid}
        </echo>
    </target>


</project>
