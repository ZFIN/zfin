<html><head><title></title></head>
<body bgcolor=#ffffff>

<A NAME="1001595">
<P>
</A><A NAME="996824">
<h1><FONT FACE="Helvetica,Arial">
   <center><i>
      Implementing drag and drop

   </i></center>
</FONT></h1>
</A><A NAME="1005643">

<img src="Graphics/dragdrop.mak.anc.gif">

he drag and drop framework lets a user interact with an application by clicking an object with the mouse and dragging it. For example, in a drawing program, the user could set the color of a graphic element by dragging a color swatch from a chooser and dropping it on the element.<P></A>
<A NAME="1005695">
The IFC provides a framework for adding drag and drop behavior to Java applications. Because Java does not let you access the built-in drag and drop subsystem of your platform, the IFC framework supports drag and drop only within an application. However, even with this limitation, drag and drop is an extremely useful feature.<P></A>
<HR>
<A NAME="How drag and drop works"></A>
<A NAME="1005516">
<H1><FONT FACE="Helvetica,Arial"> How drag and drop works</FONT></H1>
</A><A NAME="1005518">
A <B>drag session</B> begins when the user clicks within a <B>drag source</B>, creating a draggable object that tracks the mouse pointer as the user drags the mouse. A drag session ends when the user releases the mouse over an object known as the <B>drag destination</B>. The destination can either accept or refuse the dragged object. If refused, the dragged object typically returns to its source.<P></A>
<A NAME="1005859">
You specify an object as a drag source or a drag destination by implementing the <code>DragSource</code> and <code>DragDestination</code> interfaces, respectively. Use the <code>mouseDown</code> or <code>mouseDragged</code> method of the drag source <code>View</code> to create an instance of <code>DragSession</code>, the class that implements drag and drop behavior. <code>DragSession</code> is responsible for tracking the mouse pointer with an image, querying the destination, and returning the dragged object to the drag source.<P></A>
<A NAME="1010246">
For example, a color well object is a drag source because it is a subclass of <code>DragWell</code>, which implements the <code>DragSource</code> interface. Clicking within a color well creates a drag session and displays a color swatch that tracks the mouse pointer. When the user releases the mouse button, the drag destination beneath the swatch either accepts the color or refuses it.<P></A>
<A NAME="1008994">
<B>A drag session with a color well
<img src="Graphics/dragdrop.mak.anc1.gif">


</B>
<P>
</A>


<A NAME="1005579">
Here are the general steps you take to provide drag and drop support in an application:<P></A>
<ol>

<a name="1006294">
<li>Implement the <code>DragSource</code> interface for objects that are available as drag sources. <a href="dragdrop.mak.html#1006293">See&nbsp;"Specifying a drag source" on page 55</a>.
</a>


<a name="1006417">
<li>Use the <code>mouseDragged</code> method of source objects to create an instance of <code>DragSession</code>. <a href="dragdrop.mak.html#1007690">See&nbsp;"Initiating a drag session" on page 56</a>.
</a>


<a name="1006305">
<li>Implement the <code>DragDestination</code> interface for objects that accept dragged objects. <a href="dragdrop.mak.html#1005952">See&nbsp;"Specifying a drag destination" on page 57</a>.
</a>


<a name="1006342">
<li>In the drag destination objects, override the <code>acceptsDrag</code> method of <code>View</code> to return a value. <a href="dragdrop.mak.html#1005952">See&nbsp;"Specifying a drag destination" on page 57</a>.
</a>

</ol>
<HR>
<A NAME="Specifying a drag source"></A>
<A NAME="1006293">
<H1><FONT FACE="Helvetica,Arial"> Specifying a drag source</FONT></H1>
</A><A NAME="1006073">
You specify an object as a drag source by implementing the <code>DragSource</code> interface, which contains the methods listed in <a href="dragdrop.mak.html#1006073">Table&nbsp;5.1</a>.

<TABLE BORDER="2">
<CAPTION></CAPTION>
<tr><th><b><A NAME="1006111">
Method<P>
</A><B><th><b><A NAME="1006113">
Description<P>
</A><B>
<tr><td><A NAME="1006115">
<code>dragWasAccepted</code><P>
</A><td><A NAME="1006117">
Called when a destination accepts a drag.<P>
</A>
<tr><td><A NAME="1006119">
<code>dragWasRejected</code><P>
</A><td><A NAME="1006121">
Called when a destination rejects a drag.<P>
</A>
<tr><td><A NAME="1006123">
<code>sourceView</code><P>
</A><td><A NAME="1006125">
Returns the view that initiated the drag session.<P>
</A>

</TABLE>

<TABLE>
<TR><TD>
</TABLE>


<P></A>
<A NAME="1006256">
For example, suppose you are creating a drawing application that displays items on a palette; users can drag items from the palette and drop them into the work space of your application. You can create the <code>IconView</code> class as an abstract superclass of the views that appear to the user as items on the palette. You can make <code>IconView</code> available as a drag source by providing an implementation for the <code>DragSource</code> methods such as the following:<P></A>
<A NAME="1006275">
<PRE>public abstract class IconView extends View implements DragSource {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public void dragWasAccepted(DragSession session) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public boolean dragWasRejected(DragSession session) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public View sourceView(DragSession session) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>...<br>}</PRE>
</A>
<A NAME="1007510">
The sample Aquarium application contains another example of specifying a drag source. See the file <code>IconView.java</code> in the <code>Aquarium</code> folder within the <code>Examples</code> folder.<P></A>
<HR>
<A NAME="Initiating a drag session"></A>
<A NAME="1007690">
<H1><FONT FACE="Helvetica,Arial"> Initiating a drag session</FONT></H1>
</A><A NAME="1010705">
The <code>DragSession</code> class performs most of the work for drag and drop support. A drag session object tracks the mouse pointer as the user drags the mouse. On each move, the drag session object notifies the views beneath the pointer that it has entered, moved within, exited, or been released within their bounds.<P></A>
<A NAME="1007692">
Override the <code>mouseDown</code> or <code>mouseDragged</code> method of the drag source to initiate a drag session. The following code shows the prototype of the <code>DragSession</code> constructor:<P></A>
<A NAME="1007443">
<PRE>public DragSession(DragSource source, Image image,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int initialX, int initialY,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int mouseDownX, int mouseDownY,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String dataType, Object data)</PRE>
</A>
<A NAME="1007415">
The image in the constructor represents the data that the user is manipulating; the image tracks the mouse as the user drags. The <em>initialX</em> and <em>initialY</em> parameters specify the initial location of the image; <em>mouseDownX</em> and <em>mouseDownY</em> specify the initial location of the mouse. Specify these integers relative to the coordinate system of the drag source. Specify the actual data and the type of data that the user is manipulating in the constructor, and optionally change them with the <code>setData</code> and <code>setDataType</code> methods.<P></A>
<A NAME="1007200">
For example, a drag well can intitiate a drag session when a user drags the mouse within it, as shown in the following example:<P></A>
<A NAME="1008410">
<PRE>public void mouseDragged(MouseEvent event) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new DragSession(this, image(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0, 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event.x, event.y,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataType(), data());<br>}</PRE>
</A>
<A NAME="1010792">
In this example, the image, data type, and data used by the constructor are returned by the <code>image</code>, <code>dataType</code>, and <code>data</code> methods of the <code>DragWell</code> itself. The actual implementation of <code>DragSession</code> in <code>DragWell</code> is slightly more complicated; it has been simplified for this example.<P></A>
<A NAME="1007656">
The sample Aquarium application initiates a drag session within the <code>mouseDragged</code> method. See the file <code>IconView.java</code> in the <code>Aquarium</code> folder within the <code>Examples</code> folder.<P></A>
<HR>
<A NAME="Specifying a drag destination"></A>
<A NAME="1005952">
<H1><FONT FACE="Helvetica,Arial"> Specifying a drag destination</FONT></H1>
</A><A NAME="1006830">
You specify an object as a drag destination by implementing the <code>DragDestination</code> interface, which contains the methods listed in <a href="dragdrop.mak.html#1006830">Table&nbsp;5.2</a>.

<TABLE BORDER="2">
<CAPTION></CAPTION>
<tr><th><b><A NAME="1006841">
Method<P>
</A><B><th><b><A NAME="1006843">
Description<P>
</A><B>
<tr><td><A NAME="1006845">
<code>dragDropped</code><P>
</A><td><A NAME="1006847">
Called when an object is dropped on a view.<P>
</A>
<tr><td><A NAME="1006849">
<code>dragEntered</code><P>
</A><td><A NAME="1006851">
Called when an object is dragged into a view.<P>
</A>
<tr><td><A NAME="1006853">
<code>dragExited</code><P>
</A><td><A NAME="1006855">
Called when an object is dragged out of a view.<P>
</A>
<tr><td><A NAME="1006941">
<code>dragMoved</code><P>
</A><td><A NAME="1006943">
Called when an object is moved within a view.<P>
</A>

</TABLE>

<TABLE>
<TR><TD>
</TABLE>


<P></A>
<A NAME="1010851">
To provide minimal drag and drop functionality, use the implementation of the <code>dragDropped</code> method to handle a dropped object, and simply return from the other methods. If you want to enhance the functionality of your application, you can handle other user actions in the implementation of <code>dragEntered</code>, <code>dragMoved</code>,and <code>dragExited</code>. For example, if you want to animate a view to indicate that it is a valid drop destination, begin the animation within <code>dragEntered</code> and end it within <code>dragExited</code>.<P></A>
<A NAME="1008330">
A drag session object sends messages to call the methods in <code>DragDestination</code> in response to user actions. Any object that implements <code>DragDestination</code> receives these messages as the drag session object moves over it.<P></A>
<A NAME="1008332">
If the drag destination is a view, override its <code>acceptsDrag</code> method to return a value. By default, <code>acceptsDrag</code> returns null. Specify the view that is the recipient of drag messages as the value of <code>acceptsDrag</code>.<P></A>
<A NAME="1008157">
For example, suppose you want to create a text field that accepts a color dragged from a color well. To specify this drag destination, create a subclass of <code>TextField</code>, return the view itself within the <code>acceptsDrag</code> method, and handle the drop in the implementation of the <code>dragDropped</code> method, as shown in the following code:<P></A>
<A NAME="1008781">
<PRE>public class ColorField extends TextField implements DragDestination{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ColorField(int x, int y, int width, int height) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(x, y, width, height);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public DragDestination acceptsDrag(DragSession dragSession,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int x, int y) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (Color.COLOR_TYPE.equals(dragSession.dataType())) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return null;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public boolean dragDropped(DragSession dragSession) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Color color;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color = ((Color)dragSession.data());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setBackgroundColor(color);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;draw();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public boolean dragEntered(DragSession dragSession) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public boolean dragMoved(DragSession dragSession) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public void dragExited(DragSession dragSession) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>}</PRE>
</A>
<A NAME="1008159">
As shown in the previous example, use the <code>acceptsDrag</code> method to examine the data type of the item a user is dropping. To reject the item, return null; by default, the item returns to the drag source. To accept the item, return a value.<P></A>
<A NAME="1007167">
Typically, the drag destination returned in the <code>acceptsDrag</code> method of a view is the view itself, as shown in the previous example. However, you can return any object that implements the <code>DragDestination</code> interface. For example, <code>acceptsDrag</code> can return a controller object as the recipient of drag messages.<P></A>

<hr><br>

<P>
<SCRIPT>
document.write("<FONT SIZE=-2>Last modified " + document.lastModified)
</SCRIPT>
<P>
</body>
</html>
