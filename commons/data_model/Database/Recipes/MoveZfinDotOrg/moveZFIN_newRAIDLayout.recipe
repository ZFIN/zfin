2007/10/01 

We need to reformat zfindb to use a new RAID.  First, we have to get
zfin.org off of production so that we can do this work.

Tasks to perform in advance of the move:
========================================

 1. Pick a time. It needs to be coordinated with curators, 
    technologists, and the CS system administrators.

    STATUS: 


 2. Make updated version of http.conf files on both servers

    STATUS: on helix: /private/httpd.conf/httpd.conf.main.notzfin 
    	       	      updated manually to get changes from  httpd.conf.main and 
                      add changes necessary to bring up helix.cs.uoregon.edu
		      add httpd.conf.main.bkup.071001 as a copy of httpd.conf.main

            on embryonix: /private/httpd/conf/move.zfin.org.here.httpd.conf 
	       	      modified to take SSL changes from httpd.conf and
	              add changes necessary to bring up zfin.org on embryonix
		      add httpd.conf.bkup.071001 as a copy of httpd.conf

	done: 10/01/07 :10am

 3. Create the ZFIN_WWW tree on Embryonix
    
        as informix (srcembryonix)

        % cd /research/zusers/embryonix
        
        % cvs -q update -P

	STATUS: 10/01/07: 10am

 4. rsync the images and pdf from Helix to Embryonix
       we will run this again during the move, this run is get most of the updates
       to reduce the moving time

        as yourself on embryonix:
       
       % cd /research/zcentral/loadUp/embryonixLoadUp/embryonixImageLoadUp/

       % sudo -u zfishweb /local/bin/rsync -upvab --copy-links  /research/zprod/loadUp/imageLoadUp/ /research/zcentral/loadUp/embryonixLoadUp/embryonixImageLoadUp

       This takes about 15 minutes from scratch, less if images already exist.


       STATUS: done: 10/01/07 5:31pm
       	       done: 10/02/07 7:45am

       Now do the PDF rsync.
       As yourself on embryonix:

       % cd /research/zcentral/loadUp/embryonixLoadUp/embryonixPDFLoadUp/
       
       % sudo -u zfishweb /local/bin/rsync -upvab --copy-links /research/zprod/loadUp/PDFLoadUp/ /research/zcentral/loadUp/embryonixLoadUp/embryonixPDFLoadUp/

       STATUS: done 10/01/07 5:31pm
       	       done: 10/02/07 7:47am       

     5. Config Tomcat applications for zfin.org on Embryonix

	% cd zfin.org
  
          edit file to update docBase and having index path to almost
          index repository. 

----------------------------------------------------------------------------------

	done already.

      6. Check Tomcat configuration

         uncomment the section for zfin.org on embryonix and comment out the 
	 similar section:

	  /private/apps/tomcat/conf/server.xml

	  
<!--   When ZFIN.org is on embryonix

       <Resource
        name="jdbc/zfinDatabase"
        auth="Container"
        type="javax.sql.DataSource" 
        description="The ZFIN Database"
        factory="org.apache.tomcat.dbcp.dbcp.BasicDataSourceFactory"
        driverClassName="com.informix.jdbc.IfxDriver"
        url="jdbc:informix-sqli://zfin.org:2002:INFORMIXSERVER=wanda;user=zfinner;password=Rtwm4ts" />
-->

Tasks to perform at the time of the move:
==========================================
    0. Email zfinner(make sure Marie & Jon are on the list), 
       curators not web updates, tech people no direct updates.   

    1. Open a shell as informix on helix

       % srchelix   
 
       Open another shell as informix on embryonix

       % srcalmost

    2. Disable web update and cron job on Helix   

        % echo 'update zdb_flag set zflag_is_on = "t",
                                    zflag_last_modified = CURRENT
        where zflag_name = "disable updates"' | dbaccess zfindb

        As informix on helix
        % cdhelix
        % cd server_apps/cron
        % gmake stop
   
	STATUS: done: 7:48am


    3. Unload zfindb from Helix

        as informix on helix:
 
        % unloaddb.pl zfindb /research/zunloads/databases/zfindb/2007.10.02.pre_move

	(make sure the path to the unloads directory is correct)

	STATUS: done: 7:59am


    4. Load the dump into zfindb on Embryonix

       as informix on embryonix (srcembryonix):

        % loaddb.pl zfindb /research/zunloads/databases/zfindb/2007.10.02.pre_move

	STATUS: done: 8:16 am

      
    5. While loading, zip production FTP dir and transfer to Embryonix

??      Dave has been doing this step as self and execute sudo, why not as informix??

        on Helix

        % cd /research/zprod/ftp
        % tar cf pub.tar pub

        on Embryonix

        % cd /research/zcentral/ftp
        % cp -f /research/zprod/ftp/pub.tar . 
        % rm -rf pub 
        % tar xf pub.tar

	STATUS: done 8:01am


    6. While loading, rsync the images and pdf from Helix to Embryonix

        as yourself on embryonix

        % sudo -u zfishweb /local/bin/rsync -upvab --copy-links /research/zprod/loadUp/imageLoadUp/ /research/zcentral/loadUp/embryonixLoadUp/embryonixImageLoadUp/

        % sudo -u zfishweb /local/bin/rsync -upvab --copy-links /research/zprod/loadUp/PDFLoadUp/ /research/zcentral/loadUp/embryonixLoadUp/embryonixPDFLoadUp/


	STATUS: done: 8:02am


     7. Update /private/ZfinLinks on Embryonix
             
        Change any links that move when zfin.org moves.

       % rm www; ln -s /research/zcentral/www_homes/embryonix www
       % rm mirror_src; ln -s /research/zusers/mirror mirror_src
       % rm mirror_dest; ln -s /research/zcentral/ftp/pub/transfer/Mirror/site mirror_dest

        STATUS: done: 8:03am 


     8. Once the DB load finished, gmake the web site

        As informix on embryonix

        % cdembryonix
        % cvs -q update -dP
        % gmake postloaddb

        STATUS: done: 8:19 am

     9. Create all the outgoing data transfer files

        As informix on embryonix, srcembryonix
 
	% cdembryonix
        % cd server_apps/data_transfer
        % gmake push

	zfishweb crontab is still running.  its only job is to rsync image/pdf files to embryonix.
	we do that manually in this process, so it is ok.  If you want to stop, there is a
	crontab.zfishweb on /server_apps/cron to replace when done...

	STATUS: done: 8:21 am

     10 Test that embryonix.cs.uoregon.edu comes up

        Not everything will work, but the basics like the home page will. 
        If something obvious does not work, then you need to fix it before 
        moving on.

	STATUS: working, 8:19am

     11. Update tomcat server.xml file
       
        As yourself on embryonix

        % cd /private/apps/tomcat/conf

        % co -l server.xml

        Edit server.xml change the jdbc connection section:

        Change
        <Resource
        name="jdbc/zfinDatabase"
        ...
        url="jdbc:informix-sqli://embryonix.cs.uoregon.edu:2002:INFORMIXSERVER=wanda;user=zfinner;password=Rtwm4ts" />

        To
        <Resource
        name="jdbc/zfinDatabase"
        ...
        url="jdbc:informix-sqli://zfin.org:2002:INFORMIXSERVER=wanda;user=zfinner;password=Rtwm4ts" />


     12. Update embryonix apache configuration files
      
        As yourself on embryonix

        % cd /private/httpd/conf

        % sudo cp httpd.conf httpd.conf.bkup.preMove.071002
        % co -l httpd.conf
        % sudo cp move.zfin.org.here.httpd.conf.070824 httpd.conf
        % sudo ../bin/apachectl configtest

      
    13. Notify developers Apache and Tomcat would be down on embryonix, as well as Informix engine.

    14. Stop tomcat and apache on Embryonix

         As self on Embryonix

         % sudo /private/apps/tomcat-5.5.15/bin/jsvc-src/native/startStop.sh stop
      
         % sudo /private/httpd/bin/apachectl stop

	 done: 8:35am

    15. Archive the catalina.out file, and start a fresh one 

         As self on Embryonix
        
         % cd /private/apps/tomcat/logs
         % sudo -u zfishweb gzip catalina.out
         % sudo -u zfishweb touch catalina.out
         % ls -l catalina.out

	 done: 8:44am
     
    16. Copy the Apache log files from the production server to embryonix

        As yourself on the production server:
        % cp /private/httpd/logs/zfin.org/access_log /research/zusers/staylor/Temp/logs071002/ 
        % cp /private/httpd/logs/zfin.org/error_log /research/zusers/staylor/Temp/logs071002/

        As yourself on the development server:
        cd /private/httpd/logs/zfin.org 
        sudo cp /research/zusers/staylor/Temp/logs071002/access_log . 
        sudo cp /research/zusers/staylor/Temp/logs071002/error_log . 
        sudo chown root:other *_log


    17. Start Apache and Tomcat

         As self on Embryonix
 
         % sudo /private/httpd/bin/apachectl start
	 (should this be startssl?) 

         % sudo /private/apps/tomcat-5.5.15/bin/jsvc-src/native/startStop.sh start

	 done: 8:46am


    18. Take the informix server down on embryonix
 
        This step is necessary in order to perform the next step. 
        If you update the INFORMIXSQLHOSTS file while the server is up and 
        running, then bad things can happen like clients can't reach it, and 
        you can't shut down the engine.
   
        As informix on the embryonix server:
        onmode -k

        STATUS: done: 8:47


    19. Update the development server's INFORMIXSQLHOSTS file

        Wanda's INFORMIXSQLHOSTS file is at
        /private/apps/Informix/informix/etc/sqlhosts

        Change 
        wanda ontlitcp embryonix.cs.uoregon.edu zfin_tli

        to
        wanda ontlitcp zfin.org zfin_tli

        STATUS:  done: 8:48


    20. Get systems to swap zfin.org from the production server to the 
         development server

         STATUS: done: 9:03am


    21. Bring up Informix server on embryonix


         As informix on embryonix, 
         
        ( open a new shell)

         % srcembryonix
         % oninit

         STATUS: done: 9:05am

    22. Test that you can get to zfin.org,  ZIRC links, the mirror site, 
         the CVSweb site, and the test web sites, albino.zfin.org, for example.

         Watch the access_log and error_log to make sure that offsite 
         URLs can successfully access zfin.org

         STATUS: done


    23. Start cron on embryonix

        As informix on embryonix
        % cdembryonix
        % cd server_apps/cron
        % gmake start

	done: 9:06

    23. Enable update to zfin.org on Embryonix

         As self or informix
         % echo 'update zdb_flag set zflag_is_on = "f",zflag_last_modified = CURRENT
        where zflag_name = "disable updates"' | dbaccess zfindb

	no

    24. Notify zfinner that zfin.org is on embryonix. 
        No tomcat configuration changes. Monitor embryonix load. 

	done.

    25. Throttle back loaddb.pl on embryonix for as long as zfin.org is on it.

        commenting out the setting of PDQPRIORITY and 
        PSORT_N_PROCS environment variables.

        STATUS:  no

    25. Change the production server's Apache to use the new config file.
        Bounce apache.

       As yourself on helix
       % cd /private/httpd/conf
       % cp httpd.conf.main httpd.conf.main.bkup.071002
       % co -l httpd.conf.main
       % cp httpd.conf.main.notzfin httpd.conf.main
       % sudo ../bin/apachectl stop
       ( % sudo ../bin/apachectl start if start  )

       STATUS: 


    26. Update tomcat server.xml file and bounce tomcat
       
        As yourself on helix

        % cd /private/apps/tomcat/conf

        % co -l server.xml

        Edit server.xml change the jdbc connection section:

        Change
        <Resource
        name="jdbc/zfinDatabase"
        ...
        url="jdbc:informix-sqli://zfin.org:2002:INFORMIXSERVER=wildtype;user=zfinner;password=Rtwm4ts" />

        To
        <Resource
        name="jdbc/zfinDatabase"
        ...
        url="jdbc:informix-sqli://helix.cs.uoregon.edu:2005:INFORMIXSERVER=wildtype;user=zfinner;password=Rtwm4ts" />

          
	done: 9:15am figure out perms.



    27. Update INFORMIXSQLHOSTS file on helix

        As informix on helix:

        onmode -k

       Wildtype's INFORMIXSQLHOSTS file is at
       /private/apps/Informix/informix/etc/sqlhosts

       Change 
       wildtype ontlitcp zfin.org zfin1_tli

       to
       wildtype ontlitcp helix.cs.uoregon.edu zfin1_tli

       STATUS: 

    28. Bring informix up on the production server

        As informix on helix
        % oninit

        STATUS: 

    29. Test that you can get to helix.cs.uoregon.edu.

        STATUS: 


=========================================
Helix is now ours to mess with.
=========================================
x. take down apache, tomcat and informix on this server.

   as informix on helix:
   % onmode -k

   as self on helix:
   % /private/httpd/bin/apachectl stop

   as self on helix:

   % sudo /private/apps/tomcat-5.5.15/bin/jsvc-src/native/startStop.sh stop
      
   % sudo /private/httpd/bin/apachectl stop
   

x. ask Lauradel to rsync/move the filesystems over to the new RAID.

!!DO NOT HAVE HER REMOVE THE A1000!!! 

Wait to do this until we've oninit'd.
after reboot informix will come up again on its own and we don't want it to get
into a funky state.

---------------------------------------------------------------------------------------------------------------

x. take down informix on helix if it came up on reboot.

   as informix

   % onmode -k

   (new onconfig for the new raid is in ~/informix/etc/onconfig.newRAID; 
   	* change tempdbspaces to be 1-14 instead of 3-12
	* added extra SHMTRVMEM, added 1 extra AIO VP, added TBLSPSTAT 1
	* has parameters for init set, need to change these in round 2 of oninit.
   )

x. copy the onconfig for old helix on A1000

   % cp ~/informix/etc/onconfig ~/informix/etc/onconfig.oldA1000

x. move the new RAID onconfig to onconfig

   % cp ~/informix/etc/onconfig.newRAID ~/informix/etc/onconfig

   this has the startup parameters set.

   done: 9:50

x. initialize informix

   % oninit -i

   came up. 
 
 (using the init onconfig at this point)

x. Convert to large chunks

    % onmode -BC 1
    % ontape -s -L 0
    % onmode -BC 2
    % ontape -s -L 0

x. remove old links

   as informix

   % cd ~/informix/dev   
   % rm * 
   
done: make sure your ln -s works.

x. add the new ones

   ln -s /dev/rdsk/c6t0d0s6 defaultdbs_c1 

   ln -s /dev/rdsk/c6t0d1s6 llogdbs1_c1
   ln -s /dev/rdsk/c6t0d2s6 plogdbs1_c1
   ln -s /dev/rdsk/c6t0d0s6 rootdbs_c1  

   ln -s /dev/rdsk/c6t0d0s6 idxdbs1_c1  
   ln -s /dev/rdsk/c6t0d1s6 idxdbs2_c1 
   ln -s /dev/rdsk/c6t0d2s6 idxdbs3_c1


   ln -s  /dev/rdsk/c6t0d0s6 smartbs1_c1 
   ln -s /dev/rdsk/c6t0d2s6  smartdfltbs_c1  

   ln -s /dev/rdsk/c7t0d0s1 smarttempbs1_c1  

   ln -s /dev/rdsk/c6t0d0s6 tbldbs1_c1  
   ln -s /dev/rdsk/c6t0d1s6 tbldbs2_c1  
   ln -s /dev/rdsk/c6t0d2s6 tbldbs3_c1  

   ln -s /dev/rdsk/c7t0d0s1 tempdbs1_c1  
   ln -s /dev/rdsk/c7t0d0s1 tempdbs2_c1  
   ln -s /dev/rdsk/c7t0d0s1 tempdbs3_c1  
   ln -s /dev/rdsk/c7t0d0s1 tempdbs4_c1  
   ln -s /dev/rdsk/c7t0d0s1 tempdbs5_c1  

   ln -s /dev/rdsk/c7t0d0s1 tempdbs6_c1  
   ln -s /dev/rdsk/c7t0d0s1 tempdbs7_c1  
   ln -s /dev/rdsk/c7t0d0s1 tempdbs8_c1 
   ln -s /dev/rdsk/c7t0d0s1 tempdbs9_c1  
   ln -s /dev/rdsk/c7t0d0s1 tempdbs10_c1

x. this is on helix internal disk.

  ln -s /dev/rdsk/c1t2d0s3 tempdbs11_c1 
  ln -s /dev/rdsk/c1t2d0s3 tempdbs12_c1  
  ln -s /dev/rdsk/c1t3d0s3 tempdbs13_c1  
  ln -s /dev/rdsk/c1t3d0s3 tempdbs14_c1  

done : pre oninit -i so we have the rootdbspace linked.

x. All of the raw disks need to be owned
by informix:informix.

   ask Lauradel to do so if not already done.

   done: 8am.

x. Bring up informix on helix

   as informix on helix

   % oninit 

add ontape start.??

x. Now add all the spaces.

    Add the spaces in the order you want them to show up in ISA; lets go by disk first, then type.


!!!!rootdbs is here too.!!!! so offset is 32768
onspaces -c -d defaultdbs      -p /private/apps/Informix/informix/dev/defaultdbs_c1   -o 32768    -s 98034
onspaces -c -d tbldbs1         -p /private/apps/Informix/informix/dev/tbldbs1_c1      -o 130802   -s 2097152
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXUNUSED BUT USED TO BE THE OLD INDEXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXx
onspaces -c -S smartbs1        -p /private/apps/Informix/informix/dev/smartbs1_c1     -o 2621170  -s 4194304 -Df "LOGGING=ON,AVG_LO_SIZE=32"
onspaces -c -d idxdbs1         -p /private/apps/Informix/informix/dev/idxdbs1_c1      -o 6815474  -s 1572864


onspaces -c -d llogdbs         -p /private/apps/Informix/informix/dev/llogdbs1_c1     -o 0	   -s 6291456
onspaces -c -d tbldbs2         -p /private/apps/Informix/informix/dev/tbldbs2_c1      -o 6291456   -s 2097152
onspaces -c -d idxdbs2         -p /private/apps/Informix/informix/dev/idxdbs2_c1      -o 8388608   -s 1572864



onspaces -c -d plogdbs         -p /private/apps/Informix/informix/dev/plogdbs1_c1      -o 0         -s 65536 
onspaces -c -d tbldbs3         -p /private/apps/Informix/informix/dev/tbldbs3_c1       -o 65536     -s 2097152 
XXXXXXXXXXXXXXXXUNUSED BUT USED TO BE THE OLD INDEXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
onspaces -c -S smartdfltbs     -p /private/apps/Informix/informix/dev/smartdfltbs_c1   -o 2555904   -s 262144  -Df "LOGGING=ON,AVG_LO_SIZE=32"
onspaces -c -d idxdbs3         -p /private/apps/Informix/informix/dev/idxdbs3_c1       -o 2818048   -s 1572864 

--here!!---
onspaces -c -d tempdbs1     -t -p /private/apps/Informix/informix/dev/tempdbs1_c1     -o 0         -s 2097152 
onspaces -c -d tempdbs2     -t -p /private/apps/Informix/informix/dev/tempdbs2_c1     -o 2097152   -s 2097152
onspaces -c -d tempdbs3     -t -p /private/apps/Informix/informix/dev/tempdbs3_c1     -o 4194304   -s 2097152
onspaces -c -d tempdbs4     -t -p /private/apps/Informix/informix/dev/tempdbs4_c1     -o 6291456   -s 2097152
onspaces -c -d tempdbs5     -t -p /private/apps/Informix/informix/dev/tempdbs5_c1     -o 8388608   -s 2097152

onspaces -c -d tempdbs6     -t -p /private/apps/Informix/informix/dev/tempdbs6_c1     -o 10485760  -s 2097152
onspaces -c -d tempdbs7     -t -p /private/apps/Informix/informix/dev/tempdbs7_c1     -o 12582912  -s 2097152
onspaces -c -d tempdbs8     -t -p /private/apps/Informix/informix/dev/tempdbs8_c1     -o 14680064  -s 2097152
onspaces -c -d tempdbs9     -t -p /private/apps/Informix/informix/dev/tempdbs9_c1     -o 16777216  -s 2097152
onspaces -c -d tempdbs10    -t -p /private/apps/Informix/informix/dev/tempdbs10_c1    -o 18874368  -s 2097152

onspaces -c -S smarttempbs1 -t -p /private/apps/Informix/informix/dev/smarttempbs1_c1 -o 20971520 -s 1048576 -Df "LOGGING=ON,AVG_LO_SIZE=32"


onspaces -c -d tempdbs11    -t -p /private/apps/Informix/informix/dev/tempdbs11_c1   -o   0    	   -s 1048576
onspaces -c -d tempdbs12    -t -p /private/apps/Informix/informix/dev/tempdbs12_c1   -o   1048576  -s 1048576

onspaces -c -d tempdbs13    -t -p /private/apps/Informix/informix/dev/tempdbs13_c1   -o   0  	   -s 1048576
onspaces -c -d tempdbs14    -t -p /private/apps/Informix/informix/dev/tempdbs14_c1   -o   1048576  -s 1048576



x. Now, run a level 0 archive

    % ontape -s -L 0

    had some troube with logs filling up, maybe because of TABLSPCSTATS,  but we don't know.
    started ontape and the immediate probs went away (full log).

 x. Activate the new spaces in the onconfig file, and restart informix.

    cd
    cd informix/etc
    edit onconfig to remove startup params: root and plog.

    % onmode -k
    % oninit

x. add logical logs in quiescent mode

    % onmode -u

x. add the logical logs

    llogdbs1 has been ionncreased to 4 GB in size, which is big enough to hold
    63 or 64 64 MB files; 

    Add 63 log files

      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs
      onparams -a -d llogdbs

    do a level 0 backup to make them available

      ontape -s -L 0

    Drop the old log files.

      onparams -d -l 1
      onparams -d -l 3
      onmode -l
      had to advance to the newly created, instead of the old ones.
      next onconfig should have bigger llog in rootdbs so we don't fill them up.
      ontape -s -L 0
      onparams -d -l 2
      ontape -s -L 0

      had some more weird log issues, couldn't drop logs, got weird messages about pre-drop llgs?
      started ontape again, it turned off??  and then we were golden for dropping logs again. 

  --this brings it back to full online mode (from quiescent)--
      onmode -m
      onstat -l

      done: 12:37

x. start logging: gmake dumplogscontinuous from /research/zprod/users/zfin.org/ZFIN_WWW/server_apps/DB_maintenance ?? well, we'll try it

   as informix on helix:

   % cd /research/zprod/users/zfin.org/ZFIN_WWW/server_apps/DB_maintenance
   % gmake dumplogscontinuous 

   had some weirdness with the llogs.  we had to advance and drop, etc.
   had ontape -c on for the duration...
   more research need.
   already did this.

x. if the filesystems are usable, try loading the database: !!! USE THE MODIFIED SCHEMA FILE from /research/zusers/staylor/newRAID/schemaFile.sql

   % started: 11:07:25
   % finished: 11:16

   not bad

   took a look at ISA, it was not pretty, I increased the indexspaces,but only by a little.  Dropped them, and recreated at the end of the
   file...so we have a chunk of unused space in the middle of our config, but we can fix it next time.

x. gmake postloaddb 

x. restart apache
   as self on helix
   % cd /private/httpd/bin
   % sudo apachectl start

x. restart tomcat

   % restarttomcat.pl

else??

   had some trouble with tomcat...can't find its files.
   decided to table and let Lauradel have the reigns again.
   she is rebooting. 12:39pm

% had to redo the indexdbspace
% done: 11:58am

zfin_jump is redirecting poorly, manually fixed the files in /research/zcentral/www_homes/embryonix for now.
	  need to look at the tt files again to see that cgi-bin is redirecting to zfin.org???

x. test the system

helix.cs.uoregon.edu
ISA
maps
zirc links
etc...

=========================================
Move ZFIN.org back.
=========================================


    6. Update /private/ZfinLinks on Embryonix
            
       % rm www; ln -s /research/zprod/www_homes/zfin.org www
       % rm mirror_src; ln -s /research/zprod/users/mirror mirror_src
       % rm mirror_dest; ln -s /research/zprod/ftp/pub/transfer/Mirror/site mirror_dest

        STATUS:  done: 12:57


     8. Create all the outgoing data transfer files

        As informix on helix
 
        % cd server_apps/data_transfer
        % gmake push

	do not do this, updates never turned on, exist already from rsync.

    10. Take level 0 dump

        As informix on helix

        % ontape -s -L 0 

    11. Update tomcat server.xml file
       
        As yourself on helix

        % cd /private/apps/tomcat/conf

        % co -l server.xml

        Edit server.xml change the jdbc connection section:

        Change
        <Resource
        name="jdbc/zfinDatabase"
        ...
        url="jdbc:informix-sqli://helix.cs.uoregon.edu:2005:INFORMIXSERVER=wildtype;user=zfinner;password=Rtwm4ts" />

        To
        <Resource
        name="jdbc/zfinDatabase"
        ...
        url="jdbc:informix-sqli://zfin.org:2005:INFORMIXSERVER=wildtype;user=zfinner;password=Rtwm4ts" />


    12. Update helix apache configuration files
      
        As yourself on Helix

        % cd /private/httpd/conf
        % cp httpd.conf.main.bkup.071002 httpd.conf
        % ci -u httpd.conf.main
   
	done: 1:01
    13. Stop tomcat and apache on Embryonix

         As self on Helix

         % sudo /private/apps/tomcat-5.5.15/bin/startStop.sh stop
      
         % sudo /private/httpd/bin/apachectl stop


    14. Archive the catalina.out file, and start a fresh one 

         As self on helix
        
         % cd /private/apps/tomcat/logs
         % gzip -c catalina.out > catalina.out.gz
         % sudo touch catalina.out
         % ls -l catalina.out
     
	done: 1:02 -- we don't need the test.

    15. Copy the Apache log files from embryonix back

        As yourself on embryonix:
        % cp -f /private/httpd/logs/zfin.org/access_log /research/zusers/staylor/Temp/logs071002/
        % cp -f /private/httpd/logs/zfin.org/error_log /research/zusers/staylor/Temp/logs071002/

        As yourself on helix:
        cd /private/httpd/logs/zfin.org 
        sudo cp -f /research/zusers/staylor/Temp/logs071002/access_log . 
        sudo cp -f /research/zusers/staylor/Temp/logs071002/error_log . 
        (sudo chown root:zfishweb *_log)

	

    17. Take the informix server down on helix
 
        As informix on helix:
        onmode -k

        STATUS: done: 1:04pm


   18. Update production server's INFORMIXSQLHOSTS file

        Wanda's INFORMIXSQLHOSTS file is at
        /private/apps/Informix/informix/etc/sqlhosts

        Change 
        wanda ontlitcp helix.cs.uoregon.edu zfin_tli

        to
        wanda ontlitcp zfin.org zfin_tli

        STATUS:  done: 1:04pm


   19. Get systems to swap zfin.org from the development server to the 
       production server.
 
      STATUS:done: 1:43


   20. Start Apache and Tomcat

         As self on Helix
 
         % sudo /private/httpd/bin/apachectl start

         % sudo /private/apps/tomcat-5.5.15/bin/startStop.sh start

	 STATUS:done

   21. Bring up informix

       as informix on helix

       In a new shell
       % srchelix
       % oninit
       
       STATUS:
	
   22. Test that you can get to zfin.org, zirc links ...

   23. State ontape on hliex

       As informix on helix
       % cdhleix
       % cd server_apps/DB_maintenance
       % gmake dumplogscontinuous

       STATUS:

   24. Start cron on the production server and restart it on the development server.

      As informix on helix
      % cd server_apps/cron
      % gmake start

      As informix on embryonix
      % srcalmost
      % cdalmost
      % cd server_apps/cron
      % gmake startdevl

      STATUS: 


   25. Enable updates on zfin.org.

      As informix on helix

      % echo 'update zdb_flag set zflag_is_on = "f", zflag_last_modified = CURRENT 
             where zflag_name = "disable updates"' | dbaccess zfindb


   26. Notify all that zfin.org is back, but need to take down apache
       and informix on embryonix


   27. Restore httpd.conf on Embryonix
       as self on embryonix
       % cd /private/httpd/conf
       % cp httpd.conf.bkup.071002 httpd.conf
       % ci -u httpd.conf

       done 
   28. Restore tomcat server.xml on Embryonix
       % cd /private/apps/tomcat/conf

        Change
        url="jdbc:informix-sqli://zfin.org:2002:INFORMIXSERVER=wanda;user=zfinner;password=Rtwm4ts" />

        To    
        url="jdbc:informix-sqli://embryonix.cs.uoregon.edu:2002:INFORMIXSERVER=wanda;user=zfinner;password=Rtwm4ts" />
       
       % ci -u server.xml

   28. Take down apache, tomcat and informix on embryonix

      as yourself on embryonix

      % sudo /private/httpd/bin/apachectl stop
      % sudo /private/apps/tomcat-5.5.15/bin/jsvc-src/native/startStop.sh stop

      as informix on embryonix

      onmode -k


   29. update the INFORMIXSQLHOSTS file on wanda
       %cd /private/apps/Informix/informix/etc/sqlhosts
 
       wanda  ontlitcp embryonix.cs.uoregon.edu zfin_tli

   30. Bring informix up on embryonix
 
       As informix on embryonix

       start a new shell
       srcalmost
       oninit

       done: 1:51
   31. Bring apache and tomcat up on embryonix

      % sudo /private/httpd/bin/apachectl startssl
      % sudo /private/apps/tomcat-5.5.15/bin/jsvc-src/native/startStop.sh start


   32. Check that test sites are back, quicksearch works.

       check access log

       done: people are accessing zfin.org



--------------------------------------------------------------------------------------------
   33. Clean up filesystems and databases on Embryonix

      Drop zfindb on wanda/embryonix.
        % echo 'drop database zfindb' |dbaccess
	done.

      drop the ZFIN_WWW source tree and the www_homes/embryonix dest tree.

      leave it here for now.

      Clear out the imageLoadUp directories.
        Need a script to do all these. 

	leave it here for now.
      Clear out FTP directory.
      leave it here for now.