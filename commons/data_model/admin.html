<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<TITLE>System, Web Server, and Database Administration, ZFIN Documentation
<br>
This documentation is preserved for historical purposes, and NOT updated. Updated documentation is found here: <a href="http://almost.zfin.org/doc">http://almost.zfin.org/doc</a><br>
</TITLE>

<link rel=stylesheet href="doc.css" type="text/css">

<style type="text/css">
  td.equip {
    font-size: smaller
  }
  th.equip {
    font-size: smaller
  }
</style>


</HEAD>

<script language="JavaScript" src="/header.js" type="text/javascript"></script>

</td></tr></table>

<div class="zdoc">

<CENTER>
<h1>ZFIN Documentation:<br>System, Web Server, and Database Administration
<br>
This documentation is preserved for historical purposes, and NOT updated. Updated documentation is found here: <a href="http://almost.zfin.org/doc">http://almost.zfin.org/doc</a><br>
</H1>

<p>$Id: admin.html,v 1.60 2007-12-27 23:22:05 peirans Exp $

<p><a href="index.html">Back to Table of Contents</a>
<br><a href="standards.html">Previous Section</a>

</CENTER>

<p>This document is one of several that describe the Zebrafish Information
Network, or ZFIN.  This document focuses on administrative tasks related to
maintaining ZFIN machines, web servers, and databases.

<!-- =================================================================== -->
<!-- ========= Database Administration ================================= -->
<!-- =================================================================== -->

<h1 class="zdoc"><a name="Database Administration">Database Administration</a></h1>

<p>ZFIN uses the Informix database management system.  Everything described
in this section is relevant to Informix.  Informix is also used in the 
CIS department for instructional purposes.  The instructional copy of 
Informix is mostly maintained by CIS folks (Paul Bloch and Chris Wilson
as of 2001/06). 
Before IBM bought Informix in 2001, ZFIN got upgrades for CIS.  Now,
CIS has gotten its own free copies of Informix through the IBM Scholars
program.


<!-- ========= Products and Licenses =================================== -->

<h2 class="zdoc"><a name="Products and Licenses">Products and Licenses</a></h2>


<h3 class="zdoc"><a name="Informix Dynamic Server">Informix Dynamic Server</a></h3>

<p>This is the Informix server/engine.  The name is often abbreviated as
IDS.  IDS is the name applied to anything in the 9.x line of Informix 
products.  ZFIN came into the Informix world at around 9.13, so this is 
all we have ever had.

<p>In the summer of 2003 we switched from IDS 9.21/32 bit to IDS 9.30/64 bits.
In the spring of 2004 we upgraded from IDS 9.30 to IDS 9.40.

<p>Informix Connect and <a href="#Informix Server Administrator (ISA)">ISA</a>
currently come bundled with IDS.


<h3 class="zdoc"><a name="Client SDK">Client SDK</a></h3>

<p>Client SDK contains 
several application programming interfaces (APIs) needed to develop
applications for Informix servers.  These include
<ul>
 <li>ESQL/C
 <li>Informix Object Interface for C++
 <li>Informix GLS
 <li>Informix ODBC Driver with MTS support
 <li>Password CSM
 <li>LIBMI for Client Applications
</ul>
<p>This used to be available for free from Informix and then IBM, but IBM has
resumed charging for it.

<p>ZFIN supports both a 32 bit and 64 bit versions of Client SDK.  The 
64-bit version is installed in the same directory as the IDS engine.
The 32 bit version is available through the 

<div class="fileline">
/private/apps/Informix/ClientSDK.32bits
</div>

<p>sym link for 32 bit clients.  The 32-bit Client SDK is currently used by 
<a href="#PERL">PERL</a>, and the 64-bit Client SDK is used by everything else, 
including <a href="#Apache and Web Datablade Administration">Apache</a>.

<p>Since the 64 bit Client SDK is installed in the default INFORMIXDIR, you
will get that version by default.  If you ever want to use the 32 bit 
Client SDK, you will need to redefine your INFORMIXDIR:

<div class="shellline">
setenv INFORMIXDIR /private/apps/Informix/ClientSDK.32bits
</div>



<h3 class="zdoc"><a name="Informix Server Administrator (ISA)">
             Informix Server Administrator (ISA)</a></h3>

<p>Informix Server Administrator (ISA) is a web based tool for managing 
Informix engines.  It is a free product that became available in 2000 and 
that we installed at ZFIN in 2001/11.  It is basically 
a graphical user interface for all the <span class="shell">on*</span> commands.
It makes
monitoring the engine much easier.


<table class="zdoc"> 
 <caption>To invoke ISA, goto these URLs</caption>
 <tr>
  <th>Machine</th>
  <th>URL</th>
 </tr>
 <tr>
  <td><a href="impl.html#Production Server">Production Server</a></td>
  <td><a href="http://helix.cs.uoregon.edu:2006">helix.cs.uoregon.edu:2006</a></td>
 </tr>
 <tr>
  <td><a href="impl.html#Development Server">Development Server</a></td>
  <td><a href="http://embryonix.cs.uoregon.edu:2006">embryonix.cs.uoregon.edu:2006</a></td>
 </tr>
</table>

<p>These URLs are only accessible from a very limited set of IP addresses

<p>You will need to "log in" to ISA in order to use it.  The login for ISA is
"zfinisa".  This is a read-only login.  If you need the password, talk to
Dave C or Sierra.  (ISA also supports logins that allow 
you to update things in Informix.  However, we don't use this capability
at ZFIN.  All changes are done through the shell.)



<h3 class="zdoc"><a name="Verity Text Search Datablade">
             Verity Text Search Datablade</a></h3>

<p>This datablade supports search engine like searches of text fields in 
Informix.  
This was evaluated for inclusion in ZFIN by Brock Sprunger in 2001.  We
had all sorts of trouble with it badly hanging the Informix engine.  One 
of the problems was that if a table had an HTML column in it, then adding
Verity indexes to it would certainly cause the server to crash.  However,
even after changing 
<a href="db.html#LVARCHAR, CLOB, and HTML">HTML columns to CLOBs</a>, 
Brock could still reliably crash 
the engine (although not quite as easily).  

<p>At the 2001 IBM Informix Conference, I was told 2 things:
<ol>
  <li>The handling of HTML data types would greatly improve in IDS 9.30.
    In theory this might let us keep our columns as HTML.
  <li>Datablades tend to play fast and loose with Informix engine user 
    stack space.  Error checking for stack overflow is sporadic at best.
    When we were doing the Verity testing user stack space was limited to
    32K.  We have since increased it to 128K.  It is quite possible that
    the space required by both Web DataBlade, which defines the HTML datatype,
    and the Verity Text Search DataBlade, would always overflow the 32K
    limit.  It is also possible that Verity on its own, could also overflow
    a 32K limit.
</ol>

<p>The plan was to reevaluate Verity when we went to IDS 9.30.
However, at the 2002 IBM Data Management Conference I learned that Verity 
was no longer sold by IBM.  They could not work out an agreement with
Verity.  This was confirmed by the most recent IBM-Informix White Paper, 
which mentioned several datablades, but not Verity at all.  

<p>I also was later told by someone in IBM, that Verity support would go
away entirely at the end of 2003.

<p>So, in the fall of 2002, ZFIN decided that Verity was not a part of its
future, since IBM was no longer promoting it or enhancing it.  

<p>Full text searches of the database and the web site became a big issues in
2003 and 2004.  The <a href="impl.html#Uniquery">Uniquery</a> work addresses
this, as does FogBUGZ
<a href="http://zfinwinserver1.uoregon.edu/fogbugz/default.asp?pg=pgEditBug&amp;command=view&amp;ixbug=461">case 461</a>.





<h3 class="zdoc"><a name="Licenses">Licenses</a></h3>

<p>Before Informx 9.4, each Informix product that ZFIN used had a serial
number that had to be used when installing the product and when dealing
with IBM support.  However, starting with 9.4 there are no more serial
numbers.  The current license is shown in <b>bold</b>.

<table class="zdoc">
 <caption>
  <b><a href="impl.html#Production Server">Production</a> Licenses</b>
 </caption>
 <tr>
  <th>Product
  <th>Version
  <th>Went Live
  <th>Serial #
 </tr>
 <tr>
  <td><b>IBM Informix Dynamic Server</b>
   <br>&nbsp;&nbsp;IBM Informix Dynamic Server
   <br>&nbsp;&nbsp;IBM Informix Dynamic Server
   <br>&nbsp;&nbsp;Informix Internet Foundation
  </td>
  <td><b>9.40.FC5</b>
   <br>9.40.FC3
   <br>9.30.FC3 (64-bit)
   <br>9.21.UC4-1 (32-bit)
  </td>
  <td><b>2004/11/30</b>
    <br>2004/04/16
    <br>2003/08/19
    <br>2001/03/30
  </td>
  <td>
    <br>
    <br>ACP#J267193
    <br>AAD#J118100
  </td>
 </tr>
 <tr>
  <td><b>Client SDK, 64-bit</b>
   <br>&nbsp;&nbsp;Client SDK, 64-bit
  </td>
  <td><b>2.81.FC2R1</b>
   <br>2.70.FC5
  </td>
  <td><b>2004/04/16</b>
   <br>2003/08/19
  </td>
  <td>
   <br>ACP#J267193
  </td>
 </tr>
 <tr>
  <td><b>Client SDK, 32-bit</b>
   <br>&nbsp;&nbsp;Client SDK
   <br>&nbsp;&nbsp;Client SDK
   <br>&nbsp;&nbsp;Client SDK (free)
  </td>
  <td><b>2.90.UC1</b>
   <br>2.81.UC3
   <br>2.70.UC5
   <br>2.60.UC1
  </td>
  <td><b>2005/03/23</b>
   <br>2004/04/16
   <br>2003/08/19
   <br>2001/03/30
  </td>
  <td><br>
   <br>ACP#J267193
   <br>ACN#J334914
  </td>
 </tr>
 <tr>
  <td><b>Informix Server Administrator (ISA)</b>
   <br>&nbsp;&nbsp;Informix Server Administrator (ISA) (bundled)
   <br>&nbsp;&nbsp;Informix Server Administrator (ISA) (free)
  </td>
  <td><b>1.50.UC3</b>
   <br>1.50.UC2
   <br>1.40.UC3
  </td>
  <td><b>2004/11/30</b>
   <br>2004/04/16
   <br>2002/01/29
  </td>
  <td>
   <br>
   <br>ACN#J334914
  </td>
 </tr>
 <tr>
  <td><b>Web Datablade</b>
   <br>&nbsp;&nbsp;Web Datablade
   <br>&nbsp;&nbsp;Web Datablade
  </td>
  <td><b>4.13.FC3</b>
   <br>4.13.FC2 (64-bit)
   <br>4.13.UC2 (32-bit)
  </td>
  <td><b>2004/11/30</b>
   <br>2003/08/14
   <br>2003/04/22
  </td>
  <td>
   <br>ACP#J267193
   <br>AAD#J118100
  </td>
 </tr>
 <tr>
  <td><b>JDBC</b>
   <br><b>JDBC</b>
   <br>&nbsp;&nbsp;JDBC
  </td>
  <td><b>3.00.JC1</b>
   <br><b>2.21.JC6</b>
   <br>2.21.JC2
  </td>
  <td><b>2005/03/09</b>
    <br><b>2004/11/30</b>
    <br>2002/08/28
  <td><br>
  </td>
 </tr>
</table>

<table class="zdoc">
 <caption>
  <b><a href="impl.html#Development Server">Development</a> Licenses</b>
 </caption>
 <tr>
  <th>Product
  <th>Version
  <th>Went Live
  <th>Serial #

 <tr>
  <td><b>IBM Informix Dynamic Server</b><br>
      &nbsp;&nbsp;IBM Informix Dynamic Server<br>
      &nbsp;&nbsp;IBM Informix Dynamic Server<br>
      &nbsp;&nbsp;Informix Internet Foundation
  </td>
  <td><b>9.40.FC5</b><br>
      9.40.FC3<br>
      9.30.FC3 (64-bit)<br>
      9.21.UC4-1 (32-bit)
  </td>
  <td><b>2004/11/07</b><br>
      2004/03/18<br>
      2003/06/29<br>
      2001/02/25
  </td>
  <td><br>
      <br>
      ACP#J267193<br>
      AAD#J120526
  </td>
 </tr>
 <tr>
  <td><b>Client SDK, 64-bit</b><br>
      &nbsp;&nbsp;Replaced: Client SDK<br>
  </td>
  <td><b>2.81.FC2R1</b><br>
      2.70.FC5
  </td>
  <td><b>2004/03/18</b><br>
      2003/06/29
  </td>
  <td><br>
      ACP#J267193
  </td>
 </tr>
 <tr>
  <td><b>Client SDK, 32-bit</b><br>
      &nbsp;&nbsp;Client SDK<br>
      &nbsp;&nbsp;Client SDK<br>
      &nbsp;&nbsp;Client SDK (free)
  </td>
  <td><b>2.90.UC1</b><br>
      2.81.UC3<br>
      2.70.UC5<br>
      2.60.UC1
  </td>
  <td><b>2005/03/08</b><br>
      2004/03/18<br>
      2003/06/29<br>
      2001/02/25
  </td>
  <td><br>
      <br>
      ACP#J267193<br>
      ACN#J334914
  </td>
 </tr>
 <tr>
  <td><b>Informix Server Administrator (ISA)</b><br>
      &nbsp;&nbsp;Informix Server Administrator (ISA) (bundled)<br>
      &nbsp;&nbsp;Informix Server Administrator (ISA) (free)
  </td>
  <td><b>1.50.UC3</b><br>
      1.50.UC2<br>
      1.40.UC3
  </td>
  <td><b>2004/11/07</b><br>
      2004/03/18<br>
      2001/11/29
  </td>
  <td><br>
      <br>
      ACN#J334914
  </td>
 </tr>
 <tr>
  <td><b>Web Datablade</b><br>
      &nbsp;&nbsp;Web Datablade<br>
      &nbsp;&nbsp;Web Datablade
  </td>
  <td><b>4.13.FC3</b><br>
      4.13.FC2 (64-bit)<br>
      4.13.UC2 (32-bit)
  </td>
  <td><b>2004/11/07</b><br>
      2003/06/29<br>
      2003/04/22
  </td>
  <td><br>
      ACP#J267193<br>
      AAD#J120526
  </td>
 </tr>
 <tr>
  <td><b>JDBC</b><br>
      <b>JDBC</b><br>
      &nbsp;&nbsp;JDBC
  </td>
  <td><b>3.00.JC1</b><br>
      <b>2.21.JC6</b><br>
      2.21.JC2
  </td>
  <td><b>2005/03/09</b><br>
      <b>2004/11/07</b><br>
      2002/08/28
  <td><br>
  </td>
 </tr>
</table>



<!-- ========= Dealing With IBM Corporation ============================ -->

<h2 class="zdoc"><a name="Dealing With IBM Corporation">
                          Dealing With IBM Corporation</a></h2>



<h3 class="zdoc"><a name="History">History</a></h3>

<p>The original title of this section was "Dealing With Informix Corporation".
IBM purchased Informix on 2001/07/01.  This did not change how we got support
until 2002/07.  Our support contracts with Informix had been from July to July
and during that first year we just renewed our old support agreement.  
However, by 2002/07, IBM was actively migrating former Informix customers
to their 
<a href="#IBM Passport Advantage Support">Passport Advantage</a> support 
program.  It took ZFIN until 2002/12
to actually get the kinks worked out of the new setup.

<p>The information in the remainiing parts of this section may not be
entirely reliable.  I am doing my best to update them as I find out how
things are done under Passport Advantage.  However, some of them may 
still describe the old Informix support.

<p>Prior to the IBM buyout, 
ZFIN and CIS got their Informix licenses through the Informix Software
Grant Program.  The two departments paid a total of $1500/year for maintenance
and that is all.  Diana Tetro 
(<a href="mailto:diana@prospero.uoregon.edu">diana@prospero.uoregon.edu</a>)
from Purchasing in Molecular Biology handled the contract on the UO end.

<p>Our primary contact at Informix for the grants program was Diane Nicola.
As near as anyone can tell, Diane has since left IBM.  Verdette Wilkins,
650-926-6079, was the IBM employee (a former Informix employee as well) who
helped ZFIN migrate from Informix support to Passport Advantage.


<h3 class="zdoc"><a name="IBM Scholars Program">IBM Scholars Program</a></h3>

<p>The IBM Scholars Program allows registered scholars to get almost every 
piece of software they make for free.  This includes Informix products (and 
DB2 and WebSphere products if we ever get to that).  The downside of the
scholars program is that you only get web support for anything you get 
through it.
Also, not all versions of all products are available through the Scholars 
Program.  See below.

<p>ZFIN made the decision <i>not</i> to use the Scholars Program for support
reasons.  ZFIN uses IBM's
<a href="#IBM Passport Advantage Support">Passport Advantage</a> support
for all IBM products used in the ZFIN web site.

<p>We do this for several reasons:
<ul>
  <li>Telephone support.  Anything we use in the web site, is considered
     important and therefore we are willing to pay to support it.
  <li>The 64-bit versions of the Informix product line are not available
     through the Scholars program.
  <li>The Web Datablade is not available through the scholars program.
</ul>

<p>The URL for the Scholars Program is

<center>
<p><a href="http://www-3.ibm.com/software/info/university/">
            http://www-3.ibm.com/software/info/university/</a>
</center>
<p>Once there you can get software by clicking on the "Downloads & CDs"
link, and then on the "Download now" button.  You will then need to login.
<table>
  <tr>
    <td>Username</td>
    <td>clements@cs.uoregon.edu</td>
  </tr>
  <tr>
    <td>Password</td>
    <td>See Dave C.</td>
  </tr>
</table>

<p>CIS decided to go with the Scholars Program for all of its Informix
products and support.  Therefore, ZFIN is no longer directly involved in
getting them new copies of Informix products or in getting them support.



<h3 class="zdoc"><a name="IBM Passport Advantage Support">
             IBM Passport Advantage Support</a></h3>

<p>Passport Advantage is IBM's paid support program.  ZFIN pays about 
$17,500/year
to support its 2 Informix engines, Web Datablade licenses for 6 CPUs, and 
Client SDKs for 20 seats.  

<p>The contract for the Informix engines (about $10K of the total) 
expires on 07/31 of every 
year.  We renew it through Diana Tetro in the MolBio purchasing office.  Each
of the 2 licenses is for 30 users.  As of 2002/12 all of the paperwork for this 
is in Dave C's office in his filing cabinet in a folder titled "Informix".

<p>ZFIN uses Passport Advantage for two things:

<ol>
  <li><a href="#Bug Reporting">Bug Reporting</a>:  This is done over
    the phone.  
  <li><a href="#Upgrades">Upgrades</a>:  This is done over the web.
</ol>

<p>In order to do either of these things you will need some information.

<table>
  <tr>
    <td>Contract Number (2002-2004)</td>
    <td>111669</td>
  </tr>
  <tr>
    <td>Passport Advantage Site Number (2002-2003)</td>
    <td>7377672</td>
  </tr>
  <tr>
    <td>IBM Customer Number</td>
    <td>9102304 (formerly 9095156, not sure why it changed)</td>
  </tr>
</table>

<p>Our contact person for problems with our Passport Advantage support
is Chrissy Dowds, 1-888-278-5586, x32714 (as of 2004/06).

<p>The URL for Passport Advantage is

<div class="urlline">
<a href="http://www.ibm.com/software/passportadvantage">
         http://www.ibm.com/software/passportadvantage</a>
</div>
<p>Once there, to login, click on the "Customer Site" link on the right hand
side.  This will bring up a login screen:
<table>
  <tr>
    <td>Username</td>
    <td>zfin</td>
  </tr>
  <tr>
    <td>Password</td>
    <td>See Dave C.</td>
  </tr>
</table>

<p>From there I think the 2 interesting links are the "Account Information"
and "Manage Your Account" links.



<h3 class="zdoc"><a name="Bug Reporting">Bug Reporting</a></h3>

<p>ZFIN traditionally tries to deal with bugs by 
looking for workarounds.  If we can find a workaround we generally use it
and do not report the bug to IBM.  However, if you can't find a 
workaround, you will have to contact IBM Informix support.

<p>Before contacting Informix support you should have at least ZFIN's
<a href="#IBM Passport Advantage Support">IBM Passport Advantage</a>
Agreement and Site numbers.  In addition, you may also need the 
<a href="#Licenses">serial number</a> of the product you are having 
trouble with. 
I don't know yet if IBM requires the serial number or not.

<p>It is also often helpful to have an e-mail describing the problem typed
up and ready to send.  

<p>The best way to contact support is through the phone.  Their support
has a huge phone menu, almost all of which you can ignore.  The phone 
menu is documented in the <i>Customer Service Quick Reference Guide</i>.
To open a case:
<ol>
 <li>Dial 1 800 274 8184.
 <li>Follow the instructions.
</ol>

<p>You will then speak with someone who is familiar with IDS.
If they can't solve your problem immediately they will open a case and give
you a case number.  Hang on to that case number.  You will need it in every
subsequent communication about the problem.  They will also give you their
e-mail address and typically ask you to send them some information.

<p>Support will typically come up with workarounds for problems rather than
fix them outright.  Occasionally they will recommend that you upgrade.
No matter what, they will not close the case until you agree to it.




<h3 class="zdoc"><a name="Upgrades">Upgrades</a></h3>

<p>Upgrades are available through the
<a href="http://www.ibm.com/software/passportadvantage">Passport Advantage</a>
web site.  
<ol>
  <li>Log on as described in the 
    <a href="#IBM Passport Advantage Support">IBM Passport Advantage Support</a>
    section above.
  <li>Click on "Account Information".
  <li>Click on "Software Download".
  <li>This brings up a form that is already filled in.  I recommend changing
    one item in the form:  limit the platform to Solaris.  Click on the submit
    button.  
  <li>Select the item you want to download.
</ol>




<h3 class="zdoc"><a name="Online Resources">Online Resources</a></h3>

<p>The pages are good sources of information:

<table>
 <tr>
  <td>Informix documentation</td>
  <td><a href="http://www-3.ibm.com/software/data/informix/pubs/library/">
               http://www-3.ibm.com/software/data/informix/pubs/library/</a></td>
 </tr>  
 <tr>
  <td>IBM Informix Homepage</td>
  <td><a href="http://www.ibm.com/informix">
               http://www.ibm.com/informix</a></td>
 </tr>  
 <tr>
  <td>IIUG Software Repository</td>  
  <td><a href="http://www.iiug.org/software/index.html">
               http://www.iiug.org/software/index.html</a></td>
 </tr>  
 <tr>
  <td>Informix Answers Online</td>  
  <td><a href="http://www.ibm.com/software/data/informix/pubs/library">
               http://www.ibm.com/software/data/informix/pubs/library</a></td>
 </tr>  
 <tr>
  <td>Informix Product Family News</td>  
  <td><a href="http://www.ibm.com/software/data/informix/news">
               http://www.ibm.com/software/data/informix/news</a></td>
 </tr>  
 <tr>
  <td>Informix Today - Subscription & Archive</td>  
  <td><a href="http://www-306.ibm.com/software/data/informix/informixtoday">
               http://www-306.ibm.com/software/data/informix/informixtoday</a></td>
 </tr>  
 <tr>
  <td>IBM Informix Support Site</td>  
  <td><a href="http://www.ibm.com/software/data/informix/support">
               http://www.ibm.com/software/data/informix/support</a></td>
 </tr>  
 <tr>
  <td>Upcoming IBM Conferences Worldwide</td>  
  <td><a href="http://www.ibm.com/services/learning/conf">
               http://www.ibm.com/services/learning/conf</a></td>
 </tr>  
</table>



<!-- ========= Backups ================================================= -->

<h2 class="zdoc"><a name="Backups">Backups</a></h2>

<p>ZFIN has three types of backups.  The first two go hand in hand with
each other.
<ol>
 <li><a href="#Full Nightly Dump of Production Server">
               Full nightly dump of production server</a>
 <li><a href="#Logical Log Dumps as the Logs Become Full">
               Logical log dumps as the logs become full</a>
 <li><a href="#Unloads of Individual Databases">
               Unloads of individual databases</a>
</ol>


<h3 class="zdoc"><a name="Full Nightly Dump of Production Server">
             Full Nightly Dump of Production Server</a></h3>

<p>A <a href="#cron">cron job</a> 
runs under user informix on production every night.  It does
a full dump of the production server.  This dump calls ontape to dump the
entire production server.  The output of this dump can then be used,
along with the 
<a href="#Logical Log Dumps as the Logs Become Full">logical log dumps</a>,
to restore the production server from scratch.  The dump includes 
everything in the server, including the data dictionary, the root dbspace,
and any databases defined in production.

<p>Since ZFIN was migrated to Informix in 2000/03, we have not yet (as of
2004/10) had to use these nightly dumps.

<p>The cron job that creates the nightly dump is

<div class="fileline">
<a href="http://cvs.zfin.org/cvs/cvsweb.cgi/ZFIN_WWW/server_apps/DB_maintenance/dumpServer.pl">server_apps/DB_maintenance/dumpServer.pl</a>
</div>

<p>It dumps the server to disk.  It uses a bit of trickery to get ontape
to believe that a disk file is actually a tape drive in order for this to
work.  The output of the dump goes to a single file pointed by this symbolic
link:

<div class="fileline">
server_apps/DB_maintenance/data
</div>

<p>This file is removed and recreated every night.  At any point
in time, the only full system dump in existence will be the one created 
the previous night.  This file is backed up nightly by the regular
CIS backup process (networker).



<h3 class="zdoc"><a name="Logical Log Dumps as the Logs Become Full">
                          Logical Log Dumps as the Logs Become Full</a></h3>

<p>The 
<a href="#Full Nightly Dump of Production Server">nightly dump</a>
produces a snapshot of the production server at the time it was taken.
However, if you want to restore the server to some point after a nightly 
dump was made you will also need to use the logical log dumps.

<p>The logical logs are a record of changes that are made to the database.
They first exist inside Informix on the raw disk managed by Informix.  As
updates are made to the database, those updates are also written to the 
logical log.

<p>When a logical log become full, the Informix engine closes it, and then
opens a new one and starts writing to it.  ZFIN uses the 
<span class="shell">ontape</span> utility to
copy full log files from inside Informix out to the Unix file system where
they can be backed up by the CIS backup process (networker).  Once 
<span class="shell">ontape</span>
has copied the file to disk the space is marked as available for reuse 
within the Informix engine.

<p>The script that fires off ontape is

<div class="fileline">
  <a href="http://cvs.zfin.org/cvs/cvsweb.cgi/ZFIN_WWW/server_apps/DB_maintenance/dumpLogsContinuous.pl">server_apps/DB_maintenance/dumpLogsContinous.pl</a>
</div>

<p>It fires off <span class="shell">ontape</span> in continuous logging mode.  
<span class="shell">ontape</span> stays up for 
as long as the Informix engine is up, and writes full logical logs to disk
as they become full.  As with the nightly backups, we lie to 
<span class="shell">ontape</span> to get 
it to believe that a disk file is actually a tape drive.  

<p>The disk file that 
<span class="shell">ontape</span> writes to is pointed to by this symbolic link:

<div class="fileline">
  server_apps/DB_maintenance/logs
</div>

<p>Log files are appended to this file as they become full.

<p><b>Warning:</b> The <span class="file">dumpLogsContinuous.pl</span> script is
<a href="#Startup and Shutdown"><b>not</b> automatically started</a>
when the production server is rebooted, or when the Informix engine is 
restarted.  The <span class="file">dumpLogsContinuous.pl</span> script 
must be manually started whenever
the Informix engine is restarted.  If this is not done then production will
appear to work fine for several days until it suddenly comes to a grinding 
halt when all of the logical logs fill up.  
If this happens, the first line of <span class="shell">onstat</span>
output will say "CKPT Required".  It can be started by getting to the 
DB_maintenace directory and then running gmake:
<div class="shell">
  cd ZFIN_WWW/server_apps/DB_maintenance
  gmake dumplogscontinuous
</div>




<h3 class="zdoc"><a name="Unloads of Individual Databases">
                          Unloads of Individual Databases</a></h3>

<p>The previous two sections described backups that were for an entire 
Informix engine.  Those dumps produce large binary files with which you 
can restore a corrupt engine.  However, they are often not useful for the
types of backups that ZFIN most often needs.  It is practically impossible
to use those dumps to transfer a database from one engine to another or
to reload the contents of a particular table.  That is not what those dumps
are designed for.

<p>ZFIN uses the <span class="file">unloaddb.pl</span> script for these 
purposes.  
<span class="file">unloaddb.pl</span>
unloads a single database, including the database's schema, using 
(mostly) SQL unload commands.  It produces a directory containing 
one text file for each table in the database (tables with 
<a name="impl.html#BLOBs and CLOBs">BLOB or CLOB columns</a> will 
have multiple files).
<p>Please see standards for use of BLOB/CLOB columns:
<a href="db.html#LVARCHAR, CLOB, and HTML">BLOBs (binary large objects)
and CLOBs (character large objects)</a>

<p>The output of <span class="file">unloaddb.pl</span> can be loaded with the 
<a href="impl.html#loaddb.pl"><span class="file">loaddb.pl</span></a> script,
either as a new database, or in place of an already existing database.
<span class="file">unloaddb.pl</span> and 
<a href="impl.html#loaddb.pl"><span class="file">loaddb.pl</span></a>
are both in the <a href="impl.html#ZFIN Commons">ZFIN Commons</a> bin directory.

<p><span class="file">unloaddb.pl</span> is called by <a href="#cron">cron</a>, 
5 nights a week,
to unload the production database so that it can be loaded into 
development databases as needed.  These dumps also provide ZFIN with 
useful snapshots of the state of the database on the day they were taken.
Unlike the nightly backups, ZFIN hangs onto multiple unloads of the 
production database.

<p>The more recent unloads can be found in 

<div class="fileline">
  <a href="impl.html#ZFIN Unloads">/research/zunloads</a>/databases/production/yyyy.mm.dd.n
</div>

<p>where <kbd>yyyy.mm.dd</kbd> is the date the unload was done, and 
<kbd>n</kbd> is the number of the dump taken that day, usually 1.  
Older unloads can be
found in 

<div class="fileline">
  <a href="impl.html#ZFIN Archive">/research/zarchive0</a>/databases/zfindb/
</div>

<p>Only about one unload per month is stored in the archive directory.


<!-- ========= Monitoring ============================================== -->

<h2 class="zdoc"><a name="Monitoring">Monitoring</a></h2>

<p><b>Note:</b>  This section was written before ZFIN had installed
<a href="#Informix Server Administrator (ISA)">ISA</a>.  Many of the 
<span class="shell">on*</span> commands described here can now be done with ISA.

<p>Try to check the server every morning.  These checks work other times during
the day as well, of course, but if something goes wrong during the day, you
are likely to get a phone call about it before you notice the problem.


<h3 class="zdoc"><a name="Memory Usage">Memory Usage</a></h3>

<p>The days of running out of memory should be past, but just in case they are
not, log in and run

<div class="shell">
% top -ores

load averages:  0.00,  0.02,  0.06                                     16:25:33
115 processes: 112 sleeping, 1 zombie, 1 stopped, 1 on cpu
CPU states: 98.9% idle,  0.1% user,  0.7% kernel,  0.3% iowait,  0.0% swap
Memory: 1152M real, 24M free, 1555M swap in use, 502M swap free

  PID USERNAME THR PRI NICE  SIZE   RES STATE   TIME    CPU COMMAND
  587 informix   5  59  -10 1036M  617M sleep 643:39  0.00% oninit
  589 informix   5  59  -10 1036M   99M sleep 111:18  0.00% oninit
  590 informix   5  59  -10 1036M   90M sleep  44:50  0.00% oninit
  594 informix   5  59  -10 1036M   67M sleep   0:56  0.00% oninit
  588 informix   4  59  -10 1036M   67M sleep   0:01  0.00% oninit
  595 informix   4  59  -10 1036M   66M sleep   0:00  0.00% oninit
  593 informix   4  59  -10 1036M   66M sleep   0:00  0.00% oninit
  596 informix   4  59  -10 1036M   66M sleep   0:00  0.00% oninit
  591 informix   4  59  -10 1036M   66M sleep   0:00  0.00% oninit
  592 informix   4  59  -10 1036M   66M sleep   0:00  0.00% oninit
22477 informix   5  59  -10  386M   62M sleep  94:01  0.13% oninit
22479 informix   5  59  -10  386M   32M sleep 116:52  0.01% oninit
...
</div>

<p>The Memory line is important

<div class="shellline">
Memory: 1152M real, 24M free, 1555M swap in use, 502M swap free
</div>

<p>As long as the sum of the free and the swap free is at least 100 MB,
memory is fine.  It does not matter if one or the other drops to near 0,
as long as there is still space in the other

<p>Unless an informix server has been bounced recently, the SIZE column
tells you which processes belong to A or B.  The oninit's with a size of 
1036M belong to B, the production server, and those with a size of 386M
belong to test.  The maximum size of the production and test servers are
both capped at those numbers.

<p>If we are running out of memory then <a href="#rebooting">restart the
server</a>.



<h3 class="zdoc"><a name="Informix Server Status - onstat">Informix Server Status - onstat</a></h3>

<p>onstat is the usual process for monitoring the status of the database:

<div class="shell">
% onstat 

Informix Dynamic Server 2000 Version 9.20.UC2  -- On-Line -- Up 17 days 18:46:29 -- 1048576 Kbytes

Userthreads
address  flags   sessid   user     tty      wait     tout locks nreads   nwrites
e0d2018  ---P--D 1        informix -        0        0    0     2155     13667
e0d25d8  ---P--F 0        informix -        0        0    0     0        78273
e0d2b98  ---P--F 0        informix -        0        0    0     0        37934
e0d3158  ---P--F 0        informix -        0        0    0     0        34596
e0d3718  ---P--- 5        informix -        0        0    0     0        1820
e0d3cd8  ---P--B 6        informix -        0        0    0     27       1524
e0d4e18  ---P--M 9        informix 12       0        0    0     0        0
e0d5f58  ---P--D 13       informix -        0        0    0     14       0
 8 active, 128 total, 21 maximum concurrent

Profile
dskreads pagreads bufreads %cached dskwrits pagwrits bufwrits %cached
1026307  4898384  867193765 99.88   309164   2452435  3265074  90.53  

isamtot  open     start    read     write    rewrite  delete   commit   rollbk
719812284 53898854 58036138 486726929 1262800  132010   65721    9703     9

gp_read  gp_write gp_rewrt gp_del   gp_alloc gp_free  gp_curs 
20682    18       372      15       0        0        48      

ovlock   ovuserthread ovbuff   usercpu  syscpu   numckpts flushes 
0        0            0        48017.15 473.98   2444     10012   

bufwaits lokwaits lockreqs deadlks  dltouts  ckpwaits compress seqscans
59417    0        623811662 0        0        54       48202    263714  

ixda-RA  idx-RA   da-RA    RA-pgsused lchwaits
14707    2        468407   481982     496435  
</div>

<p>In this example output, the database is idle.  There are only 8 users 
listed, all of them are informix, and none of them hold locks.  If someone
is accessing the database their login will show up in the list.  

<p>Accesses that come in through the web pages show up as user zfinner.
These are usually fleeting.  However, occasionally, a user will request a 
query that takes a while to run.  In such cases other users may back up 
behind that zfinner's request.  If you see more than 3 zfinner users in the 
output of onstat then watch the database closely for the next 2 minutes.  If 
the logjam doesn't break then the server might be in trouble and it might
be good to <a href="#rebooting">restart the server</a>.

<p>The first line of output is also important:

<div class="shellline">
Informix Dynamic Server 2000 Version 9.20.UC2  -- On-Line -- Up 17 days 18:46:29 -- 1048576 Kbytes
</div>

<p>The important part there is the "-- On-Line --"  Other options are 
"-- Quiescent --", which means the DB is up and running, but it's not letting 
any users in.  It shouldn't ever be in Quiescent state unless you put it 
there explicitly or the server is in the process of coming up after a reboot.

<p>If the database is down entirely, instead of getting an onstat
report, you will get 

<div class="shellline">
shared memory not initialized for INFORMIXSERVER 'server_name'
</div>

<p>in which case the server needs to be <a href="#starting.server">started</a>.

<p>If you get something other than an onstat report or the "shared memory not
initialized" error, then the DB is in a bad shape, and is not likely to be 
brought down through normal techniques.  See <a href="#badly.broken">"Dealing
with a badly broken server"</a> below.


<p>Another possibility for the first line of the onstat report is:

<div class="shell">
Informix Dynamic Server 2000 Version 9.20.UC2   \
  -- On-Line (CKPT REQ) -- Up 12 days 20:48:45 -- 753664 Kbytes
Blocked:CKPT 
</div>

<p>This means that the transaction logs have filled up.  And what that probably
means is that the last time the Informix server was rebooted (probably about 
7-10 days before this happens), that ontape was not started.  ontape runs in
the background and copies logs from informix raw disk to cooked disk where 
they are then backed up to tape.  See the <a href="#starting.ontape">"Starting 
ontape"</a> section below for more information.

<p>See the <a href = "#solutions">"Solutions"</a> section below for what to do 
about all these problems.

<p>%onstat -g ses [session id] : gives a detailed view of a particular session 

<p>%onstat -g : will give a list of all onstat commands<br>

<p>The options and output of onstat are explained in the
Informix Administrator's Reference.




<h3 class="zdoc"><a name="Active Queries">Active Queries</a></h3>

<p>The best way we know to display what queries are running in the server 
right now is to run this query against the sysmaster database:
<div class="sql">
select sqs_sessionid, sqs_statement
  from syssqlstat
  where sqs_statement &lt;&gt; "-"
    and sqs_statement not like "select sqs_sessionid%";
</div>

<p>This is far from perfect.  It only displays the first 200 characters of the 
query.  However, it works better than any other query we have found.  These
two queries tell us something, but we aren't sure what:
<div class="sql">
select scs_sqlstatement
  from syssqlcurses
  where scs_sqlstatement &lt;&gt; ""
    and scs_sqlstatement not like "select scs_sqlstatement%";

select sqx_sqlstatement
  from syssqexplain
  where sqx_sqlstatement not like "select sqx_sqlstatement%"
    and sqx_sqlstatement not like "create view %syssqexplain%"
    and sqx_sqlstatement &lt;&gt; "";
</div>

<p>Finally, onstat can also be used to monitor active queries:<br><br>
<table>
 <tr>
  <td valign="top"><span class="shell">onstat&nbsp;-g&nbsp;sql</span></td>
  <td>Displays all databases currently executing queries and
      what SQL keyword is currently being executed by these databases.
  </td>
 </tr>
 <tr>
  <td valign="top"><span class="shell">onstat&nbsp;-g&nbsp;stm</span></td>
  <td>Displays all current sql statements.  Statements executed
      via the web (through webexplode) usually are not very informative, as the
      database statement being executed is 'webexplode' (which is displayed in
      this output as 'EXECUTE FUNCTION'.
  </td>
 </tr>
</table>




<h3 class="zdoc"><a name="Monitoring Locks">Monitoring Locks</a></h3>

<p>A good repository for scripts that can be used for monitoring the database
can be found at <a href="http://www.iiug.org">www.iiug.org</a>.  
The script: 
<div class="fileline">
<a href="impl.html#ZFIN Commons">/private/ZfinLinks/Commons/</a>bin/locks.sh
</div>

<p>modified from one found at www.iiug.org) shows the locks currently in
use on an informix server.  The following is sample output from embryonix:
<div class="shell">
Lock usage report Total locks in use 8 out of 131072
----------------------------------------------------------------------------
SESSION  OWNER      DATABASE   TABLE            LEVEL     TYPE      #LOCKS
----------------------------------------------------------------------------
   32710 staylor    smartbs3   LO_hdr_partn       TABLE   INT-EX     1     
   32712 zfinner    sysmaster  sysdatabases       ROW     SHRED      1     
   32710 staylor    smartbs4   LO_hdr_partn       TABLE   INT-EX     1     
   32710 staylor    smartbs1   LO_hdr_partn       TABLE   INT-EX     1     
   32710 staylor    sysmaster  sysdatabases       ROW     SHRED      1     
   32710 staylor    smartbs2   LO_hdr_partn       TABLE   INT-EX     1     
   32710 staylor    hoovdb     fish_image         TABLE   INT-EX     1     
   32713 staylor    sysmaster  sysdatabases       ROW     SHRED      1     
   32710 staylor    smartbs2   LO_hdr_partn       ROW     EXCLV      1   
</div>
<p>The type of lock is important: <br>
SHRED: is a non-exclusive, shared lock.<br>
EXCLV: is an exclusive lock.<br>




<h3 class="zdoc">
  <a name="Monitoring Temp Table Creation and Use">
           Monitoring Temp Table Creation and Use</a>
</h3>

<p>The following query can be used against the sysmaster db to determine 
the number and names of temporary tables currently in use.
<div class="sql">
SELECT n.dbsname, n.owner, n.tabname,
              COUNT(*), SUM(i.ti_nptotal), SUM(i.ti_nrows)
        FROM systabnames n, systabinfo i
        WHERE BITVAL(i.ti_flags, "0x0020") = 1
        AND i.ti_partnum = n.partnum
        group by n.dbsname, n.owner, n.tabname
</div>


<h3 class="zdoc">
  <a name="Informix Server Status - Message Log">
           Informix Server Status - Message Log</a>
</h3>

<P>It's also a good idea to check the server message log.  The Informix 
server writes messages to the file at regular intervals (checkpoints).  
It also writes messages whenever the server encounters a 'serious' problem.
These problems don't necessarily need to be dealt with, but if the server
is acting up you might find some clues about it in the message log.

<p>The message log for production is in 

<div class="fileline">
$INFORMIXDIR/online.log
</div>

<p>The messages in the message log are explained in somewhat more detail
in the Informix Universal Server Administrator's guide, Chapter 40.



<h3 class="zdoc"><a name="Other Informix Monitoring Tools">
                          Other Informix Monitoring Tools</a></h3>

<p>At least two other tools are available:

<ol>
<li> onperf
<li> onmonitor
<li> oncheck
</ol>

<p>These are explained in the Administrator's Guide.



<!-- ========= Fixing Immediate Problems =============================== -->

<h2 class="zdoc"><a name="Fixing Immediate Problems">Fixing Immediate Problems</a></h2>

<p>The first subsection here discusses what should always be done when a
problem is encountered.  The remaining sections discuss what should be done
in response to various conditions.



<h3 class="zdoc"><a name="Run onstat -a">Run onstat -a</a></h3>
<p>The first thing to do when you think the server is having a problem to
run onstat with the -a option and save the results to a file:

<div class="shellline">
% onstat -a &gt; /tmp/onstat-a
</div>

<p>This will take a fairly complete picture of the state of the database,
and will be handy for doing the postmortem.  This usually runs in less than 
a minute.  The output of onstat is explained in the Administrator's Guide,
pages 39-75 to 39-107.



<h3 class="zdoc"><a name="Errors">Errors</a></h3>


<h4 class="zdoc"><a name="online.but.piling.up">onstat says -- On-Line --, but zfinners piling up</a></h4>

<p>In this case onstat indicates the database is alive and well, but 
response time is either very bad or infinite and has been this way for a 
couple of minutes.  My usual assumption in this case is that someone has 
a lock held and everyone else is queuing up behind it.

<p>If you can easily identify the lock holder and it's one of us, have them
log out.  If the problem doesn't go away, or if no one local has a lock then
I usually reboot the server.

<p>See the <a href="#rebooting">"Rebooting the server"</a> 
section below for how to do this.



<h4 class="zdoc"><a name="checkpoint.required">onstat says -- On-Line (CKPT REQ) --</a></h4>

<p>In this case, the transaction logs have filled up, but ontape is not 
running.  Start ontape to backup the logs.  After ontape has started the
'CKPT REQ' should go away.

<p>See the <a href="#starting.ontape">"Starting ontape"</a> section below.



<h4 class="zdoc"><a name="server.down">onstat says 'shared memory not initialized for ...'</a></h4>

<p>In this case the Informix server is entirely down and needs to be brought 
back up.  

<p>See the <a href="#starting.server">"Starting the server"</a> section below.




<h4 class="zdoc"><a name="server.screwed">onstat returns a different one line error</a></h4>

<p>If onstat does not return a list of users, or the 'shared memory not 
initialized error', but rather something else or not at all, then the server 
is in a very bad state.  It is halfway down and halfway up and it may not 
respond to a command to bring it down.

<p>To deal with this situation, see the <a href="#badly.broken">
"Dealing with a badly broken server"</a> section
below.




<!-- ========= Solutions =============================================== -->

<h2 class="zdoc"><a name="solutions">Solutions</a></h2>

<p>This section talks about the onmode command quite a bit.  The onmode 
command is discussed in detail in the Administrators Guide, Chapter 8

<p><b>All of these solutions assume you are logged in as user informix when
doing this.</b>



<h3 class="zdoc"><a name="badly.broken">Dealing with a badly broken server</a></h3>

<p>This section describes what to do when the server doesn't respond
(in a regular way) to onstat, or you have tried to stop the server
with onmode and it hasn't completely gone down.


<p>If you haven't already done so, try and kill the server with onmode:

<div class="shell">
% onmode -k 

This will take Informix Dynamic Server 2000 OFF-LINE -
Do you wish to continue (y/n)? y

There are 5 user threads that will be killed.
Do you wish to continue (y/n)? y
%
</div>

<p>If your conversation with onstat looked like the above then that is
promising.  If this took the server down, a subsequent onstat will get the following:

<div class="shell">
% onstat 
shared memory not initialized for INFORMIXSERVER 'server_name'
</div>

<p>If you get this then go to the <a href="#starting.server">
"Starting the server"</a> section below
for how to bring the server back up.

<p> If you don't get that then onmode failed to kill the server.
At this point we are indeed in deep trouble.  You will have 
to manually kill some processes and/or shared memory segments to 
bring the server entirely down.

<p>Gather information about any oninit processes that are still running:

<div class="shell">
% ps -ef | grep oninit
    root   594   588  0   Oct 02 ?        0:59 oninit
informix   590   588  0   Oct 02 ?       45:04 oninit
    root   593   588  0   Oct 02 ?        0:00 oninit
informix   587     1  0   Oct 02 ?       665:20 oninit
    root   595   588  0   Oct 02 ?        0:00 oninit
informix   589   588  0   Oct 02 ?       112:40 oninit
    root   596   588  0   Oct 02 ?        0:00 oninit
informix 11742  5338  0 15:20:20 pts/8    0:00 grep oninit
    root   592   588  0   Oct 02 ?        0:00 oninit
    root   591   588  0   Oct 02 ?        0:00 oninit
    root   588   587  0   Oct 02 ?        0:01 oninit
</div>

<p>Now identify the 'original' oninit based on its process ID and parent
process IDs.  In this case process 587 is the original oninit, since all
the other oninits were either started by 587, or started by processes that
were started by 587.

<p>After identifying the original oninit, kill it.

<div class="shell">
% kill 587
%
</div>

<p>If you are lucky (and you probably will be) this will cascade out to 
all the other oninit processes and they will die as well.  Run ps again
to check.  If their are still some oninits that are alive then you will
have to kill them individually.  If they don't respond, you will have
to kill -9 them.

<p>After all of the oninit processes have been killed you will need to 
check if all the associated shared memory segments and semaphores have also 
been killed.  To check what IPC resources are still allocated run ipcs:

<div class="shell">
% ipcs
IPC status from &lt;running system&gt; as of Fri Oct 20 15:29:43 PDT 2000
Message Queue facility inactive.
T         ID      KEY        MODE        OWNER    GROUP
Shared Memory:
m       1200   0x52574801 --rw-rw----     root informix
m       1201   0x52574802 --rw-rw----     root informix
m        703   0x52564801 --rw-rw----     root informix
m        704   0x52564802 --rw-rw----     root informix
m        905   0x52574803 --rw-rw---- informix informix
m        906   0x52574804 --rw-rw---- informix informix
m        907   0x52574805 --rw-rw---- informix informix
m        908   0x52574806 --rw-rw---- informix informix
m        909   0x52574807 --rw-rw---- informix informix
m        910   0x52574808 --rw-rw---- informix informix
m        911   0x52574809 --rw-rw---- informix informix
m        912   0x5257480a --rw-rw---- informix informix
m        913   0x5257480b --rw-rw---- informix informix
m        914   0x5257480c --rw-rw---- informix informix
m        915   0x5257480d --rw-rw---- informix informix
m        916   0x5257480e --rw-rw---- informix informix
m        917   0x5257480f --rw-rw---- informix informix
m        918   0x52574810 --rw-rw---- informix informix
m        919   0x52574811 --rw-rw---- informix informix
m        920   0x52574812 --rw-rw---- informix informix
m        921   0x52574813 --rw-rw---- informix informix
m        922   0x52574814 --rw-rw---- informix informix
m        923   0x52574815 --rw-rw---- informix informix
m        824   0x52574816 --rw-rw---- informix informix
m        825   0x52564803 --rw-rw---- informix informix
m        826   0x52564804 --rw-rw---- informix informix
m        827   0x52564805 --rw-rw---- informix informix
m        828   0x52564806 --rw-rw---- informix informix
m        829   0x52564807 --rw-rw---- informix informix
m        830   0x52564808 --rw-rw---- informix informix
m        831   0x52564809 --rw-rw---- informix informix
m        832   0x5256480a --rw-rw---- informix informix
m        833   0x52574817 --rw-rw---- informix informix
m        834   0x52574818 --rw-rw---- informix informix
m        835   0x52574819 --rw-rw---- informix informix
m        836   0x5257481a --rw-rw---- informix informix
m        737   0x5257481b --rw-rw---- informix informix
m        738   0x5257481c --rw-rw---- informix informix
m        739   0x5257481d --rw-rw---- informix informix
m        740   0x5257481e --rw-rw---- informix informix
Semaphores:
s     786432   0          --ra-ra----     root informix
s     458753   0          --ra-ra----     root informix
</div>

<p>This ipcs command was run while both test and production were up and 
running.  If you get anything reported in this list then you will need
to kill it manually.  To manually kill a shared memory sequence:

<div class="shellline">
% ipcrm -m _id_
</div>

<p>where _id_ is ID from the ipcs listing for the segment.  To kill a
semaphore enter

<div class="shellline">
% ipcrm -s _id_
</div>

<p>where _id_ is ID from the ipcs listing for the semaphore.

<p> You may need to asks Systems to kill segments or semaphores owned
by root.

<p> When all the oninits, shared memory, and semaphores are down, the 
Informix server is down.  See the section titled <a href="#starting.server">
"Starting the server"</a> for how to bring it back up.



<h3 class="zdoc"><a name="rebooting">Rebooting the server</a></h3>

<p>Use the instructions in this section if the server is still up and running
and responding to onstat.

<p>To bring the server down, run onmode:

<div class="shell">
% onmode -k

This will take Informix Dynamic Server 2000 OFF-LINE -
Do you wish to continue (y/n)? y

There are _n_ user threads that will be killed.
Do you wish to continue (y/n)? y
%
</div>

<p>To verify that it came down, run onstat:

<div class="shell">
% onstat 
shared memory not initialized for INFORMIXSERVER 'server_name'
</div>

<P>If it doesn't say that they something went wrong and you should see the
section above titled "Dealing with a badly broken server."

<p>If does say that then the server was successfully brought down and 
is ready to be brought back up.  See the <a href="#starting.server">
"Starting the server"</a> section below
for instructions on how to do that.



<h3 class="zdoc"><a name="starting.server">Starting the server</a></h3>

<p>The instructions in this section assume that the server has been brought 
down completely.  To verify that the server is down completely run onstat.
You should see:

<div class="shell">
% onstat 
shared memory not initialized for INFORMIXSERVER 'server_name'
</div>

<p>If you don't then the server is not down yet.  See either the 
<a href="#badly.broken">"Dealing with a badly broken server"</a>
section or the <a href="#rebooting">"Rebooting the server"</a> sections
above.

<p>however, if you get the above message, then the server is ready to be 
brought back up.  To bring the server back up simply run oninit.

<div class="shell">
% oninit
%
</div>

<p>After oninit has finished, run onstat to check that the server came back up.
onstat may cycle through quiescent or checkpoint required states, but within
a minute of oninit finishing the database should be online again.

<p>At this point the server is back up, but we still need to start ontape to
write the transaction logs out.  See the <a href="#starting.ontape">
"Starting ontape"</a> section below
for how to do this.




<h3 class="zdoc"><a name="starting.ontape">Starting ontape</a></h3>

<p>Whenever the server is stopped the ontape process that runs in the 
background also stops.  However, restarting the server does not automatically
restart the ontape process as well.  ontape must be manually restarted after
every server restart.  We only need to restart ontape for the production server
as all of the test servers are configured to write their logs to /dev/null.

<p>See the <a href="#Logical Log Dumps as the Logs Become Full">Logical Log 
Dumps as the Logs Become Full</a> section for information on restarting ontape.


<!-- ========= Disk Usage ============================================== -->

<h2 class="zdoc"><a name="Disk Usage">Disk Usage</a></h2>

<p>This section on disk usage could be split between this section and 
the <a href="#System Administration">System Administration</a> section,
as it pertains to both raw disk (used by Informix) and the Unix file system.
However, we cover it all here for the convenience of having it here, and 
because managing the raw disk is the hard part.

<p>Informix stores its data in raw disk partitions.  Standard Unix file IO
operations don't work on raw disk.  Instead, whatever process owns the 
raw disk takes full responsibility for IO to and from the disk.  The OS 
does not buffer IO to raw disk, and raw disk does not use the standard 
inode structure that most Unix file systems do.

<p>The following sections discuss how disk is allocated on ZFIN machines.
They attempt to show disk allocation graphically.  Two programs were used
to gather the data used to draw these diagrams.  

<p>The diagrams themselves are drawn in xfig, using the same settings
that were used to generate the other diagrams in this doc.
See the section on 
<a href="intro.html#Figures">how to update figures</a> for how
these were generated and how to update them.

<p>All offsets that are shown are in sectors.  Sectors are 512 bytes under
Solaris.  Informix usually asks for things in kilobytes or pages.  Informix page
sizes are 2048 bytes under Solaris.  
You will need to some math when
working with Informix utilities.


<h3 class="zdoc"><a name="Ownership">Ownership</a></h3>

<p>Any Unix file partitions that are used by Informix as raw disk must
be owned by user informix and have group informix and the owner and group
must have read and write privileges.



<h3 class="zdoc"><a name="RAID">RAID</a></h3>

<p>The <a href="impl.html#Production Server">production server</a>
has a Sun A1000 Storedge RAID attached to it, and the 
<a href="impl.html#Development Server">development server</a>
has an NStor 4150S RAID attached to it.  Before we 
get into the details of them, here is a primer on RAID in general and 
Sun RAID technology in particular.

<p>Without RAID, a logical disk drive and a physical disk drive are one 
and the same.  That is, what the OS thinks is a disk drive actually corresponds
to a single physical disk drive.  With RAID, the mapping between logical 
disks and physical disks is much more complicated.  What appears
as a single disk to the OS may in fact actually map to
multiple physical disk drives, and each physical disk drive may contain parts
of multiple logical disk drives.



<h4 class="zdoc"><a name="RAID Levels">RAID Levels</a></h4>

<p>RAID levels determine how logical disk drives are mapped to physical 
disk drives.  At ZFIN, there are four RAID levels of interest, 0, 1, 5 and
10 (also known as 1+0).  This document used to offer a breif description of
each level, but I dropped it because there are much better explanations on-line.

<p><a href="http://www.acnc.com/04_00.html">AC&amp;NC's RAID.edu site</a> has an
excellent graphical description of RAID levels 
<a href="http://www.acnc.com/04_01_00.html">0</a>,
<a href="http://www.acnc.com/04_01_01.html">1</a>, and 
<a href="http://www.acnc.com/04_01_05.html">5</a>.  
There is a good explanation of 
<a href="http://www.pcguide.com/ref/hdd/perf/raid/levels/multLevel01-c.html">RAID
level 10</a>
(and how it is different from RAID level 0+1/01) in the 
<a href="http://www.pcguide.com/ref/hdd/perf/raid/">PC Guide's RAID section</a>.

<p>ZFIN uses RAID 10 on the <a href="#Sun A1000 RAID">production RAID</a>
and RAID 5 on the <a href="#NStor 4150S RAID">development RAID</a>.



<h4 class="zdoc"><a name="Sun A1000 RAID">Sun A1000 RAID</a></h4>

<p>The RAID that ZFIN uses on the 
<a href="impl.html#Production Server">production server</a> is an A1000 
from Sun.
The A1000 has 
some additional terminolgy that
needs to be understood:


<table class="definition">
  <caption>A1000 RAID Terminology</caption>
  <tr>
    <td class="term">Drive Group</td>
    <td>A group of disk drives that LUNs are spread across.  This is 
      the highest level division within a RAID.  LUNs are never spread across
      multiple drive groups.  You can have up to 32 LUNs per drive group.
    </td>
  </tr>
  <tr>
    <td class="term">Logical Unit (LUN)</td>
    <td>This appears as a disk drive (not a partition) to the 
      operating system, but in fact a LUN can be distributed across multiple 
      disks within a drive group.
    </td>
  </tr>
  <tr>
    <td class="term">Hot Spare</td>
    <td>These are unused disks that automatically come online and 
      replace an active disk when that disk has a problem.
      Not dedicated to any drive group.
    </td>
  </tr>
  <tr>
    <td class="term">RAID Module</td>
    <td>The whole A1000 unit, including controller and disks is a
      RAID module.
    </td>
  </tr>
  <tr>
    <td class="term">RAID 1</td>
    <td>The Sun documentation never explicitly mentions RAID 10.  However,
      if you create a RAID 1 drive group with 4 or more physical drives in it 
      (RAID 1 drive groups must always have an even number of drives), then 
      that drive group will be implemented as RAID 10.
    </td>
  </tr>
</table>

<p>All the LUNs within a drive group must have the same RAID level.
Drive groups are created when the first LUN in them is created.

<p>The typical approach is to put as many disks as 
possible into a single drive group and then put all of your logical drives
(LUNs) into that drive group.  With the exception of temporary dbspaces,
we have does this at ZFIN.

<p>The A1000 is managed by the CS systems staff (Lauradel) using the 
Sun StorEdge RAID Manager software 
(see <a href="Products/raidusers2.ps">User's Guide</a>,
<a href="Products/raidinstall2.ps">Installation and Support Guide</a>,
<a href="Products/raidrelease2.ps">Release Notes</a>).  Lauradel has 
also typed up some documentation on how she manages the RAID.  See

<div class="fileline">
     /home/systems/sysadm/Documents/Zfin/HelixA1000.txt
</div>




<h4 class="zdoc"><a name="NStor 4150S RAID">NStor 4150S RAID</a></h4>

<p>The <a href="http://www.nstor.com">NStor</a> RAID array was purchased through
<a href="http://www.ncegroup.com">NCE Computer Group</a> in 2003/02.  It is a
<a href="Products/nexStor4000S.pdf">NexStor 4150S</a> 
(although it may be a 4120S, we aren't really sure)
Ultra 160 Dual Controller, with twelve 146 GB, 10,000 RPM disks.
In Solaris 8 and before Lauradel administered the NStor RAID with the 
<a href="Products/administorGuide.pdf">Administor Plus</a> software (a 
package that Lauradel is less than enamored with.)  However, starting with
Solaris 9, she has been reduced to using a serial connection and a 
command line interface to administer it.

<p>Although it was written with the A1000 RAID in mind, most of the 
discussion on <a href="#RAID">RAID</a> also
applies to the NStor RAID.  One key difference in terminolgy between the 
<a href="#Sun A1000 RAID">A1000</a> and the NStor, is that NStor uses the 
term "Array" instead of "Drive Group".  ZFIN documentation uses "Drive Group"
in most places.

<p>Unlike the A1000, we configured the 
NStor RAID to be RAID 5 instead of RAID 10.  The
<a href="impl.html#Development Server">development server</a> has greater space
requirements than does the
<a href="impl.html#Production Server">production server</a> and does not have 
the speed or reliability requirements that production does either.  
Therefore we went with the slightly
slower and slightly less reliable, but much more space efficient option.

<p>It also worth noting that 1 to 8 MB of space is reserved at the front of each
LUN for disk geometry.  (NStor tech support tells us that only th first 16KB 
are actually used, but the software allocates more.)  Care must be taken
when allocating partitions within LUNs to leave the first 8MB of the 
LUN as reserved.




<h4 class="zdoc"><a name="RAID and Informix">RAID and Informix</a></h4>

<p>Informix is oblivious to whether its raw disk partitions are 
on RAID or not.  Furthermore, Informix has no documentation describing
how to physically design a database that will reside on RAID.
All of their performance documentation assumes you are using non-RAID
devices.

<p>However, at the 2002 IBM Data Management conference I did get some
information on this from some Informix developers:

<ul>
  <li>If you use Kernal Asynchronous IO (KAIO), and we do, then IO requests
    will be sent to the OS as soon as Informix knows it needs IO.  What 
    happens to it after that is up the operating system.

  <li>I'm not sure what happens in Solaris, but the hope is that it just
    dumps the request off to the RAID controller and it takes care of it.

  <li>For query processing the 
    <table>
      <tr>
        <td>
	  number of concurrent IO requests = 
	</td>
	<td>
	  # of fragments for the table being read, per query
	</td>
      </tr>
    </table>

  <li>Most / all of ZFIN's large tables are 
    <a href="#Fragmentation">fragmented</a> across 3 
    <a href="#DB Spaces">DB spaces</a>.
    Therefore, any query that results in a table scan of these will 
    result in 3 concurrent IO requests.
  </li>
  <li>Note that the number of chunks in a DB space does not have any 
    impact.  The # of IOs is driven by table fragments (which means
    DBspaces), not the number of chunks.  Chunks within a 
    fragment/dbspace are read serially.  
  </li>
</ul>

<p>Given this information,
here are the guidelines that were used in the physical design:

<ul>
  <li>The total number of <a href="#DB Spaces">dbspaces</a>
    roughly corresponds to the number of 
    physical disks in the drive group.  Hopefully, this will allow Informix
    to give the RAID enough work to do.
  </li>
  <li>Medium and large tables are <A href="#Fragmentation">fragmented</a>
    into multiple dbspaces using
    round robin fragmentation.  Round robin causes
    Informix to fire up a read thread for each fragment, thus increasing
    the disk controllers optimization choices.
  </li>
  <li>There are 
    <a href="#Index dbspaces">multiple dbspaces that contain only indexes</a>.
    However, 
    each index is fully contained within a single dbspace.  Having multiple
    dbspaces for indexes is meant to increase the number of read requests
    that are simultaneously sent to the RAID.
  </li>
  <li>See the <a href="#Temporary dbspaces">Temporary dbspaces</a> section
    for a discussion of why they are or aren't on RAID.
  </li>
  <li>Experiments led us to the current design of 3 
    <a href="#Table dbspaces">table dbspaces</a> and 
    4 <a href="#Index dbspaces">index dbspaces</a>.  
    Additional dbspaces do help, just not by enough to
    make them worth the management effort.  
  </li>
</ul>

<p>It is worth noting that this physical design, which was tuned for RAID,
will also work well in a non-RAID environment.



<h3 class="zdoc"><a name="Production Server Disk">Production Server Disk</a></h3>

<P>The <a href="impl.html#Production Server">production server</a> has 
4 internal disks and the <a href="#Sun A1000 RAID">Sun A1000 RAID</a>
hung off of it.


<h4 class="zdoc"><a name="Production Internal Disks">Internal Disks</a></h4>

<p>The 4 internal disks are physically identical, and are laid out in a 
common pattern.

<p><b>Helix Disk Controller SD1</b>, LSI 53c1030 SCSI

<div class="disk">
  <p><b>c1t0d0s*</b>, Fujitsu MAP3735N SUN72G, 68.4 GB
  <table class="zdoc">
    <tr>
      <th>#</th>
      <th>Offset (KB)</th>
      <th>Size (KB)</th>
      <th>Name</th>
      <th>Notes</th>
    </tr>
    <tr>
      <td class="numeric">0</td>
      <td class="numeric">0</td>
      <td class="numeric">10,532,160</td>
      <td class="name">/</td>
      <td>Root filesystem
    </tr>
    <tr>
      <td class="numeric">1</td>
      <td class="numeric">10,532,160</td>
      <td class="numeric">8,425,728</td>
      <td class="name">None (swap)</td>
      <td>Used for VM, /tmp, /proc</td>
    </tr>
    <tr>
      <td class="numeric">3</td>
      <td class="numeric">18,957,888</td>
      <td class="numeric">2,106,432</td>
      <td class="name">None (Wildtype RAW)</td>
      <td>
        <table class="raw">
          <caption>Informix Raw Disk Chunks</caption>
          <tr>
            <th>Offset (KB)</th>
            <th>Size (KB)</th>
            <th>Name</th>
          </tr>
          <tr>
            <td class="numeric">0</td>
            <td class="numeric">2,097,152</td>
            <td class="name"><a href="#Temporary dbspaces">tempdbs1_c1</a></td>
          </tr>
          <tr>
            <td class="numeric">2,097,152</td>
            <td class="numeric">9,280</td>
            <td>unused</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td class="numeric">4</td>
      <td class="numeric">21,064,329</td>
      <td class="numeric">50,610,336</td>
      <td class="name">/export/helix0</td>
      <td>Unused, not backed up</td>
    </tr>
  </table>

  <p><b>c1t1d0s*</b>, Fujitsu MAP3735N SUN72G, 68.4 GB
  <table class="zdoc">
    <tr>
      <th>#</th>
      <th>Offset (KB)</th>
      <th>Size (KB)</th>
      <th>Name</th>
      <th>Notes</th>
    </tr>
    <tr>
      <td class="numeric">0</td>
      <td class="numeric">0</td>
      <td class="numeric">10,532,160</td>
      <td class="name">/private</td>
      <td><a href="impl.html#/private">Private disk</a> for helix.
    </tr>
    <tr>
      <td class="numeric">1</td>
      <td class="numeric">10,532,160</td>
      <td class="numeric">8,425,728</td>
      <td class="name">None (swap)</td>
      <td>Used for VM, /tmp, /proc</td>
    </tr>
    <tr>
      <td class="numeric">3</td>
      <td class="numeric">18,957,888</td>
      <td class="numeric">2,106,432</td>
      <td class="name">None (Wildtype RAW)</td>
      <td>
        <table class="raw">
          <caption>Informix Raw Disk Chunks</caption>
          <tr>
            <th>Offset (KB)</th>
            <th>Size (KB)</th>
            <th>Name</th>
          </tr>
          <tr>
            <td class="numeric">0</td>
            <td class="numeric">2,097,152</td>
            <td class="name"><a href="#Temporary dbspaces">tempdbs2_c1</a></td>
          </tr>
          <tr>
            <td class="numeric">2,097,152</td>
            <td class="numeric">9,280</td>
            <td>unused</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td class="numeric">4</td>
      <td class="numeric">21,064,329</td>
      <td class="numeric">50,610,336</td>
      <td class="name">/export/helix1</td>
      <td>Unused, not backed up</td>
    </tr>
  </table>

  <p><b>c1t2d0s*</b>, Fujitsu MAP3735N SUN72G, 68.4 GB
  <table class="zdoc">
    <tr>
      <th>#</th>
      <th>Offset (KB)</th>
      <th>Size (KB)</th>
      <th>Name</th>
      <th>Notes</th>
    </tr>
    <tr>
      <td class="numeric">0</td>
      <td class="numeric">0</td>
      <td class="numeric">10,532,160</td>
      <td class="name">/root-t2</td>
      <td>Reserved for past, future, or backup versions of root filesystem.
    </tr>
    <tr>
      <td class="numeric">1</td>
      <td class="numeric">10,532,160</td>
      <td class="numeric">8,425,728</td>
      <td class="name">None (swap)</td>
      <td>Used for VM, /tmp, /proc</td>
    </tr>
    <tr>
      <td class="numeric">3</td>
      <td class="numeric">18,957,888</td>
      <td class="numeric">2,106,432</td>
      <td class="name">None (Wildtype RAW)</td>
      <td>
        <table class="raw">
          <caption>Informix Raw Disk Chunks</caption>
          <tr>
            <th>Offset (KB)</th>
            <th>Size (KB)</th>
            <th>Name</th>
          </tr>
          <tr>
            <td class="numeric">0</td>
            <td class="numeric">2,097,152</td>
            <td class="name"><a href="#Temporary dbspaces">tempdbs3_c1</a></td>
          </tr>
          <tr>
            <td class="numeric">2,097,152</td>
            <td class="numeric">9,280</td>
            <td>unused</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td class="numeric">4</td>
      <td class="numeric">21,064,329</td>
      <td class="numeric">50,610,336</td>
      <td class="name">/export/helix2</td>
      <td>Unused, not backed up</td>
    </tr>
  </table>

  <p><b>c1t3d0s*</b>, Fujitsu MAP3735N SUN72G, 68.4 GB
  <table class="zdoc">
    <tr>
      <th>#</th>
      <th>Offset (KB)</th>
      <th>Size (KB)</th>
      <th>Name</th>
      <th>Notes</th>
    </tr>
    <tr>
      <td class="numeric">0</td>
      <td class="numeric">0</td>
      <td class="numeric">10,532,160</td>
      <td class="name">/private-t3</td>
      <td>Reserved for past, future, or backup versions of /private.
    </tr>
    <tr>
      <td class="numeric">1</td>
      <td class="numeric">10,532,160</td>
      <td class="numeric">8,425,728</td>
      <td class="name">None (swap)</td>
      <td>Used for VM, /tmp, /proc</td>
    </tr>
    <tr>
      <td class="numeric">3</td>
      <td class="numeric">18,957,888</td>
      <td class="numeric">2,106,432</td>
      <td class="name">None (Wildtype RAW)</td>
      <td>
        <table class="raw">
          <caption>Informix Raw Disk Chunks</caption>
          <tr>
            <th>Offset (KB)</th>
            <th>Size (KB)</th>
            <th>Name</th>
          </tr>
          <tr>
            <td class="numeric">0</td>
            <td class="numeric">2,097,152</td>
            <td class="name"><a href="#Temporary dbspaces">tempdbs4_c1</a></td>
          </tr>
          <tr>
            <td class="numeric">2,097,152</td>
            <td class="numeric">9,280</td>
            <td>unused</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td class="numeric">4</td>
      <td class="numeric">21,064,329</td>
      <td class="numeric">50,610,336</td>
      <td class="name">/export/helix3</td>
      <td>Unused, not backed up</td>
    </tr>
  </table>

</div>



<h4 class="zdoc"><a name="Production RAID Disks">RAID Disks</a></h4>

<p>Production has a <a href="#Sun A1000 RAID">Sun StorEdge A1000 RAID array</a>
with 12 18GB disks.
If you are unfamiliar with RAID on Solaris, see the 
<a href="#RAID">RAID</a> section for an overview or RAID levels 
and terminology.

<p>This section has 2 subsections, one describing how the physical disks
in the RAID are allocated to logical disks (LUNs in RAID terminology),
and one describing how the logical disks are allocated.

<p><b><a name="Physical Allocation">Physical Allocation</a></b>

<p>The 12 disks are allocated as follows:

<ul>
  <li><a href="#Drive Group 1"><b>Drive Group 1</b></a>: A single physical disk.
    This is configured as RAID 0.  A RAID 0 drive group 
    with only a single physical disk in it is equivalent to no RAID.
  <li><A href="#Drive Group 2"><b>Drive Group 2</b></a>:  
    Contains 10 physical disks.  This is configured
    as RAID 1.  Since the drive group has more than 2 physical disks in it,
    it is actually RAID 10, striping and mirroring.
  <li><b>Hot Spare</b>:  A single disk is available as a hot spare.
</ul>

<center>
<br>
<img src="Admin/a1000.raid.physical.gif" alt="Production RAID Physical Layout">
<br>
</center>

<p><b><a name="Logical Allocation">Logical Allocation</a></b>

<p><b>Helix RAID Disk Controller</b>, Symbios 53C875 Fast20 Wide SCSI (I think)

<div class="disk">

  <p><b><a name ="Drive Group 1">Drive Group 1</a></b>

  <div class="disk">
    <p><b>c3t5d0s*, LUN 0</b>, 2.0 GB
    <table class="zdoc">
      <tr>
	<th>#</th>
	<th>Offset (KB)</th>
	<th>Size (KB)</th>
	<th>Name</th>
	<th>Notes</th>
      </tr>
      <tr>
	<td class="numeric"></td>
	<td class="numeric">0</td>
	<td class="numeric">2,048</td>
	<td>reserved</td>
	<td>First 2 MB reserved for disk geometry</td>
      </tr>
      <tr>
	<td class="numeric">0</td>
	<td class="numeric">2,048</td>
	<td class="numeric">2,095,103.5</td>
	<td class="name">None (Wildtype RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">2,095,102</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs5_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">2,095,102</td>
	      <td class="numeric">1.5</td>
	      <td>unused</td>
	    </tr>
	  </table>
	</td>
      </tr>
    </table>

    <p><b>c3t5d4s*, LUN 4</b>, 14.8 GB
    <table class="zdoc">
      <tr>
	<th>#</th>
	<th>Offset (KB)</th>
	<th>Size (KB)</th>
	<th>Name</th>
	<th>Notes</th>
      </tr>
      <tr>
	<td class="numeric"></td>
	<td class="numeric">0</td>
	<td class="numeric">2,048</td>
	<td>reserved</td>
	<td>First 2 MB reserved for disk geometry</td>
      </tr>
      <tr>
	<td class="numeric">0</td>
	<td class="numeric">2,048</td>
	<td class="numeric">2,097,152</td>
	<td class="name">None (Wildtype RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">2,097,152</td>
	      <td class="name"><a href="#Smart BLOB Spaces">smarttempbs_c1</a></td>
	    </tr>
	  </table>
	</td>
      </tr>
      <tr>
	<td class="numeric"></td>
	<td class="numeric">2,099,200</td>
	<td class="numeric">13,443,072</td>
	<td>unused</td>
	<td></td>
      </tr>
    </table>
  </div>

  <p><b><a name="Drive Group 2">Drive Group 2</a></b>
  <div class="disk">
    <p><b>c3t5d1s*, LUN 1</b>, 32.0 GB
    <table class="zdoc">
      <tr>
	<th>#</th>
	<th>Offset (KB)</th>
	<th>Size (KB)</th>
	<th>Name</th>
	<th>Notes</th>
      </tr>
      <tr>
	<td class="numeric"></td>
	<td class="numeric">0</td>
	<td class="numeric">2,048</td>
	<td>reserved</td>
	<td>First 2 MB reserved for disk geometry</td>
      </tr>
      <tr>
	<td class="numeric">0</td>
	<td class="numeric">2,048</td>
	<td class="numeric">33,552,384</td>
	<td class="name">None (Wildtype RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">524,288</td>
	      <td class="name"><a href="#Table dbspaces">tbldbs1_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">524,288</td>
	      <td class="numeric">524,288</td>
	      <td class="name"><a href="#Table dbspaces">tbldbs2_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">1,048,576</td>
	      <td class="numeric">524,288</td>
	      <td class="name"><a href="#Table dbspaces">tbldbs3_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">1,572,864</td>
	      <td class="numeric">4,194,304</td>
	      <td class="name">llogdbs1_c1</td>
	    </tr>
	    <tr>
	      <td class="numeric">5,767,168</td>
	      <td class="numeric">65,536</td>
	      <td class="name">plogdbss1_c1</td>
	    </tr>
	    <tr>
	      <td class="numeric">5,832,704</td>
	      <td class="numeric">262,144</td>
	      <td class="name"><a href="#Index dbspaces">idxdbs2_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">6,094,848</td>
	      <td class="numeric">262,144</td>
	      <td class="name"><a href="#Index dbspaces">idxdbs3_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">6,356,992</td>
	      <td class="numeric">262,144</td>
	      <td class="name"><a href="#Index dbspaces">idxdbs4_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">6,619,136</td>
	      <td class="numeric">262,144</td>
	      <td class="name"><a href="#Index dbspaces">idxdbs1_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">6,881,280</td>
	      <td class="numeric">32,768</td>
	      <td class="name"><a href="#Default dbspace">defaultdbs_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">6,914,048</td>
	      <td class="numeric">32,768</td>
	      <td class="name">rootdbs_c1</td>
	    </tr>
	    <tr>
	      <td class="numeric">6,946,816</td>
	      <td class="numeric">1,048,576</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs6_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">7,995,392</td>
	      <td class="numeric">1,048,576</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs7_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">9,043,968</td>
	      <td class="numeric">1,048,576</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs8_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">10,092,544</td>
	      <td class="numeric">4,194,304</td>
	      <td class="name"><a href="#Smart BLOB Spaces">smartbs1_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">14,286,848</td>
	      <td class="numeric">4,194,304</td>
	      <td class="name"><a href="#Smart BLOB Spaces">smartbs2_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">18,481,152</td>
	      <td class="numeric">4,194,304</td>
	      <td class="name"><a href="#Smart BLOB Spaces">smartbs3_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">22,675,456</td>
	      <td class="numeric">4,194,304</td>
	      <td class="name"><a href="#Smart BLOB Spaces">smartbs4_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">26,869,760</td>
	      <td class="numeric">524,288</td>
	      <td class="name"><a href="#Default dbspace">smartdfltbs_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">27,394,048</td>
	      <td class="numeric">1,048,576</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs9_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">28,442,624</td>
	      <td class="numeric">1,048,576</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs10_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">29,491,200</td>
	      <td class="numeric">1,048,576</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs11_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">30,539,776</td>
	      <td class="numeric">1,048,576</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs12_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">31,588,352</td>
	      <td class="numeric">262,144</td>
	      <td>idxdbs1_c2</td>
	    </tr>
	    <tr>
	      <td class="numeric">31,850,496</td>
	      <td class="numeric">262,144</td>
	      <td>idxdbs2_c2</td>
	    </tr>
	    <tr>
	      <td class="numeric">32,112,640</td>
	      <td class="numeric">262,144</td>
	      <td>idxdbs3_c2</td>
	    </tr>
	    <tr>
	      <td class="numeric">32,374,784</td>
	      <td class="numeric">262,144</td>
	      <td>idxdbs1_c2</td>
	    </tr>
	    <tr>
	      <td class="numeric">32,636,928</td>
	      <td class="numeric">32768</td>
	      <td>defaultdbs_c2</td>
	    </tr>

	    <tr>
	      <td class="numeric">32,669,696</td>
	      <td class="numeric">884,736</td>
	      <td>unused</td>
	    </tr>

	  </table>
	</td>
      </tr>
    </table>

    <p><b>c3t5d2s*, LUN 2</b>, 43.9 GB
    <table class="zdoc">
      <tr>
	<th>#</th>
	<th>Offset (KB)</th>
	<th>Size (KB)</th>
	<th>Name</th>
	<th>Notes</th>
      </tr>
      <tr>
	<td class="numeric">0</td>
	<td class="numeric">0</td>
	<td class="numeric">54,677,504</td>
	<td class="name">
	  /research/zprod, 
	  <br>&nbsp;&nbsp;a.k.a. /export/zprod</td>
	<td><a href="impl.html#ZFIN Prod">ZFIN production</a> cooked filesystem</td>
      </tr>
    </table>

  </div>
</div>



<h3 class="zdoc"><a name="Development Server Disk">Development Server Disk</a></h3>

<p>The <a href="impl.html#Development Server">development server</a>
has 4 internal disks and the 
<a href="#NStor 4150S RAID">NStor RAID</a> attached to it.
<p> The current physical layout was made on 12/27/2007.


<h4 class="zdoc"><a name="Development Internal Disks">Internal Disks</a></h4>

<p>Embryonix has 4 identical internal disks.


<p><b>Embryonix Disk Controller SD1</b>, LSI 1030 SCSI

<div class="disk">
  <p><b>c1t0d0s*</b>, Hitachi DK32EJ72NSUN72G, 68.4 GB
  <table class="zdoc">
    <tr>
      <th>#</th>
      <th>Offset (KB)</th>
      <th>Size (KB)</th>
      <th>Name</th>
      <th>Notes</th>
    </tr>
    <tr>
      <td class="numeric">0</td>
      <td class="numeric">0</td>
      <td class="numeric">10,491,456</td>
      <td class="name">/root-t0</td>
      <td>Reserved for past, future and backup versions of /</td>
    </tr>
    <tr>
      <td class="numeric">1</td>
      <td class="numeric">10,491,456</td>
      <td class="numeric">6,293,856</td>
      <td class="name">None (swap)</td>
      <td>Used for VM, /tmp, /proc</td>
    </tr>
    <tr>
      <td class="numeric">4</td>
      <td class="numeric">16,785,312</td>
      <td class="numeric">2,101,344</td>
      <td class="name">None (Wanda RAW)</td>
      <td>
        <table class="raw">
          <caption>Informix Raw Disk Chunks</caption>
          <tr>
            <th>Offset (KB)</th>
            <th>Size (KB)</th>
            <th>Name</th>
          </tr>
          <tr>
            <td class="numeric">0</td>
            <td class="numeric">2,097,152</td>
            <td class="name"><a href="#Temporary dbspaces">tempdbs1_c1</a></td>
          </tr>
          <tr>
            <td class="numeric">2,097,152</td>
            <td class="numeric">4,192</td>
            <td>unused</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td class="numeric">5</td>
      <td class="numeric">18,886,656</td>
      <td class="numeric">52,788,000</td>
      <td class="name">
        /research/zarchive0,
        <br>&nbsp;&nbsp;a.k.a. /export/zarchive0
      </td>
      <td>First disk in the <a href="impl.html#ZFIN Archive">ZFIN archives</a>.</td>
    </tr>
  </table>

  <p><b>c1t1d0s*</b>, Hitachi DK32EJ72NSUN72G, 68.4 GB
  <table class="zdoc">
    <tr>
      <th>#</th>
      <th>Offset (KB)</th>
      <th>Size (KB)</th>
      <th>Name</th>
      <th>Notes</th>
    </tr>
    <tr>
      <td class="numeric">0</td>
      <td class="numeric">0</td>
      <td class="numeric">10,491,456</td>
      <td class="name">/</td>
      <td>Root filesystem</td>
    </tr>
    <tr>
      <td class="numeric">1</td>
      <td class="numeric">10,491,456</td>
      <td class="numeric">6,293,856</td>
      <td class="name">None (swap)</td>
      <td>Used for VM, /tmp, /proc</td>
    </tr>
    <tr>
      <td class="numeric">4</td>
      <td class="numeric">16,785,312</td>
      <td class="numeric">2,101,344</td>
      <td class="name">None (Wanda RAW)</td>
      <td>
        <table class="raw">
          <caption>Informix Raw Disk Chunks</caption>
          <tr>
            <th>Offset (KB)</th>
            <th>Size (KB)</th>
            <th>Name</th>
          </tr>
          <tr>
            <td class="numeric">0</td>
            <td class="numeric">2,097,152</td>
            <td class="name"><a href="#Smart BLOB Spaces">tempdbs2_c1</a></td>
          </tr>
          <tr>
            <td class="numeric">2,097,152</td>
            <td class="numeric">4,192</td>
            <td>unused</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td class="numeric">5</td>
      <td class="numeric">18,886,656</td>
      <td class="numeric">52,788,000</td>
      <td class="name">
        /research/zarchive1,
        <br>&nbsp;&nbsp;a.k.a. /export/zarchive1
      </td>
      <td>Second disk in the <a href="impl.html#ZFIN Archive">ZFIN archives</a>.</td>
    </tr>
  </table>

  <p><b>c1t2d0s*</b>, Hitachi DK32EJ72NSUN72G, 68.4 GB
  <table class="zdoc">
    <tr>
      <th>#</th>
      <th>Offset (KB)</th>
      <th>Size (KB)</th>
      <th>Name</th>
      <th>Notes</th>
    </tr>
    <tr>
      <td class="numeric">0</td>
      <td class="numeric">0</td>
      <td class="numeric">10,491,456</td>
      <td class="name">/private</td>
      <td><a href="impl.html#/private">Private</a> on embryonix</td>
    </tr>
    <tr>
      <td class="numeric">1</td>
      <td class="numeric">10,491,456</td>
      <td class="numeric">6,293,856</td>
      <td class="name">None (swap)</td>
      <td>Used for VM, /tmp, /proc</td>
    </tr>
    <tr>
      <td class="numeric">4</td>
      <td class="numeric">16,785,312</td>
      <td class="numeric">2,101,344</td>
      <td class="name">None (Wanda RAW)</td>
      <td>
        <table class="raw">
          <caption>Informix Raw Disk Chunks</caption>
          <tr>
            <th>Offset (KB)</th>
            <th>Size (KB)</th>
            <th>Name</th>
          </tr>
          <tr>
            <td class="numeric">0</td>
            <td class="numeric">2,097,152</td>
            <td class="name"><a href="#Temporary dbspaces">tempdbs3_c1</a></td>
          </tr>
          <tr>
            <td class="numeric">2,097,152</td>
            <td class="numeric">4,192</td>
            <td>unused</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td class="numeric">5</td>
      <td class="numeric">18,886,656</td>
      <td class="numeric">52,788,000</td>
      <td class="name">
        /research/zarchive2,
        <br>&nbsp;&nbsp;a.k.a. /export/zarchive2
      </td>
      <td>Third disk in the <a href="impl.html#ZFIN Archive">ZFIN archives</a>.</td>
    </tr>
  </table>

  <p><b>c1t3d0s*</b>, Hitachi DK32EJ72NSUN72G, 68.4 GB
  <table class="zdoc">
    <tr>
      <th>#</th>
      <th>Offset (KB)</th>
      <th>Size (KB)</th>
      <th>Name</th>
      <th>Notes</th>
    </tr>
    <tr>
      <td class="numeric">0</td>
      <td class="numeric">0</td>
      <td class="numeric">10,491,456</td>
      <td class="name">/private-t3</td>
      <td>Reserved for past, future, and backup copies of /private</td>
    </tr>
    <tr>
      <td class="numeric">1</td>
      <td class="numeric">10,491,456</td>
      <td class="numeric">6,293,856</td>
      <td class="name">None (swap)</td>
      <td>Used for VM, /tmp, /proc</td>
    </tr>
    <tr>
      <td class="numeric">4</td>
      <td class="numeric">16,785,312</td>
      <td class="numeric">2,101,344</td>
      <td class="name">None (Wanda RAW)</td>
      <td>
        <table class="raw">
          <caption>Informix Raw Disk Chunks</caption>
          <tr>
            <th>Offset (KB)</th>
            <th>Size (KB)</th>
            <th>Name</th>
          </tr>
          <tr>
            <td class="numeric">0</td>
            <td class="numeric">2,097,152</td>
            <td class="name"><a href="#Temporary dbspaces">tempdbs4_c1</a></td>
          </tr>
          <tr>
            <td class="numeric">2,097,152</td>
            <td class="numeric">4,192</td>
            <td>unused</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td class="numeric">5</td>
      <td class="numeric">18,886,656</td>
      <td class="numeric">52,788,000</td>
      <td class="name">
        /research/zarchive3,
        <br>&nbsp;&nbsp;a.k.a. /export/zarchive3
      </td>
      <td>Fourth disk in the <a href="impl.html#ZFIN Archive">ZFIN archives</a>.</td>
    </tr>
  </table>

</div>




<h4 class="zdoc"><a name="Development RAID Disks">RAID Disks</a></h4>

<p>The bulk of ZFIN's filesystems are on the 
<a href="#NStor 4150S RAID">NStor RAID</a>, which is attached to
the <a href="impl.html#Development Server">ZFIN development server</a>.


<p><b><a name="NStor RAID Physical Allocation">Physical Allocation</a></b>

<p>The 12 disks are allocated as follows:

<ul>
  <li><b>Drive Group zfish1.</b>  Contains 6 physical drives and is
    configured as RAID 5.
  <li><b>Drive Group zfish2.</b>  Contains 5 physical drives and is
    configured as RAID 5.
  <li><b>Hot Spare.</b>  A single disk is available as a hot spare.
</ul>
 
<p>Note: "Drive Groups", the Sun term, are called "Arrays" in NStor
terminolgy.

<center>
<br>
<img src="Admin/nstor.raid.physical.gif" alt="Development RAID Physical Layout">
<br>
</center>


<p><b><a name="NStor RAID Logical Allocation">Logical Allocation</a></b>

<p><b>Embryonix RAID Disk Controller</b>, Chaparral JS122(A) Ultra-160 SCSI

<div class="disk">

  <p><b><a name ="Drive Group zfish1">Drive Group zfish1</a></b>

  <div class="disk">
    <p><b>c2t1d1s*, LUN 1</b>, 564.7 GB
    <table class="zdoc">
      <tr>
	<th>#</th>
	<th>Offset (KB)</th>
	<th>Size (KB)</th>
	<th>Name</th>
	<th>Notes</th>
      </tr>
      <tr>
	<td class="numeric">3</td>
	<td class="numeric">0</td>
	<td class="numeric">277,626,880</td>
	<td class="name">
	  /research/zunloads, 
	  <br>&nbsp;&nbsp;a.k.a. /export/zfish1lun1/S3</td>
	<td><a href="impl.html#ZFIN Unloads">ZFIN Unloads</a> directory</td>
      </tr>
      <tr>
	<td class="numeric">4</td>
	<td class="numeric">277,626,880</td>
	<td class="numeric">104,857,600</td>
	<td>unused</td>
	<td></td>
      </tr>
      <tr>
	<td class="numeric">7</td>
	<td class="numeric">382,484,480</td>
	<td class="numeric">209,715,200</td>
	<td class="name">
	  /research/zusers, 
	  <br>&nbsp;&nbsp;a.k.a. /export/zfish1lun1/S7</td>
	<td><a href="impl.html#ZFIN Users">ZFIN Users</a> directory</td>
      </tr>
    </table>

    <p><b>c2t1d3s*, LUN 3</b>, 112.0 GB
    <table class="zdoc">
      <tr>
	<th>#</th>
	<th>Offset (KB)</th>
	<th>Size (KB)</th>
	<th>Name</th>
	<th>Notes</th>
      </tr>
      <tr>
	<td class="numeric"></td>
	<td class="numeric">0</td>
	<td class="numeric">8,192</td>
	<td>reserved</td>
	<td>First 8 MB reserved for disk geometry</td>
      </tr>
      <tr>
	<td class="numeric">0</td>
	<td class="numeric">8,192</td>
	<td class="numeric">33,554,432</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">25,165,824</td>
	      <td class="name"><a href="#Table dbspaces">tbldbs2_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">25,165,824</td>
	      <td class="numeric">2,097,152</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs5_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">27,262,976</td>
	      <td class="numeric">2,097,152</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs7_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">29,360,128</td>
	      <td class="numeric">2,097,152</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs9_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">31,457,280</td>
	      <td class="numeric">2,097,152</td>
	      <td class="name">unused</td>
	    </tr>
          </table>
        </td>
      </tr>
      <tr>
	<td class="numeric">1</td>
	<td class="numeric">33,562,624</td>
	<td class="numeric">33,554,432</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">25,165,824</td>
	      <td class="name"><a href="#Table dbspaces">tbldbs3_c1</a></td>
	    </tr> 
	    <tr>
	      <td class="numeric">25,165,824</td>
	      <td class="numeric">6,291,456</td>
	      <td class="name"><a href="#Smart BLOB Spaces">smartbs1_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">31,457,280</td>
	      <td class="numeric">2,097,152</td>
	      <td class="name"><a href="#Smart BLOB Spaces">smarttempbs_c1</a></td>
	    </tr>
          </table>
        </td>
      </tr>
      <tr>
	<td class="numeric">6</td>
	<td class="numeric">67,117,056</td>
	<td class="numeric">50,331,648</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">1,048,576</td>
	      <td class="name"><a href="#Smart BLOB Spaces">smartdfltbs_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">1,048,576</td>
	      <td class="numeric">4,194,304</td>
	      <td class="name">llogdbs</td>
	    </tr>
	    <tr>
	      <td class="numeric">5,242,880</td>
	      <td class="numeric">32,768</td>
	      <td class="name">plogdbs</td>
	    </tr>
	    <tr>
	      <td class="numeric">5,275,648</td>
	      <td class="numeric">16,777,216</td>
	      <td class="name"><a href="#Index dbspaces">idxdbs1_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">22,052,864</td>
	      <td class="numeric">1,048,576</td>
	      <td class="name"><a href="#Smart BLOB Spaces">smartdfltbs_c2</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">23,101,440</td>
	      <td class="numeric">27,230,208</td>
	      <td>unused</td>
          </table>
        </td>
      </tr>
    </table>
  </div>

  <p><b><a name ="Drive Group zfish2">Drive Group zfish2</a></b>

  <div class="disk">
    <p><b>c2t1d2s*, LUN 2</b>, 564.7 GB
    <table class="zdoc">
      <tr>
	<th>#</th>
	<th>Offset (KB)</th>
	<th>Size (KB)</th>
	<th>Name</th>
	<th>Notes</th>
      </tr>
      <tr>
	<td class="numeric">0</td>
	<td class="numeric">0</td>
	<td class="numeric">104,857,600</td>
	<td class="name">
	  /research/central, 
	  <br>&nbsp;&nbsp;a.k.a. /export/zfish2lun2/S0</td>
	<td><a href="impl.html#ZFIN Central">ZFIN Central</a> directory</td>
      </tr>
      <tr>
	<td class="numeric">4</td>
	<td class="numeric">104,857,600</td>
	<td class="numeric">78,643,200</td>
	<td class="name">
	  /research/blastdb, 
	  <br>&nbsp;&nbsp;a.k.a. /export/zfish2lun2/S4</td>
	<td>BLAST database directory when BLAST is on embryonix</td>
      </tr>
      <tr>
	<td class="numeric">6</td>
	<td class="numeric">183,500,800</td>
	<td class="numeric">283,557,888</td>
	<td class="name">
	  /research/blastfiles, 
	  <br>&nbsp;&nbsp;a.k.a. /export/zfish2lun2/S6</td>
	<td>
	  BLAST files directory when BLAST is on embryonix.
          <b>This partition is not backed up.</b>
	</td>
      </tr>
    </table>

    <p><b>c2t1d4s*, LUN 4</b>, 16.0 GB
    <table class="zdoc">
      <tr>
	<th>#</th>
	<th>Offset (KB)</th>
	<th>Size (KB)</th>
	<th>Name</th>
	<th>Notes</th>
      </tr>
      <tr>
	<td class="numeric"></td>
	<td class="numeric">0</td>
	<td class="numeric">1,024</td>
	<td>reserved</td>
	<td>First 1 MB reserved for disk geometry</td>
      </tr>
      <tr>
	<td class="numeric">0</td>
	<td class="numeric">1,024</td>
	<td class="numeric">2,097,152</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">65,536</td>
	      <td>sysadmindbs</td>
	    </tr>
	    <tr>
	      <td class="numeric">65,536</td>
	      <td class="numeric">2,031,616</td>
	      <td>unused</td>
	    </tr>
          </table>
        </td>
      </tr>
      <tr>
	<td class="numeric">1</td>
	<td class="numeric">2,098,176</td>
	<td class="numeric">2,097,152</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">2,097,152</td>
	      <td>unused</td>
	    </tr>
          </table>
        </td>
      </tr>
      <tr>
	<td class="numeric">2</td>
	<td class="numeric">4,195,328</td>
	<td class="numeric">2,097,152</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">2,097,152</td>
	      <td>unused</td>
	    </tr>
          </table>
        </td>
      </tr>
      <tr>
	<td class="numeric">3</td>
	<td class="numeric">6,292,480</td>
	<td class="numeric">2,097,152</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">2,097,152</td>
	      <td>unused</td>
	    </tr>
          </table>
        </td>
      </tr>
      <tr>
	<td class="numeric">4</td>
	<td class="numeric">8,389,632</td>
	<td class="numeric">2,097,152</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">2,097,152</td>
	      <td>unused</td>
	    </tr>
          </table>
        </td>
      </tr>
      <tr>
	<td class="numeric">5</td>
	<td class="numeric">10,486,784</td>
	<td class="numeric">2,097,152</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">2,097,152</td>
	      <td>unused</td>
	    </tr>
          </table>
        </td>
      </tr>
      <tr>
	<td class="numeric">6</td>
	<td class="numeric">12,583,936</td>
	<td class="numeric">2,097,152</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">2,097,152</td>
	      <td>unused</td>
	    </tr>
          </table>
        </td>
      </tr>
      <tr>
	<td class="numeric">7</td>
	<td class="numeric">14,681,088</td>
	<td class="numeric">2,097,152</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">2,097,152</td>
	      <td>unused</td>
	    </tr>
          </table>
        </td>
      </tr>

    </table>

    <p><b>c2t1d5s*, LUN 5</b>, 80.0 GB
    <table class="zdoc">
      <tr>
	<th>#</th>
	<th>Offset (KB)</th>
	<th>Size (KB)</th>
	<th>Name</th>
	<th>Notes</th>
      </tr>
      <tr>
	<td class="numeric"></td>
	<td class="numeric">0</td>
	<td class="numeric">8,192</td>
	<td>reserved</td>
	<td>First 8 MB reserved for disk geometry</td>
      </tr>
      <tr>
	<td class="numeric">0</td>
	<td class="numeric">8,192</td>
	<td class="numeric">33,554,432</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">25,165,824</td>
	      <td class="name"><a href="#Table dbspaces">tbldbs1_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">25,165,824</td>
	      <td class="numeric">2,097,152</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs6_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">27,262,976</td>
	      <td class="numeric">2,097,152</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs8_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">29,360,128</td>
	      <td class="numeric">2,097,152</td>
	      <td class="name"><a href="#Temporary dbspaces">tempdbs10_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">31,457,280</td>
	      <td class="numeric">32,768</td>
	      <td class="name">rootdbs_c1</td>
	    </tr>
	    <tr>
	      <td class="numeric">31,490,048</td>
	      <td class="numeric">32,768</td>
	      <td class="name">rootdbs_c2</td>
	    </tr>
	    <tr>
	      <td class="numeric">31522816</td>
	      <td class="numeric">2031616</td>
	      <td class="name">unused</td>
	    </tr>

          </table>
        </td>
      </tr>
      <tr>
	<td class="numeric">1</td>
	<td class="numeric">33,562,624</td>
	<td class="numeric">33,554,432</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">16,777,216</td>
	      <td class="name"><a href="#Index dbspaces">idxdbs2_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">16,777,216</td>
	      <td class="numeric">16,777,216</td>
	      <td class="name"><a href="#Index dbspaces">idxdbs3_c1</a></td>
	    </tr>
          </table>
        </td>
      </tr>
      <tr>
	<td class="numeric">6</td>
	<td class="numeric">67,117,056</td>
	<td class="numeric">16,769,024</td>
	<td class="name">None (Wanda RAW)</td>
	<td>
	  <table class="raw">
	    <caption>Informix Raw Disk Chunks</caption>
	    <tr>
	      <th>Offset (KB)</th>
	      <th>Size (KB)</th>
	      <th>Name</th>
	    </tr>
	    <tr>
	      <td class="numeric">0</td>
	      <td class="numeric">2,097,152</td>
	      <td class="name"><a href="#Default dbspace">defaultdbs_c1</a></td>
	    </tr>
	    <tr>
	      <td class="numeric">2,097,152</td>
	      <td class="numeric">16,769,024</td>
	      <td>unused</td>
	    </tr>
          </table>
        </td>
      </tr>
    </table>

  </div>

</div>



<h3 class="zdoc"><a name="Upgrade Server Disk">Upgrade Server Disk</a></h3>

<p>Bionix, the <a href="impl.html#Upgrade Server">upgrade server</a> 
has 3 disk controllers.
One controller has <a href="#Upgrade Internal Disks">2 internal disks</a>
hung off of it.  The remiaining 2 controllers are unused.



<h4 class="zdoc"><a name="Upgrade Internal Disks">Internal Disks</a></h4>

<p>Bionix has two equal sized internal disks, hung off of one controller.  

<p><b>Bionix Disk Controller 0</b>, Symbios 53c875 Fast/UltraWide SCSI

<div class="disk">
  <p><b>c0t0d0s*</b>, Fujitsu MAJ3364M SUN36G SCSI 33.9 GB
  <table class="zdoc"> 
    <tr>
      <th>#</th>
      <th>Offset (KB)</th>
      <th>Size (KB)</th>
      <th>Name</th>
      <th>Notes</th>
    </tr>
    <tr>
      <td class="numeric">0</td>
      <td class="numeric">0</td>
      <td class="numeric">8,193,204</td>
      <td class="name">/root-t0</td>
      <td>Reserved for backup of /, or Solaris 10</td>
    </tr>
    <tr>
      <td class="numeric">1</td>
      <td class="numeric">8,193,204</td>
      <td class="numeric">2,048,301</td>
      <td class="name">None (swap)</td>
      <td>Used by Solaris virtual memory</td>
    </tr>
    <tr>
      <td class="numeric">6</td>
      <td class="numeric">10,241,505</td>
        <td class="numeric">25,322,085</td>
      <td class="name">
        /research/zscratch0,
        <br>&nbsp;&nbsp;a.k.a /export/scratch0
      </td>
      <td>Scratch disk.  This is not backed up.</td>
    </tr>
  </table>

  <p><b>c0t1d0s*</b>, Fujitsu MAJ3364M SUN36G SCSI 33.9 GB
  <table class="zdoc"> 
    <tr>
      <th>#</th>
      <th>Offset (KB)</th>
      <th>Size (KB)</th>
      <th>Name</th>
      <th>Notes</th>
    </tr>
    <tr>
      <td class="numeric">0</td>
      <td class="numeric">0</td>
      <td class="numeric">8,193,204</td>
      <td class="name">/</td>
      <td>Also contains <a href="impl.html#/private">/private</a></td>
    </tr>
    <tr>
      <td class="numeric">1</td>
      <td class="numeric">8,193,204</td>
      <td class="numeric">2,048,301</td>
      <td class="name">None (swap)</td>
      <td>Used by Solaris virtual memory</td>
    </tr>
    <tr>
      <td class="numeric">5</td>
      <td class="numeric">10,241,505</td>
      <td class="numeric">12,583,039.5</td>
      <td class="name">None (Wavy RAW)</td>
      <td>
        <table class="raw">
          <caption>Informix Raw Disk Chunks</caption>
          <tr>
            <th>Offset (KB)</th>
            <th>Size (KB)</th>
            <th>Name</th>
          </tr>
          <tr>
            <td class="numeric">0</td>
            <td class="numeric">16,384</td>
            <td class="name">rootdbs_c1</td>
          </tr>
          <tr>
            <td class="numeric">16,384</td>
            <td class="numeric">32,768</td>
            <td class="name">plogdbs_c1</td>
          </tr>
          <tr>
            <td class="numeric">49,152</td>
            <td class="numeric">31,744</td>
            <td class="name">defaultdbs_c1</td>
          </tr>
          <tr>
            <td class="numeric">80,896</td>
            <td class="numeric">1,967,104</td>
            <td class="name">llogdbs_c1</td>
          </tr>
          <tr>
            <td class="numeric">2,048,000</td>
            <td class="numeric">131,072</td>
            <td class="name">idxdbs1_c1</td>
          </tr>
          <tr>
            <td class="numeric">2,179,072</td>
            <td class="numeric">131,072</td>
            <td class="name">idxdbs2_c1</td>
          </tr>
          <tr>
            <td class="numeric">2,310,144</td>
            <td class="numeric">131,072</td>
            <td class="name">idxdbs3_c1</td>
          </tr>
          <tr>
            <td class="numeric">2,441,216</td>
            <td class="numeric">131,072</td>
            <td class="name">idxdbs4_c1</td>
          </tr>
          <tr>
            <td class="numeric">2,572,288</td>
            <td class="numeric">262,144</td>
            <td class="name">tbldbs1_c1</td>
          </tr>
          <tr>
            <td class="numeric">2,834,432</td>
            <td class="numeric">262,144</td>
            <td class="name">tbldbs2_c1</td>
          </tr>
          <tr>
            <td class="numeric">3,096,576</td>
            <td class="numeric">262,144</td>
            <td class="name">tbldbs3_c1</td>
          </tr>
          <tr>
            <td class="numeric">3,358,720</td>
            <td class="numeric">65,536</td>
            <td class="name">smartdfltbs_c1</td>
          </tr>
          <tr>
            <td class="numeric">3,424,256</td>
            <td class="numeric">65,536</td>
            <td class="name">smarttempbs_c1</td>
          </tr>
          <tr>
            <td class="numeric">3,489,792</td>
            <td class="numeric">2,097,152</td>
            <td class="name">smartbs1_c1</td>
          </tr>
          <tr>
            <td class="numeric">5,586,944</td>
            <td class="numeric">2,097,152</td>
            <td class="name">smartbs2_c1</td>
          </tr>
          <tr>
            <td class="numeric">7,684,096</td>
            <td class="numeric">2,097,152</td>
            <td class="name">smartbs3_c1</td>
          </tr>
          <tr>
            <td class="numeric">9,781,248</td>
            <td class="numeric">2,097,152</td>
            <td class="name">smartbs4_c1</td>
          </tr>
          <tr>
            <td class="numeric">11,878,400</td>
            <td class="numeric">704,638</td>
            <td class="name">tempdbs1_c1</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td class="numeric">6</td>
      <td class="numeric">22,824,544.5</td>
      <td class="numeric">12,739,045.5</td>
      <td class="name">
        /research/zbionix1,
        <br>&nbsp;&nbsp;a.k.a /export/bionix1
      </td>
      <td>User disk for bionix.</td>
    </tr>
  </table>
</div>



<!-- ========= Physical Design ========================================= -->

<h2 class="zdoc"><a name="Physical Design">Physical Design</a></h2>

<p>At the time of the port to Informix (2000/03),
the physcial design consisted only of 
<a href="#Fragmentation">round-robin fragmentation</a> for every 
table and a smattering of indexes, mostly on the
<a href="db.html#Fast Search Tables">fast search tables</a>.
The vast majority of tables did not have primary keys (or unique 
constraints) defined on them.  I don't believe there was a single foreign
key or not null constraint defined in the database.  Over the next 21 months 
primary keys were defined for most tables, and foreign key, not null, and
unique constraints were added in many (but not yet all) places as well.

<p>When we moved the database from the old RAID (the Andataco) to the new 
<a href="#RAID">RAID</a> (<a href="#Production RAID Disks">the Sun A1000</a>)
in 2002/01, we did the first thorough physical design of the database.
This physical design was done 
<a href="#RAID and Informix">with the new RAID in mind</a>, but everything 
that was done will also work well in a non-RAID environment.

<p>See the <a href="#Disk Usage">Disk Usage</a> section for descriptions of
the disk layouts on the <a href="#Production Server Disk">production</a> and 
<a href="#Development Server Disk">development</a> servers.



<h3 class="zdoc"><a name="DB Spaces">DB Spaces</a></h3>

<p>DB spaces, or <i>dbspaces</i>, are the largest logical unit of storage in 
Informix.  When tables and indexes are defined you can specify what 
dbspace(s) to put the table or index into.  dbspaces are implemented with
one or more <i>chunks</i>, which are actual contiguous pieces of physical 
disk.  Informix recommends that you have only one chunk per dbspace, and
(at least initially) we have done this at ZFIN.

<p>The remainder of this section discusses the particular dbspace setup that
ZFIN uses.  Also see the 
<a href="#RAID and Informix">RAID and Informix</a> section for additional
information on dbspaces.


<h4 class="zdoc"><a name="Separate Table and Index dbspaces">
             Separate Table and Index dbspaces</a></h4>

<p>Informix recommends that you store indexes in a different dbspace 
from the dbspace where the table the index is on is stored.  This means 
that disk accesses to the index will not compete with disk accesses to 
the table.  At ZFIN we have taken that one step further and placed all indexes
in dbspaces that contain only indexes.



<h4 class="zdoc"><a name="Table dbspaces">Table dbspaces</a></h4>

<p>After experimentation 
(see <a href="#RAID and Informix">RAID and Informix</a>), we settled on
3 table dbspaces for ZFIN, called tbldbs1, tbldbs2, and
tbldbs3.  Table spaces contains only tables.




<h4 class="zdoc"><a name="Index dbspaces">Index dbspaces</a></h4>

<p>After experimentation 
(see <a href="#RAID and Informix">RAID and Informix</a>), we settled on
4 index spaces for ZFIN.  The index spaces, called idxdbs1, idxdbs2, idxdbs3,
and idxdbs4, are all the same size.  Index spaces contain only indexes.

<p>Each index is assigned to one index dbspace.  All the indexes on a 
given table are usually assigned to the same index dbspace.  
Indexes are assigned to index dbspaces based on three things:

<ul>
  <li>Size.  The goal is to have each index dbspace contain approximately 
    the same amount of data.  One index dbspace should not
    contain noticably more data then the other index dbspaces.
  </li>
  <li>Usage in joins.  For tables that are often joined together, the index
    for each table is stored in a separate index dbspace.  For example, the
    INT_PERSON_PUB,
    PERSON, and
    PUBLICATION tables (see <a href="db.html#Schema">schema documentation 
    for details</a>) are often joined
    together in a 3 way join.  Therefore, the indexes on each of those 
    3 tables are stored in different index dbspaces.  Thus, Informix can
    issue simultaneous read requests to all 3 indexes.
  </li>
  <li>Popularity of use.  We try to assure that the most often used indexes 
    are evenly distributed across all index dbspaces.  This is a great idea.
    It is also very hard to do.
  </li>
</ul>



<h4 class="zdoc"><a name="Default dbspace">Default dbspace</a></h4>

<p>When you create a database you specify what the default dbspace for the 
database is.  Any tables and indexes that are not explicitly placed 
in a dbspace end up
in the default dbspace.  This includes 
<ul>
 <li>Data dictionary tables
 <li>Indexes that are implicitly created to support primary or foreign keys
 <li>tables without an explicit "IN" clause
 <li>Explicitly created indexes that do not have an "IN" clause
</ul>

<p>Starting with Informix 9.30, ZFIN has a default dbspace called defaultdbs.
It is useful for separating the data dictionary tables from data tables, and for
easily detecting what tables and indexes have been (erroneously) 
created without "IN" clauses.




<h4 class="zdoc"><a name="Smart BLOB Spaces">Smart BLOB Spaces</a></h4>

<p>Smart BLOB Spaces, or <i>sbspaces</i>, store 
<a href="db.html#LVARCHAR, CLOB, and HTML">BLOBs (binary large objects)
and CLOBs (character large objects)</a> in Informix.  In ZFIN sbspaces are used
to store images and text fields that are too long to fit in 
<a href="db.html#LVARCHAR, CLOB, and HTML">LVARCHARs</a>.  
sbspaces are also used extensively by datablades such
as the Web datablade.  The 
<a href="db.html#LVARCHAR, CLOB, and HTML">HTML datatype</a>
from the Web datablade
uses CLOBs.

<p>When ZFIN went from Informix 9.21 to 9.30 in 2003, we went from a single
smart BLOB space with lots of chunks, to 4 smart BLOB spaces, each with a
small number of chunks (at least on production).  The hope is that we would
get better parallel reads of smart BLOBs.  Smart BLOB columns with only a
small amount of data are PUT in a single smart BLOB space, while columns with
a lot of data are 
<a href="#Fragmentation">fragmented (round robin)</a> 
into all 4 smart BLOB spaces.

<p>At that time we also added a default smart BLOB space (smartdfltbs) to hold
smart BLOBs that are not explicitly PUT in one of the other smart BLOB spaces.
This is mostly/entirely used by web datablade tables.  Starting with Informix 
9.30 ZFIN also has a temporary smart BLOB space as well.  Initial indications
are that this is not useful.



<h4 class="zdoc"><a name="Temporary dbspaces">Temporary dbspaces</a></h4>

<p>Prior to our performance problems in late 2004 (see 
<a href="http://zfinwinserver1.uoregon.edu/fogbugz/default.asp?pg=pgEditBug&amp;command=view&amp;ixbug=452">FogBUGZ case 452</a>)
we always put temporary dbspaces on drives that were not in any 
<a href="#RAID and Informix">RAID level</a>.  RAID 10 (production) 
and RAID 5 (development) make the most sense when 
you have many more reads than writes on data, since every write requires 
2 writes to the disk.  Temporary dbspaces have an almost equal number of 
reads and writes.  

<p>Prior to 2004/10 we were willing to put temporary dbspaces on disks that
might have been busy with other partitions, such as / or /private.  However,
with the increased use of 
<a href="standards.html#Temporary Tables in App Pages">temporary tables 
in app pages</a> that came with 
gene expression search form work in late 2004 (see 
<a href="http://zfinwinserver1.uoregon.edu/fogbugz/default.asp?pg=pgEditBug&amp;command=view&amp;ixbug=27">FogBUGZ case 27</a>), 
we started getting bottlenecks on
our temp tables.  At that time we stopped using temporary dbspaces on
high-activity non-RAID disks and created several new ones on RAID disks.
This helped a lot.



<h3 class="zdoc"><a name="Tables and Indexes">Tables and Indexes</a></h3>


<h4 class="zdoc"><a name="Fragmentation">Fragmentation</a></h4>

<p>In Informix a table is stored in one or more 
<a href="#DB Spaces">dbspaces</a>.  If a table is stored in more than one
dbspace, then it is <i>fragmented</i>.  Where a table is stored 
and whether or not it is fragmented, is specified at table creation time.

<p><b>Types of Fragmentation</b>

<p>Informix supports 2 types of fragmentation:
<ul>
  <li><b>Round Robin.</b>  New records are placed in the different dbspaces
    using a round robin strategy, leading to an approximately equal number 
    of records from that table in each dbspace the table is fragmented into.
  <li><b>Expression Based.</b>  Which fragment a record is placed in is 
    determined by a value or values in the record.  For example, records 
    might be fragmented based on linkage group values, with each different 
    linkage group going to a different fragment.
</ul>

<p>Both types of fragmentation are good for speeding up disk accesses.  
Fragmenting a table across multiple dbspaces allows Informix to fire off
simultaneous read requests for each dbspace that a table is fragmented 
into.  This is useful when doing full table scans.

<p>In additon, expression based fragmentation also has the potential to 
greatly reduce the number of records read for some queries.  In the linkage
group example, if a query has an equality comparison on the linkage group
column that was used to do the fragmentation, then Informix will only read
records in that fragment.

<p>As of 2002/01, ZFIN uses round robin fragmentation extensively, but does
not use expression based fragmentation at all.  The main reason we don't use
expression based fragmentation is because most of our data does not lend 
itself to usable fragmentation policies.  Fragmenting by ZDB ID makes no 
sense at all, since when we are querying on ZDB IDs we are usually looking
for a specific record (rather than a large group of records).  The same 
logic applies to names and abbreviations as well.  In fact, linkage groups 
and mapping panels
are the only obvious examples where expression based fragmentation might 
pay off in ZFIN.

<p>However, even using linkage group for fragmentation has risks.  In 
particular, there are over 20 linkage groups in zebrafish.  In order to get
the full benefits of expression based fragmentation we might need to create
a fragment for each linakge group.  In other words, we would need over 20 
fragments and therefore over 20 dbspaces.  ZFIN currently has 3 
<a href="#Table dbspaces">table dbspaces</a>.  Adding over 20 more is a 
non-trivial task, and while it might be worthwhile, it should not be done
without first determining if it is really worth it.


<p><b>Round Robin Fragmentation in ZFIN</b>

<p>In general, large tables in ZFIN are fragmented across 3
<a href="#Table dbspaces">table dbsapces</a> using round robin fragmentation.



<h4 class="zdoc"><a name="Extent Sizes">Extent Sizes</a></h4>

<p>Space within a <a href="#DB Spaces">dbspace</a> is reserved for tables 
in contiguous blocks of disk pages called <i>extents</i>.  A given extent
will hold only records for the table the extent was allocated for.  When
an extent fills up, another extent is allocated.  Tables that are 
<a href="#Fragmentation">fragmented</a>
are initially allocated one extent in each dbspace the table is fragmented
into.

<p>The extent size for a table is declared when the table is defined.
Informix recommends that extents be large enough to hold all of the records
for a table in that fragment.  That is, each table should have only 1 allocated
extent in each dbspace the table is stored in.

<p>All ZFIN tables are assigned explicit extent sizes, and those explicit 
extent size are <i>always</i> in powers of 2.  The hope is that by using only
powers of 2, the disk will become less fragmented over time.  That also lines
up nicely with the read ahead values in the onconfig file for the server.
Both RA_PAGES and RA_THRESHOLD are defined as powers of 2.

<p>Extent sizes are used at ZFIN to determine when to fragment a table and
when to keep it all in one dbspace.  The rule of thumb is something like:

<ul>
 <li>If all data can fit in a single extent less than 128 KB in size then 
   don't fragment the table.
</ul>

<p>Extent sizes should be reviewed at least once a year.  Usually they need
to grow.



<h4 class="zdoc"><a name="Lock Mode">Lock Mode</a></h4>

<p>A table's lock mode specifies the granularity at which database locks are
obtained on that table.  There are two options

<ul>
 <li><b>Row</b>: Only the needed record is locked.
 <li><b>Page</b>: All records on the same page as the needed record are locked.
</ul>

<p>Page level locking results in fewer locks (since there are multiple records
on each page) for the locking process and therefore it runs faster.  However,
it means that the locking process may be locking records it actually doesn't
need, thereby unnecessarily preventing other processes from getting the data
they need.

<p>Row level locking allows for better concurrency, but can have an extremely
negative performance impact on processes that update large number of records.

<p>Because of the tradeoffs involved, ZFIN uses a mixture of row level and 
page level locking.  (Before upgrading to Informix 9.30 in 2003/08, ZFIN used
almost entirely page level locking.  It was fast, but we often got concurrency
problems.)

<p>For each table, ZFIN uses this set of general guidelines to determine what 
the lock granularity should be.  These rules are guidelines; they are not hard
and fast.

<ul>
  <li><b><a href="db.html#Fast Search Tables">Fast search tables</a></b> 
    use page level locking.  
    These tables are updated
    by a single process, and that process updates every record in the table.
    Therefore we wouldn't gain any concurrency by using row level locks and
    all they would do is slow down table creation.

  <li><b>Large tables (more than 20,000 records)</b> use page level locking.  
    It is just too expensive to get
    tens of thousands or hundreds of thousands of locks when processing a 
    large table.  However, there is an exception to this rule.  

    If large updates to the table (where many/all records are updated) 
    are a rare thing, then use row
    level locking.  This will increase concurrency for the curators.
    However, those occassional large updates will suffer reduced 
    performance.

  <li><b>Small tables (less than 20,000 records)</b> use row level locking.
    However, if there are more than 10,000 records in the table and
    updates to most of the records happen on a regular basis then 
    consider using page level locking.
</ul>




<h4 class="zdoc"><a name="Constraint Names">Constraint Names</a></h4>

<p>Wherever possible, database constraints (primary key, unique, foreign key,
check, not null) are assigned explicit names.  This makes table definitions
longer, but it has two pleasant side effects:

<ul>
  <li><b>Better error messages.</b>
    In some error messages, the name of a violated constraint is also
    displayed, providing useful information.  System generated constraint
    names look like "U101_345" and are not useful in error messages.
  <li><b>Easier to drop constraints.</b>  If you don't name a constraint 
    then you have to look up the system generated name in the data dictionary
    and that is time consuming.
</ul>



<h4 class="zdoc"><a name="Primary Key, Unique, and Foreign Key Indexes">
             Primary Key, Unique, and Foreign Key Indexes</a></h4>

<p>Informix requires an index to support each primary key, foreign key, 
or unique constraint defined in the database.  If an index already exists
for the columns in the constraint then Informix will use the existing 
index to support the constraint.  If an index does not already 
exist then Informix will automatically build one.

<p>Unfortuantely, there is no way to control where such automatically built
indexes are placed.  Anytime Informix has to create an index to support 
a constraint it places the index in the 
<a href="#Default dbspace">default dbspace</a>.  This is undesireable 
on a number of levels.  First, defaultdbs is busy handling other things like 
the data dictionary.  Secondly, it doesn't allow us to load balance our
indexes as described in <a href="#Index dbspaces">Index dbspaces</a> above.

<p>In order to control where these indexes go on disk we define our tables
in a particular way.

<ol>
  <li>Define the table without any primary key, unique, or foreign key 
    constraints on it.
  <li>For each primary key, unique, or foreign key constraint we want to 
    place on the table, we define an index to support the constraint,
    and then we add the constraint.
</ol>

<p>This leads to large awkward looking table definitions (see below),
but it is the only way to control where indexes are placed.



<h4 class="zdoc"><a name="Example Table Definition">Example Table Definition</a></h4>

<p>Here is an example table defintion.   It includes 
<a href="#Extent Sizes">extent size</a>, 
<a href="#Fragmentation">round robin fragmentation</a>, 
<a href="#Constraint Names">explicitly named constraints</a>, and 
<a href="#Primary Key, Unique, and Foreign Key Indexes">
explicit placement of primary key, unique and foreign key indexes</a>.

<div class="sql">
create table anatomy_item 
  (
    anatitem_zdb_id                varchar(50),
    anatitem_name                  varchar(80),
    anatitem_comments_relative_url lvarchar
      not null 
        constraint anatitem_comments_relative_url_not_null,
    anatitem_start_stg_zdb_id      varchar(50)
      not null 
        constraint anatitem_start_stg_zdb_id_not_null,
    anatitem_end_stg_zdb_id        varchar(50) 
      not null 
        constraint anatitem_end_stg_zdb_id_not_null
  ) 
  fragment by round robin in tbldbs1 , tbldbs2 , tbldbs3  
  extent size 128 next size 128 lock mode page;
revoke all on "informix".anatomy_item from "public";

-- primary key

create unique index anatomy_item_primary_key_index
  on anatomy_item (anatitem_zdb_id)
  in tbldbs4;

alter table anatomy_item add constraint
  primary key (anatitem_zdb_id)
    constraint anatomy_item_primary_key;

-- alternate keys

create unique index anatitem_name_index
  on anatomy_item (anatitem_name)
  in tbldbs4;

alter table anatomy_item add constraint
  unique (anatitem_name)
    constraint anatitem_name_unique;


-- foreign keys

create index anatitem_start_stg_zdb_id_index
  on anatomy_item (anatitem_start_stg_zdb_id)
  in tbldbs4;

alter table anatomy_item add constraint 
  foreign key (anatitem_start_stg_zdb_id)
    references stage
    constraint anatitem_start_stg_zdb_id_foreign_key;

create index anatitem_end_stg_zdb_id_index
  on anatomy_item (anatitem_end_stg_zdb_id)
  in tbldbs4;

alter table anatomy_item add constraint 
  foreign key (anatitem_end_stg_zdb_id)
    references stage
    constraint anatitem_end_stg_zdb_id_foreign_key;
</div>

<p>Which is an awful lot of text just to define a table with 6 columns,
a primary key, an alternate key and 3 foreign keys.


<!-- =================================================================== -->
<!-- ========= Apache and Web Datablade Administration ================= -->
<!-- =================================================================== -->

<h1 class="zdoc"><a name="Apache and Web Datablade Administration">
                          Apache and Web Datablade Administration</a></h1>

<p>ZFIN uses Apache as its web server.  When an HTTP request arrives the
operating system routes it to Apache and then Apache either returns the
requested page (in the case of static pages), or routes the request to
the appropriate process/module (in the case of dynamic pages).  See
the <a href="impl.html#Big Picture">big picture</a>.

<P>ZFIN uses the Informix Web DataBlade to tie together Apache and 
Informix.  ZFIN pages that access the database start with a particular 
URL. Apache recognizes that URL and passes all such requests off to 
the webdriver module which is actually running inside the Apache
process.  (The webdriver module can be thought of as the "client" part of
the Web Datablade.)  
The webdriver module sends the request to Informix, invoking the Web Datablade
to retrieves the requested dynamic page
from the database, interprets it, including the execution of SQL statements,
and then returns the formatted results back to Apache, which in turn returns
the page to the outside world.



<!-- ========= Versions =============================================== -->

<h2 class="zdoc"><a name="Versions">Versions</a></h2>

<p>ZFIN tries to always run the latest version of Apache 1.3.

<p>Prior to the release of Web Datablade 4.13.FC3 in 2004, any given 
version of the Web DataBlade was <i>officially</i> supported only 
with certain versions of Apache.  However, we always got away with using the
latest Apache.  In 4.13.FC3, they now officially support any version of 
Apache, including Apache 2.0.



<!-- ========= Apache ================================================== -->

<h2 class="zdoc"><a name="Apache">Apache</a></h2>

<p>The Apache web site (<a href="http://www.apache.org">www.apache.org</a>)
is a great source of information about Apache.  It is also where you can find
versions of Apache for download.  ZFIN also owns the book 
<i>Apache Server Unleashed</i> which is also a good source of information.


<p>The Apache source and executables can be found in the same places on all
ZFIN server machines.  The source is under 
<span class="file">/private/apps/apache</span> (which is a
sym link to <span class="file">/private/apps/apache-<i>version</i></span>).  
The executables, configuration files, and logs can be found under 
<span class="file">/private/httpd</span>.  
The Apache
executable itself is at <span class="file">/private/httpd/bin/httpd</span>.

<p>When we upgraded Informix to 64-bit, we also upgraded Apache to 64-bit.
This means that the both the client parts of the Web Datablade (i.e., webdriver)
and the server side of the Web Datablade can both come from the same 64-bit
release of the Web Datablade.

<p>Note that as long as we use TCP/IP to communicate with Informix (we do),
it is not strictly required to have Apache be 64 bits.  It is acceptable, and
supported by IBM, to have Apache run a 32 bit webdriver, and Informix be
64-bit (and have a 64-bit Web Datablade), as long as both the client and
server parts came from the same release of the Web Datablade (e.g, 4.13.UC2 
and 4.13.FC2).

<p>The next time Dave upgrades Apache, 
Dave will add directions on how to do it.
It is a mostly standard process with the addition of the web datablade 
module.  Also have to modify apachectl.




<h3 class="zdoc"><a name="Starting, Stopping, and Restarting Apache">
             Starting, Stopping, and Restarting Apache</a></h3>

<p>One script, <span class="file">/private/httpd/bin/apachectl</span>, 
is used to start, 
stop and restart Apache.  The script takes a single argument:
<table border="0">
 <tr>
  <td valign="top"><b>start</b></td>
  <td>Start apache without <a href="#SSL">SSL</a>.  Use this on the 
    <a href="impl.html#Production Server">production server</a>, which as
    of 2004/11 does not have SSL installed on it.
  </td>
 </tr>
 <tr>
  <td valign="top"><b>startssl</b></td>
  <td>Start apache with <a href="#SSL">SSL</a>.  Use this on the 
    <a href="impl.html#Development Server">development server</a>, which does
    have SSL installed on it.
  </td>
 </tr>
 <tr>
  <td valign="top"><b>stop</b></td>
  <td>Kills the apache server.</td>
 </tr>
 <tr>
  <td valign="top"><b>restart</b></td>
  <td>This is a hard restart of the Apache server.  That is, any running 
    process will be immediately terminated.  The users will not get anything
    back.  It will be as if they never submitted the request.  This causes
    Apache to reread its 
    <a href="#httpd.conf Configuration File">configuration file</a>.
  </td>
 </tr>
 <tr>
  <td valign="top"><b>graceful</b></td>
  <td>This lets any running requests finish before their processes are 
    terminated.  This causes Apache to reread its
    <a href="#httpd.conf Configuration File">configuration file</a>.
  </td>
 </tr>
</table>

<p>Apache must be started, stopped, or restarted as root.  



<h3 class="zdoc"><a name="Monitoring Apache">Monitoring Apache</a></h3>

<p>To find out who has been hitting the production web site recently, run 
this command:

<div class="shellline">
  % tail -1000 /private/httpd/logs/access_log | cut -f1 -d " " | sort | uniq -c | sort | tail -10
</div>

<p>This tells you the top 10 IP addresses for the last 1000 requests.
The error log should also be checked on a regular basis.




<h3 class="zdoc"><a name="httpd.conf Configuration File">
             httpd.conf Configuration File</a></h3>

<p>Apache uses a single configuration file to tell it what to do.  This file
is located in the same place on all ZFIN server machines:

<div class="fileline">
  /private/httpd/conf/httpd.conf
</div>

<p>All our Apache configuration files are kept under source code control
(under RCS).  The contents of the files vary substantially from machine to
machine.



<h4 class="zdoc"><a name="Production httpd.conf">Production</a></h4>

<p>On <a href="impl.html#Production Server">production</a>, 
the httpd.conf file is actually a sym link to one of these
files:
<br><br>

<table class="zdoc">
 <tr>
  <td><span class="file">httpd.conf.main</span>
  <td>Used when the site is up and running normally.
 <tr>
  <td><span class="file">httpd.conf.down</span>
  <td>Used when the site is down.  
 <tr>
  <td><span class="file">httpd.conf.down.outside</span>
  <td>Used when the site is down to the outside world, but up for a select
   number of ZFIN machines.  This is useful when doing major work on the site.
   It allows you test the health of the site without making the potentially
   ill site visible to the world.
</table>

<p> The production version of httpd.conf has aliased references to the
ZFIN production loadUp directories.  We are able to secure and view images 
and PDFs in our filesystem because of these aliases.  
PDFs are restricted to be viewed by ZFIN staff only.  
Images are viewable by all users.  By having these aliases we can 
disguise the locations of our image and pdf repository, and paths to thes files
do not need to be hardcoded.

<h4 class="zdoc"><a name="Development httpd.conf">Development</a></h4>

<p>The <a href="impl.html">development server</a> has only one httpd.conf file.  
It supports over 
<a href="impl.html#Development DB Matrix">20 web sites</a>, while the 
<a href="#Production httpd.conf">production server</a> supports only 
<a href="impl.html#Production DB Matrix">2 web sites</a>.  
Because of this, the httpd.conf file on 
development looks radically different from the versions on production.

<p>The development server's configuration file first defines the 
embryonix.cs.uoregon.edu web
site (which only exists when it is zfin.org).  
The settings for embryonix.cs also become the default settings for
the VirtualHost definitions at the end of the file.  Each of the web sites
supported by the development server has a VirtualHost entry where that defines 
that web site.
The VirtualHost entries tend to be short and contain define only settings
where the defaults from the front of the file should not be used.

<p>The VirtualHost entries follow 3 basic formats:
<br><br>

<table class="zdoc">
 <tr>
  <th>Format
  <th>Explanation
 </tr>
 <tr>
  <td class="term">Development</td>
  <td>Web site is a development web site with a backing database.
      These may or may be accessible outside the University of Oregon.
  </td>
 </tr>
 <tr>
  <td class="term">Mirror</td>
  <td>Web site is defined as a mirror site with not backing database.
      Supports only static pages.
  </td>
 </tr>
 <tr>
  <td class="term">Unused</td>
  <td>Web site is unallocated</td>
 </tr>
</table>

<p> The development version of the httpd.conf files also contain 
aliases to the development loadUp filesystem.

<!-- ========= Web Datablade =========================================== -->

<h2 class="zdoc"><a name="Web Datablade">Web Datablade</a></h2>

<p>Dave?



<h3 class="zdoc"><a name="web.cnf Configuration File">web.cnf Configuration File</a></h3>

<p>Like Apache, webdriver has a single configuration file to tell it 
what to connect to and how to do it.  This file
is located in the same place on all ZFIN server machines:

<div class="fileline">
  /private/httpd/conf/web.cnf
</div>

<p>The <span class="file">web.cnf</span> file is broken into several sections:
<ul>
 <li><b>Global Settings.</b>  These determine if 
  <a href="#webdriver Log">webdriver logging</a> will be on and at what 
  level.  It also indicates if webdriver is running inside Apache (which it
  is) or as a standalone process (which it used to).
 </li>
 <li><b><a href="impl.html#Informix Environment Variables">Informix 
  environment variable settings</a></b>.
  These determine which Informix 
  engine the webdriver will connect to.
 </li>
 <li><a name="Webdriver Mappings"><b>Mappings.</b></a>
  These tell webdriver what paths it should recognize, and what database 
  and user it should connect to for each path.  In order for these to 
  work there must also be a corresponding entry in the Apache
  <a href="#httpd.conf Configuration File"><span class="file">httpd.conf</span></a>
  file.
 </li>
</ul>


<p><span class="file">web.cnf</span> is kept under source code control
(under RCS).



<h3 class="zdoc"><a name="admin Mappings">admin Mappings</a></h3>

<p>These are necessary evils.  Dave?


<!-- ========= Adding a New Web Site =================================== -->

<h2 class="zdoc"><a name="Adding a New Web Site">Adding a New Web Site</a></h2>

<p>This section assumes that you are bringing up a new site on the
<a href="impl.html#Development Server">development server</a>.

<p>There a number of steps you need to go though to bring up a new site.
Some sites are already partially defined, so you won't need to do all 
these steps.  "Partially defined" means that the server name has already 
been defined in DNS.  Additionally, there may also already be an entry 
for the site in the Apache 
<a href="#httpd.conf Configuration File"><span class="file">httpd.conf</span></a>
configuration file.

<p>Here is the process for adding a new ZFIN web site.

<ol>
 <li><b>Register the web site name in DNS.</b>
  <p>To find out if the name is already registered in DNS, ping the 
  web site name.  For instance to find out if manx.zfin.org is defined
  in DNS, type

  <div class="shell">
  % ping manx.zfin.org
  manx.zfin.org is alive
  %
  </div>

  <p>If manx had not existed ping would have returned

  <div class="shell">
  % ping manx.zfin.org
  ping: unknown host manx.zfin.org
  </div>

  <p>If <span class="shell">ping</span> indicates the host is unknown 
  then tell Dave C
  that we have some serious IP troubles.
  <br><br>
 </li>
 <li><b>Add the site name to the server's
  <a href="#httpd.conf Configuration File"><span class="file">httpd.conf</span></a>
        configuration file.</b>
  <p>Either add the site to the file, or if it is already there update
  it to be the <a href="#Development httpd.conf">type</a> of site you want.  
  Just cut, 
  paste, and modify the definition of a similar site.  You must have 
  sudo capabilities to edit the Apache configuration file.
  <br><br>

 <li><b>Restart Apache.</B>
  <p>Either run <span class="file">restartapache.pl</span> or 
  <a href="#Starting, Stopping, and Restarting Apache"><span class="file">apachectl</span></a>
  to restart Apache.
  <br><br>
 </li>
 <li><b>Add a <a href="#Webdriver Mappings">webdriver mapping</a> for the 
  site</b>.
  <p>To do this you must have sudo ability, and you must know the password
  of the <a href="#ZFIN Usernames">zfinner</a> user.  Enter
  <div class="shell">
  % setenv MI_WEBCONFIG /private/httpd/conf/web.cnf
  % sudo $INFORMIXDIR/extend/web.<i>version</i>/utils/webconfig -addmap -p /cgi-bin_<i>VirtualHost</i> -n zfin -d <i>dbname</i> -u zfinner
  </div>

  <P>where
  <table border="0">
   <tr>
    <td><span class="shell">cgi-bin_<i>VirtualHost</i></span></td>
    <td>The cgi-bin directory for the new web site.  For example,
     <span class="shell">cgi-bin_albino</span>.
    </td>
   </tr>
   <tr>
    <td><span class="shell"><i>dbname</i></span></td>
    <td>Name of the database backing the site.  For example, 
      <span class="shell">clemdb</span>.
    </td>
   </tr>
  </table>

  <P>The program will ask for zfinner's password twice.  Once it has that it
  will create a mapping in the <span class="file">web.cnf</span> file.

  <p><b>Note:</b> If and when zfinner's password changes, the connection
  to the database will stop working because the 
  <span class="file">web.cnf</span> file now
  contains their old password.  See 
  <a href="#Reassigning a Web Site">Reassigning a Web Site</a> for how to 
  deal with changed passwords.
  <br><br>
 </li>
 <li><b>Create a directory to hold the web site.</b>
  <p>The filesystems behind all of the development web sites reside in the same
  place:

  <div class="fileline">
  <a href="impl.html#ZFIN Central">/research/zcentral/</a>www_homes
  </div>

  <p>Create a new subdirectory for the new web site.  Change its ownership 
  to the primary developer for the site and set the group to fishadmin.
 </li>
</ol>



<!-- ========= Reassigning a Web Site ================================== -->

<h2 class="zdoc"><a name="Reassigning a Web Site">Reassigning a Web Site</a></h2>

<p>Reassigning a web site is almost as much work as 
<a href="#Adding a New Web Site">creating a new one</a>.  Some of the 
steps are the same.

<ol>
 <li><b>Check the web site's definition in the development server's
  <a href="#httpd.conf Configuration File"><span class="file">httpd.conf</span></a>
        configuration file.</b>
  <p>If the site used to be a different 
  <a href="#Development httpd.conf">type</a> of site 
  then you will need to update its definition.  Most of the time you 
  can use the one that is already there.  You must have 
  sudo capabilities to edit the Apache configuration file.
  <br><br>
 </li>
 <li><b>Restart Apache.</B>
  <p>If you modified the Apache configuration file in the first step then 
  you will need to restart Apache.
  Either run <span class="file">restartapache.pl</span> or 
  <a href="#Starting, Stopping, and Restarting Apache"><span class="file">apachectl</span></a>
  to restart Apache.
  <br><br>
 </li>
 <li><b>Replace the <a href="#Webdriver Mappings">webdriver mapping</a> for the 
  site</b>.
  <p>To do this you must have sudo ability, and know the password for the 
  <a href="#ZFIN Usernames">zfinner</a> user.  
  First, comment out the old webdriver 
  mapping for the site in the 
  <a href="#web.cnf Configuration File"><span class="file">web.cnf</span></a> 
  configuration mile.

  <p>Save the file.  Once that is done, create the new entry:

  <div class="shell">
  % setenv MI_WEBCONFIG /private/httpd/conf/web.cnf
  % sudo $INFORMIXDIR/extend/web.<i>version</i>/utils/webconfig -addmap -p /cgi-bin_<i>VirtualHost</i> -n zfin -d <i>dbname</i> -u zfinner
  </div>

  <P>where
  <table border="0">
   <tr>
    <td><span class="shell">cgi-bin_<i>VirtualHost</i></span></td>
    <td>The cgi-bin directory for the new web site.  For example,
     <span class="shell">cgi-bin_albino</span>.
    </td>
   </tr>
   <tr>
    <td><span class="shell"><i>dbname</i></span></td>
    <td>Name of the database backing the site.  For example, 
      <span class="shell">clemdb</span>.
    </td>
   </tr>
  </table>

  <P>The program will ask for zfinner's password twice.  Once it has that it
  will create a mapping in the <span class="file">web.cnf</span> file.

  <p><b>Note:</b> This step is necessary whenever zfinner's password changes.
  The connection
  to the database will stop working because the 
  <span class="file">web.cnf</span> file now
  contains the old password.
  <br><br>
 </li>
 <li><b>Change the ownership of the directory that holds the web site.</b>
  <p>The filesystems behind all of the development web sites reside in the same
  place:

  <div class="fileline">
  <a href="impl.html#ZFIN Central">/research/zcentral/</a>www_homes
  </div>

  <p>Change the web site directory's ownership to the new 
  primary developer for the site and set the group to fishadmin.
  Remove everything below the top directory for the website.
 </li>
</ol>




<!-- ========= Web Logs ================================================ -->

<h2 class="zdoc"><a name="Web Logs">Web Logs</a></h2>


<h3 class="zdoc"><a name="Apache Logs">Apache Logs</a></h3>

<p>We have configured our Apache servers to generate 3 log files:

<table class="zdoc">
 <caption>Apache Log Files</caption>
 <tr>
  <th>File Name
  <th>Explanation
 <tr>
  <td><span class="file">access_log</span>
  <td>Records what pages were requested when, from where, using what OS, and
      what the referring page was.  This is the main Apache log.
 <tr>
  <td><span class="file">referer_log</span>
  <td>Records the pages that referred the user to this page.  We probably don't
      need this file as this information is also available in the 
      <span class="file">access_log</span>  file.
 <tr>
  <td><span class="file">error_log</span>
  <td>Errors that Apache has encountered.  This is one of two good places to
      check when your browser indicates the server had a problem.
</table>

<p>The Apache log files reside under:

<div class="fileline">
  /private/httpd/logs/
</div>

<p>On the <a href="impl.html#Production Server">production server</a>, 
the log files reside directly in that directory.  
On the <a href="impl.html#Development Server">development server</a>, each
web site has its own subdirectory under the <span class="file">logs</span> 
directory, and the
subdirectory contains the log files.

<p>The formats, number and names of the Apache log files are all set in the
<a href="#httpd.conf Configuration File"><span class="file">httpd.conf</span></a>
file.




<h3 class="zdoc"><a name="webdriver Log">webdriver Log</a></h3>

<p>The webdriver process/module also has a log file.  The log file is 
turned on or off in the 
<a href="#web.cnf Configuration File"><span class="file">web.cnf</span></a> 
file.  
The amount of information that is
logged is also set in <span class="file">web.cnf</span>.

<p>In addition to the Apache logs, the webdriver log is the second great
place to look when trying to debug a problem with a dynamic page.  

<p>The webdriver log is generally turned off on the 
<a href="impl.html#Production Server">production server</a>.  We occasionally
turn it on when we are trying to track a problem, but we don't leave
it on for long.
webdriver logging is also usually turned off on the 
<a href="impl.html#Development Server">development server</a> as well.  The
weekend <a href="impl.html#Uniquery">Uniquery</a> indexing run hits every page
in the web site and makes the webdriver log enormous.  If you turn it on, 
make sure you turn it off before the weekend.

<p>he webdriver log, when it is on, can be found at
<div class="fileline">
  /tmp/webdriver.log
</div>
<p>on either machine.




<h3 class="zdoc"><a name="Log Analysis">Log Analysis</a></h3>

<p>Tom: write this?


<h3 class="zdoc"><a name="webrotate.pl">webrotate.pl</a></h3>

<p><a href="http://cvs.zfin.org/cvs/cvsweb.cgi/ZFIN_WWW/server_apps/WebSiteTools/webrotate.pl"><span class="file">webrotate.pl</span></a> 
is a PERL script that is run monthly by root (via 
<a href="#cron"><span class="shell">cron</span></a>) to close the Apache 
logs for the just ended month and open new logs for the month that just started.
It also replaces the IP addresses in the log files with domain names, and then
compresses the files.

<p>webrotate.pl fires off at 
midnight on the first day of the month.  The output files of webrotate are 
placed in a subdirectory of the Apache logs directory called 
<span class="file">old</span>.
Eventually they are manually copied to the 
<a href="impl.html#ZFIN Archive">ZFIN Archive</a> Logs directory.



<!-- ========= SSL ===================================================== -->

<h2 class="zdoc"><a name="SSL">SSL</a></h2>

<p>SSL stands for Secure Socket Layer, and it enables you to pass encrypted
HTTP requests.  Prior to the Informix port in 2000/03, ZFIN supported SSL.
However, when we migrated to <a href="impl.html#Past Servers">chromix</a>, 
we couldn't get SSL to work.  So it 
was turned off at that time.  It remains off.

<p>We have had some users complain about the lack of security on our login
page.

<p>In 2004 we started the process of adding SSL back into ZFIN.  See FogBUGZ
<a href="http://zfinwinserver1.uoregon.edu/fogbugz/default.asp?pg=pgEditBug&amp;command=view&amp;ixBug=261">case 261</a>
for details on this.


<!-- =================================================================== -->
<!-- ========= System Administration =================================== -->
<!-- =================================================================== -->

<h1 class="zdoc"><a name="System Administration">System Administration</a></h1>

<p>ZFIN started out as a stand alone environment in which ZFIN was 
responsible for doing all its own systems administration.  This meant
that ZFIN could be up even if CIS's servers were down, as long as the
network was up.

<p>However, this arrangement got us into trouble.  It took a lot of time
and effort and ZFIN failed to keep current with operating systems upgrades 
and patches.  Eventually we were hacked into.  The decision 
was made in 1999 that ZFIN would stop doing its own sys admin and that we
would start using the CIS system administration staff.  This would keep us
current and would leverage the expertise of a full time systems staff.

<p>The cost of this was that ZFIN is now an integrated part of CIS.  If
the CIS servers are down, then ZFIN is also effectively down as well.

<p>Most of ZFIN's sys admin work is done by the CIS sys admin staff.  However,
there is a small subset that is done by ZFIN staff.  This section describes 
that work.


<!-- ========= ZFIN Usernames ========================================== -->

<h2 class="zdoc"><A NAME="ZFIN Usernames">ZFIN Usernames</a></h2>

<p>Beside the regular user names of the ZFIN staff (e.g. clements, eriks),
there are several usernames that are used to run and support ZFIN:

<ul>
 <li><p><b>informix</b>  This user is required to exist by the Informix 
   software.  The Informix engine runs under this user, and all Informix
   software is installed under this user.  This user has absolute privileges
   within a database.  In addition, ZFIN also uses this user to build the
   <a href="intro.html#Production Site">production</a> and 
   <a href="intro.html#Pre-Production Site">pre-production</a> sites, as well 
   as the <a href="intro.html#Mirros Sites">mirror</a> site.
 </li>
 <li><p><b>zfinadmn</b>  This login is for use by Sherry.</li>
 <li><p><b>zfinner</b>  Accesses to the database that come in through the 
   production web site (and some of the test sites) connect to the database
   as this user.
 </li>
 <li><p><b>zfishweb</b>  The Apache web server runs as this user.</li>
</ul>


<!-- ========= ZFIN Groups ============================================= -->

<h2 class="zdoc"><a name="ZFIN Groups">ZFIN Groups</a></h2>

<p>There are at least 5 types of groups in Solaris.  ZFIN has 3 of these types
of groups:

<ul>
  <li>mail Groups
    <p>These are basically e-mail aliases that are used to group together 
    multiple e-mail addresses under one address.  Mail sent to a mail group
    address will be distributed to all members of the group.
    <ul>
      <li><b>fish_health</b>
        <br>E-mail alias for list of people who get fish health related 
	e-mails.  This address appears in the web site.
      <li><b>fish_requests</b>
        <br>E-mail alias for list of people who get e-mails requesting 
	fish from ZIRC.
	This address appears in the web site.
      <li><b>locusreg</b>
        <br>E-mail alias for list of people who get an emails whenever
	a new locus registration is enterred into ZFIN.
	This address appears in the web site.
      <li><b>nomenclature</b>
        <br>E-mail alias for zebrafish nomenclature committee.
	This address appears in the web site.
      <li><b>zfin_curators</b>
        <br>E-mail alias for ZFIN curators.  As of 2002/11 this is not
	used in the web site, but we think it should be.
	<br><br>
    </ul>
  <li>netgroup Groups
    <p>This type of group is used to restrict who can log into a particular
    machine.  ZFIN uses these to restrict who can log into ZFIN machines.
    These groups are listed in the <span class="file">/etc/passwd</span>
    files on ZFIN machines.
    <ul>
      <li><b>zfindevl</b>
        <br>Used to restrict who can log onto ZFIN's development machines.
      <li><b>zfinprod</b>
        <br>Used to restrict who can log onto ZFIN's production machine.
        <br><br>
    </ul>
  <li>unix Groups
    <p>This is what you usually think of when you think of groups in Unix.
    These are used to restrict access to files.
    <ul>
      <li><b>informix</b>
        <br>Group required for the informix user.  Informix software must
	be installed with this group, and raw disk must belong to this group.
      <li><b>fishauth</b>
        <br>ZFIN staff.
      <li><b>fishadmin</b>
        <br>A subset of ZFIN staff that are likely to be doing extensive
	work on Unix machines.
    </ul>
  <li>Oddball groups
    <ul>
      <li><b>zfinadmin</b>
        <br>This group exists solely to allow multiple members of ZFIN to
	  update the ZFIN groups listed above.
    </ul>
</ul>

<p><span class="shell">grpmod</span> is the command of choice for managing 
these groups.


<!-- ========= Ports and Services ====================================== -->

<h2 class="zdoc"><A NAME="Ports and Services">Ports and Services</a></h2>

<p>ZFIN uses a variety of ports/services to support a variety of functions.
Traditionally, ZFIN has been assigned ports in the range 2000 to 2010.  Port
assignments are the same across all CS servers.  Thus when a port is assigned 
to ZFIN, it is assigned to ZFIN on all the ZFIN servers, plus all the CS
servers.

<table class="zdoc">
 <caption>Ports and Services at ZFIN</caption>
 <tr>
  <th>Port</th>
  <th>Service Name</th>
  <th>Used on</th>
  <th>Explanation</th>
 </tr>
 <tr>
  <td>2000</td>
  <td>informix_tli</td>
  <td>ix</td>
  <td>Informix (onlinix) on ix.  This is the instuctional IDS engine.</td>
 </tr>
 <tr>
  <td>2001</td>
  <td>cockpit</td>
  <td>unused</td>
  <td>on-cockpit is an Informix product that ZFIN does not use (and that has
    not been pushed by Informix since at least 2000).  I would bet 
    this was created by Clif to support on-cockpit.
  </td>
 </tr>
 <tr>
  <td>2002</td>
  <td>zfin_tli</td>
  <td>embryonix</td>
  <td>Informix (wanda) on the
    <a href="impl.html#Development Server">development server</a>.  
    This is ZFIN's test/development IDS engine.</td>
 </tr>
 <tr>
  <td>2003</td>
  <td>open</td>
  <td>unused</td>
  <td>&nbsp;</td>
 </tr>
 <tr>
  <td>2004</td>
  <td>chrom_tli</td>
  <td>unused</td>
  <td>This is available on all machines. Its name is leftover from the days when
    our <a href="impl.html#Production Server">production server</a> was named
    <a href="impl.html#Past Servers">chromix</a>.
  </td>
 </tr>
 <tr>
  <td>2005</td>
  <td>zfin1_tli</td>
  <td>helix</td>
  <td>Informix (wildtype) on the 
    <a href="impl.html#Production Server">production server</a>.  
    This is ZFIN's production IDS engine.</td>
 </tr>
 <tr>
  <td>2006</td>
  <td>informix_isa</td>
  <td>embryonix<br>
    helix</td>
  <td>The Apache port used by 
    <a href="#Informix Server Administrator (ISA)">Informix Server
    Administator (ISA)</a>.  To access ISA, you connect to this port via HTTP.
  </td>
 </tr>
 <tr>
  <td>2007</td>
  <td>informix_isa_servlet</td>
  <td>embryonix</td>
  <td>Shutdown port for ZFIN's Tomcat server (see port 2008).  (The misleading
    service name for this port is due to its former use as the Tomcat port for 
    <a href="#Informix Server Administrator (ISA)">Informix Server Administator (ISA)</a>.
    ISA only needs Tomcat for two features that we don't use at ZFIN.  Therefore
    we no longer configure ISA with these two features on, and ISA no longer
    has an associated Tomcat server on ZFIN machines.)
  </td>
 </tr>
 <tr>
  <td>2008</td>
  <td>zfin_tomcat</td>
  <td>embryonix</td>
  <td>ZFIN's tomcat server.  Initially this supports the presentation of results
    from the uniquery/supersearch.
  </td>
 </tr>
 <tr>
  <td>2009</td>
  <td>open</td>
  <td>unused</td>
  <td>&nbsp;</td>
 </tr>
 <tr>
  <td>2010</td>
  <td>open</td>
  <td>unused</td>
  <td>&nbsp;</td>
 </tr>
</table>

<p>Contact the CS systems staff to get a new port allocated, or to change the 
name of an existing port/service.  (For most things the service name
does not matter.  However, the service names matter a great deal for the 
Informix ports.)




<!-- ========= /etc/system =============================================== -->

<h2 class="zdoc"><A NAME="/etc/system"><span class="file">/etc/system</span></a></h2>

<p>Machines that run Informix need a few modifications made to their 
<span class="file">/etc/system</span> file.  
<span class="file">/etc/system</span> defines 
many kernel parameters.  In order
for Informix to run well, you will need to override semaphore and shared
memory settings in particular.  See the Release Notes that come with the
Informix engine for details.

<p>Here are the additional settings that exist for Informix 9.4 under 
Solaris 9 on both the <a href="impl.html#Production Server">production</a>
and <a href="impl.html#Development Server">development</a> 
servers as of 2004/11:

<table class="zdoc">
  <caption>/etc/system Informix Related Settings</caption>
  <tr>
    <th>Setting</th>
    <th>IBM Tested Value</th>
    <th>Explanation</th>
  </tr>
  <tr>
    <td>set semsys:seminfo_semmni=8192</td>
    <td>500</td>
    <td>Maximum number of semaphore identifiers (sets of semaphores) allowed
        on this machine.
    </td>
  </tr>
  <tr>
    <td>set semsys:seminfo_semmns=8192</td>
    <td>4096</td>
    <td>Maximum number of System V semaphores allowed on this machine.
    </td>
  </tr>
  <tr>
    <td>set semsys:seminfo_semmnu=4096</td>
    <td>4096
    <td>Total number of undo structures by the System V semaphore system.
    </td>
  </tr>
  <tr>
    <td>set semsys:seminfo_semume=128</td>
    <td>64</td>
    <td>Maximum number of System V semaphore undo structures that can be 
        used by any one process.
    </td>
  </tr>
  <tr>
    <td>set semsys:seminfo_semmsl=500</td>
    <td>500</td>
    <td>Maximum number of System V semaphores per semaphore identifier.
    </td>
  </tr>
  <tr>
    <td>set&nbsp;shmsys:shminfo_shmmax=8589934592</td>
    <td>4294967296
    <td>Maximum allowed size for a shared memory segment on the machine.
        We use 8 GB.
    </td>
  </tr>
  <tr>
    <td>set shmsys:shminfo_shmmni=500</td>
    <td>500
    <td>System wide limit on number of shared memory segments that can be 
        created.
    </td>
  </tr>
</table>

<p>The Informix release notes for IDS 9.40.FC5 has this line:
<div class="shellline">
  OS Information : Built on Solaris 2.8, Certified on 2.9
</div>

<p>The release notes say that you should also set the following variables.
However, the <a href="http://docs.sun.com">Solaris 9 documentation</a>
says that these variables are now obsolete, so, we no longer set them.

<table class="zdoc">
  <caption>Obsolete /etc/system Informix Related Settings</caption>
  <tr>
    <th>Setting</th>
  </tr>
  <tr>
    <td>set semsys:seminfo_semmap=64</td>
  </tr>
  <tr>
    <td>set shmsys:shminfo_shmmin=100</td>
  </tr>
  <tr>
    <td>set shmsys:shminfo_shmseg=100</td>
  </tr>
</table>



<!-- ========= Startup and Shutdown ==================================== -->

<h2 class="zdoc"><a name="Startup and Shutdown">Startup and Shutdown</a></h2>

<p>The ZFIN servers startup process uses mostly the standard CIS startup 
process for servers.  However, there are a few processes that are unique
to ZFIN machines.  These need to be manually re-established after each 
operating system upgrade.

<p>The ZFIN startup processes, listed in the order they fire, are:
<br><br>
<table class="zdoc">
  <tr>
    <th>Files</th>
    <th>Explanation</th>
  </tr>
  <tr>
    <td><span class="file">/etc/rc2.d/S70net-tune
      <br>/etc/init.d/uo-net-tune</span>
    </td>
    <td>This increases the Kernel TCP parameter <kbd>tcp_conn_req_max_q</kbd>
      from the default 128 to 1024.  This greatly increases how many TCP 
      connections there can be to the server, and Informix will not work without
      this.  
    </td>
  </tr>
  <tr>
    <td><span class="file">/etc/rc3.d/S90uo-Xvfb
      <br>/etc/rc3.d/K90uo-Xvfb
      <br>/etc/init.d/uo-Xvfb</span>
    </td>
    <td>Starts / Kills the 
      <a href="#Xvfb and /usr/X11R6">X Virtual Frame Buffer</a>, 
      which is used by the 
      mapper applet to generate maps for printing.
    </td>
  </tr>
  <tr>
    <td><span class="file">/etc/rc3.d/S90uo-informix
      <br>/etc/rc3.d/K90uo-informix
      <br>/etc/init.d/informix</span>
    </td>
    <td>Starts / Kills the Informix server.</td>
  </tr>
  <tr>
    <td><span class="file">/etc/rc3.d/S91uo-httpd
      <br>/etc/rc3.d/K91uo-httpd
      <br>/etc/init.d/httpd</span>
    </td>
    <td>Starts / Kills
      <a href="#Apache and Web Datablade Administration">Apache</a>.
    </td>
  </tr>
  <tr>
    <td><span class="file">/etc/rc3.d/S91uo-informix-isa
      <br>/etc/rc3.d/K91uo-informix-isa
      <br>/etc/init.d/informix-isa</span>
    </td>
    <td>Starts / Kills
      <a href="#Informix Server Administrator (ISA)">ISA</a>.
    </td>
  </tr>
  <tr>
    <td><span class="file">/etc/rc3.d/S91uo-informix-ontape
      <br>/etc/rc3.d/K91uo-informix-ontape
      <br>/etc/init.d/informix-ontape</span>
    </td>
    <td>Starts / Kills
      <a href="#Logical Log Dumps as the Logs Become Full">ontape</a>
      to continuously write Informix logical logs to disk as they become full.
      This script exists only on the 
      <a href="impl.html#Production Server">production server</a> because
      ontape would write to <span class="file">/dev/null</span> on the 
      <a href="impl.html#Development Server">development server</a>.
    </td>
  </tr>
</table>


<!-- ========= cron ==================================================== -->

<h2 class="zdoc"><a name="cron">cron</a></h2>

<p>ZFIN uses cron to perform regularly scheduled work, such as 
<a href="#Backups">backing up the database</a>, running the
<a href="db.html#Database Cleaning and Validation">data validation / cleaning 
script</a>, and controlling ZFIN's 
<a href="dst.html#Automated Data Transfers">data transfer and loading from 
external data sources</a>.<br>

<p>Most of ZFIN's cron jobs run under the informix user.  A few cron jobs,
like the <a href="#webrotate.pl">Apache log rotation script</a> are run
by other users.

<p>When we move the production web site from the
<a href="impl.html#Production Server">production server</a> to the
<a href="impl.html#Development Server">development server</a>, 
we turn off crontab files on the production server, and turn them 
on on the development server.

<p>The crontab files are defined in the 
<a href="http://cvs.zfin.org/cvs/cvsweb.cgi/ZFIN_WWW/server_apps/cron/">server_apps/cron directory</a>
of the <a href="impl.html#ZFIN Development Environments">ZFIN_WWW</a> project.
The mechanism for starting and stopping cron on a particular machine is
also in that directory.  See the 
<a href="http://cvs.zfin.org/cvs/cvsweb.cgi/ZFIN_WWW/server_apps/cron/Makefile">makefile</a>
for details.

<p>crontab files are notoriously difficult to decipher.  In 2005/02, we entirely
rewrote the crontab files to make them more readable and maintainable.  We also
changed the start times of jobs to follow a specific set of rules.  See FogBUGZ
<a href="http://zfinwinserver1.uoregon.edu/fogbugz/default.asp?pg=pgEditBug&amp;command=view&amp;ixBug=381">case 381</a>
for details.

<p>We also now have a graphic representation of our crontab files:

<br><br>
<img src="http://cvs.zfin.org/cvs/cvsweb.cgi/~checkout~/ZFIN_WWW/server_apps/cron/cron.chart.gif?rev=HEAD" alt="Cron at ZFIN">
<br><br>




<!-- ========= Xvfb and /usr/X11R6 ======================================= -->

<h2 class="zdoc"><a name="Xvfb and /usr/X11R6">Xvfb and /usr/X11R6</a></h2>

<p>The X Virtual Frame Buffer (<span class="shell">Xvfb</span>) is a what?  
Have Kevin expand on this.

<p>The version of <span class="shell">Xvfb</span> that ZFIN uses is 
hard coded to expect fonts to 
be in the path <span class="file">/usr/X11R6</span>.  
However, the standard CIS installation does not
put X fonts there.  In order to use Xvfb we create a 
<span class="file">/usr/X11R6</span> 
sym link
that points to <span class="file">/local/apps/X11R6</span>, 
which is where they reside in the standard
CIS installation.


<!-- ========= Netpbm ================================================== -->

<h2 class="zdoc"><a name="Netpbm">Netpbm</a></h2>

<p>Netpbm is a graphics package that ZFIN uses to do 
<a href="db.html#Fish Images">image</a> manipulation.  In particular, to generate
thumbnails and to get image widths and heights.  It is called via the 
<a href="impl.html#sysexec, EXECWEB, and unix_commands"><span class="shell">sysexec</span></a>
mechanism.  Netpbm is installed in the 
<span class="file">/local/apps/netpbm</span>
directory, and as such it is maintained and updated by the CS system 
administrators.  At some point in the future we may want to install it
in /private/apps.

<p>The functions that Netpbm performs were formerly done with 
<a href="#alchemy">alchemy</a>.


<!-- ========= FTP ===================================================== -->

<h2 class="zdoc"><a name="FTP">FTP</a></h2>

<p>FTP is enabled on the <a href="impl.html#Production Server">production</a>
and <a href="impl.html#Development Server">development</a> servers.
Anonymous FTP is used to support 
the <a href="impl.html#Mirror Sites">mirror sites</a>.

<table class="zdoc">
 <caption>FTP Directories</caption>
 <tr>
  <th>Server</th>
  <th>Directory</th>
 </tr>
 <tr>
  <td><a href="impl.html#Production Server">Production</a></td>
  <td>
   <span class="file"><a href="impl.html#ZFIN Prod">/research/zprod/</a>ftp</span>
  </td>
 </tr>
 <tr>
  <td valign="top"><a href="impl.html#Development Server">Development</a></td>
  <td><span class="file">/private/ftp</span>, which is a sym link to 
    <span class="file">/research/zcentral/ftp</span>,
    which is the FTP root for zfin.org, when it is running on the development 
    server.  The test servers write their output FTP files to 
    <span class="file">/research/zcentral/ftp/test/<i>HostName</i></span>.
  </td>
 </tr>
</table>

<p>Several of ZFIN's 
<a href="dst.html#Automated Data Transfers">automated data transfers</a>
write to the FTP directory.



<!-- ========= E-mail ================================================== -->

<h2 class="zdoc"><a name="E-mail">E-mail</a></h2>

<p>The E-mail setup at ZFIN is complicated and I don't understand the 
technical details at all.  We use the CIS systems staff to do any 
modifications.

<p>The ZFIN (and ZIRC) staff use CIS and Neuroscience e-mail servers
for their e-mail addresses.  However, a number of us also @zfin.org 
aliases that forward to our addresses.  These are setup by the CIS systems
staff.

<p>The ZFIN <a href="impl.html#Production Server">production</a> and 
<a href="impl.html#Development Server">development</a> servers both send 
e-mail using sendmail.  Their sendmail configurations have been messed 
with.  A copy of the ZFIN sendmail.cf file is available at

<div class="fileline">
  /cs/src/Mail/sendmail-local-cf/zfin.cf-v8
</div>

<p>See also the <a href="#ZFIN Groups">ZFIN Groups</a> section for 
information on ZFIN mailing lists.



<!-- ========= Domain Name Registration ================================ -->

<h2 class="zdoc"><a name="Domain Name Registration">Domain Name Registration</a></h2>

<p>The zfin.org domain name is registered with Network Solutions 
(<a href="http://www.networksolutions.com">www.networksolutions.com</a>).
  In 2001 we renewed our 
registration for 5 years.  It is currently slated to expire on 2006/05/13.

<p>To get the full whois information on ZFIN's registration enter

<div class="shell">
  % whois -h whois.networksolutions.com zfin.org
</div>


<!-- ========= /private/apps ============================================= -->

<h2 class="zdoc"><a name="/private/apps">/private/apps</a></h2>

<p>On the ZFIN server machines, <span class="file">/private/apps</span> holds 
"system" files/applications that ZFIN 
wants to maintain independently of the operating system installation.


<h3 class="zdoc"><a name="Informix">Informix</a></h3>

<p>The <span class="file">Informix</span> 
subdirectory is the home directory of the informix user.  
It also contains 
the Informix installation and the 
<a href="#Informix Server Administrator (ISA)">ISA</a> installation.



<h3 class="zdoc"><a name="alchemy">alchemy</a></h3>

<p>alchemy is an image manipulation package.  We stopped using it
when we put the expression pattern work into production.
It has been replaced by the 
<a href="#Netpbm">Netpbm</a> package.

<p>We replaced it because 
<a href="impl.html#sysexec, EXECWEB, and unix_commands"><span class="shell">sysexec</span></a>
calls to alchemy would fail a certain percentage of the time, thus leading us
to the conclusion that alchemy was flaky.  However, after switching to 
Netpbm, we did not see a decline in the number of problems.  Thus it appears
that maybe <span class="shell">sysexec</span> is what is flaky.  



<h3 class="zdoc"><a name="apache">apache</a></h3>

<p>This contains the Apache source from which the 
<span class="file">/private/httpd</span>
directory is built.  See the 
<a href="#Apache and Web Datablade Administration">Apache and Web Datablade 
Administration</a> section for more on this process.


<h3 class="zdoc"><a name="java">java</a></h3>

<p>ZFIN does not reference the system java installation (wherever that may
be) because it can change whenever the operating system is patched or updated.
Instead we use a stable java installation which resides in this directory.



<h3 class="zdoc"><a name="PERL">PERL</a></h3>

<p>ZFIN also uses its own PERL instance.  This gets us several advantages.
First, it is faster.  The default PERL resides on the network and is noticeably
slower to use.  Secondly, we can control what modules are defined in PERL, and
when it gets updated.  Finally, the ZFIN private PERL points to our 
<a href="#Client SDK">Informix Client SDK directory</a> (the 32-bit version), 
not CIS's.

<p><span class="file">/private/bin/perl</span> is what the ZFIN scripts 
call and that is a sym link
into <span class="file">/private/apps/perl-<i>version</i></span>.

<p>ZFIN's PERL installation is managed by the CIS Systems staff.  See 
<a href="http://zfinwinserver1.uoregon.edu/fogbugz/default.asp?pg=pgEditBug&amp;command=view&amp;ixbug=505">Case 505</a>
for details.


<h3 class="zdoc"><a name="Rebol">Rebol</a></h3>

<p>Rebol is a scripting language that is used in ZFIN in a couple of places.
It is not part of the standard system installation so ZFIN has their own copy.
As of 2001/06, Tom is the ZFIN Rebol expert.

<p> Rebol is available from www.rebol.com. We only use their freely 
available "core" product.
To upgrade, cd to where you want to try out the new version, 
it could be anywhere. Start rebol: <br>

at the "&gt;&gt;" prompt type "upgrade" and rebol will go and check if 
there is a newer version of itself available.
<br>If so, it will ask if you want to get the newer version. 
Respond with "y" or some other affirmative<br>
and it will download a tarball into your current directory.<br>
to exit the rebol shell type "q" or "quit".
here is an example:
<div class="shell">
embryonix% rebol -sq
REBOL/Core 2.3.0.10.1 22-Jun-2000
Copyright 2000 REBOL Technologies.  All rights reserved.
&gt;&gt; upgrade
Your copy of Solaris Sparc REBOL/core 2.3.0.10.1 is not up-to-date.
Current version is: 2.5.0.10.1
Download current version? y
Downloaded core101.tar.gz to the current directory.
&gt;&gt; q
embryonix%

</div> 

<p> 
(note: in the core101.tar name, the ".101" is not a version number but 
indicates this is the Solaris 
binary, as opposed to the other forty platforms it runs on)

<p>
the tarball may be detarred by your method of choice, I use :
<div class="shell">
embryonix% tar -vxf core101.2.5.0.10.1.tar
x rebol, 367020 bytes, 717 tape blocks
x docs.r, 222 bytes, 1 tape blocks
x license.html, 9799 bytes, 20 tape blocks
x scripts.r, 233 bytes, 1 tape blocks
x feedback.r, 5600 bytes, 11 tape blocks
x rebol.r, 4000 bytes, 8 tape blocks
x setup.html, 26064 bytes, 51 tape blocks
embryonix%

</div>

<p>the only file that matters is the rebol executable "rebol"
which may be copied to <span class="file">/private/apps/rebol/rebol</span>
<br>
<b>on _BOTH_ the <a href="impl.html#Development Server">development</a> AND 
<a href="impl.html#Production Server">production</a> servers ...</b>
<br>
after you have tested it to your hearts content. (you may need sudo 
or root to do this)
  
<P>
to see that you indeed got a new version
<div class="shell">
embryonix% rebol -sqw
REBOL/Core 2.5.0.10.1 23-Mar-2001
Copyright 2000-2001 REBOL Technologies.  All rights reserved.
embryonix%

</div>



<!-- ========= Power =================================================== -->

<h2 class="zdoc"><a name="Power">Power</a></h2>

<p>ZFIN has grown to the point where we have significant power and air 
conditioning needs.  We have also established significant uptime goals
that require us to be up and running for all but the longest power outages.
This section discusses the power and cooling situation at ZFIN.

<p>All of our servers and disk are located in 321 Deschutes, the CIS 
machine room.  Therefore our power and air conditioning
situation is tightly tied to 
theirs.  We use their power conditioner and air conditioning (and network).
We are the second largest consumer of power and cooling in that room, 
behind the NIC, but ahead of the CS systems themselves.



<h3 class="zdoc"><a name="Equipment">Equipment</a></h3>

<table class="zdoc">
 <caption>Equipment at ZFIN</caption>
 <tr>
  <th class="equip">Item</th>
  <th class="equip">Mfr / Model</th>
  <th class="equip">Max Amps</th>
  <th class="equip" colspan="2">Actual Running KVA
    <br><a href="#Load Balancing">X1/L1/A</a>&nbsp;<a href="#Load Balancing">X2/L2/B</a></th>
  <th class="equip">Max Watts</th>
  <th class="equip">BTUs / Hr</th>
  <th class="equip">VAC Range</th>
  <th class="equip">Power<br>Supls</th>
  <th class="equip">#<br>Cords</th>
  <th class="equip">URL / Manual</th>
 </tr>
 <tr>
  <td class="equip"><center><b><a href="impl.html#Production Server">Helix</a></b></center></td>
  <td class="equip"><center>Sun Fire V440</center></td>
  <td class="equip"><center>7.7@120V<br>9.3@100V</center></td>
  <td class="equip"><center>0.25</center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>925</center></td>
  <td class="equip"><center>3157 @ 200V</center></td>
  <td class="equip"><center>100 - 240</center></td>
  <td class="equip"><center>2 x 680W</center></td>
  <td class="equip"><center>2</center></td>
  <td class="equip"><center><a href="Products/SunV440AdminGuide.pdf">See</a> pg 160-161</center></td>
 </tr>

 <tr>
  <td class="equip"><center><b><a href="impl.html#Development Server">Embryonix</a></b></center></td>
  <td class="equip"><center>Sun Fire V440</center></td>
  <td class="equip"><center>7.7@120V<br>9.3@100V</center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>0.25</center></td>
  <td class="equip"><center>925</center></td>
  <td class="equip"><center>3157 @ 200V</center></td>
  <td class="equip"><center>100 - 240</center></td>
  <td class="equip"><center>2 x 680W</center></td>
  <td class="equip"><center>2</center></td>
  <td class="equip"><center><a href="Products/SunV440AdminGuide.pdf">See</a> pg 160-161</center></td>
 </tr>
 <tr>
  <td class="equip"><center><b><a href="impl.html#Upgrade Server">Bionix</a></b></center></td>
  <td class="equip"><center>Sun Enterprise 220R</center></td>
  <td class="equip"><center>6.3@100V</center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>0.16</center></td>
  <td class="equip"><center>610</center></td>
  <td class="equip"><center>2080</center></td>
  <td class="equip"><center>100 - 240</center></td>
  <td class="equip"><center>2 x 380W</center></td>
  <td class="equip"><center>2</center></td>
  <td class="equip"><center><a href="Products/Sun220ROwnersGuide.pdf">See</a> pg 172</center></td>
 </tr>
 <tr>
  <td class="equip"><center><b><a href="admin.html#Sun A1000 RAID">Prod. RAID</a></b></center></td>
  <td class="equip"><center>Sun A1000</center></td>
  <td class="equip"><center>5@100V<br></center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>0.17</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center>1092</center></td>
  <td class="equip"><center>100 - 240</center></td>
  <td class="equip"><center>2</center></td>
  <td class="equip"><center>2</center></td>
  <td class="equip"><center><a href="Products/SunA1000InstallManual.pdf">See</a> pg 33-34</center></td>
 </tr>
 <tr>
  <td class="equip"><center><b><a href="admin.html#NStor 4150S RAID">Devl. RAID</a></b></center></td>
  <td class="equip"><center>NStor 4120S</center></td>
  <td class="equip"><center>3@110V<br>(maybe 6)</center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>0.11</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center>1194</center></td>
  <td class="equip"><center>100 - 240</center></td>
  <td class="equip"><center>2 x 350W</center></td>
  <td class="equip"><center>2</center></td>
  <td class="equip"><center><a href="Products/NStor4000sFlier.pdf">See</a></center></td>
 </tr>
 <tr>
  <td class="equip"><center><b><a href="#Terminal">Terminal</a></b></center></td>
  <td class="equip"><center>Wyse WY-30+</center></td>
  <td class="equip"><center>0.6</center></td>
  <td class="equip"><center>0.02</center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>28</center></td>
  <td class="equip"><center>144</center></td>
  <td class="equip"><center>120 or<br><a href="#Terminal">240</a></center></td>
  <td class="equip"><center>1</center></td>
  <td class="equip"><center><b><a href="#Dual Transfer Switch">1</a></b></center></td>
  <td class="equip"><center><a href="http://www.wyse.com/service/support/kbase/Specs1.asp?Q=2">See</a></center></td>
 </tr>

 <tr>
  <td class="equip"><center><b><a href="impl.html#BLAST Server">Genomix Node1</a></b></center></td>
  <td class="equip" rowspan="5"><center>Apple G5 XServe Compute Node</center></td>
  <td class="equip"><center><a href="#BLAST Max Amps">4@120V</a></center></td>
  <td class="equip"><center>0.13</center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center><a href="http://www.apple.com/education/science/solutions/setupguide/prep_cooling.html">500</a></center></td>
  <td class="equip" rowspan="6"><center>100 - 240</center></td>
  <td class="equip" rowspan="6"><center>1</center></td>
  <td class="equip" rowspan="6"><center><b><a href="#Dual Transfer Switch">1</a></b></center></td>
  <td class="equip" rowspan="6"><center><a href="Admin/Xserve_G5_User_Guide.pdf">See</a> pg 87</center></td>
 </tr>

 <tr>
  <td class="equip"><center><b><a href="impl.html#BLAST Server">Genomix Node2</a></b></center></td>
  <td class="equip"><center><a href="#BLAST Max Amps">4@120V</a></center></td>
  <td class="equip"><center>0.13</center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center><a href="http://www.apple.com/education/science/solutions/setupguide/prep_cooling.html">500</a></center></td>
 </tr>

 <tr>
  <td class="equip"><center><b><a href="impl.html#BLAST Server">Genomix Node3</a></b></center></td>
  <td class="equip"><center><a href="#BLAST Max Amps">4@120V</a></center></td>
  <td class="equip"><center>0.13</center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center><a href="http://www.apple.com/education/science/solutions/setupguide/prep_cooling.html">500</a></center></td>
 </tr>

 <tr>
  <td class="equip"><center><b><a href="impl.html#BLAST Server">Genomix Node4</a></b></center></td>
  <td class="equip"><center><a href="#BLAST Max Amps">4@120V</a></center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>0.13</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center><a href="http://www.apple.com/education/science/solutions/setupguide/prep_cooling.html">500</a></center></td>
 </tr>

 <tr>
  <td class="equip"><center><b><a href="impl.html#BLAST Server">Genomix Node5</a></b></center></td>
  <td class="equip"><center><a href="#BLAST Max Amps">4@120V</a></center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>0.13</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center><a href="http://www.apple.com/education/science/solutions/setupguide/prep_cooling.html">500</a></center></td>
 </tr>

 <tr>
  <td class="equip"><center><b><a href="impl.html#BLAST Server">Genomix</a></b></center></td>
  <td class="equip"><center>Apple G5 XServe Head Node</center></td>
  <td class="equip"><center><a href="#BLAST Max Amps">4@120V</a></center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center><a href="http://www.apple.com/education/science/solutions/setupguide/prep_cooling.html">500</a></center></td>
 </tr>

 <tr>
  <td class="equip"><center><b>BLAST Network Switch</b></center></td>
  <td class="equip"><center>HP ProCurve Switch 2824</center></td>
  <td class="equip"><center>0.6@100V </center></td>
  <td class="equip"><center>0.07</center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center>100 - 127<br>200 - 240</center></td>
  <td class="equip"><center>1</center></td>
  <td class="equip"><center><b><a href="#Dual Transfer Switch">1</a></b></center></td>
  <td class="equip"><center><a href="Products/HPSwitch_2800-Install-Guide.pdf">See</a> pg A-1</center></td>
 </tr>
 <tr>
  <td class="equip"><center><b><a href="#Dual Transfer Switch">Upper Dual Transfer Switch</a></b></center></td>
  <td class="equip"><center>Pulizzi T2235-A2-<br>CNB15S</center></td>
  <td class="equip"><center>4@120V ?</center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>0.01</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center>?</center></td>
  <td rowspan="2"><center><b>120</b></center></td>
  <td rowspan="2"><center>?</center></td>
  <td rowspan="2"><center>2</center></td>
  <td rowspan="2"><center><a href="http://www.pulizzi.com/store/datasheets/T2235.pdf">See</a></center></td>
 </tr>
 <tr>
  <td class="equip"><center><b><a href="#Dual Transfer Switch">Lower Dual Transfer Switch</a></b></center></td>
  <td class="equip"><center>Pulizzi T2235-A2-<br>CNB09S</center></td>
  <td class="equip"><center>4@120V ?</center></td>
  <td class="equip"><center>0.01</center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>?</center></td>
  <td class="equip"><center>?</center></td>
 </tr>
 <tr>
  <td class="equip"><center><b><a href="#UPS">UPS (Electrolux)</a></b></center></td>
  <td class="equip"><center>Powerware 9170+ 12 Slot Tower</center></td>
  <td class="equip"><center>9 KVA</center></td>
  <td colspan="2"><center>0.37</center></td>
  <td class="equip"><center>&nbsp;</center></td>
  <td class="equip"><center>2930</center></td>
  <td class="equip"><center>208V in<br>120V out</center></td>
  <td class="equip"><center>3 x 3KVA</center></td>
  <td class="equip"><center>1</center></td>
  <td class="equip"><center><a href="Products/Powerware9170UsersGuide.pdf">See</a></center></td>
 </tr>
 <tr>
  <td rowspan="2"><center><b>Totals</b></center></td>
  <td colspan="2" rowspan="2" class="equip"></td>
  <td class="equip"><center>0.915</center></td>
  <td class="equip"><center>1.125</center></td>
  <td colspan="6" rowspan="2" class="equip"></td>
 </tr>
 <tr>
  <td colspan="2" class="equip"><center>2.04</center></td>
 </tr>
</table>


<p><b>Notes:</b>
<ol>
 <li><b>Actual Running KVA:</b>  This shows what the KVA requirements are for
     that piece of equipment when it is being fully supported by the UPS.
     This is an observed average.  KVA consumed varies with load and disk 
     activity.
 <li><a name="BLAST Max Amps"><b>Max Amps:</b></a> 
     The numbers for the BLAST nodes are less than the published rating
     of 5.5 max amps (<a href="Admin/Xserve_G5_User_Guide.pdf">see pg 87)</a>
     and 4.0 running amps 
     (<a href="http://www.apple.com/education/science/solutions/setupguide/prep_power.html">see</a>) per node.
     E-mail correspondence with folks at Apple 
     indicates that max startup amps is 4 per node, and "Steady running 
     state current should be around 2.2-2.5A worst case @  100% CPU load 
     for each node."  
 <li><b>URL/Manual:</b> This is a reference to a manual or web page that 
     describes the power characteristics of the equipment.
</ol>


<h3 class="zdoc"><a name="Dual Transfer Switch">Dual Transfer Switches</a></h3>

<p>In 2003/08, ZFIN purchased a 
<a href="http://www.pulizzi.com/product/Search/Advanced/Details.cfm?ASSEMBLY=2958&amp;MAXROWS=25">Pulizzi T2235-A2-CNB09S dual transfer switch</a>.
We purchased a second nearly identical Pulizzi T2235-A2-CNB15S (15 foot power
cords instead of 9 foot) in 2004/08.
A dual transfer switch is basically a (very) glorified power strip with 2 
input power cords.  It allows you to hook up equipment with only 1 power cord
to two different power supplies.  If one fails, the dual transfer switch 
automatically switches to the remaining one.  We hook one cord to the 
UPS and one directly to the power conditioner output.  Therefore, if the UPS 
or the power conditioner fails, we will still have power.

<p>One input (the rightmost from the back of the switch) is the primary input.
If there is power to this input then it will use it.  It will only use the
power from the secondary input if the primary input is out.  It will also
switch back to the primary when power returns to it.  The primary is 
connected to the UPS and the secondary is connected to the wall.

<p>We need dual transfer switches because these machines have only a single
power cord:
<ul>
 <li><a href="#Terminal">Dumb Terminal</a>
 <li><a href="impl.html#BLAST Server">BLAST Server Compute Nodes</a>
 <li><a href="impl.html#BLAST Server">BLAST Server Head Node</a>
</ul>

<p>We need 2 switches because putting all of that equipment on a single 
switch pushed it dangerously close to 20 amps.

<p>Why did we get dual transfer switches that requires 120V, instead of a 
more flexible one that ranges from 100 to 240V?  First, it is not clear what the
terminal supports (see below), and second, the cabling for the 100 to 240V 
model is more complicated then the 120V model.



<h3 class="zdoc"><a name="Terminal">Terminal</a></h3>

<p>ZFIN is borrowing a Wyse WY-30+ dumb terminal from CIS to use as a console
for all our servers.  We have a 6 to 1 DB-9 switch that allows us to do this
The voltage range of
the terminal is not clear.  The label on the back says 120V, but the 
<a href="http://www.wyse.com/service/support/kbase/Specs1.asp?Q=2">documentation</a>
 for it says 98-132V and 196-264V.  

<p>The terminal is connected to the <a href="#UPS">UPS</a> via a rather 
convoluted path.  It sits on top of the UPS.  Its power cord is plugged into
a white powerstrip near the bottom of the UPS.  This powerstrip goes back to
the <a href="#Dual Transfer Switch">lower dual transfer switch</a>.  One of the
inputs for the lower dual transfer switch goes to the wall, and the other goes 
to the UPS.

<p>We need the terminal on a dual transfer switch, rather than on the UPS
because if the UPS fails, and the terminal is on the UPS, and the terminal
is currently switched to a server, then that server will hang.  Sun machines
are required to have a keyboard attached to them to stay up.
Lauradel succeeded in modifying this requirement slightly, but it is still
safest to never switch the terminal to a given server unless the terminal
is on.


<h3 class="zdoc"><a name="UPS" href="http://electrolux.cs.uoregon.edu">Uninterruptable Power Supply (UPS)</a></h3>

<p>ZFIN has an  
<a href="http://www.powerware.com/UPS/9170Plus_UPS.asp">Eaton Powerware 9170+ 
12 slot Tower UPS</a>.  The UPS has these features:

<ul>
 <li>18 batteries (9 strings in Powerware terminology)
 <li>3 x 3 KVA power modules, for a total of 9 KVA
 <li>208V input, 120V output
 <li>12 5-20R outlets: Standard 3-prong, 20 Amps, 120V
 <li>2 L6-30R outlets: Locking 3-prong, 30 Amps, 250V
 <li>2 L14-30R outlets: Locking 4-prong, 30 Amps, 125/250V
 <li>60 Amp circuit breaker
 <li>A <a href="Products/PowerwareWebSNMPcardmanual.pdf">Web/SNMP card</a>
   that allows us to monitor and configure the UPS from the web (try 
   <a href="http://electrolux.cs.uoregon.edu">electrolux.cs.uoregon.edu</a>), 
   and for e-mails to be sent out when alarms happen.
</ul>

<p>See the 
<a href="Products/Powerware9170UsersGuide.pdf">Powerware 9170+ User's Guide</a>
for more information.

<p>We went with the 120V output because the 
<a href="#Dual Transfer Switch">dual transfer switches</a>
require it.  


<h4 class="zdoc"><a name="Estimated Run Times">Estimated Run Times</a></h4>

<p>When we were first attaching equipment to the UPS (2003/03/31)
we checked what the
estimated run time was for various combinations of equipment.
At this time, we had <a href="impl.html#Past Servers">chromix</a> as our
production server, instead of <a href="impl.html#Production Server">helix</a>.
Chromix drew more power (0.48 KVA) then helix does (0.25 KVA).  

<p>We have not gotten new numbers since we replaced chromix, but the new
run times with helix should be at least as long as they were with chromix.
The times given below are from when we had chromix.  Therefore they are lower
bounds.


<table class="zdoc">
 <caption>Estimated UPS Run Times Under Various Loads</caption>
 <tr>
  <th>Servers</th>
  <th>Estimated Run Time</th>
 </tr>
 <tr>
  <td>
   Helix, A1000 RAID
  </td>
  <td>
   ? hours, ?? minutes
  </td>
 </tr>
 <tr>
  <td>
   Helix, A1000 RAID, Embryonix, NStor RAID
  </td>
  <td>
   at least 2 hours, 53 minutes
  </td>
 </tr>
 <tr>
  <td>
   Helix, A1000 RAID, Embryonix, NStor RAID, Bionix
  </td>
  <td>
   at least 2 hours, 35 minutes
  </td>
 </tr>
 <tr>
  <td>
   Helix, A1000 RAID, Embryonix, NStor RAID, Bionix, Genomix
  </td>
  <td>
   ? hours, ?? minutes
  </td>
 </tr>
</table>




<h4 class="zdoc"><a name="Load Balancing">Load Balancing</a></h4>

<p>The UPS is divided into halves, known as X1 (or L1 or A) and X2 (or L2 or B),
and
the power load on each side should be approximately equal.  The repercussions
of being out of balance are not that severe.  Nevertheless, we try our best
to balance the load.
In particular, we put servers and their RAIDs on different sides so that 
when we shut down a server, the balance will be approximately maintained.
The <a href="impl.html#BLAST Server">BLAST compute nodes</a> can be moved
from one side to the other to keep things approximately in balance.
See the <a href="#Equipment">Equipment</a> table 
for a list of which equipment is on which side.

<p>There are many active power strips in back of (or at the top of)
the ZFIN rack.  
<ol>
 <li><b>Black plastic power strip at bottom of rack:</b>  This
     one leads to the power coming directly out of the power conditioner.  This
     is effectively wall power.  If the UPS fails, then this power strip will
     keep things up and running.
 </li>
 <li><b>Two green metal power strips at bottom, labeled "ZFIN X1":</b>
     These both lead to the X1/L1/A side of the UPS.  There are two of these, 
     not because we ran out of plugs on the first power strip, but because
     placing all the plugs on one strip might exceed that circuit's capacity.
     One is 15 amps and the other is 20 amps.
 </li>
 <li><b>Two green metal power strips at bottom, labeled "ZFIN X2":</b>
     These lead to the X2/L2/B side of the UPS.  One is 15 amps and the other is
     20 amps.
 </li>
</ol>


<h4 class="zdoc"><a name="Support">Support</a></h4>

<p>Support for the UPS is available from Powerware:
<br><br>
<table>
 <tr>
  <td>Phone:</td>
  <td>1 800 356 5737</td>
 </tr>
 <tr>
  <td>E-mail:</td>
  <td><a href="mailto://techsupt@powerware.com">techsupt@powerware.com</a></td>
 </tr>
</table>

<p>They may want the UPS's serial number:

<p>&nbsp;&nbsp;C661N0 18KA046035

<p>See their 
<a href="http://www.powerware.com/Service_Support/Technical_Support.asp">Technical
Support web page</a> for further details.

<p>The warranty on the UPS runs through 2006/01/06.  Before that happens we
will need to get a support contract for the UPS.  See FogBUGZ
<a href="http://zfinwinserver1.uoregon.edu/fogbugz/default.asp?pg=pgEditBug&amp;command=view&amp;ixBug=507">case 507</a>
for service contract options.



<h4 class="zdoc"><a name="UPS History">History</a></h4>

<p>Before ZFIN moved from 
<a href="impl.html#Past Servers">zfishstix to chromix</a> in 2000, 
we had a UPS.  However, the UPS was not powerful enough to power chromix, so 
we did not use it after that, and eventually discarded it in 2001.  Also in 
2000, ZFIN went from having standalone systems to being integrated with the
CIS machines.  The CIS machines did not have a UPS, so there was no point in 
us staying up, if they weren't staying up.

<p>All of that changed in 2003 when CIS got its own UPS.  During the interim, 
UOnet also got a UPS.  ZFIN was now the odd man out.  In 2003/09, ZFIN 
temporarily
moved on to CIS's UPS to weather the annual UO power outage day.  This went 
without event, and ZFIN was given until 2004/01/01 to get its own UPS.

<p>We didn't quite make that deadline.  After gathering several bids (see
<a href="http://zfinwinserver1.uoregon.edu/fogbugz/default.asp?pg=pgEditBug&amp;command=view&amp;ixBug=181">case 181</a> for details),
ZFIN ordered a 
<a href="http://www.powerware.com/UPS/9170Plus_UPS.asp">Powerware 9170+ 12 
slot Tower UPS</a> 
at the very end of 2003.  After getting rewiring done and moving 
some equipment, we brought the UPS up in 2004/03.  



<!-- =================================================================== -->
<!-- ========= BLAST Server Administration ============================= -->
<!-- =================================================================== -->

<h1 class="zdoc"><a name="BLAST Server Administration">
                          BLAST Server Administration</a></h1>

<p>The section describes how the 
ZFIN <a href="impl.html#BLAST Server">BLAST server</a> is administered.
This is a particularly difficult area for several reasons:

<ul>
  <li>The BLAST server is an Apple cluster, and everything else at ZFIN is
    a Sun Solaris server.
  </li>
  <li>The CS Systems staff manages other Apple servers, but this is the 
    only cluster that they manage.
  </li>
  <li>The cluster uses 
    <a href="#BioTeam iNquiry">BioTeam's iNquiry software</a> to manage
    the cluster.  iNquiry and the resst of the system interact in complicated 
    ways and it not always obvious what you can and can't do with the underlying
    system without adversely affecting iNquiry.
  </li>
  <li>We are still working out protocols for 
    <a href="#Who Does What">who does what</a>.  Everything about this is new.
  </li>
</ul>



<!-- ========= Who Does What ========================================== -->

<h2 class="zdoc"><a name="Who Does What">Who Does What</a></h2>

<p>For much of the first year we had the cluster, we struggled with getting the
system to work at all.  Part of the problem was that we did not have clear
protocols for what Systems staff was responsible for and what ZFIN staff was
responsible for.  See FogBUGZ
<a href="http://zfinwinserver1.uoregon.edu/fogbugz/default.asp?pg=pgEditBug&amp;command=view&amp;ixbug=291">case 291</a>
for some history on this.

<p>After some discussion, we settled on this separation of responsibilities:

<p>CS Systems staff is responsible for:

<ul>
  <li>OS installs and upgrades</li>
  <li>User and filesystem management</li>
  <li>Systems software installs and upgrades, including things like 
    MySQL and PHP
  </li>
  <li>Network and switch issues</li>
  <li>Establishing protocols for tasks like:
    <ul>
      <li>Powering nodes up and down</li>
      <li>Updating the compute node disk image on the head node</li>
      <li>Pusing the compute node disk image out to the compute nodes</li>
    </ul>
  </li>
  <li>Updating <a href="#BioTeam iNquiry">BioTeam iNquiry</a> software</li>
  <li>Sun Grid Engine (SGE) updates.  SGE comes with iNquiry and the two
    are tightly integrated.
  </li>
  <li>Backups</li>
</ul>

<p>ZFIN staff is responsible for

<ul>
  <li>iNquiry configuration and extension.  "Extension" means adding packages
    to iNquiry using the standard iNquiry methods.
  </li>
  <li>SGE configuration.</li>
</ul>

<p>This can all be summarized as: <b>Systems will do most of the contact with
BioTeam, and ZFIN will stick to a few very well defined areas.</b>



<!-- ========= BioTeam iNquiry ======================================== -->

<h2 class="zdoc"><a name="BioTeam iNquiry">BioTeam iNquiry</a></h2>

<p>ZFIN uses the iNquiry package from <a href="http://bioteam.net">BioTeam</a>
to manage the cluster.  iNquiry uses 
<a href="http://gridengine.sunsource.net/">Sun Grid Engine (SGE)</a> to 
coordinate work within the cluster, and 
<a href="http://www.pasteur.fr/recherche/unites/sis/Pise/">PISE</a> 
to give a uniform interface to 200 
bioinformatics tools that come with iNquiry.  PISE is also used to add new
tools that are not included with iNquiry, such as WU-BLAST.

<p>The initial copy of iNquiry came on a FireWire drive from Apple.  The head
node is booted off the FireWire drive.  This step may or may not completely
erase everything on the head node disk.

<p>There are a number of URLs that might be useful with iNquiry:

<table>
  <tr>
    <td>BioTeam</td>
    <td><a href="http://bioteam.net">http://bioteam.net</a></td>
  </tr>
  <tr>
    <td>BioTeam My Software Update - MSU</td>
    <td><a href="http://msu.bioteam.net">http://msu.bioteam.net</a></td>
  </tr>
  <tr>
    <td>BioTeam iNquiry Announcement Mailing List</td>
    <td><a href="http://bioteam.net/mailman/listinfo/inquiry-announce">
	         http://bioteam.net/mailman/listinfo/inquiry-announce</a></td>
  </tr>
  <tr>
    <td>BioTeam iNquiry Documentation Page</td>
    <td><a href="http://rt.bioteam.net:8080/metadot/index.pl?iid=2444">
                 http://rt.bioteam.net:8080/metadot/index.pl?iid=2444</a></td>
  </tr>
  <tr>
    <td>BioTeam FAQ</td>
    <td><a href="http://bioteam.net/faq/">http://bioteam.net/faq/</a></td>
  </tr>  
</table>

<!-- =================================================================== -->
<!-- ========= Moving zfin.org to a Different Machine ================== -->
<!-- =================================================================== -->

<h1 class="zdoc"><a name="Moving zfin.org to a Different Machine">
                          Moving zfin.org to a Different Machine</a></h1>


<p>The zfin.org web site usually runs on the
<a href="impl.html#Production Server">production server</a>.  
However, we occassionally
need to move it to the
<a href="impl.html#Development Server">development server</a>, 
either for regular maintenance, or because of an 
emergency.  This section describes how to do this move as well as how to move
it back again.  

<p>The description in this section assumes that you are doing the move in 
a non-emergency situation, where the database and web site are still up and
running on the production server.  
If this is not the case then the opening steps will be 
different.  In particular, you will be loading the previous night's dump file,
rather than a dump that you just created.



<!-- ========= Moving from the Production Server to the Development Server -->

<h2 class="zdoc">
  <a name="Moving from the Production Server to the Development Server">
           Moving from the Production Server to the Development Server</a>
</h2>

<p>This section lists a general recipe for moving the production web site
from the <a href="impl.html#Production Server">production server</a> to the
<a href="impl.html#Development Server">development server</a>.
However, each move is done for a different reason
and has its own quirks.  Therefore, I recommend that before each move, you
type up a recipe that is specific to the move that you are doing.

<p>For an example of a specific recipe, see the 2004/11/16 entry in

<div class="fileline">
<a href="impl.html#ZFIN Users">/research/zusers/</a>clements/Zfin/Database/serverlog
</div>

<p>Tasks to perform in advance of the move:

<ol>
  <li>Pick a time for the move.  It needs to be coordinated with curators,
    technologists, and the CS system administrators.

    <p>STATUS: 
    <br><br>
  </li>

  <li>Get the 2 server's
    <a href="#httpd.conf Configuration File">httpd.conf</a> Apache configuration
    files ready to go.

    <p>On the <a href="impl.html#Production Server">production server</a>, 
    you will probably want to use the
    <a href="#Production httpd.conf">httpd.conf.down.outside</a> file.  
    This marks the web site on the 
    <a href="impl.html#Production Server">production server</a>
    as down to all outside users, but allows browsers on
    a few select ZFIN machines to still access the web site.  Users in the
    outside world will never actually see the "web site down" page because
    we won't swap to this file until after zfin.org has been reassigned to
    <a href="impl.html#Development Server">development server</a>.  
    This file should be reviewed, to see if it needs any changes.

    <p>On the development server, the changes to the httpd.conf file are 
    minimal:

    <ul>
      <li>Change ServerName from "embryonix.cs.uoregon.edu" to "zfin.org".  This
        needs to be done in 3 places.
      <li>Open up the 3 Directory statemets for the embryonix web site.  Comment
        out the "Deny from all" lines and uncomment the "Allow from all" lines.
      <li>Change the access_log and error_log directory from embryonix to 
        zfin.org.
      <li>Uncomment the virtual host for zfin.org just before the SSL part
        of the file.
    </ul>

    <p>Save the changes to a file.

    <p>STATUS: 
  </li>
</ol>

<p>Tasks to perform the day before the move.  This list assumes that you will
be doing the move first thing the following morning.

<ol>
  <li>Uncomment the section of unloaddb.pl that sets the 
    <a href="Database/DataModel/index.htm">ZDB_FLAG</a>
    "disable updates" record to true.

    <p>This will disallow user updates through the web sites starting
    when the unload is started.

    <p>STATUS: 
    <br><br>
  </li>

  <li>Reschedule the cron job that unloads the database, to be after all other
    cron jobs that night, but early enough so that it will finish before you
    come in.  This allows users in Europe to update their records for most
    of their work day, and means you don't have to wait while the dump runs.

    <p>STATUS: 
    <br><br>
  </li>

  <li>Send out e-mail reminding curators, technologists, and sys admins
    that the move will be tomorrow morning, and that all update activity 
    will be blocked until the move is finished.  Last time we did the move
    it took us about an hour and fifteen minutes.

    <p>STATUS: 
    <br><br>
  </li>
</ol>

<p>Tasks to perform at the time of the move:

<ol>

  <li>If you are updating the schema file, now is the time to put the updated
    schema file in the dump directory created the night before.

    <p>STATUS: 
    <br><br>
  </li>

  <li>Load the dump into zfindb on the development server.

    <p>as informix on embryonix:

    <div class="shell">
    % srcembryonix
    % <a href="impl.html#loaddb.pl">loaddb.pl</a> zfindb <a href="impl.html#ZFIN Unloads">/research/zunloads/</a>databases/zfindb/<i>YYYY-MM-DD.1</i>
    </div>

    <p>STATUS: 
    <br><br>
  </li>

  <li>While the database is loading, create the ZFIN_WWW directory on the 
    development server:

    <p>as informix on embryonix:
    <div class="shell">
    % cd <a href="impl.html#ZFIN Users">/research/zusers/</a>embryonix
    % cvs checkout ZFIN_WWW
    % cvs -q update -P
    </div>
 
    <p>STATUS: 
    <br><br>
  </li>

  <li>While the DB is loading, dump <a href="#FTP">FTP</a> dir on the 
    <a href="impl.html#Production Server">production server</a> and transfer it to
    the <a href="impl.html#Development Server">development server</a>.

    <p>Helix's FTP dir:
    <div class="fileline"><a href="impl.html#ZFIN Prod">/research/zprod/</a>ftp</div>
    <p>Embryonix's FTP dir:
    <div class="fileline"><a href="impl.html#ZFIN Central">/research/zcentral/</a>ftp</div>

    <p>As yourself on the production server
    <div class="shell">
    % cd /research/zprod/ftp
    % sudo tar cf pub.tar pub
    </div>
    <p>as yourself on embryonix
    <div class="shell">
    % cd /research/zcentral/ftp
    % sudo cp /research/zprod/ftp/pub.tar .
    % sudo rm -rf pub
    % sudo tar xf pub.tar
    </div>
    <p>STATUS: 
    <br><br>
  </li>

  <li>Update <span class="file">/private/ZfinLinks</span> 
    on the development server.

    <p>Change any links that move when zfin.org moves.

    <p>STATUS: 
    <br><br>

  </li>

  <li>Once the DB load has finished, gmake whole web site.

    <p>As informix on embryonix

    <div class="shell">
    % srcembryonix
    % cdembryonix
    % gmake
    </div>

    <p>STATUS: 
    <br><br>
  </li>

  <li>Create all the outgoing data transfer files

    <p>As informix on embryonix
    <div class="shell">
    % cd server_apps/data_transfer
    % gmake push
    </div>
    <p>STATUS: 
    <br><br>
  </li>

  <li>Test that embryonix.cs.uoregon.edu comes up.

    <p>Not everything will work, but the basics like the home page will.
    If something obvious does not work, then you need to fix it before
    moving on.
    <br><br>

    <p>STATUS: 
    <br><br>
  </li>

  <li>Update the development server's httpd.conf file and stop apache.

    <P>This should get the remainder of the web site features up.  However,
    you won't be able to test them until systems has moved zfin.org to
    the development server.

    <p>As yourself on embryonix

    <div class="shell">
    cd /private/httpd/conf
    sudo cp httpd.conf httpd.conf.main
    sudo cp <i>modified_httpd.conf</i> httpd.conf
    sudo ../bin/apachectl stop
    </div>

    <p>STATUS: 
    <br><br>
  </li>

  <li>Copy the Apache log files from the production server to 
    the development server and start apache.

    <p>This gives us continuity of Apache log files.  That is, all the 
    entries for one month, will reside in one file, instead of in two.

    <p>As yourself on the production server:
    <div class="shell">
    cp /private/httpd/logs/access_log /research/zusers/clements/Zfin/Temp/
    cp /private/httpd/logs/error_log /research/zusers/clements/Zfin/Temp/
    </div>
    <p>As yourself on the development server:
    <div class="shell">
    cd /private/httpd/logs/zfin.org
    sudo cp /research/zusers/clements/Zfin/Temp/access_log .
    sudo cp /research/zusers/clements/Zfin/Temp/error_log .
    sudo chown root:other *_log
    </div>


  <li>Take the informix server down.

    <p>This step is necessary in order to perform the next step.  If you
    update the INFORMIXSQLHOSTS file while the server is up and running,
    then bad things can happen like clients can't reach it, and 
    you can't shut down the engine.

    <p>As informix on the development server:

    <div class="shellline">
    onmode -k 
    </div>

    <p>STATUS: 
    <br><br>
  </li>


  <li>Update the development server's INFORMIXSQLHOSTS file

    <p>Wanda's INFORMIXSQLHOSTS file is at

    <div class="fileline">
    /private/apps/Informix/informix/etc/sqlhosts
    </div>

    <p>Change the definition of wanda from 

    <div class="shellline">
    wanda            ontlitcp        embryonix.cs.uoregon.edu   zfin_tli
    </div>
    <p>to
    <div class="shellline">
    wanda            ontlitcp        zfin.org   zfin_tli
    </div>

    <p>This allows JDBC to work.
    <br><br>

    <p>STATUS: 
    <br><br>
  </li>

  <li>Get systems to swap zfin.org from the 
    <a href="impl.html#Production Server">production server</a> to the
    <a href="impl.html#Development Server">development server</a>

    <p>Call whichever sys admin you have arranged this and ask them to make the 
    swap and call you back when it is done.

    <p>STATUS: 
    <br><br>
  </li>

  <li>Bring the informix server up.

    <p>As informix on embryonix, <b>with a new shell</b>:

    <div class="shell">
    srcwanda
    oninit
    </div>

    <p>STATUS: 
    <br><br>
  </li>

  <li>Test that you can get to zfin.org.
    You may have trouble with browser caching at this point.  If you get 
    there try and login.  If you can log in you are running on embryonix.  

    <p>Also test the ZIRC links, the 
    <a href="http://mirror.zfin.org">mirror site</a>, the 
    <a href="http://cvs.zfin.org/cvs/cvsweb.cgi/">CVSweb site</a>, and any
    of the test web sites, <a href="http://albino.zfin.org">albino.zfin.org</a>,
    for example.

    <p>STATUS: 
    <br><br>
  </li>

  <li>Watch the access_log and error_log to make sure that offsite URLs
    can successfully access zfin.org

    <p>STATUS: 
    <br><br>
  </li>

  <li>Start cron on the 
    <a href="impl.html#Development Server">development server</a> and stop it 
    on the <a href="impl.html#Production Server">production server</a>.

    <p>As informix on embryonix
    <div class="shell">
    % cd server_apps/cron
    % gmake start
    </div>

    <p>As informix on helix
    <div class="shell">
    % srchelix
    % cdhelix
    % cd server_apps/cron
    % gmake stop
    </div>

    <p>STATUS: 
    <br><br>
  </li>

  <li>Enable user updates through the web site by setting the 
    <a href="Database/DataModel/index.htm">ZDB_FLAG</a> 
    "disable updates" record to false.

    <p>As informix on embryonix:
    <div class="sql">
    update zdb_flag
      set zflag_is_on = 'f',
          zflag_last_modified = CURRENT
      where zflag_name = "disable updates";
    </div>

    <p>Check that you can login.

    <p>STATUS: 
    <br><br>
  </li>

  <li>Notify curators, technologists, and sys admins that zfin.org is 
    up and running on the development server.

    <p>STATUS: 
    <br><br>
  </li>

  <li>Change the <a href="impl.html#Production Server">production server's</a>
    Apache to use the new config file.

    <p>As yourself on helix

    <div class="shell">
    % cd /private/httpd/conf
    % sudo rm httpd.conf
    % sudo ln -s httpd.conf.down.outside httpd.conf
    % sudo ../bin/apachectl start
    </div>

    <p>STATUS: 
    <br><br>
  </li>

  <li>Update the <a href="impl.html#Production Server">production server's</a> 
    INFORMIXSQLHOSTS file

    <p>Wildtype's INFORMIXSQLHOSTS file is at

    <div class="fileline">
    /private/apps/Informix/informix_wildtype/etc/sqlhosts.wildtype
    </div>

    <p>Change the definition of wanda from 

    <div class="shellline">
    wildtype        ontlitcp        zfin.org        zfin1_tli
    </div>
    <p>to
    <div class="shellline">
    wildtype        ontlitcp        helix.cs.uoregon.edu  zfin1_tli
    </div>

    <p>STATUS: 
    <br><br>
  </li>

  <li>Bring informix up on the 
    <a href="impl.html#Production Server">production server</a>

    <p>As informix on helix, <b>in a new shell</b>
    <div class="shell">
    % srcwildtype
    % oninit
    </div>

    <p>STATUS: 
    <br><br>
  </li>

  <li>Test that you can get to helix.cs.uoregon.edu.

    <p>This step assumes that you actually want the ability to access
    the web site on the 
    <a href="impl.html#Production Server">production server</a> while 
    zfin.org is running on the 
    <a href="impl.html#Development Server">development server</a>.
    As yourself on embryonix or helix

    <div class="shellline">
    % netscape helix.cs.uoregon.edu
    </div>

    <p>STATUS: 
    <br><br>
  </li>

  <li>Throttle back loaddb.pl on embryonix for as long as zfin.org is on it.
    <p>This involves commenting out the setting of PDQPRIORITY and PSORT_N_PROCS
    environment variables.

    <p>STATUS: 
    <br><br>
  </li>

  <li>Comment out the section of unloaddb.pl that sets the 
    <a href="Database/DataModel/index.htm">ZDB_FLAG</a>
    "disable updates" record to true.

    <p>This means tonight's dump won't diable updates.

    <p>STATUS: 
    <br><br>
  </li>

  <li>If you expect to still be on the development server during a change of 
    month, then add webrotate to root's cron on the development server and 
    drop it from root's cron on the production server.

    <p>STATUS: 
    <br><br>
  </li>
  
</ol>



<!-- ========= Moving from the Development Server to the Production Server -->

<h2 class="zdoc">
  <a name="Moving from the Development Server to the Production Server">
           Moving from the Development Server to the Production Server</a>
</h2>

<p>This process involves reversing everything you did to get zfin.org moved
to the <a href="impl.html#Development Server">development server</a>
in the first place.  Rather than produce an explicit recipe here,
I refer you to the previous section, and remind you that you should type
up your own recipe for doing  the move.



<!-- ========= LoadUp directories and Moving zfin.org -->

<h2 class="zdoc">
  <a name="Moving loadUp directories">
           Moving loadUp directories</a>
</h2>

<p>When zfin.org is on another machine, its loadUp directories (for 
storing images and PDFs in the filesystem) must also be moved or replicated
on the new machine.  When zfin.org is on embryonix, loadUp directories for
production and loadUp directories for development are on the same server.

<p>Development files must be kept separate from production files, just
as development databases must be kept separate from the production database
even when both are on the same server.  

<p>When zfin.org is on embryonix, the /research/zcentral/loadUp directory 
holds both the development loadUp directories:<br> 
/research/zcentral/loadUp/imageLoadUp and /research/zcentral/loadUp/PDFLoadUp
and the production loadUp directories:<br>
/research/zcentral/loadUp/embryonixLoadUp/embryonixImageLoadUp/imageLoadUp and 
/research/zcentral/loadUp/embryonixLoadUp/embryonixPDFLoadUp/PDFLoadUp<br>

<p>These directories are references both in the apache configuration
for production when its on the development machine and in the
embryonix.tt file.  The embryonix.tt file holds generic pointers to the
embryonixLoadUp directories above.  The apache configuration
recognizes the destination directories in the embryonixLoadUp directories
via the web.  Both of these configurations are slightly different than
those for either the production filesystem on the production server,
and those for the development filesystem on the development server.

<p>When production (zfindb) is loaded on development, the embryonix.tt
file controls where files are loaded (to the embryonix directories
above), and the modified apache configuration points users to 
the embryonix directories instead of the /research/zprod/loadUp
directories on helix.

<p>This is a snipit of the apache configuration for production
on development (note: you must change the apache configuration to allow
outside users to view the embryonixLoadUp directories when production
is on embryonix!): 

<div class="shell">
    Alias /imageLoadUp "/research/zcentral/loadUp/imageLoadUp"

    &lt;Directory "/research/zcentral/loadUp/imageLoadUp"&gt;
      AllowOverride None
      order deny,allow
      Deny from all
      Allow from env=AllowedDevelopmentHosts
    &lt;/Directory&gt;

    # Add alias to correct, non-development filesystem 
    # when zfindb is on embryonix

    Alias /embryonixImageLoadUp "/research/zcentral/loadUp/embryonixLoadUp/embryonixImageLoadUp"

    &lt;Directory "/research/zcentral/loadUp/embryonixLoadUp/embryonixImageLoadUp"&gt;
      AllowOverride None
      order deny,allow
      Deny from all
      Allow from env=AllowedDevelopmentHosts
    &lt;/Directory&gt;
</div>

<p>Here is a snipit of the embryonix.tt file compared to the helix.tt file:

<p><span class="file">embryonix.tt:</span>

<div class="shell">
&lt;--|IMAGE_LOAD|--&gt;		/embryonixImageLoadUp/imageLoadUp
&lt;--|LOADUP_FULL_PATH|--&gt;	/private/ZfinLinks/loadUp/embryonixLoadUp
&lt;--|PDF_LOAD|--&gt;		/embryonixPDFLoadUp/PDFLoadUp
</div>

<p><span class="file">helix.tt:</span>

<div class="shell">
&lt;--|IMAGE_LOAD|--&gt;		/imageLoadUp
&lt;--|LOADUP_FULL_PATH|--&gt;	/private/ZfinLinks/loadUp
&lt;--|PDF_LOAD|--&gt;		/PDFLoadUp
</div>

<p><span class="file">hoover.tt:</span>

<div class="shell">
&lt;--|IMAGE_LOAD|--&gt;		/imageLoadUp
&lt;--|LOADUP_FULL_PATH|--&gt;	/research/zcentral/loadUp
&lt;--|PDF_LOAD|--&gt;		/PDFLoadUp
</div>

<p>In order to establish the embryonix loadUp directories, files must
be copied from the /research/zprod/loadUp directories to the
/research/zcentral/loadUp/embryonixLoadUp directories.  Rsync is an 
effective way to do this.  

<p>Rsync is a good way to copy files from a repository to
a destination. (see the rsync man pages for details).
The repository is /research/zprod/loadUp and the destination
in this case is: /research/zcentral/loadUp/embryonixLoadUp/

<p>A typical rsync call looks like this:<br>



<br><br>
</div>

<script language="JavaScript" src="/footer.js" type="text/javascript"></script>
