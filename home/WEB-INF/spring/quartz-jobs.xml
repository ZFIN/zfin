<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!-- register them in the scheduler -->
    <bean id="scheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
        <!-- name used to publish applicationContext to Quartz Job instances, so they can call business services -->
        <property name="autoStartup" value="${RUN_QUARTZ_JOBS}"/>
        <property name="triggers">
            <list>
                <ref bean="regenerateWebHostDatabasesDaily"/>
                <ref bean="validateDatabasesDaily"/>
                <ref bean="pushAntibodiesToWikiWeekly"/>
                <ref bean="setPermissionsToOwnerTrigger"/>
                <ref bean="updateDOIDailyTrigger"/>
                <ref bean="updateDOIMonthlyTrigger"/>
                <ref bean="microarrayTrigger"/>
<!--
                <ref bean="reloadOntologyTrigger"/>
                <ref bean="loadQualityOntology"/>
                <ref bean="loadAnatomyOntology"/>
                <ref bean="loadGeneOntology"/>
                <ref bean="loadSpatialOntology"/>
-->
                <ref bean="sandboxCleanerTrigger"/>
                <ref bean="validateZebrafishBookPermissionsTrigger"/>
                <ref bean="removeGoTermsFromWithdrawnMarkersWeekly"/>
            </list>
        </property>
        <property name="quartzProperties">
            <props>
                <!-- ThreadPool -->
                <prop key="org.quartz.threadPool.class">org.quartz.simpl.SimpleThreadPool</prop>
                <prop key="org.quartz.threadPool.threadCount">3</prop>
                <prop key="org.quartz.threadPool.threadPriority">5</prop>
                <prop key="org.quartz.jobStore.class">org.quartz.simpl.RAMJobStore</prop>
                <prop key="org.quartz.jobStore.class">org.quartz.simpl.GroupRAMJobStore</prop>
            </props>
        </property>
    </bean>

    <!--jobs to run-->
    <bean id="regenerateWebHostDatabasesDaily" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Regenerate WebHost Curated Databases"/>
                <property name="group" value="Blast Databases"/>
                <property name="jobClass" value="org.zfin.sequence.blast.RegenerateWebHostCuratedDatabasesJob"/>
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_DO_NOTHING"/>
        <!--a nice lookup-->
        <!--fire at 2 am every day-->
        <property name="cronExpression" value="0 0 2 * * ?"/>
    </bean>


    <bean id="validateDatabasesDaily" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Validate Blast Databases"/>
                <property name="group" value="Blast Databases"/>
                <property name="jobClass" value="org.zfin.sequence.blast.ValidateBlastDatabases"/>
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_DO_NOTHING"/>
        <!--a nice lookup-->
        <!--fire at 3 am every day-->
        <property name="cronExpression" value="0 0 3 * * ?"/>
    </bean>

    <bean id="removeGoTermsFromWithdrawnMarkersWeekly" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Remove Go Terms From Withdrawn Markers"/>
                <property name="group" value="GO"/>
                <property name="jobClass" value="org.zfin.datatransfer.go.RemoveGoTermsFromWithdrawnMarkersJob"/>
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_FIRE_ONCE_NOW"/>
        <!--a nice lookup-->
        <!--fire at 8.12 pm every Friday -->
        <property name="cronExpression" value="0 12 20 ? * FRI"/>
    </bean>

    <bean id="pushAntibodiesToWikiWeekly" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Synchronize ZFIN Antibodies With Wiki"/>
                <property name="group" value="Wiki"/>
                <property name="jobClass" value="org.zfin.wiki.AntibodyWikiSynchronizationJob"/>
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_FIRE_ONCE_NOW"/>
        <!--a nice lookup-->
        <!--fire at 3.12 am every Sunday-->
        <property name="cronExpression" value="0 12 3 ? * SUN"/>
    </bean>

    <bean id="setPermissionsToOwnerTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Set Permissions to Owner on Wiki"/>
                <property name="group" value="Wiki"/>
                <property name="jobClass" value="org.zfin.wiki.SetPermissionsToOwnerJob"/>
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_DO_NOTHING"/>
        <property name="cronExpression">
            <!--goes off every 15 minutes -->
            <value>0 0,15,30,45 * * * ?</value>
        </property>
    </bean>

    <bean id="validateZebrafishBookPermissionsTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Validate Zebrafish Book Permissions"/>
                <property name="group" value="Wiki"/>
                <property name="jobClass" value="org.zfin.wiki.ValidatePermissionsForZebrafishBookJob"/>
            </bean>
        </property>
        <property name="cronExpression">
            <!--goes off at 2 am-->
            <value>0 0 2 * * ?</value>
        </property>
    </bean>

    <bean id="sandboxCleanerTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Clean Sandbox Wiki"/>
                <property name="group" value="Wiki"/>
                <property name="jobClass" value="org.zfin.wiki.SandboxCleanerJob"/>
            </bean>
        </property>
        <property name="cronExpression">
            <!--goes off at 3 am-->
            <value>0 0 3 * * ?</value>
        </property>
    </bean>

    <bean id="updateDOIDailyTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="DOI Daily Update"/>
                <property name="group" value="DOI"/>
                <property name="jobClass" value="org.zfin.datatransfer.doi.UpdateDOIJob"/>
                <property name="jobDataAsMap">
                    <map>
                        <entry key="reportAll" value="false"/>
                        <entry key="maxAttempts" value="20"/>
                        <!--<entry key="maxToProcess" value="10"/>-->
                    </map>
                </property>
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_DO_NOTHING"/>
        <!--goes off every day at 4 am-->
        <property name="cronExpression" value="0 0 4 * * ?"/>
    </bean>


    <bean id="updateDOIMonthlyTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="DOI Monthly Update"/>
                <property name="group" value="DOI"/>
                <property name="jobClass" value="org.zfin.datatransfer.doi.UpdateDOIJob"/>
                <!--just use defaults-->
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_FIRE_ONCE_NOW"/>
        <!--goes off the 21st of each month-->
        <property name="cronExpression" value="0 50 03 21 * ?"/>
    </bean>

    <bean id="microarrayTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Microarray Update"/>
                <property name="group" value="Microarray"/>
                <property name="jobClass" value="org.zfin.datatransfer.microarray.MicroarrayJob"/>
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_FIRE_ONCE_NOW"/>
        <!--goes off every Monday at 12.30 am-->
        <property name="cronExpression" value="0 30 0 ? * Mon"/>
    </bean>


    <bean id="reloadOntologyTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Reload Ontologies into Memory"/>
                <property name="group" value="Load Ontology"/>
                <property name="jobClass" value="org.zfin.ontology.quartz.ReloadOntologiesJob"/>
                <property name="jobDataAsMap">
                    <map>
                        <entry key="jobName" value="Reload Ontologies into Memory"/>
                    </map>
                </property>
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_FIRE_ONCE_NOW"/>
        <!--goes off every day at 4.10 am-->
        <property name="cronExpression" value="0 0 16 ? * SUN-THU"/>
    </bean>

    <bean id="loadQualityOntology" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Quality Ontology"/>
                <property name="group" value="Load Ontology"/>
                <property name="jobClass" value="org.zfin.ontology.quartz.LoadOntologiesJob"/>
                <property name="jobDataAsMap">
                    <map>
                        <entry key="oboFileName" value="quality.obo"/>
                        <entry key="oboFileUrl"
                                  value="http://obo.cvs.sourceforge.net/*checkout*/obo/obo/ontology/phenotype/quality.obo"/>
                        <entry key="scriptDirectory" value="../server_apps/data_transfer/LoadOntology"/>
                        <entry key="scriptFileName" value="loadTerms.sql,fixAnnotationsUponOntologyLoad.sql,dropTempTables.sql"/>
                        <entry key="useExistingFile" value="false"/>
                        <entry key="jobName" value="Load Quality Ontology"/>
                    </map>
                </property>
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_SMART_POLICY"/>
        <!--goes off every day at 4.10 am-->
        <property name="cronExpression" value="0 0 16 ? * SUN-THU"/>
    </bean>

    <bean id="loadGeneOntology" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Gene Ontology"/>
                <property name="group" value="Load Ontology"/>
                <property name="jobClass" value="org.zfin.ontology.quartz.LoadOntologiesJob"/>
                <property name="jobDataAsMap">
                    <map>
                        <entry key="oboFileName" value="gene-ontology.obo"/>
                        <entry key="oboFileUrl"
                                  value="http://www.geneontology.org/ontology/obo_format_1_2/gene_ontology.1_2.obo"/>
                        <entry key="scriptDirectory" value="../server_apps/data_transfer/LoadOntology"/>
                        <entry key="scriptFileName" value="loadTerms.sql,fixAnnotationsUponOntologyLoad.sql,dropTempTables.sql"/>
                        <entry key="useExistingFile" value="false"/>
                        <entry key="jobName" value="Load Gene Ontology"/>
                    </map>
                </property>
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_SMART_POLICY"/>
        <!--goes off every day at 4.10 am-->
        <property name="cronExpression" value="1 0 16 ? * SUN-THU"/>
    </bean>

    <bean id="loadAnatomyOntology" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Anatomy Ontology"/>
                <property name="group" value="Load Ontology"/>
                <property name="jobClass" value="org.zfin.ontology.quartz.LoadOntologiesJob"/>
                <property name="jobDataAsMap">
                    <map>
                        <entry key="oboFileName" value="anatomy.obo"/>
                        <entry key="oboFileUrl"
                                  value="http://obo.cvs.sourceforge.net/*checkout*/obo/obo/ontology/anatomy/gross_anatomy/animal_gross_anatomy/fish/zebrafish_anatomy.obo"/>
                        <entry key="scriptDirectory" value="../server_apps/data_transfer/LoadOntology"/>
                        <entry key="scriptFileName" value="loadTerms.sql,fixAnnotationsUponOntologyLoad.sql,dropTempTables.sql"/>
                        <entry key="useExistingFile" value="false"/>
                        <entry key="jobName" value="Load Anatomy Ontology"/>
                    </map>
                </property>
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_SMART_POLICY"/>
        <!--goes off every day at 4.10 am-->
        <property name="cronExpression" value="2 0 16 ? * SUN-THU"/>
    </bean>

    <bean id="loadSpatialOntology" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.JobDetailBean">
                <property name="name" value="Spatial Ontology"/>
                <property name="group" value="Load Ontology"/>
                <property name="jobClass" value="org.zfin.ontology.quartz.LoadOntologiesJob"/>
                <property name="jobDataAsMap">
                    <map>
                        <entry key="oboFileName" value="spatial.obo"/>
                        <entry key="oboFileUrl"
                                  value="http://obo.cvs.sourceforge.net/viewvc/obo/obo/ontology/anatomy/caro/spatial.obo"/>
                        <entry key="scriptDirectory" value="../server_apps/data_transfer/LoadOntology"/>
                        <entry key="scriptFileName" value="loadTerms.sql,fixAnnotationsUponOntologyLoad.sql,dropTempTables.sql"/>
                        <entry key="useExistingFile" value="false"/>
                        <entry key="jobName" value="Load Spatial Ontology"/>
                    </map>
                </property>
            </bean>
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_SMART_POLICY"/>
        <!--goes off every day at 4.10 am-->
        <property name="cronExpression" value="3 0 16 ? * SUN-THU"/>
    </bean>

</beans>
