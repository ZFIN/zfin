<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!-- register them in the scheduler -->
    <bean id="scheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
        <!-- name used to publish applicationContext to Quartz Job instances, so they can call business services -->
        <property name="autoStartup" value="${RUN_QUARTZ_JOBS}"/>
        <property name="triggers">
            <list>
                <ref bean="goaGafLoadTrigger"/>
                <ref bean="fpInferenceGafLoadTrigger"/>
                <ref bean="paintGafLoadTrigger"/>
            </list>
        </property>
        <property name="quartzProperties">
            <props>
                <!-- ThreadPool -->
                <prop key="org.quartz.threadPool.class">org.quartz.simpl.SimpleThreadPool</prop>
                <prop key="org.quartz.threadPool.threadCount">3</prop>
                <prop key="org.quartz.threadPool.threadPriority">5</prop>
                <prop key="org.quartz.jobStore.class">org.quartz.simpl.RAMJobStore</prop>
                <prop key="org.quartz.jobStore.class">org.quartz.simpl.GroupRAMJobStore</prop>
            </props>
        </property>
    </bean>

    <!--jobs to run-->

    <!--NOTE: these are both autowired in the zfinapp context-->
    <!--<bean id="downloadService1" class="org.zfin.datatransfer.service.DownloadService"/>-->
    <!--<bean id="gafService1" class="org.zfin.datatransfer.go.service.GafService"/>-->
    <!--<bean id="uniprotGafLoadJob1" class="org.zfin.datatransfer.service.UniprotGafLoadJob">-->
    <!--<property name="downloadService" ref="downloadService1"/>-->
    <!--<property name="gafService" ref="gafService1"/>-->
    <!--<property name="fanged" value="false"/>-->
    <!--</bean>-->

    <!--This is defined in a separate context-->
    <bean id="downloadService" class="org.zfin.datatransfer.service.DownloadService"/>
    <bean id="goaGafParser" class="org.zfin.datatransfer.go.GoaGafParser"/>
    <bean id="fpGafParser" class="org.zfin.datatransfer.go.FpInferenceGafParser"/>
    <bean id="paintGafParser" class="org.zfin.datatransfer.go.PaintGafParser"/>

    <bean id="goaGafLoadJobBean" class="org.springframework.scheduling.quartz.JobDetailBean">
        <property name="name" value="GOA GAF Load"/>
        <property name="group" value="GO"/>
        <property name="jobClass" value="org.zfin.datatransfer.go.service.GafLoadJob"/>
        <property name="jobDataAsMap">
            <map>
                <entry key="downloadService" value-ref="downloadService"/>
                <entry key="downloadUrl" value="ftp://ftp.ebi.ac.uk/pub/databases/GO/goa/ZEBRAFISH/gene_association.goa_zebrafish.gz"/>
                <entry key="organization" value="GOA"/>
                <entry key="gafParser" value-ref="goaGafParser"/>
            </map>
        </property>
    </bean>

    <bean id="fpInferenceGafLoadJobBean" class="org.springframework.scheduling.quartz.JobDetailBean">
        <property name="name" value="FP Inference GAF Load"/>
        <property name="group" value="GO"/>
        <property name="jobClass" value="org.zfin.datatransfer.go.service.GafLoadJob"/>
        <property name="jobDataAsMap">
            <map>
                <entry key="downloadService" value-ref="downloadService"/>
                <entry key="downloadUrl" value="http://build.berkeleybop.org/view/GAF/job/gaf-check-zfin/lastSuccessfulBuild/artifact/gene_association.zfin.inf.gaf"/>
                <entry key="organization" value="FP Inferences"/>
                <entry key="gafParser" value-ref="fpGafParser"/>
            </map>
        </property>
    </bean>

    <bean id="paintGafLoadJobBean" class="org.springframework.scheduling.quartz.JobDetailBean">
        <property name="name" value="Paint GAF Load"/>
        <property name="group" value="GO"/>
        <property name="jobClass" value="org.zfin.datatransfer.go.service.GafLoadJob"/>
        <property name="jobDataAsMap">
            <map>
                <entry key="downloadService" value-ref="downloadService"/>
                <entry key="downloadUrl" value="http://www.geneontology.org/gene-associations/submission/paint/pre-submission/gene_association.paint_zfin.gz"/>
                <entry key="organization" value="PAINT"/>
                <entry key="gafParser" value-ref="paintGafParser"/>
            </map>
        </property>
    </bean>

    <bean id="goaGafLoadTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail" ref="goaGafLoadJobBean">
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_FIRE_ONCE_NOW"/>
        <!--goes off the 22nd of each month-->
        <property name="cronExpression" value="0 50 03 22 * ?"/>
    </bean>

    <bean id="fpInferenceGafLoadTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail" ref="fpInferenceGafLoadJobBean">
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_FIRE_ONCE_NOW"/>
        <!--goes off the 22nd of each month-->
        <property name="cronExpression" value="0 50 02 22 * ?"/>
    </bean>

    <bean id="paintGafLoadTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <property name="jobDetail" ref="paintGafLoadJobBean">
        </property>
        <property name="misfireInstructionName" value="MISFIRE_INSTRUCTION_FIRE_ONCE_NOW"/>
        <!--goes off the 22nd of each month-->
        <property name="cronExpression" value="0 30 02 22 * ?"/>
    </bean>

</beans>
