<HTML>

<?MIVAR Name=page_name>$(IF,$(XST,$query_results),ZFIN Accession Search Results,ZFIN Accession Search)<?/MIVAR>

<?MIVAR><TITLE>$page_name</TITLE><?/MIVAR>

<SCRIPT>


</SCRIPT>

<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpageheader.apg';">$1<?/MISQL>

<basefont size=2>

<?MIVAR NAME=$accession>exists<?/MIVAR>

<?MIBLOCK COND="$(XST,$query_results)">

  <?MIVAR NAME=$MI_NULL>NULL<?/MIVAR>
  <?MIVAR NAME=gcount>0<?/MIVAR>
  <?MIVAR NAME=mcount>0<?/MIVAR>
  <?MIVAR NAME=pcount>0<?/MIVAR>
  <?MIVAR name=jtype>any<?/MIVAR>
  <?MIVAR name=pub_status>any<?/MIVAR>
  <?MIVAR name=cur_status>any<?/MIVAR>
  <?MIVAR name=order_pref>name<?/MIVAR>
  <?MIVAR name=line_type>accession<?/MIVAR>
  <?MIVAR name=mutagen>any<?/MIVAR>
  <?MIVAR name=chrom_change>any<?/MIVAR>
  <?MIVAR name=chrom_num>0<?/MIVAR>
  <?MIVAR name=searchtype>begins<?/MIVAR>
  <?MIVAR name=query_results>exists<?/MIVAR>


  <!--   THIS BLOCK HANDLES ACCESSION NUMBER SEARCHES ONLY NON ZDB_ID -->
  <?MIVAR name=aname>$(UPPER,$aname)<?/MIVAR>
  <?MIVAR name=OID>$aname<?/MIVAR>
  <?MIBLOCK COND="$(=,$(POSITION,$aname,ZDB),0)">

    <?MIVAR name=$inputaname>$aname <?/MIVAR>
    <!-- if the accession number specified has contains mgi:, omim: or gdb: , get rid of them -->
    <?MIBLOCK COND="$(>,$(POSITION,$aname,:),0)">
      <?MIVAR NAME=$newaname>$(SUBSTR,$aname,$(+,$(POSITION,$aname,:),1),$(STRLEN,$aname))<?/MIVAR>
      <?MIVAR name=$inputaname>$aname <?/MIVAR>
      <?MIVAR NAME=$aname>$newaname<?/MIVAR>
    <!-- DEBUGGING <?MIVAR> newaname = $newaname <?/MIVAR> -->
    <?/MIBLOCK>


    <!-- look if accession number links to publication -->

    <?MISQL SQL="select count(*)::integer from publication  where lower(accession_no) like lower('%$aname%') and status ='active';"> 
      $(SETVAR,$pcount,$1)
    <?/MISQL>
    <?MIBLOCK COND="$(NC,$pcount,0)">
	<?MIVAR NAME=$start_page>aa-pubselect2.apg<?/MIVAR>	
	<?MIVAR NAME=$constraint> where accession_no = '$aname' <?/MIVAR> 
        <?MISQL SQL="select WebExplode(object,'') from webPages where ID='$start_page';">$1<?/MISQL>
    <?/MIBLOCK>

   <!-- look if accession number links to any marker, significance 11 and 12 signify orthologue or accession numbers -->

    <?MISQL SQL="select count(*)::integer from all_map_names a  where allmapnm_name = lower('$aname') and allmapnm_significance in (11,12);">
      $(SETVAR,$gcount,$1)
    <?/MISQL>
    <?MIBLOCK COND="$(NC,$gcount,0)">
	<?MIVAR NAME=$start_page>aa-markerselect.apg<?/MIVAR>	
        <?MIVAR NAME=$name>$aname<?/MIVAR>
        <?MISQL SQL="select WebExplode(object,'') from webPages where ID='$start_page';">$1<?/MISQL>
    <?/MIBLOCK>

    <?MIBLOCK COND="$(AND,$(EC,$pcount,0),$(EC,$mcount,0),$(EC,$gcount,0))">
      <form><center><font size=4><?MIVAR><b>Requested acession number is not available in ZFIN.</b></font></center> <?/MIVAR>
      </form>
    <?/MIBLOCK>

  <?/MIBLOCK>


  <!--  THIS BLOCK HANDLES ZDB ID SEARCHES  -->

  <?MIBLOCK COND="$(>,$(POSITION,$aname,ZDB),0)">

    <?MIVAR NAME=$start_page>NULL<?/MIVAR>
    <!-- if a zdb is passed in,  set second frame to it's viewer with specified zdb_id! -->

    <?MIBLOCK COND="$(XST,$aname)")>
      <?MIVAR name=aname>$(UPPER,$aname)<?/MIVAR>
      <?MIVAR name=$OID>$aname<?/MIVAR>
      <?MIVAR NAME=$constraint> where zdb_id = '$OID' <?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,LAB),0)">aa-labselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,PERS),0)">aa-persselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,COMPANY),0)">aa-companyselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,PUB),0)">aa-pubselect2.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,FISH),0)">aa-fishselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,GENE),0)">aa-markerselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,SSLP),0)">aa-markerselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,EST),0)">aa-msegselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,BAC),0)">aa-markerselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,PAC),0)">aa-markerselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,BAC_END),0)">aa-markerselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,PAC_END),0)">aa-markerselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,LOCUS),0)">aa-locusview.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,REFCROSS),0)">aa-crossview.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,RAPD),0)">aa-markerselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,STS),0)">aa-markerselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,RFLP),0)">aa-markerselect.apg<?/MIVAR>
      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,IMAGE),0)">aa-imageview.apg<?/MIVAR>

      <?MIVAR NAME=$start_page COND="$(>,$(POSITION,$aname,XPAT),0)">aa-xpatview.apg<?/MIVAR>
    <?/MIBLOCK>

    <?MIBLOCK COND="$(EC,$start_page,NULL)">
      <form><center><font size=4><?MIVAR><b>Requested ID is not available in ZFIN.</b> </font></center><?/MIVAR>
      </form>
    <?/MIBLOCK>  <!-- ends if start page is null -->


    <?MIBLOCK COND="$(NC,$start_page,NULL)">  
	<?MIVAR COND="$(OR,$(>,$(POSITION,$start_page,mseg),0),$(>,$(POSITION,$start_page,marker),0))" NAME=$constraint> mrkr_zdb_id = '$OID' <?/MIVAR>    
        <?MISQL SQL="select WebExplode(object,'') from webPages where ID='$start_page';">$1<?/MISQL>
    <?/MIBLOCK>  <!-- ends if valid start page, not null  -->


  <?/MIBLOCK>  <!-- ENDS IF SEARCHTYPE ZDB ID -->


<?/MIBLOCK> <!--XST query_results-->



<!------------- search ------------->


    <Table class=search width="100%" border=0 cellpadding=1 cellspacing=0>
      <TR>
	<td class=titlebar>
          &nbsp;&nbsp;

  <?MIBLOCK COND="$(NXST,$query_results)">
	  <b>Search for ACCESSION Number</b>
  <?MIELSE>
          <a name=modify></a><b>Modify your search</b>
  <?/MIBLOCK>

        </td>
        <td class=titlebar align=right>
        <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-input_button_generic.apg';">$1<?/MISQL>          
        </td>
      </tr>

<form name=critform method=post action="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->" >

  <TR>
   <TD class="fullwidth">
    <?MIVAR>
    <b>Accession Number:</b> <input type=text name=aname size=15 value=$(IF,$(XST,$aname),$aname, )> </font>
    <?/MIVAR>
   </TD>
  </TR>
  <TR> 
   <TD class="submitbar" colspan=2 align="right">
    <input type=submit name=action value="SEARCH">
    <input type=button value="RESET" onClick='document.critform.aname.value = ""'> 
   </TD> 
  </TR>
</TABLE>


<input type=hidden name=MIval value=aa-accessionselect.apg>
<input type=hidden name=query_results value="exists">


<!-- This next little block executes only if we are using the browser as a
selector. That is we want user to ultimately CHOOSE a browsed value. All
we have to do at this point is pass the return record along the appropriate form.
-->
<?MIVAR COND="$(XST,$return_rec)">
<input type=hidden NAME="return_rec" value=$return_rec>
<?/MIVAR>

<?MIVAR COND="$(XST,$query_results)">
    </td>
  </tr>
</table>
<?/MIVAR>

</form>

<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpagefooter.apg';">$1<?/MISQL>






