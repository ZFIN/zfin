<?MICOMMENT>
FILE: markerview.apg
PREFIX: mrkrview_ (but none replaced as of Feb. 2005)

DESCRIPTION:
This file implements a viewer for MARKER records.

INPUT VARS:
OUTPUT VARS:

EFFECTS:

NOTE:
Because this page drops temporary tables it cannot be webexploded from
inside a select statement.  This page must first be retrieved with a
select statement and then passed to webexplode from an execute function
statement.  See discussion of the MIqry2pass variable in the Web
Datablade documentation.

Recent changes:
for antibody: antibody subsection added at the end of gene product section.
for antibody: added meta redirect at the beginning and the end of the file.
<?/MICOMMENT>



<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<?MICOMMENT> ** if a vegaID is passed in, use it to get the OID ** <?/MICOMMENT>
<?MISQL COND="$(XST,$vegaID)" SQL="select first 1 mrkr_zdb_id
                 from marker, db_link
                where mrkr_zdb_id = dblink_linked_recid
                  and dblink_acc_num = '$vegaID';">
    <?MIVAR name="$OID">$1<?/MIVAR>
  <?/MISQL>

<?MIVAR COND="$(AND,$(NXST,$OID),$(XST,$temp_oid))" NAME=$OID>$temp_oid<?/MIVAR>


<HTML>
<head>
  <META HTTP-EQUIV="EXPIRES" CONTENT="Wed Sep 11 09:35:25 PDT 1996">

  <script src="/javascript/profile-edit.js"></script>

  <link rel=stylesheet type="text/css" href="/css/tabEdit.css">

  <SCRIPT>

  function updateInnerHTML(element_id,html_to_display) {
    var c1 = document.getElementById(element_id);
    c1.innerHTML = html_to_display;
   }

  function start_note(ref_page) {
    top.zfinhelp=open("/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-"+ref_page+".apg","notewindow","scrollbars=no,toolbar=no,directories=no,menubar=no,status=no,resizable=yes,width=400,height=325");
  }

  function call_mapplet() {
	document.mapper.submit();
  }

  function call_zmapplet() {
	document.mapper.action='/<!--|CGI_BIN_DIR_NAME|-->/view_zmapplet.cgi';
	document.mapper.submit();
  }

  function edit_linkage(link_id,oid) {
	window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-edit_linkage.apg&link_id='+link_id+'&OID='+oid)
  }

  function edit_go(oid) {
	window.location.replace('/action/marker/marker-go-edit/'+oid)
  }

  function get_spdesc(oid) {
	window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markerspcomments.apg&OID='+oid)
  }
  function start_help() {
   top.zfinhelp=open('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-helpframes.html&calling_page=sequence_tools_help.html',"helpwindow","scrollbars=yes,toolbar=no,directories=no,menubar=no,status=no,resizable=yes,width=800,height=600");
  }

  </SCRIPT>
  <?MIVAR COND="$(AND,$(NXST,$OID),$(XST,$temp_oid))" NAME=$OID>$temp_oid<?/MIVAR>

<script type="text/javascript" language="JavaScript">
function jump(form_select){
    if (0 != form_select.selectedIndex){
        window.open(form_select.options[form_select.selectedIndex].value,parseInt(Math.random()*2000000000));
    }
    return true;
}
</script>

  <SCRIPT>
   function info() {
	window.alert('ANONYMOUS LINKAGE:\n This linkage has not been published yet. ZFIN supports anonymous linkages to promote scientific \ncollaboration; you should contact the submitter of this mapping data (just click the link) \nto negotiate access to this information.');
   }
  //  initialize view_mapplet parameters
   marker = '';

  </SCRIPT>
</HEAD>


<!------------------------------------------------------>

<?MIVAR name=$highlight><!--|HIGHLIGHT_COLOR|--><?/MIVAR>

<?MIVAR NAME=$MI_NOVALUE><?/MIVAR>
<?MIVAR NAME=$MI_NULL><?/MIVAR>

<?MIBLOCK COND="$(NXST,$OID)">
  <p>
  ERROR -- something bad happened -- no OID passed in!
<?/MIBLOCK>

<!-- One block till </body> ---------------------------->
<?MIBLOCK COND="$(XST,$OID)">

  <!-- set default value for variables ----------------->
  <?MIVAR COND="$(NXST,$distance)" NAME=$distance><?/MIVAR>
  <?MIVAR COND="$(NXST,$lod)" NAME=$lod><?/MIVAR>
  <?MIVAR COND="$(NXST,$metric)" NAME=$metric><?/MIVAR>
  <?MIVAR COND="$(NXST,$lg)" NAME=$lg><?/MIVAR>
  <?MIVAR COND="$(NXST,$map_comments)" NAME=$map_comments><?/MIVAR>
  <?MIVAR NAME=$ref_map><?/MIVAR>

  <!-- default user as GUEST---------------------->
  <?MIVAR NAME=$userid>GUEST<?/MIVAR>

  <!-- page header display ----------------->
  <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpageheader.apg';">$1<?/MISQL>


  <?MISQL COND=$(XST,$debug_timing) SQL="
        execute function get_time()">
        <br>$1 Page Start
  <?/MISQL>


  <!-- NOW a slight ugliness that would go away if/when we re-implement the MAP_MARKER stuff as hierarchical classes: we don't know what type up marker we are trying to view, and yet we need to know exactly that in order to know what table to select from. So we first look at ZFIN id to determine type, which determines table
  -->


  <?MISQL SQL="
    select mrkr_name, mrkr_type, mrkrtype_type_display, mrkr_abbrev, mrkr_comments
      from marker, marker_types
      where mrkr_zdb_id = '$OID'
	and mrkr_type = marker_type;
    ">
  <?/MISQL>
  <?MIVAR NAME=$name>$1<?/MIVAR>
  <?MIVAR NAME=$marker_type>$2<?/MIVAR>
  <?MIVAR NAME=$marker_type_display>$3<?/MIVAR>
  <?MIVAR NAME=$abbrev>$4<?/MIVAR>
  <?MIVAR NAME=$comments>$5<?/MIVAR>
  <?MIVAR NAME=$id_exist COND="$(>,$MI_ROWCOUNT,0)">t<?/MIVAR>



  <?MIVAR COND="$(NXST,$gene_has_chimeric_clone)" NAME=$gene_has_chimeric_clone>f<?/MIVAR>
  <?MISQL COND="$(EQ,$marker_type,GENE)"
  SQL="
    select 't'
    from marker_relationship
      join clone on clone_mrkr_zdb_id = mrel_mrkr_2_zdb_id
    where mrel_mrkr_1_zdb_id = '$OID'
	and clone_problem_type = 'Chimeric'
    ;
  ">
      <?MIVAR  NAME=$gene_has_chimeric_clone>$1<?/MIVAR>
  <?/MISQL>

  <?MISQL SQL="
	select * from marker_type_group_member
	 where mtgrpmem_mrkr_type_group='GENEDOM'
	   and mtgrpmem_mrkr_type = '$marker_type';
	">
  <?/MISQL>
  <?MIVAR COND="$(>,$MI_ROWCOUNT,0)" NAME=type_of_genedom>t<?/MIVAR>
  <?MIVAR COND="$(>,$(POSITION,$marker_type,CONSTRCT),0)" NAME=type_of_construct>t<?/MIVAR>

  <?MISQL SQL="
	select 't'
          from marker_type_group_member
	 where mtgrpmem_mrkr_type_group='KNOCKDOWN_REAGENT'
	   and mtgrpmem_mrkr_type = '$marker_type'; ">
     <?MIVAR NAME=type_of_knockdown_reagent>t<?/MIVAR>
  <?/MISQL>

  <!-- if no match for the entered ID, display not found msg ------>
  <?MIBLOCK COND="$(OR,$(EC,$name,$MI_NOVALUE),$(NXST,$id_exist))">
     <!-- look to see if replaced zdb_id -->
     <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-zdb_history.apg';">$1<?/MISQL>

     <?MIBLOCK COND="$(NXST,$new_oid)">
       <form><center><font size=4>
        <?MIVAR> <b>Requested ID not found on ZFIN.<?/MIVAR></font>
       </form>
     <?/MIBLOCK>


  <?MIELSE> <!-- if entered ID has an entry in ZFIN------------------------>

      <SCRIPT> <!-- functions for update--------------------->

      <?MIVAR COND="$(XST,$UPDATE)">
	function doit(attr,attr_type,print_name) {
		doit(attr,attr_type,print_name,'');
	}
	function doit(attr,attr_type,print_name,xtra_param) {
		window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markerupdate.apg&OID=$OID&attr='+attr+'&attr_type='+attr_type+'&print_name='+print_name+'&xtra_param='+xtra_param+'&target_table=marker');
	}

	function Delete_listitem(item_name,item_id) {
		window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr='+item_name+'&attr_type=special-listitem&old_value='+item_id+'&comments=Deleted&target_table=marker');
	}

	function Delete_alias(alias,marker_id) {
 		 window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=dalias_alias&attr_type=delete-alias&old_value='+alias+'&comments=Deleted&target_table=marker');
	}

        <?MISQL SQL="select WebExplode(object,'jsdelatt_OID=$OID&jsdelatt_Mival=aa-do-markerupdate.apg&jsdelatt_page_var=__attr_type=special-listitem__comments=Deleted__target_table=marker')
        from webPages where ID='aa-js-delete_attrib.apg';">$1<?/MISQL>

	function Delete_mrel(mrel_partner_id, type) {
 		 window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=marker_relationship&attr_type=delete-mrkrrelation&old_value='+mrel_partner_id+'&comments=Deleted&target_table=marker&info='+type);
	}

	function delete_supplier(supplier_zdb_id) {
 		 window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr_type=delete-supplier&old_value='+supplier_zdb_id);
	}

	function new_ortho() {
		var speciesind=document.updater1.species.selectedIndex;
		var species=document.updater1.species[speciesind].value;
		var oname=document.updater1.oname.value;
		var oabbrev=document.updater1.oabbrev.value;
		if ((oname != '') && (oabbrev != '')) {
  		 window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=orthologue&attr_type=special-newortho&old_value='+species+'&new_value='+escape(oname)+'&target_table=marker&info='+oabbrev);
  		}
	}



	function new_seqnum() {
		var dbind=document.updateseq.seqdb.selectedIndex;
		var dbfull=document.updateseq.seqdb[dbind].text;

        var pattern = /-/ ;
        var dbname = dbfull.split(pattern)[0].trim() ;
        var seq_type = dbfull.split(pattern)[1].trim() ;

        // this is required for the form processing for some reason
        seq_type='sequence&fdbcont_data='+seq_type ;
		var seq_acc=document.updateseq.seq_acc.value.trim();
		var fdb_id =document.updateseq.seqdb.value.trim();
        // alert('dbname: '+ dbname+ ' seq_type: '+seq_type) ;
        // alert('fdb_id: '+ fdb_id+ ' seq_acc: '+seq_acc) ;


        // the following checks enforce correct accession# format
        // per curator, we check RefSeq and Vega for now
		if ( ( dbname == 'RefSeq' && /RNA/.test(seq_type) &&  ! /[NX]M[_]/.test(seq_acc) )
                   ||( dbname == 'RefSeq' && /Polypeptide/.test(seq_type) &&  ! /[NX]P[_]/.test(seq_acc) )             ){

		    alert ("RefSeq accession number is in a wrong format, please check.");
		    return false;
		}

		if ( /[NX].[_]/.test(seq_acc) && dbname != 'RefSeq' ){

		    alert ("The accession number is in RefSeq format, please check dbname.");
		    return false;
		}

		if ( dbname == 'Vega_Trans' &&  ! /^OTT/.test(seq_acc) ){

		    alert ("Vega Trans accession number is in a wrong format, please check.");
		    return false;
		}
		if ( /^OTT/.test(seq_acc) && dbname != 'Vega_Trans' ){

		    alert ("The accession number is in Vega Trans format, please check dbname.");
		    return false;
		}

		// call do-markerupdate.apg to do the job
		if (seq_acc != '') {

		   var attribution_type = "special-newseqnum";
	           if  (dbname == 'GenBank') {
			var attribution_type = "special-check-newseqnum";
		   }

  		   window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&ancor=sequence&OID=$OID&attr=seqnum&attr_type='+attribution_type+'&old_value='+dbname+'&new_value='+seq_acc+'&target_table=marker&fdbcont_super='+seq_type+'&xtra_param='+fdb_id);
  		}

	}

	function update_seqnum() {
		var dbind=document.updateseq.upd_seq_zdb.selectedIndex;
		var seq_zdb=document.updateseq.upd_seq_zdb[dbind].value.trim();
		var seq_len=document.updateseq.upd_seq_length.value.trim();
		var dbind=document.updateseq.upd_seq_type.selectedIndex;
		var seq_type=document.updateseq.upd_seq_type[dbind].value;
		if (seq_zdb != '') {
  		 window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&anchor=sequence&OID=$OID&attr=seqnum&attr_type=special-updateseqnum&old_value=dblink_length&new_value='+seq_len+'&target_table=marker&dataOID='+seq_zdb+'&xtra_param='+seq_type);
  		}
	}
	function new_othernum() {
		var dbind=document.updateother.seqdb.selectedIndex;
		var dbname=document.updateother.seqdb[dbind].value;
		var seq_acc=document.updateother.seq_acc.value.trim();
		var dbind=document.updateother.seq_super.selectedIndex;
		var seq_type=document.updateother.seq_super[dbind].value.trim();
		if (seq_acc != '') {
		 window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&ancor=other&OID=$OID&attr=seqnum&attr_type=special-newseqnum&old_value='+dbname+'&new_value='+seq_acc+'&target_table=marker&fdbcont_super='+seq_type);
		}
	}

    // sets chimerism, which is the problem type
	function new_proseqnum() {
		var dbind=document.updateps.prt_seqdb.selectedIndex;
		var dbname=document.updateps.prt_seqdb[dbind].value;
		var seq_acc=document.updateps.prt_seq_acc.value.trim() ;
		if (seq_acc != ''){
		  window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=seqnum&attr_type=special-newseqnum&old_value='+dbname+'&new_value='+seq_acc+'&target_table=marker&fdbcont_super=protein&fdbcont_data=domain');
  		}
	}

	function new_mrkrrel(mrkrrel_type, mrkr_abbrev_value) {
		var mrkr_abbrev = escape(mrkr_abbrev_value.trim());
		mrkrrel_type.replace(/ /,"%20");
		if (mrkr_abbrev != '') {
		  window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=mrkrrel&attr_type=special-newmrkrrel&old_value='+mrkrrel_type+'&new_value='+mrkr_abbrev+'&target_table=marker');
  		}
	}

	function new_supplier(supplier_id) {
		if (supplier_id != '') {
		  window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr_type=special-newsupplier&new_value='+supplier_id);
  		}
	}

	function update_nomen_comments(nomen_zdb,comments_obj) {
        	var new_comments = escape(comments_obj.value);
		if ((nomen_zdb != '') && (new_comments != '')) {
		  window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID='+nomen_zdb+'&attr=comments&attr_type=textarea&old_value=$OID&new_value='+new_comments+'&target_table=marker_history&info=mhist_');
  		}
	}

        <?MICOMMENT> Note Can Be Blank. However, the xtra_param variable is set to alias
          by the updating page when xtra_param is null. An edit has occured, so set
          note = 'Sequence modified'.
        <?/MICOMMENT>
 	function update_sequence(mrkr_zdb_id,old_seq,new_seq,note) {
 	        if (note == '') {note = 'Sequence modified';}
 	        note = escape(note.replace(/\n/g, "<br>"));
 		 
 		  window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&dataOID='+mrkr_zdb_id+'&attr=seq_sequence&attr_type=special&old_value='+old_seq+'&new_value='+new_seq+'&target_table=marker_sequence&xtra_param='+note);
  
        }


        function update_second_sequence(seq_zdb,old_seq,new_seq,note,new_seq_2) {
 	        if (note == '') {note = 'Sequence modified';}
 	        note = escape(note.replace(/\n/g, "<br>"));
  		  window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&dataOID='+seq_zdb+'&attr=seq_sequence_2&attr_type=special&old_value='+old_seq+'&new_value='+new_seq+'&target_table=marker_sequence&xtra_param='+note+'&new_value2='+new_seq_2);
 
        }

	function update_problem_type(old_value , new_value) {
            old_value.replace(/ /, "%20") ;
 	    old_value = escape(old_value);
            new_value.replace(/ /, "%20") ;
 	    new_value = escape(new_value);
            if(old_value!=new_value){
               window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&anchor=top&OID=$OID&attr=clone_problem_type&attr_type=boolean&old_value='+old_value+'&new_value='+new_value+'&target_table=clone');
            }
	}

	function new_attrib_nomen(nomen_zdb,pub_obj) {
        	var pub_id = escape(pub_obj.value.trim());
		if ((nomen_zdb != '') && (pub_id != '')) {
		  window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=recattrib&attr_type=special-newattrib&old_value='+nomen_zdb+'&new_value='+pub_id+'&target_table=marker&info=nomen');
  		}
	}

	function new_attrib_mrel(attrmrelform) {
		var mrkr_abbrev=escape(attrmrelform.attrib_mrkr_abbrev.value.trim());
		var pub_id=attrmrelform.attrib_mrel_pubid.value.toUpperCase().trim();
                <?MICOMMENT>
                   Do not allow "clone contains gene" marker_relationship for ZDB-PUB-030703-1.

                   1. The form passes in gene abbrevs, so get all the abbrevs that have
                   the not allowed relationship.
                   2. Compare the pub id to the identified pub id.
                   3. If the pub is a match, compare against each gene abbrev.
                   4. If an abbrev matches, display error message.
                <?/MICOMMENT>
		var mrkr_match = false;
		var pub_match = false;

		if (pub_id == "ZDB-PUB-030703-1") { pub_match = true;}

		<?MIVAR>
		  <?MISQL SQL="select mrkr_abbrev from marker, marker_relationship where mrel_mrkr_2_zdb_id = '$OID' and mrel_mrkr_1_zdb_id = mrkr_zdb_id;">
		     if (mrkr_abbrev == "$1") {mrkr_match = true;}
		  <?/MISQL>
		<?/MIVAR>

		if ((pub_match == true) && (mrkr_match == true))
		{
		   alert("clone contains gene is not allowed with Vega Load pub.");
		   return false;
		}
		if ((mrkr_abbrev != '') && (pub_id != '')) {
		  window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=recattrib&attr_type=special-newattrib&old_value='+mrkr_abbrev+'&new_value='+pub_id+'&target_table=marker&info=mrel');
  		}
	}

	function new_attrib_ssprevname(objform) {
		var prev_name=escape(objform.attrib_ssprevname.value.trim());
		var pub_id=objform.attrib_ssprevname_pubid.value.toUpperCase().trim();
		if ((prev_name != '') && (pub_id != '')) {
		  window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=recattrib&attr_type=special-newattrib&old_value='+prev_name+'&new_value='+pub_id+'&target_table=marker&info=namealias');
  		}
	}

	function new_attrib_prevname(objform) {
		var prev_name=escape(objform.attrib_prevname.value.trim());
		var pub_id=objform.attrib_prevname_pubid.value.toUpperCase().trim() ;

		if ((prev_name != '') && (pub_id != '')) {
		  window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=recattrib&attr_type=special-newattrib&old_value='+prev_name+'&new_value='+pub_id+'&target_table=marker&info=namealias');
  		}
	}

	function new_attrib_prtnseq() {
		var seq_acc = document.updateps.attrib_prtn_seqacc.value.trim() ;
		var pub_id = document.updateps.attrib_prtn_pubid.value.toUpperCase().trim() ;
		if((seq_acc != '')&&(pub_id != '')) {
			window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=recattrib&attr_type=special-newattrib&old_value='+seq_acc+'&new_value='+pub_id+'&target_table=marker&info=seqacc');
		}
	}
	function new_attrib_seq() {
		var seq_acc = document.updateseq.attrib_seq_acc.value.trim();
		var pub_id = document.updateseq.attrib_seq_pubid.value.toUpperCase().trim();
		var fdb_id = document.updateseq.attrib_seq_fdb.value.toUpperCase().trim();
		if((seq_acc != '')&&(pub_id != '')) {
			window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=recattrib&attr_type=special-newattrib&old_value='+seq_acc+'&new_value='+pub_id+'&target_table=marker&info=seqacc&xtra_param='+fdb_id);
		}
	}
	function new_attrib_other() {
		var seq_acc = document.updateother.attrib_seq_acc.value.trim();
		var pub_id = document.updateother.attrib_seq_pubid.value.toUpperCase().trim();
		if((seq_acc != '')&&(pub_id != '')) {
			window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=recattrib&attr_type=special-newattrib&old_value='+seq_acc+'&new_value='+pub_id+'&target_table=marker&info=seqacc');
		}
	}

	function new_attrib_mutant(dataid, objform) {
		var pub_id = objform.attrib_mutant_pubid.value.toUpperCase().trim();
		if((dataid != '')&&(pub_id != '')) {
			window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=recattrib&attr_type=special-newattrib&old_value='+dataid+'&new_value='+pub_id+'&target_table=marker&info=cloned_gene');
		}
	}

 	function new_attrib_markerseq(dataid) {
 		var pub_id = document.newdata.mrkrview_seq_pubid.value.toUpperCase().trim();
 		if((dataid != '')&&(pub_id != '')) {
 			window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=recattrib&attr_type=special-newattrib&old_value='+dataid+'&new_value='+pub_id+'&target_table=marker&info=marker_sequence');
 		}
 	}

        <?/MIVAR>
      </SCRIPT>

     <!-- user authorization check------------------------------->
        <?MIVAR COND="$(NXST,$UPDATE)" >
                <meta http-equiv="refresh" content="0;url=/action/marker/view/$OID">
                This page is for updates only.
                <a href="/action/marker/view/$OID">
                Moving to new marker page.
                </a>
        <?/MIVAR>

      <?MISQL COND="$(NXST,$UPDATE)" SQL="select WebExplode(object,'page_title=View $marker_type') from webPages where ID='aa-secure_navigation.apg';">$1
      <?/MISQL>

      <!-- If updating, only let owner update anything -->
      <?MISQL COND="$(XST,$UPDATE)" SQL="select WebExplode(object,'page_title=Update Gene&permission=owns&rtype=marker') from webPages where ID='aa-secure_navigation.apg';">$1
      <?/MISQL>

    <?MIVAR COND="$(AND,$(XST,$UPDATE),$(EQ,$marker_type,GENE))">
    <script type="text/javascript">
        var MarkerProperties= {
            zdbID: "$OID"
        };
    </script>

              <?MICOMMENT>
              Adds the GeneEditController.
              <?/MICOMMENT>
        <link rel="stylesheet" type="text/css" href="/css/Marker.css"/>
    <script type="text/javascript" language="javascript" src="/gwt/org.zfin.gwt.marker.Marker/org.zfin.gwt.marker.Marker.nocache.js"></script>
    <?/MIVAR>


      <?MIBLOCK COND="$(NC,$AUTHORIZED,false)"> <!-- if authorized---------->

	  <!-- title for webpage history ----------->
          <?MIBLOCK COND="$(XST,$UPDATE)">
		<?MIVAR>
 			<TITLE>ZFIN Update: $abbrev</title>
		<?/MIVAR>
	  <?MIELSE>
		<?MIVAR>
 			<TITLE>ZFIN: $marker_type_display: $abbrev </title>
		<?/MIVAR>
          <?/MIBLOCK>

	  <!-- NOW JUST TOSS OUT THE RETRIEVED DATA IN A TABLE -->
	  <!-- FIRST THROW UP THE ZDB DATA MANAGER FOR THE RECORD -->
        <?MIBLOCK COND="$(NXST,$mrkrview_no_update)">
  	   <?MISQL COND="$(NXST,$UPDATE)" SQL="select WebExplode(object,'rtype=marker') from webPages where ID='aa-data_mgr.apg';">$1
	   <?/MISQL>
        <?MIELSE>
           <?MIVAR>
             <TABLE WIDTH=100% border=0 bgcolor="$highlight">
           <?/MIVAR>
           <?MIVAR COND="$(NXST,$MIval)" NAME=$MIval>aa-stub.html<?/MIVAR>
           <?MIVAR>
<TR align=center>
<TD><font size=-1> <b>ZFIN ID:</b> $OID </font><?/MIVAR>
</TD>
</table>
        <?/MIBLOCK>

	  <!----- OKAY, NOW  THROW UP THE  MARKER INFO ------------------>

  <?MISQL COND=$(XST,$debug_timing) SQL="
        execute function get_time()">
        <br>$1 Page Display ...
  <?/MISQL>

<!----------------------------------------------------------->
<p>

<?MIVAR COND="$(XST,$UPDATE)">

        <form>
        <center>
        <a
        style="font-size: large;"
        href="javascript:"
        onClick="document.location.replace('/action/marker/view/$OID')"
        >[View Marker]</a>
        </center>
        </form>
<?/MIVAR>



<?MICOMMENT>=========================================================
            ==     Name    &   Input Welcome button
            ==     Symbol (if genedom)
	    =========================================================
<?/MICOMMENT>
<?MICOMMENT> use table to line up title and your input welcome button
<?/MICOMMENT>
<table width=100% cellspacing=0>
  <tr>
   <td width=85%>
    <?MIVAR COND="$(XST,$UPDATE)">
    	<INPUT TYPE=button value=Update onClick="doit('mrkr_name','text','$marker_type_display+Name','updatename')">
    <?/MIVAR>

    <?MIVAR NAME=$title>$marker_type_display Name<?/MIVAR>
    <FONT size=+1><b>
<?MIBLOCK COND="$(OR,$(XST,$type_of_genedom),$(XST,$type_of_construct))">
      <?MIVAR>$title:&nbsp;<i>$name</i><?/MIVAR>
<?MIELSE>
      <?MIVAR>$title:&nbsp;$name<?/MIVAR>

<?/MIBLOCK>
    </b></FONT>
   </td>
   <?MIBLOCK COND="$(NXST,$UPDATE)">
    <td width=15% align=right>
     <?MIVAR>
       <?MISQL SQL="select WebExplode(object,'subject=$abbrev') from webPages where ID='aa-input_button_generic.apg';">$1<?/MISQL>
      <?/MIVAR>
    </td>
   <?/MIBLOCK>
  </tr>
  <?MIVAR COND="$(XST,$type_of_genedom)">
    <tr><td colspan=2>
      <?MIVAR COND="$(XST,$UPDATE)">
        <INPUT TYPE=button value=Update onClick="doit('mrkr_abbrev','text','$marker_type_display+Abbrev')">
      <?/MIVAR>
      <FONT size=+1><b>
	$marker_type_display Symbol:&nbsp;<i>$abbrev</i>
      </b></FONT>
    </td></tr>
 <?/MIVAR>
</table>


<?MICOMMENT>=========================================================
            ==     Previous Names
	    =========================================================
<?/MICOMMENT>
<?MIVAR COND="$(XST,$UPDATE)">
  <INPUT TYPE=button
    value=Add
    onClick="doit('dalias_alias','text','Alias','alias')">
  <b>Previous Names:</b>
<?/MIVAR>



<?MISQL SQL="
  select dalias_alias, dalias_zdb_id
    from data_alias, alias_group
    where dalias_data_zdb_id = '$OID'
    and aliasgrp_pk_id = dalias_group_id
    and aliasgrp_name = 'alias';">

  <?MIBLOCK COND="$(=,$MI_CURRENTROW,1)">

    <?MIVAR NAME=mrkrvw_alias_name_array>$1<?/MIVAR>
    <?MIVAR NAME=mrkrvw_alias_zdb_id_array>$2<?/MIVAR>

    <?MIBLOCK COND="$(NXST,$UPDATE)">
      <b>Previous Names:</b>
    <?MIELSE>
      <form>
      <br><b>Add Reference:</b>
      Previous name:<input type=text name=attrib_prevname>
      Reference:<input type=text name=attrib_prevname_pubid>
      <input type=button value="Add" onClick=new_attrib_prevname(this.form);>
      </form>
    <?/MIBLOCK>

  <?MIELSE>

    <?MIVAR>$(VECAPPEND,$mrkrvw_alias_name_array,$1)<?/MIVAR>
    <?MIVAR>$(VECAPPEND,$mrkrvw_alias_zdb_id_array,$2)<?/MIVAR>
  <?/MIBLOCK>

<?/MISQL>


<?MICOMMENT>
Only need to update clones, etc., which should be the only things that will have a problem type.
<?/MICOMMENT>

<?MIBLOCK COND="$(AND,$(XST,$UPDATE),$(OR,$(EQ,$marker_type,EST),$(EQ,$marker_type,CDNA),$(EQ,$marker_type,BAC),$(EQ,$marker_type,PAC)))">

    <?MIVAR name=mrkrvw_problem_type>NONE<?/MIVAR>
    <?MISQL SQL="
      SELECT clone_problem_type
      FROM clone
      WHERE clone_mrkr_zdb_id = '$OID';">
      <?MIVAR NAME=mrkrvw_problem_type>$1<?/MIVAR>
    <?/MISQL>
      <form name="clone_problem">
      <b>Update Problem Type:</b>
      <select name=attrib_problem_type>
      <option name="NONE" value="NONE">None</option>
    <?MISQL SQL="
      SELECT cpt.cpt_type from clone_problem_type cpt ;
      ">
      <option
      <?MIVAR COND="$(EQ,$1,$mrkrvw_problem_type)">
      selected
      <?/MIVAR>
       value="$1">$1</option>
    <?/MISQL>
      </select>
      <?MIVAR>
      <input type=button value="Update" onClick="update_problem_type('$mrkrvw_problem_type',this.form.attrib_problem_type.value)">
      <?/MIVAR>
      </form>

<?/MIBLOCK>


<?MIVAR NAME=mrkrvw_vec_index>1<?/MIVAR>
<?MIVAR NAME=mrkrvw_vec_size>$(VECSIZE,$mrkrvw_alias_name_array)<?/MIVAR>
<?MIBLOCK INDEX=$mrkrvw_alias_name FOREACH=$mrkrvw_alias_name_array>

  <?MIVAR NAME=$mrkrvw_alias_name_plus>$(URLENCODE,$mrkrvw_alias_name)<?/MIVAR>
  <?MIVAR COND="$(XST,$UPDATE)">
    <br>
    <INPUT TYPE=button
      value=Delete
      onClick="Delete_alias('$mrkrvw_alias_name_plus','$OID')">
  <?/MIVAR>

  <?MIVAR>

    $mrkrvw_alias_name<?MISQL SQL="select WebExplode(object,'dataId=$mrkrvw_alias_zdb_id_array[$mrkrvw_vec_index]&type=recattrib') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL>$(IF,$(AND,$(NXST,$UPDATE),$(NE,$mrkrvw_vec_index,$mrkrvw_vec_size)),",")

    $(SETVAR,$mrkrvw_vec_index,$(+,$mrkrvw_vec_index,1))

  <?/MIVAR>
<?/MIBLOCK>

<?MIVAR COND="$(>,$MI_ROWCOUNT,0)">
    <br>
<?/MIVAR>


<?MICOMMENT>=========================================================
            ==     Sequence Similarities
	    =========================================================
<?/MICOMMENT>
<?MIVAR NAME="display_sequence_similarity">false<?/MIVAR>

<?MISQL SQL="select count(*)
	     from data_alias, alias_group
	     where dalias_data_zdb_id = '$OID'
	       and dalias_group_id = aliasgrp_pk_id
	       and aliasgrp_name = 'sequence similarity';">
  <?MIVAR COND="$(>,$1,0)" NAME="display_sequence_similarity">true<?/MIVAR>
<?/MISQL>

<?MIBLOCK COND="$(EQ,$display_sequence_similarity,true)">

  <?MIVAR COND="$(XST,$UPDATE)">
      <INPUT TYPE=button
        value=Add
        onClick="doit('dalias_alias','text','Alias','sequence+similarity')">
  <?/MIVAR>

  <b>Keywords and Sequence Similarities:</b>

 <?MISQL SQL="
  select dalias_alias, dalias_zdb_id
    from data_alias, alias_group
    where dalias_data_zdb_id = '$OID'
    and dalias_group_id = aliasgrp_pk_id
    and aliasgrp_name = 'sequence similarity';">

  <?MIVAR COND="$(AND,$(=,$MI_CURRENTROW,1),$(XST,$UPDATE))">
    <form>
    <br><b>Add Reference:</b>
    Sequence similarity:<input type=text name=attrib_ssprevname>
    Reference:<input type=text name=attrib_ssprevname_pubid>
    <input type=button value="Add" onClick=new_attrib_ssprevname(this.form);>
    </form>
  <?/MIVAR>


  <?MIVAR NAME=$alias>$1<?/MIVAR>
  <?MIVAR NAME=$aliasId>$2<?/MIVAR>
  <?MIVAR COND="$(XST,$alias)" NAME=$alias_plus>$(URLENCODE,$alias)<?/MIVAR>
  <?MIVAR COND="$(XST,$UPDATE)">
    <br>
    <INPUT TYPE=button
      value=Delete
      onClick="Delete_alias('$alias_plus','$OID')">
  <?/MIVAR>
  $(IF,$(AND,$(NXST,$UPDATE),$(>,$MI_CURRENTROW,1)),;) $alias

  <?MIBLOCK COND="$(XST,$aliasId)">
      <?MISQL SQL="select WebExplode(object,'dataId=$aliasId&type=recattrib') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL>
  <?/MIBLOCK>

<?/MISQL>
<?MIVAR COND="$(>,$MI_ROWCOUNT,0)">
    <br>
<?/MIVAR>
<?/MIBLOCK> <?MICOMMENT> end display_sequence_similarity <?/MICOMMENT>

 <?MICOMMENT>
              ============================================
                Supplier for TALEN and CRISPR
              ============================================
 <?/MICOMMENT>
<?MIBLOCK COND="$(AND,$(XST,$UPDATE),$(OR,$(EC,$marker_type,CRISPR),$(EC,$marker_type,TALEN)))">
<p/>
  <b> Supplier: </b>
  <?MISQL SQL="select zdb_id, name
	         from int_data_supplier
		 join lab on idsup_supplier_zdb_id = zdb_id
	        where idsup_data_zdb_id = '$OID'
	       union
	       select zdb_id, name
	         from int_data_supplier
		 join company on idsup_supplier_zdb_id = zdb_id
	        where idsup_data_zdb_id = '$OID';">

    <?MIVAR NAME=mrkrview_str_supplier_zdb_id>$1<?/MIVAR>
    <?MIVAR NAME=mrkrview_str_supplier_name>$2<?/MIVAR>
    <?MIBLOCK COND="$(=,$MI_CURRENTROW,1)">
    <?MIELSE>
	, &nbsp;
    <?/MIBLOCK>

    <?MIVAR>
       <input type="button" value="Delete" onClick="delete_supplier('$mrkrview_str_supplier_zdb_id')">
    <?/MIVAR>
    <?MIVAR>$mrkrview_str_supplier_name<?/MIVAR>
  <?/MISQL>
  <?MIBLOCK COND="$(!=,$MI_ROWCOUNT,0)">
    <p> <?MICOMMENT> for display purpose <?/MICOMMENT>
  <?/MIBLOCK>

<div>
<form>
<input type="button" value="Add supplier" onClick="new_supplier(supplierToAddZdbID);"><input id="supplier" type="text" size="35" />
</form>
</div>
<?/MIBLOCK> <?MICOMMENT> end of supplier section <?/MICOMMENT>

 <?MICOMMENT>
              ===================
                Marker Sequence
              ===================
 <?/MICOMMENT>

 <?MIVAR NAME=$mrkrview_sequence><?/MIVAR>

 <?MIBLOCK COND="$(EC,$marker_type,TALEN)">
   <?MISQL SQL="select seq_sequence, seq_sequence_2, seq_offset_start,seq_offset_stop
                  from marker_sequence
                 where seq_mrkr_zdb_id = '$OID';">
    <?MIVAR NAME=$mrkrview_sequence>$1<?/MIVAR>
    <?MIVAR NAME=$mrkrview_second_sequence>$2<?/MIVAR>
    <?MIVAR NAME=$mrkrview_seq_start>$3<?/MIVAR>
    <?MIVAR NAME=$mrkrview_seq_stop>$4<?/MIVAR>
   <?/MISQL> 
 <?MIELSE>
   <?MISQL SQL="select seq_sequence, "", seq_offset_start,seq_offset_stop
                  from marker_sequence
                 where seq_mrkr_zdb_id = '$OID';">
    <?MIVAR NAME=$mrkrview_sequence>$1<?/MIVAR>
    <?MIVAR NAME=$mrkrview_second_sequence>$2<?/MIVAR>
    <?MIVAR NAME=$mrkrview_seq_start>$3<?/MIVAR>
    <?MIVAR NAME=$mrkrview_seq_stop>$4<?/MIVAR>
   <?/MISQL>
 <?/MIBLOCK>

 <?MICOMMENT> get blast linkout url to ncbi-blast<?/MICOMMENT>
 <?MISQL SQL="select db.blastdb_path from blast_database db
            where
            db.blastdb_name = 'BLAST';">
    <?MIVAR NAME=ncbi_blast_url>$1<?/MIVAR>
 <?/MISQL>

 <?MIVAR NAME=blast_option>&EXPECT=1000&WORD_SIZE=7&ENTREZ_QUERY=Danio rerio [ORGN]&FORMAT_ENTREZ_QUERY=All organisms<?/MIVAR>


  <?MIBLOCK COND="$(AND,$(XST,$UPDATE),$(XST,$type_of_knockdown_reagent))">
      </form>
      <form name=newdata>

      <br>
        <?MIBLOCK COND="$(OR,$(EC,$marker_type,CRISPR),$(EC,$marker_type,TALEN))">
          <b>Target Sequence:</b>
        <?MIELSE>
          <b>Sequence:</b>
        <?/MIBLOCK>

      <table border=0 bgcolor="<!--|HIGHLIGHT_COLOR|-->">
        <tr><td>
        <?MIBLOCK COND="$(EC,$marker_type,TALEN)">
          <?MISQL SQL="select WebExplode(object,'seqdata_sequence=$mrkrview_sequence&seqdata_second_sequence=$mrkrview_second_sequence&isTalen=yes') from webPages where ID='aa-sequence_data_entry.apg';">$1<?/MISQL>
        <?MIELSE>
          <?MISQL SQL="select WebExplode(object,'seqdata_sequence=$mrkrview_sequence') from webPages where ID='aa-sequence_data_entry.apg';">$1<?/MISQL>
        <?/MIBLOCK>

     <?MIBLOCK COND="$(EC,$marker_type,TALEN)">
      <INPUT TYPE=button
        value="Update Sequence"
        <?MIVAR>
        onClick="
        if(document.newdata.seqdata_action.selectedIndex==0){
            actionSequence(4);
        }

        if (validSequence(document.newdata.seqdata_DisplaySequence.value) && validSequence(document.newdata.seqdata_2nd_DisplaySequence.value)){
            update_second_sequence('$OID','$mrkrview_second_sequence',document.newdata.seqdata_DisplaySequence.value,document.newdata.seqdata_CuratorNote.value,document.newdata.seqdata_2nd_DisplaySequence.value)
        }">
        <?/MIVAR>
     <?MIELSE>
      <INPUT TYPE=button
        value="Update Sequence"
        <?MIVAR>
        onClick="
        if(document.newdata.seqdata_action.selectedIndex==0){
            actionSequence(4);
        }

        if (validSequence(document.newdata.seqdata_DisplaySequence.value) ){
            update_sequence('$OID','$mrkrview_sequence',document.newdata.seqdata_DisplaySequence.value,document.newdata.seqdata_CuratorNote.value)
        }">
        <?/MIVAR>
     <?/MIBLOCK>     
        <br>
        </td></tr>
      </table>

      <?MIVAR COND="$(NC,$mrkrview_sequence,)">
         <br>Add Sequence Reference:
         <input type=text name=mrkrview_seq_pubid>
         <input type=button value="Add" onClick=new_attrib_markerseq('$OID');>
        <?MISQL SQL="select WebExplode(object,'dataId=$OID&type=recattrib') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL>
        <p>
      <?/MIVAR>
      </form>

  <?MIELSE COND="$(NC,$mrkrview_sequence,)">
      <br> <?MICOMMENT> for display purpose <?/MICOMMENT>
      <?MICOMMENT>use table to align sequence and disclaimer<?/MICOMMENT>
      <table width=100% cellspacing=0>

       <tr>
        <td width=7%>
          <b>Sequence:</b>
        </td>



      <tr>
        <td> &nbsp; </td>
      <?MICOMMENT>This is for Morpholinos<?/MICOMMENT>
        <?MIBLOCK COND="$(NC,$marker_type,SNP)">
        <td>
         <?MICOMMENT>in checkedout branch, a sequence_disclaimer.apg page is added.
               we are hardcoding now, and will update when merge.
         <?/MICOMMENT>
         <font size=-1>
           &nbsp;(Although ZFIN verifies reagent sequence data, we recommend that you conduct independent sequence analysis before ordering any reagent.)
         </font>
        </td>
        <?/MIBLOCK>
      </tr>
     </table>

     <br>
 <?/MIBLOCK>


<?MICOMMENT>=========================================================
            ==     Target Gene
	    =========================================================
<?/MICOMMENT>
<?MIBLOCK COND="$(XST,$type_of_knockdown_reagent)">
  <?MIBLOCK COND="$(XST,$UPDATE)">
     <form>
     Add Target Gene:
     Symbol: <input type=text size=15 name=mrkr_abbrev id="targetGeneSymbol">
     <input type=button value="Add it!" onClick="new_mrkrrel('1to2-knockdown reagent targets gene',jQuery('#targetGeneSymbol').val())">
     <br>
     Add Reference:
     Gene symbol:<input type=text name=attrib_mrkr_abbrev id="targetGeneSymbol2">
     Reference:<input type=text name=attrib_mrel_pubid>
     <input type=button value="Add" onClick=new_attrib_mrel(this.form);>
     </form>
  <?/MIBLOCK>

  <?MISQL SQL="select mrkr_zdb_id, mrkr_abbrev, mrel_zdb_id, get_mrkr_abbrev_html_link(mrkr_zdb_id)
	       from marker_relationship
		    join marker on mrel_mrkr_2_zdb_id = mrkr_zdb_id
	      where mrel_mrkr_1_zdb_id = '$OID'
		and mrel_type = 'knockdown reagent targets gene'
		order by 2;">

    <?MIVAR NAME=mrkrview_trg_gene_zdb_id>$1<?/MIVAR>
    <?MIVAR NAME=mrkrview_trg_gene_sym>$2<?/MIVAR>
    <?MIVAR NAME=mrkrview_trg_mrel_zdb_id>$3<?/MIVAR>
    <?MIVAR NAME="mrkrview_trg_gene_link">$4<?/MIVAR>
    <?MIBLOCK COND="$(=,$MI_CURRENTROW,1)">
	<b> Target Gene: </b>
    <?MIELSE>
	, &nbsp;
    <?/MIBLOCK>

    <?MIVAR COND="$(XST,$UPDATE)">
       <input type=button value=Delete
         onClick="Delete_mrel('$mrkrview_trg_gene_zdb_id','knockdown reagent targets gene')">
    <?/MIVAR>
    $mrkrview_trg_gene_link
    <!-- <a href="/action/marker/view/$mrkrview_trg_gene_zdb_id">$mrkrview_trg_gene_sym</a> -->
    <?MISQL SQL="select WebExplode(object,'dataId=$mrkrview_trg_mrel_zdb_id&type=recattrib') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL>
  <?/MISQL>
  <?MIBLOCK COND="$(!=,$MI_ROWCOUNT,0)">
    <p> <?MICOMMENT> for display purpose <?/MICOMMENT>
  <?/MIBLOCK>
<?/MIBLOCK> <?MICOMMENT> end of type_of_knockdown_reagent<?/MICOMMENT>



<?MICOMMENT>=========================================================
            ==     Nomenclature History
	    =========================================================
<?/MICOMMENT>


<?MISQL SQL="select * from marker_history where mhist_mrkr_zdb_id = '$OID'">
<?/MISQL>
<?MIVAR COND="$(AND,$(XST,$type_of_genedom),$(>,$MI_ROWCOUNT,0))">
    <font size=-1><A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-nomenview.apg&OID=$OID&abbrev=$abbrev$(IF,$(XST,$UPDATE),&UPDATE=1)">Nomenclature History</A>
    </font>
    <br>
<?/MIVAR>


<?MICOMMENT>
=========================================================
==    Marker View Problem Types
=========================================================
<?/MICOMMENT>
<?MIVAR name=mrkrvw_problem_type><?/MIVAR>
<?MISQL SQL="
  SELECT clone_problem_type
  FROM clone
  WHERE clone_mrkr_zdb_id = '$OID';">
  <?MIVAR NAME=mrkrvw_problem_type>$1<?/MIVAR>
<?/MISQL>

<?MIVAR COND="$(AND,$(NE,$mrkrvw_problem_type,),$(NXST,$UPDATE))">
<b>Problem Type:</b> &nbsp; &nbsp; $mrkrvw_problem_type <img src="/images/warning-noborder.gif" width=20 height=20 align=top>
<?/MIVAR>


<?MICOMMENT>=========================================================
            ==    Curator Note
	    =========================================================
<?/MICOMMENT>
<?MIBLOCK COND="$(NXST,$mrkrview_no_update)">
<?MIBLOCK COND="$(EC,$AUTHORIZED,root)">
  <br>
  <B>Curator Notes:</B>
    <?MIVAR><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-curatornote.apg&OID=$OID">(View/Add Notes)</a><?/MIVAR>
  <?MISQL SQL="select count(*)
		from data_note
		where dnote_data_zdb_id = '$OID' ;">

  <?MIVAR COND="$(NC,$1,0)">
    <?MISQL SQL="select first 1 dnote_text from data_note
                 where dnote_data_zdb_id='$OID'
                order by dnote_date desc">
     <?MIVAR NAME=$mrkrview_datanote>$1<?/MIVAR>
     <?/MISQL>
<br>
     <?MIVAR>$(SUBSTR,$mrkrview_datanote,1,100)<?/MIVAR>...
  <?/MIVAR>
 <?/MISQL>
 <br>
<?/MIBLOCK>
<?/MIBLOCK>

<?MICOMMENT>=========================================================
            ==    Note
	    =========================================================
<?/MICOMMENT>
<p>
<?MISQL SQL="
     select mrkr_comments
       from marker
      where mrkr_Zdb_id='$OID'
        and mrkr_comments is not null
        and mrkr_comments != '';">

  <?MIVAR NAME=$mrkrview_mrkr_comments>$1<?/MIVAR>

  <?MIVAR COND="$(>,$MI_CURRENTROW,0)">
     <b>Note:</b>
     &nbsp;$mrkrview_mrkr_comments
     <?MIVAR COND="$(XST,$UPDATE)">
	  <INPUT TYPE=button value="Update Note" onClick="doit('mrkr_comments','textarea','Note')">
     <?/MIVAR>
     <br>
  <?/MIVAR>
<?/MISQL>

<?MIVAR COND="$(=,$MI_ROWCOUNT,0)">
   <?MIVAR COND="$(XST,$UPDATE)">
      <INPUT TYPE=button value="Add New Marker Note" onClick="doit('mrkr_comments','textarea','Note')">
      <br>
   <?/MIVAR>
<?/MIVAR>

</P>
<?MIVAR COND="$(AND,$(NE,$marker_type,CRISPR),$(NE,$marker_type,MRPHLNO),$(NE,$marker_type,TALEN))">
To view the Gene Expression section go to the
<a href="/$OID">view page</a>
<?/MIVAR>

<?MICOMMENT> =============================================
             ==    placeholder gene disclaimer
             =============================================
<?/MICOMMENT>

<?MIBLOCK COND="$(POSITION,$abbrev,:)">
    <?MIVAR NAME="mvphnote_mrkr_abbrev">$abbrev<?/MIVAR>
    <?MIVAR NAME="mvphnote_mrkr_type">$marker_type<?/MIVAR>
    <?MIVAR NAME="mvphnote_mrkr_gene_has_chimeric_clone">$gene_has_chimeric_clone<?/MIVAR>
    <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-markerview_placeholder_note.apg';">$1<?/MISQL>
<?/MIBLOCK>


<?MISQL COND=$(XST,$debug_timing) SQL="
        execute function get_time()">
        <br>$1 End name/note section
<?/MISQL>



<?MICOMMENT>=========================================================
            ==    Clone box
	    =========================================================
<?/MICOMMENT>
<?MIVAR NAME="SOURCE"> <?/MIVAR>
<?MISQL SQL="select WebExplode(object,'CLONE_MARKER_ID=$OID') from webPages where ID='aa-clonebox.apg'
	     and exists (select 'x' from clone where clone_mrkr_zdb_id = '$OID');">
	<hr width=80%>
        <b>CLONE DATA </b> $1
        <?MIVAR NAME="$mrkrview_mrkr_is_clone">1<?/MIVAR>
<?/MISQL>


<?MICOMMENT>=========================================================
            ==    Construct features
	    =========================================================
<?/MICOMMENT>

<?MIBLOCK COND="$(>,$(POSITION,$marker_type,CONSTRCT),0)">
   <?MISQL SQL="
         select mrel_mrkr_2_zdb_id
           from marker_relationship
          where mrel_mrkr_1_zdb_id = '$OID'
            and mrel_type in ('promoter of','coding sequence of', 'contains engineered region')
        ">
   <?/MISQL>
   <?MIVAR COND="$(>,$MI_ROWCOUNT,0)">
  	<hr width=80%>
  	  <b>
		CONSTRUCT FEATURES
  	  </b>
   <?/MIVAR>
   <table width=100% cols=2 bgcolor=<?MIVAR>$highlight<?/MIVAR>>
    <?MISQL SQL="
         select get_mrkr_abbrev_html_link(mrkr_zdb_id), mrel_zdb_id
           from marker_relationship, marker
          where mrel_mrkr_1_zdb_id = '$OID'
            and mrel_mrkr_2_zdb_id = mrkr_zdb_id
            and mrel_type = 'promoter of'">

      <tr>
        <td width=25%>
          Regulatory Regions:
        </td>
        <td>
          $1<?MISQL SQL="select WebExplode(object,'dataId=$2&type=recattrib&info=standard') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL>
        </td>
      <tr>
    <?/MISQL>

    <?MICOMMENT> we are duplicating the code here, but it is simple and clear<?/MICOMMENT>
    <?MISQL SQL="
         select get_mrkr_abbrev_html_link(mrkr_zdb_id), mrel_zdb_id
           from marker_relationship, marker
          where mrel_mrkr_1_zdb_id = '$OID'
            and mrel_mrkr_2_zdb_id = mrkr_zdb_id
            and mrel_type = 'coding sequence of'">
      <tr>
        <td width=25%>
          Coding Sequences:
        </td>
        <td>
          <i>$1</i><?MISQL SQL="select WebExplode(object,'dataId=$2&type=recattrib&info=standard') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL>
        </td>
      <tr>
    <?/MISQL>

    <?MISQL SQL="
         select get_mrkr_abbrev_html_link(mrkr_zdb_id), mrel_zdb_id
           from marker_relationship, marker
          where mrel_mrkr_1_zdb_id = '$OID'
            and mrel_mrkr_2_zdb_id = mrkr_zdb_id
            and mrel_type = 'contains engineered region'">
      <tr>
        <td width=25%>
          Engineered Regions:
        </td>
        <td>
          $1<?MISQL SQL="select WebExplode(object,'dataId=$2&type=recattrib&info=standard') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL>
        </td>
      <tr>
    <?/MISQL>
    </table>
<?/MIBLOCK>


<?MISQL COND=$(XST,$debug_timing) SQL="
        execute function get_time()">
        <br>$1 Start expression section
<?/MISQL>


<?MICOMMENT>=========================================================
            ==  GENE EXPRESSION
            ==========================================================
<?/MICOMMENT>
<?MICOMMENT> check data existence, and count total pubs<?/MICOMMENT>
<?MIBLOCK COND="$(OR,$(EQ,$marker_type,EST),$(EQ,$marker_type,CDNA),$(EQ,$marker_type,EFG),$(EQ,$marker_type,GENE))">

<?MICOMMENT>
If a gene, then only show expression where the probe is not withdrawn.
Use 'not exists' because outer join includes too many results.
<?/MICOMMENT>
<?MISQL COND="$(EQ,$marker_type,GENE)"
SQL="
    select count(distinct xpatex_source_zdb_id)::integer
     from expression_experiment join
         expression_result on xpatex_zdb_id = xpatres_xpatex_zdb_id
         join expression_pattern_figure on xpatfig_xpatres_zdb_id = xpatres_zdb_id
     where xpatex_gene_zdb_id = '$OID'
     and not exists(
         select 'x' from clone
         where clone_mrkr_zdb_id=xpatex_probe_feature_zdb_id
         and clone_problem_type = 'Chimeric'
     )
     and not exists (
         select 'x' from marker
         where mrkr_zdb_id = xpatex_probe_feature_zdb_id
         and mrkr_abbrev[1,10] = 'WITHDRAWN:'
     )
     ;">
<?MIVAR NAME=mrkrview_xpatsource_count>$1<?/MIVAR>
<?/MISQL>



<?MIBLOCK COND="$(OR,$(EQ,$marker_type,EST),$(EQ,$marker_type,CDNA))">
 <?MISQL SQL="
    select count(distinct xpatex_source_zdb_id)::integer
      from expression_experiment join
           expression_result on xpatex_zdb_id = xpatres_xpatex_zdb_id
      join expression_pattern_figure on xpatfig_xpatres_zdb_id = xpatres_zdb_id

     where xpatex_probe_feature_zdb_id = '$OID'
     ;">
<?MIVAR NAME=mrkrview_xpatsource_count>$1<?/MIVAR>
<?/MISQL>
<?/MIBLOCK>

<?MISQL COND="$(EQ,$marker_type,EFG)"
  SQL="
    select count(distinct xpatex_source_zdb_id)::integer
      from expression_experiment join
           expression_result on xpatex_zdb_id = xpatres_xpatex_zdb_id
      join expression_pattern_figure on xpatfig_xpatres_zdb_id = xpatres_zdb_id
     where xpatex_gene_zdb_id = '$OID'
     ;">
<?MIVAR NAME=mrkrview_xpatsource_count>$1<?/MIVAR>
<?/MISQL>


<div class="summary">

<?MICOMMENT>Start MICROARRAY block here.  Only show others if GEO.<?/MICOMMENT>
     <?MIVAR NAME=accession_sum><?/MIVAR>
     <?MISQL SQL="
 select distinct fdb_db_name, fdb_db_query ,  dblink_acc_num,dblink_zdb_id,
	     (case fdb_url_suffix when NULL then '' else fdb_url_suffix end)
   from db_link dbl, foreign_db fdb, foreign_db_contains fdbc, marker m
     where
     dbl.dblink_fdbcont_zdb_id = fdbc.fdbcont_zdb_id
     and fdbc.fdbcont_fdb_db_id = fdb.fdb_db_pk_id
     and m.mrkr_zdb_id=dbl.dblink_linked_recid
     and fdb.fdb_db_name = 'GEO'
     and m.mrkr_zdb_id='$OID'
union
 select distinct fdb_db_name, fdb_db_query ,  dblink_acc_num,dblink_zdb_id,
	     (case fdb_url_suffix when NULL then '' else fdb_url_suffix end)
   from db_link dbl, foreign_db fdb, foreign_db_contains fdbc,marker_relationship mr
     where
     dbl.dblink_fdbcont_zdb_id = fdbc.fdbcont_zdb_id
     and fdbc.fdbcont_fdb_db_id = fdb.fdb_db_pk_id
     and fdb.fdb_db_name = 'GEO'
     and mr.mrel_mrkr_2_zdb_id=dbl.dblink_linked_recid
     and mr.mrel_mrkr_1_zdb_id='$OID'
     and mr.mrel_type='gene encodes small segment'
     ">
      <?MIVAR NAME=mrkrview_microarray_db>$1<?/MIVAR>
  <?MIVAR NAME=mrkrview_microarray_link>$2<?/MIVAR>
  <?MIVAR NAME=dblink_acc>$3<?/MIVAR>
  <?MIVAR NAME=dataId>$4<?/MIVAR>
  <?MIVAR NAME=mrkrview_microarray_suffix>$5<?/MIVAR>

	 <?MIBLOCK COND="$(EC,$MI_CURRENTROW,1)">
     <?MIVAR NAME=accession_sum>$(CONCAT,$dblink_acc,*) OR $(CONCAT,$dblink_acc,.*)<?/MIVAR>
     <?MIELSE>
     <?MIVAR NAME=accession_sum>$accession_sum OR $(CONCAT,$dblink_acc,*)
 or $(CONCAT,$dblink_acc,.*)<?/MIVAR>
     <?/MIBLOCK>
     <?/MISQL>


	 <?MIVAR COND="$(>,$MI_CURRENTROW,0)">
         <?MIVAR COND="$(EQ,$mrkrview_xpatsource_count,0)">
             <table class="summary horizontal-solidblock">
         <?/MIVAR>
         <?MICOMMENT>
         If GEO does not have this accession, then none of the other databases will have it either, so this is safe to do here
         <?/MICOMMENT>
         <tr>
         <th>Curated&nbsp;microarray&nbsp;expression:
         </th>
         <td align=left>
     <?MICOMMENT>
     They will all have the same dataId, so just using the last one will be okay
     <?/MICOMMENT>
        <?MIVAR NAME=mini_ref><?MISQL SQL="select WebExplode(object,'dataId=$dataId&type=recattrib') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL><?/MIVAR>
         <a href="$mrkrview_microarray_link$accession_sum$mrkrview_microarray_suffix">$mrkrview_microarray_db</a> &nbsp;$mini_ref

         <?MICOMMENT>Start ZF-Espresso<?/MICOMMENT>

         <?MIVAR NAME=accession_sum><?/MIVAR>
             <?MISQL SQL="
 select distinct fdb_db_name, fdb_db_query ,  dblink_acc_num,dblink_zdb_id,
	     (case fdb_url_suffix when NULL then '' else fdb_url_suffix end)
   from db_link dbl, foreign_db fdb, foreign_db_contains fdbc, marker m
     where
     dbl.dblink_fdbcont_zdb_id = fdbc.fdbcont_zdb_id
     and fdbc.fdbcont_fdb_db_id = fdb.fdb_db_pk_id
     and m.mrkr_zdb_id=dbl.dblink_linked_recid
     and fdb.fdb_db_name = 'ZF-Espresso'
     and m.mrkr_zdb_id='$OID'
union
 select distinct fdb_db_name, fdb_db_query ,  dblink_acc_num,dblink_zdb_id,
	     (case fdb_url_suffix when NULL then '' else fdb_url_suffix end)
   from db_link dbl, foreign_db fdb, foreign_db_contains fdbc,marker_relationship mr
     where
     dbl.dblink_fdbcont_zdb_id = fdbc.fdbcont_zdb_id
     and fdbc.fdbcont_fdb_db_id = fdb.fdb_db_pk_id
     and fdb.fdb_db_name = 'ZF-Espresso'
     and mr.mrel_mrkr_2_zdb_id=dbl.dblink_linked_recid
     and mr.mrel_mrkr_1_zdb_id='$OID'
     and mr.mrel_type='gene encodes small segment'
             ">
              <?MIVAR NAME=mrkrview_microarray_db>$1<?/MIVAR>
          <?MIVAR NAME=mrkrview_microarray_link>$2<?/MIVAR>
          <?MIVAR NAME=dblink_acc>$3<?/MIVAR>
          <?MIVAR NAME=dataId>$4<?/MIVAR>
          <?MIVAR NAME=mrkrview_microarray_suffix>$5<?/MIVAR>

             <?MICOMMENT><?MIVAR NAME=accession_sum>$dblink_acc $accession_sum<?/MIVAR><?/MICOMMENT>
             <?/MISQL>

	 <?MIVAR COND="$(>,$MI_CURRENTROW,0)">
        ,&nbsp;&nbsp; <?MIVAR NAME=mini_ref><?MISQL SQL="select WebExplode(object,'dataId=$dataId&type=recattrib') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL><?/MIVAR>
         <a href="$mrkrview_microarray_link$dblink_acc$mrkrview_microarray_suffix$dblink_acc">$mrkrview_microarray_db</a> &nbsp;$mini_ref
     <?/MIVAR>



         <?MICOMMENT>End ZF-Espresso<?/MICOMMENT>

         <?MICOMMENT>Start ArrayExpress<?/MICOMMENT>

         <?MIVAR NAME=accession_sum><?/MIVAR>
             <?MISQL SQL="
 select distinct fdb_db_name, fdb_db_query ,  dblink_acc_num,dblink_zdb_id,
	     (case fdb_url_suffix when NULL then '' else fdb_url_suffix end)
   from db_link dbl, foreign_db fdb, foreign_db_contains fdbc, marker m
     where
     dbl.dblink_fdbcont_zdb_id = fdbc.fdbcont_zdb_id
     and fdbc.fdbcont_fdb_db_id = fdb.fdb_db_pk_id
     and m.mrkr_zdb_id=dbl.dblink_linked_recid
     and fdb.fdb_db_name = 'ArrayExpress'
     and m.mrkr_zdb_id='$OID'
union
 select distinct fdb_db_name, fdb_db_query ,  dblink_acc_num,dblink_zdb_id,
	     (case fdb_url_suffix when NULL then '' else fdb_url_suffix end)
   from db_link dbl, foreign_db fdb, foreign_db_contains fdbc,marker_relationship mr
     where
     dbl.dblink_fdbcont_zdb_id = fdbc.fdbcont_zdb_id
     and fdbc.fdbcont_fdb_db_id = fdb.fdb_db_pk_id
     and fdb.fdb_db_name = 'ArrayExpress'
     and mr.mrel_mrkr_2_zdb_id=dbl.dblink_linked_recid
     and mr.mrel_mrkr_1_zdb_id='$OID'
     and mr.mrel_type='gene encodes small segment'
             ">
              <?MIVAR NAME=mrkrview_microarray_db>$1<?/MIVAR>
          <?MIVAR NAME=mrkrview_microarray_link>$2<?/MIVAR>
          <?MIVAR NAME=dblink_acc>$3<?/MIVAR>
          <?MIVAR NAME=dataId>$4<?/MIVAR>
          <?MIVAR NAME=mrkrview_microarray_suffix>$5<?/MIVAR>
             <?MIVAR NAME=accession_sum>$dblink_acc $accession_sum<?/MIVAR>
             <?/MISQL>

	 <?MIVAR COND="$(>,$MI_CURRENTROW,0)">
        <?MIVAR NAME=mini_ref><?MISQL SQL="select WebExplode(object,'dataId=$dataId&type=recattrib') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL><?/MIVAR>
         ,&nbsp;&nbsp; <a href="$mrkrview_microarray_link$accession_sum$mrkrview_microarray_suffix">$mrkrview_microarray_db</a> &nbsp;$mini_ref
     <?/MIVAR>
         <?MICOMMENT>End ArrayExpress<?/MICOMMENT>
         </td>
         </tr>
         <?MIVAR COND="$(EQ,$mrkrview_xpatsource_count,0)">
             </table>
         <?/MIVAR>
     <?/MIVAR>
     </table> <?MICOMMENT>close xpat section table<?/MICOMMENT>

<?MICOMMENT>End MICROARRAY block here<?/MICOMMENT>


<?/MIBLOCK> <?MICOMMENT>block for marker type=gene<?/MICOMMENT>


<?MISQL COND=$(XST,$debug_timing) SQL="
        execute function get_time()">
        <br>$1 End Expression section,Start Geno/Mutant section
<?/MISQL>



<?MICOMMENT>=========================================================
            ==    GENOTYPE for CONSTRUCTS
	    =========================================================
<?/MICOMMENT>

  <?MIVAR NAME=mkvw_geno_counter>0<?/MIVAR>
  <?MIVAR NAME=mkvw_geno_short_list_cap>5<?/MIVAR>

  <?MISQL SQL="
	select distinct genofeat_geno_zdb_id, get_geno_name_with_bg_html_link(genofeat_geno_zdb_id)
 	  from genotype_feature, feature_marker_relationship
         where fmrel_mrkr_zdb_id = '$OID'
           and fmrel_ftr_zdb_id = genofeat_feature_zdb_id
           and fmrel_type like 'contains%'">

	<?MIVAR NAME=mkvw_geno_html>$2<?/MIVAR>

        $(SETVAR,$mkvw_geno_counter,$(+,$mkvw_geno_counter,1))

  	<?MIBLOCK COND=$(=,$MI_CURRENTROW,1)>
     	    <?MIVAR NAME=mkvw_geno_short_list>$mkvw_geno_html<?/MIVAR>
      	    <?MIVAR NAME=mkvw_geno_long_list>$mkvw_geno_html<?/MIVAR>
	<?MIELSE>
	    <?MIVAR COND="$(<=,$mkvw_geno_counter,$mkvw_geno_short_list_cap)">
	       $(VECAPPEND,$mkvw_geno_short_list,$mkvw_geno_html)
            <?/MIVAR>
            <?MIVAR>
              $(VECAPPEND,$mkvw_geno_long_list,$mkvw_geno_html)
            <?/MIVAR>
        <?/MIBLOCK>

  <?/MISQL>

  <?MIBLOCK COND="$(>,$MI_ROWCOUNT,0)">
     <?MIVAR NAME=mkvw_geno_short_list_sepa SEPARATE="<br>">$mkvw_geno_short_list<?/MIVAR>
     <?MIVAR NAME=mkvw_geno_long_list_sepa SEPARATE="<br>">$mkvw_geno_long_list<?/MIVAR>
     <?MIVAR NAME=mkvw_geno_short_list_escp>$(REPLACE,$mkvw_geno_short_list_sepa,"'","")<?/MIVAR>

     <?MIVAR NAME=mkvw_geno_long_list_escp>$(REPLACE,$mkvw_geno_long_list_sepa,"'","")<?/MIVAR>

     <script>
           <?MIVAR>
   	   function expandGenotypeList() {
     	       var elem = document.getElementById("genoList");
               elem.innerHTML = '$mkvw_geno_long_list_escp <a href=javascript:onClick=shrinkGenotypeList()><img border=0 src=/images/left_arrow.gif></a>';
	   }

   	   function shrinkGenotypeList() {
     	       var elem = document.getElementById("genoList");
               elem.innerHTML = '$mkvw_geno_short_list_escp ... <a href=javascript:onClick=expandGenotypeList()>(all $MI_ROWCOUNT) <img border=0 src=/images/right_arrow.gif></a>';
	   }

	   <?/MIVAR>
     </script>

     <hr width=80%>
      <table><tr><td valign="top">
      <b>
         TRANSGENIC LINE(S):
      </b>
      </td>
      <td>
      <span id="genoList">

         <?MIVAR>$mkvw_geno_short_list_escp<?/MIVAR>

         <?MIVAR COND="$(>,$MI_ROWCOUNT,$mkvw_geno_short_list_cap)">
	   ... <a href=javascript:onClick=expandGenotypeList()>(all $MI_ROWCOUNT) <img border=0 src=/images/right_arrow.gif></a>
         <?/MIVAR>

       </span>

      </td></tr>

			</table>

  <?/MIBLOCK>



<?MICOMMENT>=========================================================
            ==    MUTANTS AND TARGETED KNOCKDOWNS
	    =========================================================
<?/MICOMMENT>
<?MIVAR NAME=display_mut_trg_title>f<?/MIVAR>


   <?MICOMMENT>==============================
               ==    Mutants
	       ==============================
   <?/MICOMMENT>
<?MIBLOCK COND="$(XST,$type_of_genedom)">

   <?MISQL SQL="select WebExplode(object,'OID=$OID') from webPages where ID='aa-allelelist.apg';">
     <?MIVAR NAME="mrkrview_allele_display">$1<?/MIVAR>
   <?/MISQL>

<?/MIBLOCK><?MICOMMENT> -- end if genedom ---<?/MICOMMENT>

  <?MICOMMENT>=========================================================
            == Phenotype
            ==========================================================
  <?/MICOMMENT>
<?MIBLOCK COND="$(OR,$(EQ,$marker_type,GENE),$(EQ,$marker_type,MRPHLNO))">
  <?MISQL SQL="select dbinfo('sessionid') from single;">
    <?MIVAR NAME=$mrkrview_session_id>$1<?/MIVAR>
    <?MIVAR NAME=$mrkrview_temp_pato>$(CONCAT,mrkrview_temp_pato_,$mrkrview_session_id)<?/MIVAR>
  <?/MISQL>

  <?MISQL SQL="execute function table_exists('$mrkrview_temp_pato')">
    <?MIVAR NAME="$mrkrview_tableExists">$1<?/MIVAR>
  <?/MISQL>
  <?MISQL COND=$(NC,$mrkrview_tableExists,f) SQL="delete from $mrkrview_temp_pato">
  <?/MISQL>
  <?MISQL COND=$(EC,$mrkrview_tableExists,f) SQL="
    create temp table $mrkrview_temp_pato (
    t_pato_zdb_id 	int       ) with NO LOG;">
  <?/MISQL>

  <?MISQL SQL="insert into $mrkrview_temp_pato
               select phenos_pk_id
                 from mutant_fast_search, phenotype_statement, phenotype_experiment
                where mfs_mrkr_zdb_id ='$OID'
      	          and mfs_genox_zdb_id = phenox_genox_zdb_id
      	          and phenos_phenox_pk_id = phenox_pk_id;">
  <?/MISQL>


<?/MIBLOCK>


    <?MICOMMENT>================================
                ==    Knockdown Reagent
	        =================================
    <?/MICOMMENT>
<?MIBLOCK COND="$(XST,$type_of_genedom)">


  <?MIVAR NAME="$mrkrview_morpholino_display"><?/MIVAR>
  <?MISQL SQL="select mrkr_zdb_id, mrkr_abbrev, mrel_zdb_id
	       from marker_relationship
		    join marker on mrel_mrkr_1_zdb_id = mrkr_zdb_id
	      where mrel_mrkr_2_zdb_id = '$OID'
		and mrel_type = 'knockdown reagent targets gene'
	      order by mrkr_abbrev_order;">

    <?MIVAR NAME=mrkrview_agt_zdb_id>$1<?/MIVAR>
    <?MIVAR NAME=mrkrview_agt_name>$2<?/MIVAR>
    <?MIVAR NAME=mrkrview_agt_mrel_zdb_id>$3<?/MIVAR>

    <?MIVAR NAME="$mrkrview_morpholino_display">$mrkrview_morpholino_display

      <?MIBLOCK COND="$(NOT,$(=,$MI_CURRENTROW,1))">,&nbsp;<?/MIBLOCK>

      <?MIVAR COND="$(XST,$UPDATE)">
         <input type=button value=Delete
           onClick="Delete_mrel('$mrkrview_agt_zdb_id','knockdown reagent targets gene')">
      <?/MIVAR>

      <a href="/action/marker/view/$mrkrview_agt_zdb_id">
        $mrkrview_agt_name
      </a>
      <?MISQL SQL="select WebExplode(object,'dataId=$mrkrview_agt_mrel_zdb_id&type=recattrib') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL>
    <?/MIVAR>
  <?/MISQL>


    <?MICOMMENT> *** DISPLAY MUTANTS & MORPHOLINOS TABLE *** <?/MICOMMENT>


  <?MIBLOCK COND="$(OR,$(NC,$mrkrview_allele_display,),$(NC,$mrkrview_morpholino_display,))">

  <div class="summary">
	<div class="summaryTitle">MUTANTS AND TARGETED KNOCKDOWNS</div>

    <table class="summary horizontal-solidblock">

        <?MIBLOCK COND="$(NC,$mrkrview_allele_display,)">
          <tr>
            <th>Alleles:</th>
            <td><?MIVAR>$mrkrview_allele_display<?/MIVAR></td>
          </tr>
        <?/MIBLOCK>

        <?MIBLOCK COND="$(NC,$mrkrview_morpholino_display,)">
          <tr>
            <th>Knockdown&nbsp;reagents:</th>
            <td><?MIVAR>$mrkrview_morpholino_display<?/MIVAR></td>
          </tr>
        <?/MIBLOCK>

    </table>
    </div>

    <?/MIBLOCK>

<?/MIBLOCK><?MICOMMENT>end of type_of_genedom<?/MICOMMENT>

<?MISQL COND=$(XST,$debug_timing) SQL="
        execute function get_time()">
        <br>$1 End Geno/Mutant section
<?/MISQL>


<?MICOMMENT>=========================================================
            ==    GENE PRODUCT
	    =========================================================
<?/MICOMMENT>
<?MIBLOCK COND="$(XST,$type_of_genedom)">

    <?MIVAR NAME=qualifier>false<?/MIVAR>
    <?MIVAR NAME=$molgoid><?/MIVAR>
    <?MIVAR NAME=$moldisp><?/MIVAR>
    <?MIVAR NAME=$molterm><?/MIVAR>
    <?MIVAR NAME=$molmrkrgoevid><?/MIVAR>


  <?MIVAR NAME=$titledisplay>0<?/MIVAR>
  <?MISQL SQL="select fdb_db_query from foreign_db where fdb_db_name='QuickGO'">
     <?MIVAR NAME=$dbquery>$1<?/MIVAR>
  <?/MISQL>

<!-- use vector storing the three ontology and loop through -->
<?MIVAR NAME=ontologies><?/MIVAR>
<?MISQL SQL="select distinct term_ontology from term where term_ont_id like 'GO:%' order by term_ontology">
	$(SETVAR,$ontologies[$MI_CURRENTROW],$1)
<?/MISQL>
<?MIBLOCK INDEX=$ontology FOREACH=$ontologies>
    <?MISQL SQL="
      select first 1 mrkrgoev_zdb_id, term_name, mrkrgoev_gflag_name
        from term,go_evidence_code, marker_go_term_evidence
        where mrkrgoev_mrkr_zdb_id = '$OID'
          and mrkrgoev_term_zdb_id = term_zdb_id
          and mrkrgoev_evidence_code = goev_code
          and term_ontology = '$ontology'
        order by goev_display_order, term_name">
    <?/MISQL>
   <?MIVAR NAME=$evid>$1<?/MIVAR>
   <?MIBLOCK COND="$(NE,$3,)">
    <?MIVAR NAME=qualifier>true<?/MIVAR>
   <?/MIBLOCK>
  <?/MISQL>
<?/MIBLOCK>

  <?MISQL SQL="
        select count(distinct mrkrgoev_term_zdb_id) :: integer
          from marker_go_term_evidence
         where mrkrgoev_mrkr_zdb_id = '$OID'  ;">
  <?/MISQL>


 <?MIVAR NAME=$rowcount>$1<?/MIVAR>
 <?MIBLOCK COND="$(>,$rowcount,0)">
    <?MIVAR>
	<div class="summary">
	  <div class="summaryTitle">GENE ONTOLOGY</div>
	  <?/MIVAR>
      <?MIVAR COND="$(XST,$UPDATE)">
      <INPUT TYPE=button value="Update" onClick="edit_go('$OID')">
    <?/MIVAR>
 <?MIELSE>

      <?MIBLOCK COND="$(XST,$UPDATE)">


	<div class="summary">
	  <div class="summaryTitle">GENE ONTOLOGY</div>
      <?MIVAR>
      <INPUT TYPE=button value="Update" onClick="edit_go('$OID')"><?/MIVAR>
     <?/MIBLOCK>
  <?/MIBLOCK>

    <?MIBLOCK COND="$(>,$rowcount,0)">
    <?MIVAR><TABLE class="summary"><?/MIVAR>
    <tr>
         <th width = "15%"><A HREF="/zf_info/GO.html">Ontology</A></th>
        <?MIBLOCK COND="$(EC,$qualifier,true)">
        <th width = "13%">Qualifier</th>
        <?/MIBLOCK>
         <th>GO Term</th>


<!-- use vector storing the three ontology and loop through for display -->

<?MIBLOCK INDEX=$ontology FOREACH=$ontologies>

    <?MIVAR NAME=flgct>0<?/MIVAR>
    <?MIVAR NAME=flag><?/MIVAR>
    <?MIVAR NAME=isnot>f<?/MIVAR>
    <?MIVAR NAME=contribs>f<?/MIVAR>

    <?MISQL SQL="
      select first 1 term_ont_id, goev_display_order, get_entity_name_html(term_zdb_id), mrkrgoev_zdb_id,mrkrgoev_gflag_name,gont_ontology_name
        from term, go_evidence_code, marker_go_term_evidence, go_ontology
        where mrkrgoev_mrkr_zdb_id = '$OID'
          and mrkrgoev_term_zdb_id = term_zdb_id
          and mrkrgoev_evidence_code = goev_code
          and term_ontology = '$ontology'
	  and gont_ontology_internal_name = '$ontology'
        order by goev_display_order, term_name">
    <?/MISQL>

    <?MIVAR NAME=$molgoid>$1<?/MIVAR>
    <?MIVAR NAME=$moldisp>$2<?/MIVAR>
    <?MIVAR NAME=$molterm>$3<?/MIVAR>
    <?MIVAR NAME=$molmrkrgoevid>$4<?/MIVAR>
    <?MIVAR NAME=flag>$5<?/MIVAR>
    <?MIVAR NAME=ontology_name>$6<?/MIVAR>


    <?MICOMMENT>??? donot know what "'f' as mrkrgo_is_false_ref" is for ???<?/MICOMMENT>
    <?MISQL SQL="select distinct term_zdb_id,goev_display_order,term_name,'f' as mrkrgo_is_false_ref from term,go_evidence_code,marker_go_term_evidence where mrkrgoev_mrkr_zdb_id='$OID' and mrkrgoev_term_zdb_id=term_zdb_id and mrkrgoev_evidence_code=goev_code and term_ontology='$ontology' order by goev_display_order"><?/MISQL>
    <?MIVAR NAME=$anncount>$MI_ROWCOUNT<?/MIVAR>

    <?MIBLOCK COND="$(>,$flgct,0)">
       <?MIBLOCK COND="$(=,$flgct,2)">
     	<?MIVAR NAME=$isnot>t<?/MIVAR>
     	<?MIVAR NAME=$contribs>t<?/MIVAR>
      <?MIELSE>
        <?MIBLOCK COND="$(EC,$flag,not)">
           <?MIVAR NAME=$isnot>t<?/MIVAR>
        <?/MIBLOCK>
        <?MIBLOCK COND="$(EC,$flag,contributes to)">
        	<?MIVAR NAME=$contribs>t<?/MIVAR>
        <?/MIBLOCK>
     <?/MIBLOCK>
   <?/MIBLOCK>
   <?MIBLOCK COND="$(EC,$isnot,t)">
  	<?MIVAR NAME=not><i>NOT</i><?/MIVAR>
   <?MIELSE>
  	<?MIVAR NAME=not><?/MIVAR>
   <?/MIBLOCK>
   <?MIBLOCK COND="$(>,$anncount,0)">
	<TR><TD nowrap><?MIVAR>$ontology_name<?/MIVAR></TD>
   <?/MIBLOCK>
   <?MIBLOCK COND="$(OR,$(EC,$contribs,t),$(EC,$isnot,t))">
     <?MIBLOCK COND="$(EC,$contribs,t)">
      <td nowrap><?MIVAR>$not<?/MIVAR><i>Contributes to</i></td>
     <?MIELSE>
      <td nowrap><i><?MIVAR>$not<?/MIVAR></i></td>
     <?/MIBLOCK>
   <?MIELSE>
    <?MIBLOCK COND="$(EC,$qualifier,true)">
       <td></td>
     <?/MIBLOCK>
   <?/MIBLOCK>

   <?MIBLOCK COND="$(>,$anncount,1)">
       <?MIVAR><TD align=left>$molterm
     (<a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markergoview.apg&OID=$OID"><i>more</i></a>)</TD><?/MIVAR>
   <?/MIBLOCK>

   <?MIBLOCK COND="$(=,$anncount,1)">
     <?MIVAR><TD align=left>$molterm
     <a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markergoview.apg&OID=$OID"></a></TD><?/MIVAR>
   <?/MIBLOCK>
   </TR>
<?/MIBLOCK>  <?MICOMMENT> end for each ontoloty <?/MICOMMENT>

</TABLE>
  <?MIBLOCK COND="$(>,$rowcount,0)">
    <div>
	<?MIVAR><A HREF="/action/marker/marker-go-view/$OID">All GO Terms (<?MIVAR>$rowcount)</A><?/MIVAR><?/MIVAR>
    </div>
  <?/MIBLOCK>
  </div>
<?/MIBLOCK> <?MICOMMENT> end rowcount > 0 (found some go terms) <?/MICOMMENT>
  <!--------------- end of Gene Ontology --------------->




  <!-----------------  Protein Sequence  -------------->

  <?MIVAR NAME=$lastitem><?/MIVAR>
  <?MISQL SQL="
    select fdb_db_name,
	   fdb_db_query || dblink_acc_num ||
	     (case fdb_url_suffix when NULL then '' else fdb_url_suffix end),
           dblink_acc_num_display, fdb_db_significance, dblink_zdb_id
      from db_link, foreign_db, foreign_db_contains, foreign_db_data_type
      where dblink_linked_recid = '$OID'
        and dblink_fdbcont_zdb_id = fdbcont_zdb_id
	and fdbdt_pk_id = fdbcont_fdbdt_id
        and fdbcont_fdb_db_id = fdb_db_pk_id
        and fdbdt_super_type = 'protein'
      order by fdb_db_significance, fdb_db_name, dblink_acc_num_display;">

    <?MIVAR NAME=$dblinkZdbId>$5<?/MIVAR>

    <?MIBLOCK COND="$(=,$MI_CURRENTROW,1)">


	<p><b>Protein Families, Domains and Sites </b>
  	<?MIVAR>
	 <?MIBLOCK COND="$(XST,$UPDATE)">
          <form name=updateps>
          <br>
  	  <b>Add link to Protein Seq DB:</b> &nbsp;
  	  DBname:<SELECT name=prt_seqdb>
  	  <?MISQL SQL="
	    select fdb_db_name
	      from foreign_db_contains, foreign_db, foreign_db_data_type
	      where fdbdt_super_type = 'protein'
	      and fdbdt_pk_id = fdbcont_fdbdt_id
	      and fdbcont_fdb_db_id = fdb_db_pk_id
	      order by fdb_db_name;">
	    <option value="$1">$1</option>
  	  <?/MISQL>
  	  </SELECT>
 	   Accession:<input type=text size=15 name=prt_seq_acc>
  	   <input type=button value="Add it!" onClick=new_proseqnum();>

 	   <?MIVAR><br>
  	  <b>Add reference to Protein Seq:</b> &nbsp;
  	   Accession: <input type=text size=15 name=attrib_prtn_seqacc>
 	   Reference: <input type=text size=15 name=attrib_prtn_pubid>
  	   <input type=button value="Add it!" onClick=new_attrib_prtnseq();>
           <?/MIVAR>
           </form>
 	 <?/MIBLOCK> <?MICOMMENT>end of update <?/MICOMMENT>
	<TABLE class="summary">
 	 <?/MIVAR>
        <TR>
    <?/MIBLOCK>  <?MICOMMENT> end of first row <?/MICOMMENT>
    $(IF,$(AND,$(NC,$lastitem,$1),$(>,$MI_CURRENTROW,1)),</TD>)
    $(IF,$(NC,$lastitem,$1),<TD align=left>)
    <li>

    $(IF,$(XST,$UPDATE),"<input type=button value=delete onClick=Delete_listitem('db_link','"$(URLENCODE,$1:$3)"')>")
    <A HREF="$2">$1:$3</A> <?MISQL SQL="select WebExplode(object,'dataId=$5&type=recattrib') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL>

    $(SETVAR,$lastitem,$1)
 <?/MISQL>
 <?MIBLOCK COND=$MI_ROWCOUNT>
   </TD></TR></TABLE>
 <?/MIBLOCK>

  <!--------------end of Protein Sequences --------->
<!---------------- Transcripts ----------------------->


<?MICOMMENT> ** Only attempt to show related transcripts if there
                is a relationship that might bring one back  ** <?/MICOMMENT>
<?MISQL SQL="select 'x' from single
             where exists (select 'x' from marker_relationship
                           where mrel_mrkr_1_zdb_id = '$OID'
                             and mrel_type = 'gene produces transcript');">

<div id="markerviewtranscriptdetails">Loading Transcript Data... <img src="/images/ajax-loader.gif"/></div>
<?MIVAR>
<script type="text/javascript">
  jQuery('#markerviewtranscriptdetails').load('/action/marker/related-transcripts?zdbID=$OID', function() { processPopupLinks('#markerviewtranscriptdetails'); });
</script>
<?/MIVAR>

<?/MISQL>


<!---------------- end Transcripts ------------------->

  <!--------------- Gene Product Description ------->
  <?MISQL SQL="select dblink_linked_recid
		 from external_note, db_link
		where extnote_data_zdb_id = dblink_zdb_id
		  and dblink_linked_recid = '$OID';">
  <?/MISQL>
  <?MIBLOCK COND="$(>,$MI_ROWCOUNT,0)">
        <?MIBLOCK COND="$(=,$titledisplay,0)">
		<hr width = "80%">
  		<b>GENE PRODUCTS </b>
		<?MIVAR>$(SETVAR,$titledisplay,1)<?/MIVAR>
	<?/MIBLOCK>
	<p><?MIVAR><A HREF=/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-geneprddescription.apg&OID=$OID><b>Gene Product Description</b></A><?/MIVAR>

  <?/MIBLOCK>
  <!-----------end of Gene Product Description ------->

  <!--------------- Antibody ------->
  <?MISQL SQL="select count(mrel_mrkr_2_zdb_id)
  		 from marker_relationship
  		where mrel_mrkr_1_zdb_id = '$OID'
  		  and mrel_type = 'gene product recognized by antibody';">
  <?/MISQL>
  <?MIBLOCK COND="$(>,$1,0)">

  <div class="summary">
  <div class="summaryTitle">ANTIBODIES</div>
  <table class="summary">
  <?MIVAR NAME=$antibodyID><?/MIVAR>
  <tr><td>
  <?MISQL SQL="select mrel_mrkr_2_zdb_id,mrkr_name
    		 from marker_relationship, marker
    		where mrel_mrkr_1_zdb_id = '$OID'
    		  and mrel_type = 'gene product recognized by antibody'
    		  and mrel_mrkr_2_zdb_id = mrkr_zdb_id
    		  order by mrkr_abbrev;">
           <?MIVAR NAME=mrkrvw_antibody_id>$1<?/MIVAR>
           <?MIVAR NAME=mrkrvw_antibody_name>$2<?/MIVAR>
           <?MIBLOCK COND=$(=,$MI_CURRENTROW,1)>
	   	<?MIVAR NAME=mrkrvw_antibody_list_firstItem>t<?/MIVAR>
	   <?MIELSE>
	   	<?MIVAR NAME=mrkrvw_antibody_list_firstItem>f<?/MIVAR>
           <?/MIBLOCK>
           <?MISQL SQL="select recattrib_source_zdb_id
	                             from record_attribution
	                            where recattrib_data_zdb_id = '$mrkrvw_antibody_id';">
	        <?MIVAR NAME=mrkrvw_antibody_pub_id>$1<?/MIVAR>
	   <?/MISQL>
	   <?MIVAR NAME=mrkrvw_antibody_pub_count>$MI_ROWCOUNT<?/MIVAR>
	   <?MIBLOCK COND="$(=,$mrkrvw_antibody_pub_count,0)">
	       <?MIVAR NAME=mrkrvw_antibody_pub><?/MIVAR>
	   <?MIELSE COND="$(=,$mrkrvw_antibody_pub_count,1)">
	       <?MIVAR NAME=mrkrvw_antibody_pub>(<A HREF=/$mrkrvw_antibody_pub_id>$mrkrvw_antibody_pub_count</A>)<?/MIVAR>
	   <?MIELSE>
	       <?MIVAR NAME=mrkrvw_antibody_pub>(<A HREF=/action/antibody/publication-list?antibody.zdbID=$mrkrvw_antibody_id&orderBy=author>$mrkrvw_antibody_pub_count</A>)<?/MIVAR>
           <?/MIBLOCK>

           <?MIVAR NAME=mrkrvw_antibody_display><A HREF=/action/marker/view/$mrkrvw_antibody_id>$mrkrvw_antibody_name</A> $mrkrvw_antibody_pub<?/MIVAR>
           <?MIBLOCK COND=$(EQ,$mrkrvw_antibody_list_firstItem,t)>
	        <?MIVAR NAME=mrkrvw_antibody_display_list>$mrkrvw_antibody_display<?/MIVAR>
	   <?MIELSE>
	   	<?MIVAR>$(VECAPPEND,$mrkrvw_antibody_display_list,$mrkrvw_antibody_display)<?/MIVAR>
           <?/MIBLOCK>
  <?/MISQL>
  <?MIVAR NAME=mrkrvw_antibody_display_list_sepa SEPARATE=", ">$mrkrvw_antibody_display_list<?/MIVAR>
  <?MIVAR>$mrkrvw_antibody_display_list_sepa<?/MIVAR>
  </td> </tr>
  </table>
  <?/MIBLOCK> <!-----------end of Antibody ------->

<?/MIBLOCK> <?MICOMMENT> marker is a gene ($type_of_genedom exists) <?/MICOMMENT>

<!------------------ end of GENE PRODUCT ---------------------->
<?MIVAR NAME=mrkrview_mrkr_fam><?/MIVAR>
<?MIBLOCK COND="$(EC,$AUTHORIZED,root)">
        <?MISQL SQL="select
                     * from genedom_family_member
                     where gfammem_mrkr_zdb_id='$OID'">
        <?MIVAR NAME=$mrkrview_mrkr_fam>$1<?/MIVAR>
        <?/MISQL>
        <?MIBLOCK COND="$(NC,$mrkrview_mrkr_fam,)">
<p>
          <b>Gene Family:</b>
            <?MIVAR>$mrkrview_mrkr_fam<?/MIVAR>

        <?/MIBLOCK>
<?/MIBLOCK>




<?MICOMMENT>=========================================================
            ==    CONSTRUCTS WITH SEQUENCE FROM
	    =========================================================
<?/MICOMMENT>
  <?MISQL SQL="
         select mrel_mrkr_1_zdb_id
           from marker_relationship
          where mrel_mrkr_2_zdb_id = '$OID'
            and mrel_type in ('promoter of','coding sequence of', 'contains engineered region')
        ">
   <?/MISQL>
   <?MIBLOCK COND="$(>,$MI_ROWCOUNT,0)">
  	<hr width=80%>
  	  <b>
	     CONSTRUCTS WITH SEQUENCE FROM <?MIVAR><i>$abbrev</i><?/MIVAR>
  	  </b>
   <table class="summary" cols=2>
    <tr>
     <td>
       <?MISQL SQL="select WebExplode(object,'mrkr_id=$OID') from webPages where ID='aa-mrkrgenolist.apg';">$1<?/MISQL>
     </td>
    </tr>
   </table>
<?/MIBLOCK>

<?MISQL COND=$(XST,$debug_timing) SQL="
        execute function get_time()">
        <br>$1 End GO/Protein, Start Mrel section
<?/MISQL>

<?MICOMMENT>=========================================================
            ==    CLONE GBROWSE IMAGE
            =========================================================
<?/MICOMMENT>

<?MIBLOCK COND="$(XST,$mrkrview_mrkr_is_clone)">

<div class="summary">
<div id="clone_gbrowse_thumbnail_box"  style="display: none;" >
  <table class="summary solidblock" id="clone_gbrowse_thumbnail_box">
    <caption>GBROWSE</caption>
    <?MIVAR>
    <tr>
      <td style="text-align: center">
        <div style="margin: .5em; border: 1px solid black; background: white">

        <a href="/<!--|GBROWSE_PATH_FROM_ROOT|-->?name=$abbrev">
        <img
             onload="document.getElementById('clone_gbrowse_thumbnail_box').style.display = 'block';"
             style="padding-bottom:10px; border: 0 "
             src="/<!--|GBROWSE_IMG_PATH_FROM_ROOT|-->?grid=0&width=600&options=fullclone+0+mRNA+0+genes+0&type=fullclone&type=genes&type=mRNA&name=$OID&h_feat=$abbrev">

        </a>

        </div>
      </td>
     </tr>
    <?/MIVAR>
  </table>

</div>
</div>
<?/MIBLOCK>







<?MICOMMENT>=========================================================
            ==    MARKER RELATIONSHIP
	    =========================================================
<?/MICOMMENT>

<?MIBLOCK COND="$(NXST,$type_of_knockdown_reagent)">
<?MIVAR NAME=$mrel_mtype><?/MIVAR>
<?MIVAR NAME=$mrel_count><?/MIVAR>

<?MISQL SQL="
        select count(*)::Integer
               from marker_relationship
               inner join marker
               on mrkr_zdb_id = mrel_mrkr_2_zdb_id
              where (mrel_mrkr_1_zdb_id = '$OID'
                     or mrel_mrkr_2_zdb_id = '$OID')
                and mrel_type not in  ('knockdown reagent targets gene',
					'promoter of',
					'coding sequence of',
					'contains engineered region'
					)
                    ;">
     <?MIVAR NAME=$mrel_count>$1<?/MIVAR>
<?/MISQL>
<?MIBLOCK COND="$(OR,$(NC,$mrel_count,0),$(XST,$UPDATE))">
  <HR width="80%">
  <b>
  <?MIBLOCK COND="$(XST,$type_of_genedom)">
    SEGMENT (CLONE AND PROBE) RELATIONSHIPS
  <?MIELSE>
    <?MIBLOCK COND="$(NE,$marker_type,REGION)">
    MARKER RELATIONSHIPS
    <?/MIBLOCK>
  <?/MIBLOCK>
  </b>
<?/MIBLOCK>
<?MIBLOCK COND="$(AND,$(XST,$UPDATE),$(NE,$marker_type,REGION))">
 <br><form name=updaterrel>
 <b>Add relationship:</b> &nbsp;
 Relationship:<SELECT name=relship>
 <?MISQL SQL="select unique mreltype_name, mreltype_1_to_2_comments
	       from marker_relationship_type
	            join marker_type_group_member
		      on mreltype_mrkr_type_group_1 = mtgrpmem_mrkr_type_group
	      where get_obj_type('$OID') = mtgrpmem_mrkr_type
		and mreltype_name not in ('knockdown reagent targets gene',
					'promoter of',
					'coding sequence of',
					'contains engineered region',
					'transcript targets gene',
					'gene produces transcript'
					); ">
   <option value="1to2-$1">$1-$2
 <?/MISQL>

 <?MISQL SQL="select unique mreltype_name, mreltype_2_to_1_comments
	       from marker_relationship_type
	            join marker_type_group_member
	              on mreltype_mrkr_type_group_2 = mtgrpmem_mrkr_type_group
	      where get_obj_type('$OID') = mtgrpmem_mrkr_type
                and mreltype_name not in ('knockdown reagent targets gene',
					'promoter of',
					'coding sequence of',
					'transcript targets gene',
					'contains engineered region',
					'gene produces transcript'
					); ">
   <option value="2to1-$1">$1-$2
 <?/MISQL>
 </SELECT>
 partner Symbol:<input type=text size=15 name=mrkr_abbrev>
 <?MICOMMENT>new_mrkrrel() function is also used by target gene and
             knockdown reagent section. That is the reason why we
             need to send values as parameters. There possibly is nicer
             solution...
 <?/MICOMMENT>
 <input type=button value="Add it!" onClick=new_mrkrrel(this.form.relship.options[this.form.relship.selectedIndex].value,this.form.mrkr_abbrev.value.trim());>

  <?MIVAR COND="$(AND,$(>,$mrel_count,0),$(XST,$UPDATE))">
     <br><b>Add Reference:</b>
     Marker abbrev:<input type=text name=attrib_mrkr_abbrev>
     Reference:<input type=text name=attrib_mrel_pubid>
     <input type=button value="Add" onClick=new_attrib_mrel(this.form);>
  <?/MIVAR>

<?/MIBLOCK>  <?MICOMMENT> end if update <?/MICOMMENT>

<table class="summary horizontal-solidblock">
	<?MISQL SQL="select WebExplode(object,'mrkrrel_mrkr_zdb_id=$OID&mrkrrel_rel_direction=2_to_1') from webPages where ID='aa-markerrelationship.apg' ;">
       $1
    <?/MISQL>
	<?MISQL SQL="select WebExplode(object,'mrkrrel_mrkr_zdb_id=$OID&mrkrrel_rel_direction=1_to_2')
				   from webPages
             	  where ID='aa-markerrelationship.apg' ;">
       $1
    <?/MISQL>
</table>

<?MIBLOCK COND="$(XST,$UPDATE)">
  </form> <?MICOMMENT> end form updaterrel <?/MICOMMENT>
<?/MIBLOCK>

<?/MIBLOCK> <?MICOMMENT>end of not type_of_knockdown_reagent<?/MICOMMENT>

<!------------------ end of MARKER RELATIONSHIP --------------->

<?MICOMMENT> ceate a list of chimeric clones <?/MICOMMENT>
<?MIVAR NAME=chimeric_clone_list><?/MIVAR>
<?MISQL SQL="select clone_mrkr_zdb_id from clone where clone_problem_type = 'Chimeric';">
  $(VECAPPEND,$chimeric_clone_list,$1)
<?/MISQL>
<?MIVAR NAME=chimeric_clone_list>$(SEPARATE,$chimeric_clone_list,"','")<?/MIVAR>


<?MICOMMENT>
  ------------- SEQUENCE INFORMATION -------------------------------
<?/MICOMMENT>
<?MIBLOCK COND="$(AND,$(NE,$marker_type,CRISPR),$(NE,$marker_type,MRPHLNO),$(NE,$marker_type,TALEN))">

<?MICOMMENT> Get count of # of sequence links.  Union gets rid of dups <?/MICOMMENT>
<?MICOMMENT> TODO: redo with display groups, same as on sequence.apg page<?/MICOMMENT>
<?MISQL SQL="
  select dblink_acc_num, fdb_db_name
  from db_link, foreign_db_contains, foreign_db,
               foreign_db_contains_display_group_member, foreign_db_contains_display_group
  where dblink_linked_recid = '$OID'
    and fdbcont_fdb_db_id = fdb_db_pk_id
    and dblink_fdbcont_zdb_id = fdbcont_zdb_id
    and fdbcdg_name = 'marker linked sequence'
    and fdbcdg_pk_id = fdbcdgm_group_id
    and fdbcdgm_fdbcont_zdb_id = fdbcont_zdb_id
    -- and fdb_db_name != 'ZFIN_PROT'
  UNION
  select dblink_acc_num, fdb_db_name
  from db_link, foreign_db_contains, marker_relationship, foreign_db,
             foreign_db_contains_display_group_member, foreign_db_contains_display_group
  where mrel_mrkr_1_zdb_id = '$OID'
    and fdbcont_fdb_db_id = fdb_db_pk_id
    and dblink_linked_recid = mrel_mrkr_2_zdb_id
    and dblink_fdbcont_zdb_id = fdbcont_zdb_id
    and fdbcdg_name = 'marker linked sequence'
    and fdbcdg_pk_id = fdbcdgm_group_id
    and fdbcdgm_fdbcont_zdb_id = fdbcont_zdb_id
    -- and fdb_db_name != 'ZFIN_PROT'
    and mrel_type in ('gene contains small segment',
		      'clone contains small segment',
		      'gene encodes small segment')
    and mrel_mrkr_2_zdb_id not in ('$chimeric_clone_list')
  UNION
  select dblink_acc_num, fdb_db_name
  from db_link, foreign_db_contains,foreign_db, marker_relationship,
             foreign_db_contains_display_group_member, foreign_db_contains_display_group
  where mrel_mrkr_2_zdb_id = '$OID'
    and dblink_linked_recid = mrel_mrkr_1_zdb_id
    and dblink_fdbcont_zdb_id = fdbcont_zdb_id
    and fdbcdg_name = 'marker linked sequence'
    and fdbcdg_pk_id = fdbcdgm_group_id
    and fdbcdgm_fdbcont_zdb_id = fdbcont_zdb_id
    and fdbcont_fdb_db_id = fdb_db_pk_id
    and mrel_type in ('clone contains gene')
    and mrel_mrkr_1_zdb_id not in ('$chimeric_clone_list')
  ;">
<?/MISQL>
<?MIVAR NAME=$mrkrview_nSequenceLinks>$MI_ROWCOUNT<?/MIVAR>


<?MIBLOCK COND="$(OR,$mrkrview_nSequenceLinks,$(XST,$UPDATE))">
   <?MIBLOCK COND="$(NE,$marker_type,REGION)">
    <HR width="80%">
    <a name=sequence><b>SEQUENCE INFORMATION</b></a>
   <?/MIBLOCK>
<?/MIBLOCK>

<?MIBLOCK COND="$(AND,$(XST,$UPDATE),$(NE,$marker_type,REGION))">
  <form name=updateseq>
  <?MIVAR NAME=seq_tab>&nbsp;&nbsp;&nbsp;<?/MIVAR>
  <br>
  <?MIVAR>$seq_tab<?/MIVAR>
  <b>Link to Seq DB:</b> &nbsp;
  DBname:<SELECT name=seqdb>
  <?MISQL SQL="
select
fdb.fdb_db_name,
dt.fdbdt_data_type,dgm.fdbcdgm_fdbcont_zdb_id
from foreign_db_contains_display_group dg
join foreign_db_contains_display_group_member dgm on dg.fdbcdg_pk_id=dgm.fdbcdgm_group_id
join foreign_db_contains fdbc  on fdbc.fdbcont_zdb_id=dgm.fdbcdgm_fdbcont_zdb_id
join foreign_db fdb  on fdb.fdb_db_pk_id=fdbc.fdbcont_fdb_db_id
join foreign_db_data_type dt on fdbc.fdbcont_fdbdt_id=dt.fdbdt_pk_id
where
dg.fdbcdg_name='dblink adding on marker-edit'
order by fdb.fdb_db_name,dt.fdbdt_data_type
;
     ">
    <option value="$3" $(IF,$(EC,$1,GenBank),SELECTED)>$1 - $2</option>
  <?/MISQL>
  </SELECT>
  Accession:<input type=text size=15 name=seq_acc>
  <input type=button value="Add it!" onClick=new_seqnum();>
  <br>
  <?MIVAR>$seq_tab<?/MIVAR>
  <b>Update Sequence:</b> &nbsp;
  AccNum:<SELECT name=upd_seq_zdb>
  <?MISQL SQL="
    select distinct fdb_db_name, dblink_acc_num_display, dblink_zdb_id
      from foreign_db_contains, db_link, foreign_db, foreign_db_data_type
     where fdbdt_super_type = 'sequence'
       and fdbcont_fdbdt_id = fdbdt_pk_id
       and fdbcont_fdb_db_id = fdb_db_pk_id
       and fdbcont_zdb_id = dblink_fdbcont_zdb_id
       and dblink_linked_recid = '$OID'
     order by fdb_db_name, dblink_acc_num_display;">
    <option value="$3">$1:$2</option>
  <?/MISQL>
  </SELECT>
  Type:<SELECT name=upd_seq_type>
  <?MISQL SQL="
    select distinct fdbdt_data_type
      from foreign_db_data_type
     where fdbdt_super_type = 'sequence'
     and fdbdt_data_type != 'Sequence Clusters'
     order by fdbdt_data_type;">
    <option value="$1"  $(IF,$(EC,$1,RNA),SELECTED)>$1</option>
  <?/MISQL>
  </SELECT>
  Length: <input type=text size=10 name=upd_seq_length>
  <input type=button value="Update" onClick=update_seqnum();>

  <br>
  <?MIVAR>$seq_tab<?/MIVAR>
  <b>Add reference:</b> &nbsp;
  DBname:<SELECT name=attrib_seq_fdb>
  <?MISQL SQL="
select
fdb.fdb_db_name,
dt.fdbdt_data_type,dgm.fdbcdgm_fdbcont_zdb_id
from foreign_db_contains_display_group dg
join foreign_db_contains_display_group_member dgm on dg.fdbcdg_pk_id=dgm.fdbcdgm_group_id
join foreign_db_contains fdbc  on fdbc.fdbcont_zdb_id=dgm.fdbcdgm_fdbcont_zdb_id
join foreign_db fdb  on fdb.fdb_db_pk_id=fdbc.fdbcont_fdb_db_id
join foreign_db_data_type dt on fdbc.fdbcont_fdbdt_id=dt.fdbdt_pk_id
where
dg.fdbcdg_name='dblink adding on marker-edit'
order by fdb.fdb_db_name,dt.fdbdt_data_type
;
     ">
    <option value="$3" $(IF,$(EC,$1,GenBank),SELECTED)>$1 - $2</option>
  <?/MISQL>
  </SELECT>
  Accession: <input type=text size=15 name=attrib_seq_acc>
  Reference: <input type=text size=15 name=attrib_seq_pubid>
  <input type=button value="Add it!" onClick=new_attrib_seq();>
  <?MICOMMENT>Added CDNA for this condition (FogBugz 410) <?/MICOMMENT>

  <br>

<div id="newProteinSequence"></div>
    <br>

<?MIVAR COND="$(AND,$(XST,$UPDATE),$(EQ,$marker_type,GENE))">
<br>
<a name="addStemLoop">
<div id="newStemLoopSequence"></div>
<br>
<?/MIVAR>

    <br>

<?/MIBLOCK>  <?MICOMMENT> end update <?/MICOMMENT>

<?MIVAR NAME="$row_class">even<?/MIVAR>

<?MIBLOCK COND="$mrkrview_nSequenceLinks">
  <TABLE class="summary rowstripes">
    <TR>
      <th width=30%>Type</th>
      <th width=40%>Accession #</th>
      <th class="length">Length (bp/aa)</th>
      <th class="analysis">Analysis <a class="popup-link info-popup-link" href="/ZFIN/help_files/sequence_tools_help.html"></a></th>
    </TR>
    <?MIVAR NAME=$mrkrview_prevDataType><?/MIVAR>
    <?MIVAR NAME=$mrkrview_displayAllSequencesLink>0<?/MIVAR>
    <?MISQL SQL="
        select dblink_length, fdb_db_name, fdb_db_query || dblink_acc_num ||
               (case fdb_url_suffix when NULL then '' else fdb_url_suffix end),
               dblink_acc_num_display, dblink_zdb_id, 's', 'placeholder',
               'placeholder', fdb_db_significance, fdbdt_data_type,
               fdbdt_display_order,dblink_fdbcont_zdb_id
        from db_link, foreign_db, foreign_db_contains, foreign_db_data_type,
             foreign_db_contains_display_group_member, foreign_db_contains_display_group
        where dblink_linked_recid = '$OID'
          and dblink_fdbcont_zdb_id = fdbcont_zdb_id
          and fdbcont_fdb_db_id = fdb_db_pk_id
          and fdbcdg_name = 'marker linked sequence'
          and fdbcdgm_fdbcont_zdb_id = fdbcont_zdb_id
          and fdbcdg_pk_id = fdbcdgm_group_id
          and fdbcont_fdbdt_id = fdbdt_pk_id
      UNION
        select dblink_length, fdb_db_name, fdb_db_query || dblink_acc_num ||
               (case fdb_url_suffix when NULL then '' else fdb_url_suffix end),
               dblink_acc_num_display, dblink_zdb_id, 'r', mrel_mrkr_2_zdb_id,
               mrkr_abbrev, fdb_db_significance, fdbdt_data_type,
               fdbdt_display_order,dblink_fdbcont_zdb_id
        from db_link, foreign_db, foreign_db_contains, foreign_db_data_type,
             marker_relationship, marker,
             foreign_db_contains_display_group_member, foreign_db_contains_display_group
        where mrel_mrkr_1_zdb_id = '$OID'
          and dblink_linked_recid = mrel_mrkr_2_zdb_id
          and dblink_fdbcont_zdb_id = fdbcont_zdb_id
          and fdbcont_fdb_db_id = fdb_db_pk_id
          and fdbcdg_name = 'marker linked sequence'
          and fdbcdgm_fdbcont_zdb_id = fdbcont_zdb_id
          and fdbcdg_pk_id = fdbcdgm_group_id
          and fdbcont_fdbdt_id = fdbdt_pk_id
          and mrel_type in ('gene contains small segment',
                            'clone contains small segment',
                            'gene encodes small segment')
          and mrel_mrkr_2_zdb_id = mrkr_zdb_id
          and mrel_mrkr_2_zdb_id not in ('$chimeric_clone_list')
      UNION
        select dblink_length, fdb_db_name, fdb_db_query || dblink_acc_num ||
               (case fdb_url_suffix when NULL then '' else fdb_url_suffix end),
               dblink_acc_num_display, dblink_zdb_id, 'r', mrel_mrkr_1_zdb_id,
               mrkr_abbrev, fdb_db_significance, fdbdt_data_type,
               fdbdt_display_order,dblink_fdbcont_zdb_id
        from db_link, foreign_db, foreign_db_contains, foreign_db_data_type,
             marker_relationship, marker,
             foreign_db_contains_display_group_member, foreign_db_contains_display_group
        where mrel_mrkr_2_zdb_id = '$OID'
          and dblink_linked_recid = mrel_mrkr_1_zdb_id
          and dblink_fdbcont_zdb_id = fdbcont_zdb_id
          and fdbcont_fdb_db_id = fdb_db_pk_id


          and fdbcdg_name = 'marker linked sequence'
          and fdbcdgm_fdbcont_zdb_id = fdbcont_zdb_id
          and fdbcdg_pk_id = fdbcdgm_group_id

          and fdbcont_fdbdt_id = fdbdt_pk_id
          and mrel_type = 'clone contains gene'
          and mrel_mrkr_1_zdb_id = mrkr_zdb_id
          and mrel_mrkr_1_zdb_id not in ('$chimeric_clone_list')

        order by 11 asc, 9 asc, 1 desc, 6 desc, 4 asc
      ;">

      <?MIVAR NAME=dblink_length>$1<?/MIVAR>
      <?MIVAR NAME=db_name>$2<?/MIVAR>
      <?MIVAR NAME=link_url>$3<?/MIVAR>
      <?MIVAR NAME=acc_num>$4<?/MIVAR>
      <?MIVAR NAME=dataId>$5<?/MIVAR>
      <?MIVAR NAME=attachto>$6<?/MIVAR>
      <?MIVAR NAME=related_zdb_id>$7<?/MIVAR>
      <?MIVAR NAME=related_mrkr_abbrev>$8<?/MIVAR>
      <?MIVAR NAME=data_type>$10<?/MIVAR>
      <?MIVAR NAME=mrkr_fdbc_zdb_id>$12<?/MIVAR>




      <?MIBLOCK COND="$(NE,$data_type,$mrkrview_prevDataType)">
        <?MICOMMENT>
          Data type changed.  Display first row for this data type.
          ** 07/24/03 for some weird reasons, the column made up to distinguish
          the source of GenBank accession has to be a one-character string
	  to behave right in EC operation.
        <?/MICOMMENT>

        <?MIBLOCK COND="$(EQ,$row_class,odd)">
          <?MIVAR NAME="$row_class">even<?/MIVAR>
        <?MIELSE>
          <?MIVAR NAME="$row_class">odd<?/MIVAR>
        <?/MIBLOCK>

        <?MIVAR>
          <TR class="$row_class newgroup">
            <TD>
              $data_type
            </TD>
            <TD>
              $(IF,$(AND,$(XST,$UPDATE),$(NE,$attachto,r)),"<input type=button value=delete onClick=Delete_listitem('db_link','"$(URLENCODE,$db_name:$acc_num)"')>")
              <A HREF="$link_url">$db_name:$acc_num</A>

              <?MIBLOCK COND="$(AND,$(XST,$UPDATE),$(EC,$attachto,r))">
                <?MISQL SQL="
                  select mrkr_abbrev, mrkr_zdb_id
                    from marker
                    where mrkr_zdb_id = '$related_zdb_id'; ">
                  ( <A HREF="/action/marker/view/$related_zdb_id">$related_mrkr_abbrev</A> )
                <?/MISQL>

                <?MIVAR>$(UNSETVAR,$UPDATE)<?/MIVAR>
                <?MISQL SQL="select WebExplode(object,'dataId=$dataId&type=recattrib&info=standard') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL>
                <?MIVAR>$(SETVAR,$UPDATE,1)<?/MIVAR>
              <?MIELSE>
                <?MISQL SQL="select WebExplode(object,'dataId=$dataId&type=recattrib&info=standard') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL>
              <?/MIBLOCK>
            </TD>
            <TD class="length">
              <nobr>
                <?MIVAR>$dblink_length<?/MIVAR>
                <?MIBLOCK COND=$(NC,$dblink_length,)>
                   <?MIBLOCK COND=$(EC,$data_type,Polypeptide)> aa
                   <?MIELSE  COND=$(OR,$(EC,$data_type,RNA),$(EC,$data_type,Genomic))> bp
                   <?/MIBLOCK>
                <?/MIBLOCK>
              </nobr>
            </TD>
            <TD class="analysis">
              <?MISQL SQL="select WebExplode(object,'seqt_acc=$acc_num&seqt_acc_len=$dblink_length&seqt_acc_type=$data_type&seqt_acc_db=$db_name&seqt_fdbc_zdb_id=$mrkr_fdbc_zdb_id') from webPages where ID='aa-sequence_tools.apg';">$1<?/MISQL>
            </TD>
          </TR>
        <?/MIVAR>
        <?MIVAR NAME=$mrkrview_prevDataType>$data_type<?/MIVAR>
      <?MIELSE>
        <?MICOMMENT>
          Data type did not change.  Record that there is more than one record
          for at least one data type.
        <?/MICOMMENT>
        <?MIVAR NAME=$mrkrview_displayAllSequencesLink>1<?/MIVAR>
      <?/MIBLOCK>  <?MICOMMENT> end data type did or did not change <?/MICOMMENT>
    <?/MISQL>
  </TABLE>
    <?MIBLOCK COND=$mrkrview_displayAllSequencesLink>
      <div>
        <?MIVAR>
          <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-sequence.apg&OID=$OID$(IF,$(XST,$UPDATE),&UPDATE=1)">All Sequence Information ($mrkrview_nSequenceLinks)</a>
        <?/MIVAR>
      </div>
    <?/MIBLOCK>

<?/MIBLOCK> <?MICOMMENT> end there were sequence records <?/MICOMMENT>

<?MIBLOCK COND="$(XST,$UPDATE)">
  </form>  <?MICOMMENT> end form updateseq <?/MICOMMENT>
<?/MIBLOCK>


<?/MIBLOCK>
<?MICOMMENT>
  ---------------- ends of SEQUENCE INFORMATION ---------------
<?/MICOMMENT>


<?MICOMMENT>
------------   OTHER MARKER PAGES   -------------------------------
<?/MICOMMENT>

  <?MIVAR>$(UNSETVAR,dblink_other)<?/MIVAR>

              <?MIVAR NAME=$type_of_clone><?/MIVAR>


  <?MISQL SQL="
    select fdb_db_name, fdb_db_query || dblink_acc_num ||
	     (case fdb_url_suffix when NULL then '' else fdb_url_suffix end),
           dblink_acc_num, dblink_zdb_id, dblink_acc_num_display, fdb_db_significance
    from db_link, foreign_db, foreign_db_contains,
         foreign_db_contains_display_group_member, foreign_db_contains_display_group
    where dblink_linked_recid = '$OID'
      and dblink_fdbcont_zdb_id = fdbcont_zdb_id
      and fdbcont_fdb_db_id = fdb_db_pk_id
      and fdbcdgm_fdbcont_zdb_id = fdbcont_zdb_id
      and fdbcdg_pk_id = fdbcdgm_group_id
      and fdbcdg_name = 'summary page'


    order by 6,1,5
  ;">
    <?MIVAR NAME=db_name>$1<?/MIVAR>
    <?MIVAR NAME=link_url>$2<?/MIVAR>
    <?MIVAR NAME=acc_num>$3<?/MIVAR>
    <?MIVAR NAME=dataId>$4<?/MIVAR>
    <?MIVAR NAME=link_display>$5<?/MIVAR>

    <?MIVAR NAME=mini_ref><?MISQL SQL="select WebExplode(object,'dataId=$dataId&type=recattrib') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL><?/MIVAR>

    <?MIBLOCK COND="$(AND,$(XST,$vPrevDBname),$(NC,$vPrevDBname,$db_name))">
    <?MIBLOCK COND="$(NXST,$dblink_other)">
      <?MIVAR NAME=dblink_other>
        $vDBnameColumn
      <?/MIVAR>
    <?MIELSE>
      <?MIVAR>
        $(VECAPPEND,$dblink_other,$vDBnameColumn)
      <?/MIVAR>
    <?/MIBLOCK>
      <?MIVAR>$(UNSETVAR,vDBnameColumn)<?/MIVAR>
    <?/MIBLOCK>

    <?MIBLOCK COND=$(NXST,$vDBnameColumn)>
      <?MIVAR NAME=vDBnameColumn>
         <nobr><LI>
         $(IF,$(XST,$UPDATE),"<input type=button value=delete onClick=Delete_listitem('db_link','"$(URLENCODE,$db_name:$acc_num)"')>")
   <?MIVAR>    <A HREF="$link_url">$db_name:$link_display</A>&nbsp;$mini_ref <?/MIVAR>
        </LI></nobr>
        <?MISQL SQL="select mtgrpmem_mrkr_type_group from marker_type_group_member where mtgrpmem_mrkr_type_group='CLONE' and mtgrpmem_mrkr_type='$marker_type'">
           <?MIVAR COND="$(EC,$1,CLONE)" NAME=type_of_clone>t<?/MIVAR>
        <?/MISQL>
        <?MIBLOCK COND="$(EC,t,$type_of_clone)">
          <?MISQL SQL="select dblink_acc_num_display
                       from db_link
                       where dblink_linked_recid='$OID'
                       and dblink_fdbcont_zdb_id='ZDB-FDBCONT-040826-2'">
          <?/MISQL>

          <?MISQL SQL="select fdb_db_name,fdb_db_query from foreign_db where fdb_db_name ='Ensembl_Clone'">
           <?MIVAR NAME=$snp_db_name>$1<?/MIVAR>
           <?MIVAR NAME=$snp_db_query>$2<?/MIVAR>
          <?/MISQL>
          <?MIBLOCK COND="$(NE,$snp_ensembl_accnum,)">
             <td><nobr><li>
            <?MIVAR> <A HREF="$snp_db_query$snp_ensembl_accnum">$snp_db_name:$snp_ensembl_accnum</a><?/MIVAR>
    (<a href="/ZDB-PUB-080313-1">1</a>)
</li></nobr></td>
          <?/MIBLOCK>
        <?/MIBLOCK>
      <?/MIVAR>
    <?MIELSE>
      <?MIVAR NAME=vDBnameColumn>
        $vDBnameColumn
       <nobr><LI>
       $(IF,$(XST,$UPDATE),"<input type=button value=delete onClick=Delete_listitem('db_link','"$(URLENCODE,$db_name:$acc_num)"')>")
       <?MIVAR><A HREF="$link_url">$db_name:$link_display</A>&nbsp;$mini_ref <?/MIVAR>
        </LI></nobr>

      <?/MIVAR>
    <?/MIBLOCK>

  <?MIVAR NAME=vPrevDBname>$db_name<?/MIVAR>

  <?/MISQL>

    <?MIBLOCK COND="$(XST,$vPrevDBname)">
    <?MIBLOCK COND="$(NXST,$dblink_other)">
      <?MIVAR NAME=dblink_other>
        $vDBnameColumn
      <?/MIVAR>
    <?MIELSE>
      <?MIVAR>
        $(VECAPPEND,$dblink_other,$vDBnameColumn)
      <?/MIVAR>
    <?/MIBLOCK>
    <?/MIBLOCK>

  <?MIBLOCK COND=$(OR,$(XST,$dblink_other),$(XST,$UPDATE))>
    <?MIBLOCK COND="$(NE,$marker_type,REGION)">
    <HR width="80%">
    <?MIVAR><b>OTHER &nbsp;<i>$abbrev</i>&nbsp; GENE / MARKER PAGES</b><?/MIVAR>
    <?/MIBLOCK>
<?MIBLOCK COND="$(AND,$(XST,$UPDATE),$(NE,$marker_type,REGION))">

  <form name=updateother>
  <?MIVAR NAME=seq_tab>&nbsp;&nbsp;&nbsp;<?/MIVAR>
  <br><br>
  <?MIVAR>$seq_tab<?/MIVAR>
  <b>Link Other page:</b> &nbsp;
  DBname:<SELECT name=seqdb>
  <?MISQL SQL="
    select distinct fdb_db_name
      from foreign_db_contains, foreign_db, foreign_db_data_type
     where fdbdt_super_type = 'summary page'
      and fdbdt_pk_id = fdbcont_fdbdt_id
      and fdbcont_fdb_db_id = fdb_db_pk_id
      order by fdb_db_name;">
    <option value="$1" $(IF,$(EC,$1,VEGA),SELECTED)>$1</option>
  <?/MISQL>
  </SELECT>
  Accession:<input type=text size=25 name=seq_acc>
  Type:<SELECT name=seq_super>
  <?MISQL SQL="
    select distinct fdbdt_data_type, fdbdt_super_type
      from foreign_db_data_type
     where fdbdt_super_type = 'summary page'
     order by fdbdt_data_type;">
    <option value="$2&fdbcont_data=$1" $(IF,$(EC,$1,other),SELECTED)>$1</option>
  <?/MISQL>
  </SELECT>
  <input type=button value="Add it!" onClick=new_othernum();>

  <br>
  <?MIVAR>$seq_tab<?/MIVAR>
  <b>Add reference:</b> &nbsp;
  Accession: <input type=text size=15 name=attrib_seq_acc>
  Reference: <input type=text size=15 name=attrib_seq_pubid>
  <input type=button value="Add it!" onClick=new_attrib_other();>
  <br><br>
<?/MIBLOCK>  <?MICOMMENT> end update OTHER GENE / MARKER PAGES:<?/MICOMMENT>

    <?MIBLOCK COND="$(XST,$dblink_other)">
        <?MIVAR NAME=dblink_other_table_row><TR><TD>$(SEPARATE,$dblink_other,</TD><TD>)</TD></TR><?/MIVAR>
        <?MIVAR>
            <TABLE  class="summary">
                $dblink_other_table_row
            </TABLE>
        <?/MIVAR>
    <?/MIBLOCK>

  <?/MIBLOCK>
<?MIBLOCK COND="$(XST,$UPDATE)">
  </form>  <?MICOMMENT> end form updateother <?/MICOMMENT>
<?/MIBLOCK>

<!------------   ends   OTHER MARKER PAGES   ------------------------>

<?MISQL COND=$(XST,$debug_timing) SQL="
        execute function get_time()">
        <br>$1 End Mrel, Sequence section, Start Mapping
<?/MISQL>

<?MICOMMENT>=========================================================
            ==    MAPPING INFORMATION
	    =========================================================
<?/MICOMMENT>

<?MIBLOCK COND="$(AND,$(NXST,$type_of_knockdown_reagent),$(=,$(POSITION,$OID,CONSTRCT),0), $(=,$(POSITION,$OID,-EFG-),0))">
  <?MIBLOCK COND="$(NE,$marker_type,REGION)">
  <hr width="80%" align = center>
  <b>MAPPING INFORMATION  </b>

  <TABLE class="summary">
   <TR>
    <TD id="mappingDetail">
    </TD>
   </TR>
  </TABLE>
       	<?MIVAR>
            <script type="text/javascript">
               	jQuery('#mappingDetail').load('/action/mapping/summary/$OID');
            </script>
       	<?/MIVAR>

  <?/MIBLOCK>
<?/MIBLOCK>

<form name=updater1>

<!------------ ORTHOLOGY ------------------------------------>

<?MIBLOCK COND="$(XST,$type_of_genedom)">
 <HR width="80%">
 <a name=orthologue><b>ORTHOLOGY</b></a>
 <?MICOMMENT>at update mode, user will choose species, and invoke refresh<?/MICOMMENT>
 <?MIBLOCK COND="$(XST,$UPDATE)">
   <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-orthoedit.apg';">$1<?/MISQL>
 <?/MIBLOCK>


            <div id="orthology"></div>

<?/MIBLOCK>

<!-------------- ends ORTHOLOGY ------------------------------------>


<!------------------ PUBLICATION ------------------------------------>

<?MICOMMENT>  09/05 Decided to count both real pub and citation fake pub, and use CITATION as title. Before any database solution, still hard code the items to extract citation pub. <?/MICOMMENT>
<?MICOMMENT>  08/25 curator's decision that we will not pull over publications from related markers, or the known locus. However, any attribution to data items automatically populated to the marker itself. <?/MICOMMENT>
<?MICOMMENT>  2005/10/25 curator's decide that all allele and locus attribution will be pulled through to the gene page. <?/MICOMMENT>

<?MICOMMENT> ----- Citation Link ----- <?/MICOMMENT>

<?MISQL
         SQL="select WebExplode(object,'citlink_data_page=citgeneric.apg') from webPages where ID='aa-citlink.apg';">$1<?/MISQL>



<!----------------- ends PUBLICATION ----------------->

</form> <?MICOMMENT> end form updater1 <?/MICOMMENT>


<?/MIBLOCK> <!-- ends cond authorize exists -->

<?/MIBLOCK> <!-- name NC novalue and romwcount > 0 -->

<?/MIBLOCK> <!-- ends cond oid exists -->

<?MISQL COND=$(XST,$debug_timing) SQL="
        execute function get_time()">
        <br>$1 Page End
<?/MISQL>

<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpagefooter.apg';">$1<?/MISQL>

<script>
  jQuery(document).ready(function () {

     $('#supplier').autocompletify('/action/marker/find-suppliers?term=%QUERY');
     $('#supplier').bind('typeahead:selected', function(obj, datum, name) {
          supplierToAddZdbID = datum.id;
      });

    <?MIVAR>
            jQuery('#orthology').load('/action/marker/$OID/orthology?update=$UPDATE');
    <?/MIVAR>

    $( "#supplier" ).keypress(function(event) {
       if (event.keyCode == 13) {
	 event.preventDefault();
	 new_supplier(supplierToAddZdbID);
       }
    });

    $('#targetGeneSymbol').autocompletify('/action/marker/find-targetGenes?term=%QUERY');
    $('#targetGeneSymbol').bind('typeahead:selected', function(obj, datum, name) {
        $('#targetGeneSymbol').val(datum.id);
    });

    $("#targetGeneSymbol" ).keypress(function(event) {
      if (event.keyCode == 13) {
         event.preventDefault();
         return false;
      }
    });

  
    $('#targetGeneSymbol2').autocompletify('/action/marker/find-targetGenes?term=%QUERY');
    $('#targetGeneSymbol2').bind('typeahead:selected', function(obj, datum, name) {
        $('#targetGeneSymbol2').val(datum.id);
    });

    jQuery( "#targetGeneSymbol2" ).keypress(function(event) {
      if (event.keyCode == 13) {
         event.preventDefault();
         return false;
      }
    });

  });
</script>

</BODY>

</HTML>


