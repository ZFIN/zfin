<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
  <title>ZFIN Gene Ontology</title>
</head>
<!--app page to enter gene ontology info-->
<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpageheader.apg';">$1<?/MISQL>
<body>
<basefont size = 2>
<?MIVAR name=$highlight><!--|HIGHLIGHT_COLOR|--><?/MIVAR>
<?MIVAR NAME=$MI_NOVALUE><?/MIVAR>
<?MIVAR NAME=$MI_NULL><?/MIVAR>
<?MIBLOCK COND="$(NXST,$OID)">
  <p>
  ERROR -- something bad happened -- no OID passed in!
<?/MIBLOCK>
<?MISQL SQL="select mrkr_zdb_id from marker where mrkr_zdb_id='$OID'"><?/MISQL>
<?MIVAR NAME=$geneid>$1<?/MIVAR>

<SCRIPT>

 function edit_rec(goevid,mrkrgoid,evidence,geneid,added) {
     helpwin=open("/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-gomodify.apg&OID="+mrkrgoid+"&goevid="+goevid+"&evidence="+evidence+"&added="+added+"&geneid="+geneid,"helpwindow","scrollbars=yes,height=675,width=550,resizable=yes");
 }

 function view_notes(goevid,mrkrgoid) {
     helpwin=open("/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-gonotes.apg&OID="+goevid+"&goid="+mrkrgoid,"helpwindow","scrollbars=yes,height=200,width=300,resizable=yes");
 }

 function call_reset() {
    document.newdata.goterm.value='';
    document.newdata.pub.value='';
    document.newdata.inf.value='';
    document.newdata.comments.value='';
    var infdbase=document.newdata.infdb[0].value;
    document.newdata.infdb.value=infdbase;
    document.newdata.evidence.value=document.newdata.evidence[0].value;
 }

 function call_refresh(geneid) {
    var GOterm=document.newdata.goterm.value;
    var pub=document.newdata.pub.value;  
    window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markergoterm.apg&OID='+GOterm+'&pub='+pub+'&gene='+geneid); 
 }

 function call_validate(geneid,gotermname,goterm) {
    var goterm=document.newdata.goterm.value;
    var pub=document.newdata.pub.value;
    window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markergoterm.apg&OID='+pub+'&gotermname='+gotermname+'&goterm='+goterm+'&gene='+geneid);
 }

 function call_valinf(geneid,gotermname,goterm) {
    var goterm=document.newdata.goterm.value;
    var infind = document.newdata.infdb.selectedIndex;
    var infdbase = document.newdata.infdb[infind].value; 
    var inf=document.newdata.inf.value;
    var pub=document.newdata.pub.value;
    var evind = document.newdata.evidence.selectedIndex;
    var evi_code = document.newdata.evidence[evind].value; 
    var mod='new';
    if (infdbase=='GO')
      {
         window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markergoinf.apg&OID='+inf+'&gotermname='+gotermname+'&goterm='+goterm+'&pub='+pub+'&evidence='+evi_code+'&mod='+mod+'&gene='+geneid);
      }
 }

 function delete_rec(mrkrgoevid,mrkrgoid,goev,geneid) {
    window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markergodelete.apg&OID='+mrkrgoevid+'&markergoid='+mrkrgoid+'&goev='+goev+'&geneid='+geneid); 
 }

 function update_notes() {
    document.newdata.comments.value=document.newdata.comments.value + ' '+ 'contributes to';
 }
 
function new_go(mrkrid) {
       var goterm = document.newdata.goterm.value;
       var evind = document.newdata.evidence.selectedIndex;
       var evi_code = document.newdata.evidence[evind].value; 
       var infind = document.newdata.infdb.selectedIndex;
       var infdbase = document.newdata.infdb[infind].value; 
       var pub = document.newdata.pub.value;
       var notes = document.newdata.comments.value;
       var inf = document.newdata.inf.value;
           if ( document.newdata.isnot.checked == true )
           {
              var isnot = 'true';
           }
           else
           {
             var isnot='false';
           }
       if (pub.length==0)
       {
        window.alert("Publication cannot be null");
       }
      else
       {  
       window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markergoupdate.apg&OID='+mrkrid+'&go_id='+goterm+'&pub_id='+pub+'&evidence_code='+evi_code+'&inf_db='+infdbase+'&inf_from='+inf+'&notes='+notes+'&is_not='+isnot);
       }
 }

</SCRIPT>  

<?MIBLOCK COND="$(XST,$OID)">
  <?MIVAR>

  <form name=newdata method = post>
  <INPUT TYPE="hidden" name="MIval" value="aa-markergoentry.apg">
  <center> <input type=button align = "center" value ="Done updating. Back to Viewing!" onclick="document.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markerview.apg&OID=$OID')"></center>
  <?MIVAR COND="$(NXST,$gotermname)" NAME=$gotermname><?/MIVAR>
  <?MIVAR NAME=$infdb COND="$(NXST,$infdb)"><?/MIVAR>
  <?MIVAR COND="$(NXST,$evidence)" NAME=$evidence><?/MIVAR>
  <?MIVAR COND="$(NXST,$pub)" NAME=$pub><?/MIVAR>
  <p>
  <p> 
  <p>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://www.godatabase.org/cgi-bin/go.cgi" target="_window"><b>AmiGO</b></a>
  &nbsp;&nbsp;&nbsp;
  <a href="http://www.ebi.ac.uk/ego/" target="_window"><b>QuickGO</b></a>
  <p>

<!--Creating the entry form-->
  <table border=0 width = 100% cellspacing=10 cellpadding=0>

  <tr><td align=right>
    <b>GO Term ID</b></td>
    <td width = 10%> <input type=text 
	NAME = "goterm" size = "23" tabindex = 1 onChange=call_refresh('$OID') 
    <?MIBLOCK COND="$(XST,$goterm)">value=<?MIVAR>GO:$goterm<?/MIVAR>><?/MIBLOCK> 
    </td>
    <td><b><i><?MIVAR>$gotermname<?/MIVAR></i></b></td>
    <?MIVAR NAME=$gotermenc>$(URLENCODE,$gotermname)<?/MIVAR>
    <td></td>
    <td align=right><b>NOT</b>
    <td><input type=checkbox name=isnot></td>
    <tr><td align=right><b>Publication</b>
    <?MIVAR>
       <td><input type = text NAME = "pub" tabindex = 2 size = "23" onChange=call_validate('$OID','$gotermenc')<?MIBLOCK COND="$(XST,$pub)"> value=<?MIVAR>$pub<?/MIVAR>><?/MIBLOCK></td>
    <?/MIVAR>
    <td align=right><b>Evidence Code </b></td> 

<!--since $evidence may or may not be NULL, there can be 2 kinds of combo boxes-->
    <?MIBLOCK COND="$(=,$(STRLEN,$evidence),0)">
       <td><select name=evidence tabindex = 3><?MISQL SQL="select goev_code from go_evidence_code"><option value="$1">$1<?/MISQL></select></td>
    <?MIELSE>
       <td><select name=evidence tabindex = 3><option value=<?MIVAR>$evidence<?/MIVAR>><?MIVAR>$evidence<?/MIVAR><?MISQL SQL="select goev_code from go_evidence_code where goev_code<>'$evidence'"><option value="$1">$1<?/MISQL></select></td>
   <?/MIBLOCK>

<!--since $infdb may or may not be NULL, there can be 2 kinds of combo boxes-->
    <td align=right><b>Inferred from </b>
    <?MIBLOCK COND="$(=,$(STRLEN,$infdb),0)">
     <td><select name=infdb tabindex = 4><option value=ZFIN>ZFIN<option value=GO>GO<?MISQL SQL="select distinct fdbcont_fdb_db_name from foreign_db_contains where fdbcont_fdb_db_name in ('Genbank','RefSeq','SWISS-PROT','InterPro','GenPept')"><option value="$1">$1<?/MISQL></select>
    <?MIELSE>
     <td><select name=infdb tabindex = 4><option value=<?MIVAR>$infdb<?/MIVAR>><?MIVAR>$infdb<?/MIVAR><option value=ZFIN>ZFIN<?MISQL SQL="select distinct fdbcont_fdb_db_name from foreign_db_contains where fdbcont_fdb_db_name in ('Genbank','RefSeq','SWISS-PROT','InterPro','GenPept')"><option value="$1">$1<?/MISQL></select>
    <?/MIBLOCK>

    <td><input type = text NAME = "inf"  tabindex = 5 size = "23" onChange=call_valinf('$OID','$gotermenc')
    <?MIBLOCK COND="$(XST,$inf)">value=<?MIVAR>$inf<?/MIVAR>><?/MIBLOCK></td>

  </tr>
  </table>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <b>Notes</b></br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <textarea rows=5 cols=50 tabindex = 6 name=comments></textarea>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <input type=button name=addnote value="Contributes to (For molecular function annotations only)" align = center onClick=update_notes()>
  <p>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <?MIVAR>
    <input type=button name=addnew value="Add GO Annotation" size = "10" align = center onClick=new_go('$OID')>
  <?/MIVAR>

  <input type = button name = clear value = "Clear" size = "10" align = "center" onClick=call_reset()>
  <p>

  <hr>
  <?MISQL SQL="
        select fdb_db_query from foreign_db where fdb_db_name='QuickGO';">
   <?MIVAR NAME=$dbquery>$1<?/MIVAR>
  <?/MISQL>

<!--creating table to display added GO annotations-->

  <table border = 0 cellspacing = 0 width = 100% cellpadding = 3>
  <tr><td width = 10%><b>Category</b>
  <!--<td width=10%><b>Is NOT</b>-->
  <td><b>GO Term</b>
  <td width=10%><b>Evidence</b></td>
  <td width=10%><b>Inferred From</b>
  <td width=10%><b>Reference(s)</b>
  <td width=10%><b>Notes</b>
  <td></td> <!--For Notes button-->
  <td></td> <!--For Edit button-->

  <?MIVAR name=$highlight><!--|HIGHLIGHT_COLOR|--><?/MIVAR>
  <?MIVAR name=$row_color>$highlight<?/MIVAR>

  <?MIVAR NAME=$lastonto><?/MIVAR>
  <?MIVAR NAME=$lastgoterm><?/MIVAR>
  <?MIVAR NAME=lastevidence><?/MIVAR>
  <?MIVAR NAME=$lastpub><?/MIVAR>
  <?MIVAR NAME=lastinf><?/MIVAR>
  <?MIVAR NAME=infvector><?/MIVAR>


   <?MIVAR NAME=SQL>select  distinct goterm_ontology,goterm_name,mrkrgoev_evidence_code,gont_order,mrkrgo_zdb_id,goterm_go_id,mrkrgoev_zdb_id,mrkrgoev_infered_from,mrkrgoev_source_zdb_id,mrkrgo_go_term_zdb_id,mrkrgoev_notes,m.mrkrgo_is_false_ref from go_term g, marker_go_term_evidence e,marker_go_term m, go_ontology o where mrkrgo_mrkr_zdb_id='$OID' and m.mrkrgo_go_term_zdb_id=g.goterm_zdb_id and m.mrkrgo_zdb_id=e.mrkrgoev_mrkrgo_zdb_id and g.goterm_ontology=o.gont_ontology_name order by gont_order,goterm_name<?/MIVAR>

   <?MISQL SQL="select  distinct goterm_ontology,goterm_name,mrkrgoev_evidence_code,gont_order,mrkrgo_zdb_id,goterm_go_id,mrkrgoev_zdb_id,mrkrgoev_infered_from,mrkrgoev_source_zdb_id,mrkrgo_go_term_zdb_id,mrkrgoev_notes,m.mrkrgo_is_false_ref from go_term g, marker_go_term_evidence e,marker_go_term m, go_ontology o where mrkrgo_mrkr_zdb_id='$OID' and m.mrkrgo_go_term_zdb_id=g.goterm_zdb_id and m.mrkrgo_zdb_id=e.mrkrgoev_mrkrgo_zdb_id and g.goterm_ontology=o.gont_ontology_name order by gont_order,goterm_name">
   <?MIVAR>
     <tr bgcolor=$row_color>
   <?/MIVAR>
   <?MIVAR NAME=$ontology>$1<?/MIVAR>
   <?MIVAR NAME=$goterm>$2<?/MIVAR>
   <?MIVAR NAME=$markergotermid>$5<?/MIVAR>
   <?MIVAR NAME=$markergoevid>$7<?/MIVAR>
   <?MIVAR NAME=$markergonotes>$11<?/MIVAR>
   <?MIVAR NAME=$markergoisnot>$12<?/MIVAR>
   <?MIVAR NAME=$evidence>$(TRIM,$3)<?/MIVAR>
   <?MIVAR NAME=$sourcezdbid>$9<?/MIVAR>

<!--display changes depending whether it is a NOT annotation or not-->
   <?MIBLOCK COND="$(EC,$markergoisnot,t)">
      <?MIVAR NAME=$not><b>NOT</b><?/MIVAR>
   <?MIELSE>
      <?MIVAR NAME=$not> <?/MIVAR>
   <?/MIBLOCK>

<!--getting count of pubs for a particular annotation-->
   <?MISQL SQL="select count(distinct mrkrgoev_source_zdb_id) from marker_go_term_evidence where mrkrgoev_mrkrgo_zdb_id='$5' and mrkrgoev_evidence_code='$3'">
     <?MIVAR NAME=$refcount>$(FIX,$1)<?/MIVAR>
   <?/MISQL>

<!--now displaying annotations-->
    <?MIBLOCK COND="$(AND,$(EC,$1,$lastonto),$(EC,$lastgoterm,$2),$(EC,$lastevidence,$3))">
   <?MIELSE>
     <?MIVAR>
     <td>$(IF,$(NC,$ontology,$lastonto),$ontology)</td>
     <!-- <td>$markergoisnot</td>-->
     <td>$not <A HREF=$dbquery$6>$2</A></TD>
     <TD><A HREF="http://www.geneontology.org/doc/GO.evidence.html">$3</A></TD>
     <?MIVAR NAME=$inf_from>$8<?/MIVAR>
     <?MIVAR NAME=infvector> <?/MIVAR>
     <?MIVAR NAME=currinfs> <?/MIVAR>

     <!--getting inferences for a particular annotation-->
     <?MISQL SQL="select distinct mrkrgoev_infered_from from marker_go_term_evidence where mrkrgoev_mrkrgo_zdb_id='$markergotermid' and mrkrgoev_evidence_code='$evidence'">
      <?MIVAR NAME=currinf>$1<?/MIVAR>
      <?MIVAR NAME=$ref>select distinct mrkrgoev_infered_from from marker_go_term_evidence where mrkrgoev_mrkrgo_zdb_id='$markergotermid' and mrkrgoev_evidence_code='$evidence'<?/MIVAR>
      <?MIVAR NAME=$currinflength>$(STRLEN,$currinf)<?/MIVAR>
      <?MIBLOCK COND="$(AND,$(NC,$currinf,NULL),$(>,$currinflength,0))">
         <?MIVAR NAME=$colon>:<?/MIVAR>
         <?MIVAR NAME=$pos>$(POSITION,$currinf,$colon)<?/MIVAR>
         <?MIVAR NAME=$posn>$(-,$pos,1)<?/MIVAR>
         <?MIVAR NAME=$dbase>$(SUBSTR,$currinf,1,$posn)<?/MIVAR>
         <?MIVAR NAME=$currinflength>$(STRLEN,$currinf)<?/MIVAR>
         <?MIVAR NAME=$position>$(+,$pos,1)<?/MIVAR>
         <?MIVAR NAME=$accID>$(SUBSTR,$currinf,$position,$currinflength)<?/MIVAR>
          <?MIBLOCK COND="$(EC,$dbase,ZFIN)">
              <?MIVAR NAME=$encaccID>$(URLENCODE,$accID)<?/MIVAR>
              <?MIVAR NAME=$currinflink><a href=http://zfin.org/cgi-bin/ZFIN_jump?record=$encaccID>$accID</a><?/MIVAR>
          <?MIELSE>
               <?MIBLOCK COND="$(EC,$dbase,GO)">
                  <?MISQL SQL="select fdb_db_query from foreign_db  where fdb_db_name = 'QuickGO'"><?/MISQL>
                  <?MIVAR NAME=query>$1<?/MIVAR>
                  <?MIVAR NAME=$accID>$(SUBSTR,$accID,4,$(STRLEN,$accID))<?/MIVAR>
                  <?MIVAR NAME=$link>$query$accID<?/MIVAR>
                  <?MIVAR NAME=$currinflink><a href=$link>GO:$accID</a><?/MIVAR>
               <?MIELSE> 
                  <?MISQL SQL="select fdb_db_query from foreign_db where fdb_db_name = '$dbase'"><?/MISQL>
                  <?MIVAR NAME=query>$1<?/MIVAR>
                  <?MIVAR NAME=$link>$query$accID<?/MIVAR>
                  <?MIVAR NAME=$currinflink><a href=$link>$dbase:$accID</a><?/MIVAR>
               <?/MIBLOCK>
           <?/MIBLOCK>
       <?MIVAR NAME=currinfs>$(IF,$(=,$MI_CURRENTROW,1),$currinflink$currinfs,$currinfs<br>$currinflink)<?/MIVAR>
       <?MIELSE>
        <?MIVAR NAME=currinfs> <?/MIVAR>
       <?/MIBLOCK>
     <?/MISQL>
     <td><?MIVAR>$currinfs<?/MIVAR></td>

<!--depening on pub count, call pubview or showpubs-->
 
     <?MIBLOCK COND="$(>,$refcount,1)">
       <?MIVAR NAME=$titleexp>Gene Ontology Pubs<?/MIVAR>
       <?MIVAR NAME=$name><?/MIVAR>
       <?MIVAR>
         <td align=center><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-showpubs.apg&OID=<?MIVAR>$5<?/MIVAR>&rtype=go&title=$(URLENCODE,$titleexp)&name=$(URLENCODE,$name)&evidence=$evidence"><?MIVAR>$refcount<?/MIVAR></a></td><?/MIVAR>
     <?MIELSE>
<?MISQL SQL="select mrkrgoev_source_zdb_id from marker_go_term_evidence,marker_go_term where mrkrgo_go_term_zdb_id='$10' and mrkrgoev_mrkrgo_zdb_id=mrkrgo_zdb_id and mrkrgoev_mrkrgo_zdb_id='$5' and mrkrgoev_evidence_code='$evidence'">
       <?MIVAR NAME=$refid>$1<?/MIVAR>
      <?/MISQL>
      <td align=center><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-pubview2.apg&OID=<?MIVAR>$refid<?/MIVAR>"><?MIVAR>$refcount<?/MIVAR></a></td>
     <?/MIBLOCK>

    <?MIBLOCK COND="$(NC,$markergonotes,)">
      <?MIVAR><td width = 10%><input type = button value = "Notes" name = notes onClick=view_notes('$markergoevid','$markergotermid')></td><?/MIVAR>
    <?MIELSE>
      <td></td>
    <?/MIBLOCK>

   <td><input type = button value = "Edit" name = edit onClick=edit_rec('$markergoevid','$markergotermid','$evidence','$geneid',false)></td>

<!--Add evidence code as a parameter here-->
   <td><input type = button value = "Delete" name = edit onClick=delete_rec('$markergoevid','$markergotermid','$evidence','$geneid')></td></tr>


<?MIVAR NAME=$row_color>$(IF,$(EC,$row_color,$highlight),#FFFFFF,$highlight)<?/MIVAR>
<?/MIVAR>
<?/MIBLOCK>
$(SETVAR,$lastonto,$1)
$(SETVAR,$lastgoterm,$2)
$(SETVAR,$lastevidence,$3)
$(SETVAR,$lastpub,$9)
$(SETVAR,$lastinf,$8)
<?/MISQL>
<?MISQL SQL="execute function get_time()"><?/MISQL>
</table>
<hr>
<p>
<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpagefooter.apg';">$1<?/MISQL>

</form>
<?/MIVAR>

<?/MIBLOCK>
