<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
</head>
<!--app page to enter gene ontology info-->
<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpageheader.apg';">$1<?/MISQL>

<?MIERROR>
  <?MIVAR COND=$(XST,$MI_SQL)>
    SQL: $MI_SQL<br><br>
  <?/MIVAR>

  Code:    $MI_ERRORCODE <br>
  State:   $MI_ERRORSTATE <br>
  Message: $MI_ERRORMSG <br>

<?/MIERROR>
<?MIVAR name=$highlight><!--|HIGHLIGHT_COLOR|--><?/MIVAR>  
<?MIVAR name=$highlighter><!--|HIGHLIGHTER_COLOR|--><?/MIVAR>
<?MIVAR name=$white>#ffffff<?/MIVAR>
<?MIVAR NAME=$MI_NOVALUE><?/MIVAR>
<?MIVAR NAME=$MI_NULL><?/MIVAR>
<?MIVAR NAME=qualifier>false<?/MIVAR>
<?MIBLOCK COND="$(NXST,$OID)">
  <p>
  ERROR -- something bad happened -- no OID passed in!
<?/MIBLOCK>

 
<?MISQL COND="$(NXST,$UPDATE)" SQL="select WebExplode(object,'') from webPages where ID='aa-secure_navigation.apg';">$1
<?/MISQL>

<?MISQL COND="$(XST,$UPDATE)" SQL="select WebExplode(object,'permission=owns&rtype=marker') from webPages where ID='aa-secure_navigation.apg';">$1
<?/MISQL>

<?MIBLOCK COND="$(NC,$AUTHORIZED,false)">

<?MISQL SQL="select mrkr_zdb_id from marker where mrkr_zdb_id='$OID'"><?/MISQL>
<?MIVAR NAME=$geneid>$1<?/MIVAR>
<?mivar name=$caller>$(SUBSTR,$OID,5,3)<?/mivar>
<?MISQL SQL="select mrkr_abbrev,mrkr_name from marker where mrkr_zdb_id='$OID'"><?/MISQL>
<?MIVAR NAME=$gene>$1<?/MIVAR>
<?MIVAR NAME=$name>$2<?/MIVAR>

<head>
<title>ZFIN: GO Details: <?MIVAR> $gene <?/MIVAR>
</title>
</head>

<?MICOMMENT>
<table width="15%" align=right>
   <tr>
   <?MIVAR>
        <form method=post
              action="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->"
              target=comments>
           <input type=hidden name=subject value="$gene">
           <input type=hidden name=marker_id value="$OID">
           <input type=hidden name=MIval value="aa-your_input_welcome.apg">
           <input type=hidden name=page_id value="$OID">
           <td><input type=submit value="Your Input Welcome"></td>
         </form>
    <?/MIVAR>
    </tr>
</table>
<?/MICOMMENT>

<?MIBLOCK COND="$(XST,$OID)">
 <?MIBLOCK COND="$(NC,PUB,$caller)">
     <?MISQL COND="$(NXST,$UPDATE)" SQL="select WebExplode(object,'rtype=go') from webpages where ID='aa-data_mgr.apg';">$1<?/MISQL>

<?MIVAR name=left_tab>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<?/MIVAR>
    <TABLE width=100%>
      <TR bgcolor=#cccccc>
        <TD>
          <FONT SIZE=+1><b>GO Details</b></FONT>
        </TD>
      </TR>
    </TABLE>
<?MIVAR NAME=link_backto_OID><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markerview.apg&OID=$OID"><i>$gene</i></a><?/MIVAR>
<!------------- Title display------------>
    <table border=0 width=100%>
      <tr>
        <td>
          <font><b>
          <?MIVAR>
              Gene Name: <i>$name</i><br>
              Gene Symbol: $link_backto_OID

          <?/MIVAR>
          </b></font>
        </td>
        <td>
          <?MIBLOCK COND="$(NXST,$UPDATE)">
            <table width="15%" align=right>
             <tr>
<?MIVAR>
                  <form method=post
                        action="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->"
                        target=comments>
                     <input type=hidden name=subject value="$gene">
                     <input type=hidden name=marker_id value="$OID">
                     <input type=hidden name=MIval value="aa-your_input_welcome.apg">
                     <input type=hidden name=page_id value="$OID">
                     <td><input type=submit value="Your Input Welcome"></td>

                   </form>
              <?/MIVAR>
              </tr>
             </table>
          <?/MIBLOCK>
        </td>
      </tr>
    </table>


<?MICOMMENT>

<table width="15%" align=right>
   <tr>
   <?MIVAR>
        <form method=post
              action="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->"
              target=comments>
           <input type=hidden name=subject value="$gene">
           <input type=hidden name=marker_id value="$OID">
           <input type=hidden name=MIval value="aa-your_input_welcome.apg">
           <input type=hidden name=page_id value="$OID">
           <td><input type=submit value="Your Input Welcome"></td>
         </form>
    <?/MIVAR>
    </tr>
</table>
<?/MICOMMENT>
<p>
<p>
<p>
 <?MISQL SQL="select fdb_db_query from foreign_db where fdb_db_name='QuickGO'"><?/MISQL>
   <?MIVAR NAME=$dbquery>$1<?/MIVAR>
 
<?MISQL SQL="select mrkrgoev_zdb_id from marker_go_term_evidence where mrkrgoev_mrkr_zdb_id='$OID'">
  <?MIVAR NAME=evid>$1<?/MIVAR>
  <?MISQL SQL="select count(*) from go_evidence_flag where goevflag_mrkrgoev_zdb_id='$evid'">
     <?MIBLOCK COND="$(>,$1,0)">
        <?MIVAR NAME=qualifier>true<?/MIVAR>
     <?/MIBLOCK>    
  <?/MISQL>
 
<?/MISQL>

<!--creating table to display added GO annotations-->
<p><p>

  <table border = 0 cellspacing = 0 width = 100% cellpadding=0>
  <tr bgcolor=#cccccc height=25><td><b>Ontology</b></td>
  <?MIVAR COND="$(EC,$qualifier,true)">
	<td><b>Qualifier</b></td>
  <?/MIVAR>
  <td nowrap><b>GO Term</b>
  <td><b>Evidence</b></td>
  <td nowrap><b>Inferred From</b>
  <td><b>Reference(s)</b>

  <?MIVAR name=$row_color>$white<?/MIVAR>

  <?MIVAR NAME=lastonto><?/MIVAR>
  <?MIVAR NAME=lastgoterm><?/MIVAR>
  <?MIVAR NAME=lastevidence><?/MIVAR>
  <?MIVAR NAME=lastflag><?/MIVAR>
  <?MIVAR NAME=lasthasinf><?/MIVAR>

<?MISQL SQL="
       select goterm_ontology,goterm_name,mrkrgoev_evidence_code,gont_order,goterm_go_id,
	      mrkrgoev_go_term_zdb_id,mrkrgoev_zdb_id, mrkrgoev_source_zdb_id,
	      mrkrgoev_notes, goevflag_gflag_name 
	 from go_term, marker_go_term_evidence, go_ontology, outer go_evidence_flag
	where mrkrgoev_mrkr_zdb_id='$OID' 
	  and mrkrgoev_go_term_zdb_id=goterm_zdb_id 
	  and goterm_ontology=gont_ontology_name 
	  and mrkrgoev_zdb_id = goevflag_mrkrgoev_zdb_id
        order by 4,2,3 " 
>


   <?MIVAR NAME=$ontology>$1<?/MIVAR>
   <?MIVAR NAME=$goterm>$2<?/MIVAR>
   <?MIVAR NAME=$evidence>$(TRIM,$3)<?/MIVAR>
   <?MIVAR NAME=$goid>$5<?/MIVAR>
   <?MIVAR NAME=$gozdbid>$6<?/MIVAR>
   <?MIVAR NAME=$markergoevid>$7<?/MIVAR>
   <?MIVAR NAME=$sourcezdbid>$8<?/MIVAR>
   <?MIVAR NAME=$markergonotes>$9<?/MIVAR>
   <?MIVAR NAME=$flag>$10<?/MIVAR>
   <?MIVAR NAME=isnot>f<?/MIVAR>
   <?MIVAR NAME=contribs>f<?/MIVAR>
   <?MIVAR COND="$(EC,$flag,not)" NAME=$isnot>t<?/MIVAR>
   <?MIVAR COND="$(EC,$flag,contributes to)" NAME=$contribs>t<?/MIVAR>

   <?MIBLOCK COND="$(EC,$isnot,t)">
 	 <?MIVAR NAME=not>NOT<?/MIVAR>
   <?MIELSE>
  	<?MIVAR NAME=not><?/MIVAR>
   <?/MIBLOCK>

   <?MIVAR NAME=has_inf>f<?/MIVAR>
   <?MISQL SQL="select * from inference_group_member where infgrmem_mrkrgoev_zdb_id = '$markergoevid'"><?/MISQL>
   <?MIVAR COND="$(>,$MI_ROWCOUNT,0)" NAME=has_inf>t<?/MIVAR>

   <?MIVAR NAME=infername><?/MIVAR>

   <?MIBLOCK COND="$(AND,$(NC,$lastonto,),$(NC,$ontology,$lastonto))">
      <tr bgcolor=#aaaaaa>
      <?MIVAR COND="$(EC,$qualifier,true)"><td colspan=6><img src="/images/transp.gif" width="1" height="1"></td><?/MIVAR>
      <?MIVAR COND="$(NC,$qualifier,true)"><td colspan=5><img src="/images/transp.gif" width="1" height="1"></td><?/MIVAR>
      </tr>
   <?/MIBLOCK>

   <!--now displaying annotations-->
   <?MIBLOCK COND="$(OR,$(NC,$ontology,$lastonto),$(NC,$lastgoterm,$goterm),$(NC,$lastevidence,$evidence),$(NC,$flag,),$(NC,$flag,$lastflag),$(EC,$has_inf,t),$(NC,$has_inf,$lasthasinf))">

     <tr bgcolor=<?MIVAR>$row_color<?/MIVAR> height=25>

     <?MIVAR>
     <td nowrap>$(IF,$(NC,$ontology,$lastonto),$ontology)</td> 
     <?MIBLOCK COND="$(EC,$qualifier,true)">
       <?MIBLOCK COND="$(EC,$contribs,t)">
        <td nowrap><i><?MIVAR><i>$not</i><?/MIVAR> Contributes to<i></td>
       <?MIELSE>
        <td nowrap><i><?MIVAR><i>$not</i><?/MIVAR></td>
       <?/MIBLOCK>
     <?/MIBLOCK>
     <td><A HREF=$dbquery$goid>$goterm</A></TD>
     <td nowrap><A HREF="http://www.geneontology.org/doc/GO.evidence.html#$(LOWER,$evidence)">$evidence</A></TD>

     <?MIVAR NAME=currinfs><?/MIVAR>
     <?MIVAR NAME=$infs><?/MIVAR>
     <?MISQL SQL="select infgrmem_inferred_from from inference_group_member where infgrmem_mrkrgoev_zdb_id='$markergoevid'"><?/MISQL>
     <?MIVAR NAME=$infcount>$MI_ROWCOUNT<?/MIVAR>
     <?MISQL SQL="select infgrmem_inferred_from 
		    from inference_group_member 
		   where infgrmem_mrkrgoev_zdb_id='$markergoevid'">
        <?MIVAR NAME=$infername>$1<?/MIVAR>
     	<?MIVAR NAME=$colon>:<?/MIVAR>
     	<?MIVAR NAME=$comma>,<?/MIVAR>
     	<?MIVAR NAME=$pos>$(POSITION,$infername,$colon)<?/MIVAR>
     	<?MIVAR NAME=$posn>$(-,$pos,1)<?/MIVAR>
     	<?MIVAR NAME=$dbase>$(SUBSTR,$infername,1,$posn)<?/MIVAR>
     	<?MIVAR NAME=$currinflength>$(STRLEN,$infername)<?/MIVAR>
     	<?MIVAR NAME=$position>$(+,$pos,1)<?/MIVAR>
     	<?MIVAR NAME=$accID>$(SUBSTR,$infername,$position,$currinflength)<?/MIVAR>
     	<?MIBLOCK COND="$(EC,$dbase,ZFIN)">
	   <?MIVAR NAME=inf_mem_sym><?/MIVAR>
	   <?MISQL COND="$(>,$(POSITION,$accID,GENO),0)" SQL="
		select geno_display_name
		  from genotype
		 where geno_zdb_id = '$accID'">
	      <?MIVAR NAME=inf_mem_sym>$1<?/MIVAR>	
	   <?/MISQL>
 	   <?MISQL COND="$(=,$(POSITION,$accID,GENO),0)" 
		   SQL="
		select mrkr_abbrev
		  from marker
		 where mrkr_zdb_id = '$accID'">
	      <?MIVAR NAME=inf_mem_sym>$1<?/MIVAR>	
	   <?/MISQL>
           <?MIBLOCK COND="$(=,$(POSITION,$accID,MRPHLNO),0)">
	      <?MIVAR NAME=inf_mem_sym><i>$inf_mem_sym</i><?/MIVAR>	
           <?MIELSE>
	      <?MIVAR NAME=inf_mem_sym>$inf_mem_sym<?/MIVAR>	
           <?/MIBLOCK>
           <?MIVAR NAME=$currinflink><a href="/<!--|CGI_BIN_DIR_NAME|-->/ZFIN_jump?record=$accID">$inf_mem_sym</a><?/MIVAR>
    	<?MIELSE COND="$(EC,$dbase,GO)">
         	<?MISQL SQL="select fdb_db_query from foreign_db where fdb_db_name ='QuickGO'"><?/MISQL>
          	<?MIVAR NAME=query>$1<?/MIVAR>
          
          	<?MIVAR NAME=$link>$query$accID<?/MIVAR>
          	<?MIVAR NAME=$currinflink><a href=$link>GO:$accID</a><?/MIVAR>
        <?MIELSE>
          <?MISQL SQL="select a.fdb_db_query from foreign_db a where a.fdb_db_name='$dbase'"><?/MISQL>
          <?MIVAR NAME=query>$1<?/MIVAR>
          <?MIVAR NAME=$link>$query$accID<?/MIVAR>
          <?MIVAR NAME=$currinflink><a href=$link>$dbase:$accID</a><?/MIVAR>
       <?/MIBLOCK>
 
       <?MIVAR NAME=infs>$(IF,$(>,$infcount,1),$currinflink<br>$infs,$(TRIM,$infs)$currinflink)<?/MIVAR>
    <?/MISQL>
    <td nowrap><?MIVAR>$infs<?/MIVAR> </td>

    <?MIVAR NAME=pubcount>1<?/MIVAR>
    <?MICOMMENT>in case this annotation has no qualifier and inference group,
		we check to see if other annotation with the same marker, goterm, evidence
		has qualifier or inference group. if both no, group the publication
    <?/MICOMMENT> 
    <?MIBLOCK COND="$(AND,$(EC,$flag,),$(EC,$has_inf,f))"> 
       <?MISQL SQL="select * 
		   from marker_go_term_evidence
     		  where mrkrgoev_evidence_code='$evidence' 
		    and mrkrgoev_mrkr_zdb_id='$OID'
		    and mrkrgoev_go_term_zdb_id ='$gozdbid'
		    and mrkrgoev_zdb_id <> '$markergoevid'
                    and exists (select 'x' from inference_group_member
     where mrkrgoev_zdb_id = infgrmem_mrkrgoev_zdb_id
      union
    select 'x' from go_evidence_flag
      where mrkrgoev_zdb_id = goevflag_mrkrgoev_zdb_id) ;
       <?/MISQL>
       <?MISQL COND="$(=,$MI_ROWCOUNT,0)" SQL="
		 select count(distinct mrkrgoev_source_zdb_id) 
		   from marker_go_term_evidence
		  where mrkrgoev_evidence_code='$evidence' 
		    and mrkrgoev_mrkr_zdb_id='$OID'
		    and mrkrgoev_go_term_zdb_id ='$gozdbid'">
             <?MIVAR NAME=pubcount>$(FIX,$1)<?/MIVAR>
    	<?/MISQL>
     <?/MIBLOCK>   
    
     <?MIBLOCK COND="$(EC,$pubcount,1)">
      <td align=center><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-pubview2.apg&OID=<?MIVAR>$sourcezdbid<?/MIVAR>"><?MIVAR>$pubcount<?/MIVAR></a></td></tr>
    <?MIELSE>
       <?MIVAR NAME=$titleexp>Gene Ontology Pubs<?/MIVAR>
       <?MIVAR NAME=$name><?/MIVAR>
       <?MIVAR>
         <td align=center><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-showpubs.apg&OID=$OID&rtype=goview&title=$(URLENCODE,$titleexp)&name=$(URLENCODE,$name)&goterm=$gozdbid&evidence=$evidence&total_count=$pubcount"><?MIVAR>$pubcount<?/MIVAR></a></td></tr><?/MIVAR>
    <?/MIBLOCK>

    <?MIVAR NAME=$row_color>$(IF,$(EC,$row_color,$highlighter),$white,$highlighter)<?/MIVAR>
  
  $(SETVAR,$lastonto,$ontology)
  $(SETVAR,$lastgoterm,$goterm)
  $(SETVAR,$lastevidence,$evidence)
  $(SETVAR,$lastflag,$flag)
  $(SETVAR,$lasthasinf,$has_inf)

 <?/MIVAR> 
 <?/MIBLOCK>
<?/MISQL>
</table>
<hr>
<p>
<?/MIBLOCK>
<?/MIBLOCK> <?MICOMMENT>-- end of OID check--<?/MICOMMENT>
<?/MIBLOCK> <?MICOMMENT>-- end of AUTHORIZED check--<?/MICOMMENT>

<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpagefooter.apg';">$1<?/MISQL>
