<HTML>

<?MIERROR>
  <?MIVAR COND=$(XST,$MI_SQL)>
    SQL: $MI_SQL<br><br>
  <?/MIVAR>

  Code:    $MI_ERRORCODE <br>
  State:   $MI_ERRORSTATE <br>
  Message: $MI_ERRORMSG <br>

<?/MIERROR>

<?MICOMMENT>
//------------------------------------------------------------------//
  Check for input variable and return an error if they don't exist.
//------------------------------------------------------------------//
<?/MICOMMENT>

<?MIBLOCK COND="$(NXST,$OID)">
  <p>
  ERROR -- something bad happened -- no OID passed in!
<?/MIBLOCK>

<?MIVAR NAME=$target_table>marker<?/MIVAR>

<SCRIPT> <!-- functions for undate--------------------->
   <?MIVAR COND="$(XST,$UPDATE)">
	function doit(attr,attr_type,print_name) {
		window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markerupdate.apg&OID=$OID&attr='+attr+'&attr_type='+attr_type+'&print_name='+print_name+'&target_table=$target_table&caller=sequence.apg');
	}

	function Delete_listitem(item_name,item_id) {
		window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr='+item_name+'&attr_type=special-listitem&old_value='+item_id+'&new_value=deleted&target_table=$target_table&caller=sequence.apg');
	}	

        <?MISQL SQL="select WebExplode(object,'jsdelatt_OID=$OID&jsdelatt_Mival=aa-do-markerupdate.apg&jsdelatt_page_var=__attr_type=special-listitem__new_value=deleted__caller=sequence.apg__target_table=$target_table') 
        from webPages where ID='aa-js-delete_attrib.apg';">$1<?/MISQL>

	function new_attrib_seq() {
		var seq_acc = document.updater.attrib_seq_acc.value;
		var pub_id = document.updater.attrib_seq_pubid.value.toUpperCase();
		if((seq_acc != '')&&(pub_id != '')) {
			window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=recattrib&attr_type=special-newattrib&old_value='+seq_acc+'&new_value='+pub_id+'&target_table=$target_table&info=seqacc&caller=sequence.apg');
		}
	}
	function new_seqnum() {
		var dbind=document.updater.seqdb.selectedIndex;
		var dbname=document.updater.seqdb[dbind].value;
		var seq_acc=document.updater.seq_acc.value;
		var dbind=document.updater.seq_super.selectedIndex;
		var seq_type=document.updater.seq_super[dbind].value;
		if ((seq_acc != '')&& (dbname == 'GenBank')) {
		 window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=seqnum&attr_type=special-check-newseqnum&old_value='+dbname+'&new_value='+seq_acc+'&target_table=marker&fdbcont_super='+seq_type+'&caller=sequence.apg');
		}
		else if (seq_acc != '') {
		 window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&attr=seqnum&attr_type=special-newseqnum&old_value='+dbname+'&new_value='+seq_acc+'&target_table=marker&fdbcont_super='+seq_type+'&caller=sequence.apg');
		}
	}

	function update_seqnum() {
		var dbind=document.updater.upd_seq_zdb.selectedIndex;
		var seq_zdb=document.updater.upd_seq_zdb[dbind].value;
		var seq_len=document.updater.upd_seq_length.value;
		var dbind=document.updater.upd_seq_type.selectedIndex;
		var seq_type=document.updater.upd_seq_type[dbind].value;
		if (seq_zdb != '') {
		 window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-markerupdate.apg&OID=$OID&caller=sequence.apg&attr=seqnum&attr_type=special-updateseqnum&old_value=dblink_length&new_value='+seq_len+'&target_table=marker&dataOID='+seq_zdb+'&xtra_param='+seq_type+'&caller=sequence.apg');
		}
	}
  <?/MIVAR>

    function start_help() {
     top.zfinhelp=open('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-helpframes.html&calling_page=sequence_tools_help.html',"helpwindow","scrollbars=yes,toolbar=no,directories=no,menubar=no,status=no,resizable=yes,width=800,height=600");
    }
</SCRIPT>

    <?MISQL SQL="
      SELECT mrkr_name, mrkr_abbrev, mrkr_type
      FROM marker
      WHERE mrkr_zdb_id = '$OID';">

      <?MIVAR NAME=mrkr_name>$1<?/MIVAR>
      <?MIVAR NAME=mrkr_abbrev>$2<?/MIVAR>
      <?MIVAR NAME=mrkr_type>$3<?/MIVAR>

    <?/MISQL>

      <?MIVAR NAME=link_backto_OID><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markerview.apg&OID=$OID$(IF,$(XST,$UPDATE),&UPDATE=1)">$(IF,$(!=,$(POSITION,$OID,GENE),0),<i>)$mrkr_abbrev$(IF,$(!=,$(POSITION,$OID,GENE),0),</i>)</a><?/MIVAR>

  <!-- if no match for the entered ID, display not found msg ------>
  <?MIBLOCK COND="$(OR,$(EC,$mrkr_name,$MI_NOVALUE),$(=,$MI_ROWCOUNT,0))">
     <!-- page header display ----------------->
     <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpageheader.apg';">$1<?/MISQL>
     <!-- look to see if replaced zdb_id -->
     <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-zdb_history.apg';">$1<?/MISQL>

     <?MIBLOCK COND="$(NXST,$new_oid)">
       <form><center><font size=4>
        <?MIVAR> <b>Requested ID not found on ZFIN.<?/MIVAR>
       </form>
     <?/MIBLOCK>


  <?MIELSE> <!-- if entered ID has an entry in ZFIN------------------------>



  <?MISQL COND="$(NXST,$UPDATE)" SQL="select WebExplode(object,'page_title=View $mrkr_type') from webPages where ID='aa-secure_navigation.apg';">$1
  <?/MISQL>

  <!-- If updating, only let owner update anything -->
  <?MISQL COND="$(XST,$UPDATE)" SQL="select WebExplode(object,'page_title=Update Gene&permission=owns&rtype=$target_table') from webPages where ID='aa-secure_navigation.apg';">$1
  <?/MISQL>


  <?MIBLOCK COND="$(NC,$AUTHORIZED,false)"> <!-- if authorized---------->

    <!-- title for webpage history ----------->
    <?MIBLOCK COND="$(XST,$UPDATE)">
      <?MIVAR>
        <TITLE>Update Sequence info: $mrkr_abbrev</title>
      <?/MIVAR>
    <?MIELSE>
      <?MIVAR>
        <TITLE>ZFIN: Sequence Details: $mrkr_abbrev</title>
      <?/MIVAR>
    <?/MIBLOCK>

    <!-- page header display ----------------->
    <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpageheader.apg';">$1<?/MISQL>


    <?MISQL COND="$(NXST,$UPDATE)" SQL="select WebExplode(object,'rtype=$target_table') from webPages where ID='aa-data_mgr.apg';">$1
    <?/MISQL>

    <!------- Main page information ---------------->



    <!----------------------------------------------------------->
    <p>

    <?MIVAR name=$highlight><!--|HIGHLIGHT_COLOR|--><?/MIVAR>

    <?MISQL SQL="select fdb_db_query from foreign_db where fdb_db_name = 'BLAST';">
      <?MIVAR NAME=fdb_url_blast>$1<?/MIVAR>
    <?/MISQL>

    <?MISQL SQL="select fdb_db_query from foreign_db where fdb_db_name = 'MEGA BLAST';">
      <?MIVAR NAME=fdb_url_mega_blast>$1<?/MIVAR>
    <?/MISQL>

    <?MISQL SQL="select fdb_db_query from foreign_db where fdb_db_name = 'PBLAST';">
      <?MIVAR NAME=fdb_url_pblast>$1<?/MIVAR>
    <?/MISQL>

    <?MISQL SQL="select fdb_db_query from foreign_db where fdb_db_name = 'BLAT';">
      <?MIVAR NAME=fdb_url_blat>$1<?/MIVAR>
    <?/MISQL>

    <?MIVAR name=left_tab>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<?/MIVAR>
    <TABLE width=100%>
      <TR bgcolor=#cccccc>
        <TD>
          <FONT SIZE=+1><b>Sequence Information</b></FONT>
        </TD>
      </TR>
    </TABLE>

    <?MIVAR COND="$(XST,$UPDATE)"> <!---- define button to go back------>

      <form name=updater><!-- for buttons for update purpose----------->
      <center><font size=+2>
      <input type=button
          value=" DONE UPDATING. Back to Viewing! " onClick="document.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-sequence.apg&OID=$OID')">
      </font></center>

    <?/MIVAR>

    <!------------- Title display------------>
    <table border=0 width=100%>
      <tr>
        <td>
          <font><b>
          <?MIVAR>
            $(IF,$(=,$(POSITION,$OID,GENE),0),
              $mrkr_type: $link_backto_OID <br>,

              Gene Name: <i>$mrkr_name</i><br>
              Gene Symbol: $link_backto_OID
              )

          <?/MIVAR>
          </b></font>
        </td>
        <td>
          <?MIBLOCK COND="$(NXST,$UPDATE)"> <!---- define Input Welcome button---->
            <table width="15%" align=right>
             <tr>
             <?MIVAR>
                  <form method=post
                        action="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->"
                        target=comments>
                     <input type=hidden name=subject value="$mrkr_abbrev">
                     <input type=hidden name=marker_id value="$OID">
                     <input type=hidden name=MIval value="aa-your_input_welcome.apg">
                     <input type=hidden name=page_id value="$OID">
                     <td><input type=submit value="Your Input Welcome"></td>
                   </form>
              <?/MIVAR>
              </tr>
             </table>
          <?/MIBLOCK>
        </td>
      </tr>
    </table>

    <!------------------------------------------>

    <?MIBLOCK COND="$(XST,$UPDATE)">
<P>
<b>Add link to Seq DB:</b> &nbsp;
DBname:<SELECT name=seqdb>
  <?MISQL SQL="
    select distinct fdbcont_fdb_db_name
      from foreign_db_contains
     where fdbcont_fdbdt_super_type = 'sequence'
       and fdbcont_fdb_db_name <> 'BLAST'
     order by fdbcont_fdb_db_name;">
    <option value="$1" $(IF,$(EC,$1,GenBank),SELECTED)>$1</option>
  <?/MISQL>
</SELECT>
Type:<SELECT name=seq_super>
  <?MISQL SQL="
    select distinct fdbdt_data_type, fdbdt_super_type
      from foreign_db_data_type
     where fdbdt_super_type = 'sequence'
     order by fdbdt_data_type;">
    <option value="$2&fdbcont_data=$1" $(IF,$(EC,$1,cDNA),SELECTED)>$1</option>
  <?/MISQL>
</SELECT>
Accession:<input type=text size=15 name=seq_acc>
<input type=button value="Add it!" onClick=new_seqnum();>

<br>
<b>Update Sequence:</b> &nbsp;
AccNum:<SELECT name=upd_seq_zdb>
  <?MISQL SQL="
    select distinct fdbcont_fdb_db_name, dblink_acc_num_display, dblink_zdb_id
      from foreign_db_contains, db_link
     where fdbcont_fdbdt_super_type = 'sequence'
       and fdbcont_fdb_db_name <> 'BLAST'
       and fdbcont_zdb_id = dblink_fdbcont_zdb_id
       and dblink_linked_recid = '$OID'
     order by fdbcont_fdb_db_name, dblink_acc_num_display;">
    <option value="$3">$1:$2</option>
  <?/MISQL>
</SELECT>
Type:<SELECT name=upd_seq_type>
  <?MISQL SQL="
    select distinct fdbdt_data_type
      from foreign_db_data_type
     where fdbdt_super_type = 'sequence'
     order by fdbdt_data_type;">
    <option value="$1" $(IF,$(EC,$1,cDNA),SELECTED)>$1</option>
  <?/MISQL>
</SELECT>
Length: <input type=text size=10 name=upd_seq_length>
<input type=button value="Update" onClick=update_seqnum();>

<br>
<b>Add reference to Sequence:</b> &nbsp;
Accession: <input type=text size=15 name=attrib_seq_acc>
Reference: <input type=text size=15 name=attrib_seq_pubid>
<input type=button value="Add it!" onClick=new_attrib_seq();>

<?MIVAR NAME=$lastitem><?/MIVAR>

    <?/MIBLOCK>

<?MISQL SQL="
  select count(*)::integer
  from db_link, foreign_db_contains
  where dblink_linked_recid = '$OID'
    and dblink_fdbcont_zdb_id = fdbcont_zdb_id
    and fdbcont_fdbdt_super_type = 'sequence'
  ;">
<?/MISQL>
<?MIVAR NAME=vSequence_count>$1<?/MIVAR>

<?MIBLOCK COND="$(!=,$vSequence_count,0)">
    <?MIVAR NAME=row_color>$highlight<?/MIVAR>

    <?MIVAR><TABLE border=0 cellspacing=2 cellpadding=3 bgcolor=$highlight width=100%><?/MIVAR>
    <TR bgcolor=#ccccccc>
      <TD width=30%><b>Type</b></TD>
      <TD width=40%><b>Accession #</b></TD>
      <TD align=right width=10%><b>Length</b></TD>
      <TD align=center width=20%><A HREF="javascript:start_help()"><b>Analysis</b></A></TD>
    </TR>

      <?MISQL SQL="
        select  fdbcont_fdbdt_data_type,dblink_length, fdb_db_name, fdb_db_query || dblink_acc_num ||
       (case fdb_url_suffix when NULL then '' else fdb_url_suffix end),
               dblink_acc_num_display, dblink_zdb_id, fdb_db_significance, fdbdt_display_order
        from db_link, foreign_DB, foreign_db_contains, foreign_db_data_type
        where dblink_linked_recid = '$OID'
          and dblink_fdbcont_zdb_id = fdbcont_zdb_id
          and fdbcont_fdb_db_name = fdb_db_name
          and fdbcont_fdbdt_super_type = 'sequence'
          and fdbcont_fdbdt_data_type = fdbdt_data_type
          and fdbcont_fdbdt_super_type = fdbdt_super_type
          and fdbcont_fdb_db_name != 'BLAST'
        order by 8,7,2 desc,3,5
      ;">

        <?MIVAR NAME=$MI_NULL><?/MIVAR>
        <?MIVAR NAME=data_type>$1<?/MIVAR>
        <?MIVAR NAME=dblink_length>$2<?/MIVAR>
        <?MIVAR NAME=db_name>$3<?/MIVAR>
        <?MIVAR NAME=link_url>$4<?/MIVAR>
        <?MIVAR NAME=acc_num>$5<?/MIVAR>
        <?MIVAR NAME=dataId>$6<?/MIVAR>

        <?MIVAR>
        <?MICOMMENT>
	  ** 07/24/03 for some weird reasons, the column made up to distinguish
	  the source of GenBank accession has to be a one-character string
	  to behave right in EC operation.
	<?/MICOMMENT>

        <TR bgcolor=$row_color style="height:2.25em;">

          <TD>
            $(IF,$(AND,$(XST,$pre_data_type),$(EC,$data_type,$pre_data_type)),&nbsp;,$data_type)
          </TD>
          <TD>
            $(IF,$(XST,$UPDATE),"<input type=button value=delete onClick=Delete_listitem('db_link','"$(URLENCODE,$db_name:$acc_num)"')>")
            <A HREF="$link_url">$db_name:$acc_num</A><?/MIVAR>
            <?MISQL SQL="select WebExplode(object,'dataId=$dataId&type=recattrib&info=standard') from webPages where ID='aa-miniref_display.apg';">$1<?/MISQL>
          </TD>
          <TD align=right>
            <nobr>
                <?MIVAR>$dblink_length<?/MIVAR>
                <?MIBLOCK COND=$(NC,$dblink_length,)>
                   <?MIBLOCK COND=$(EQ,$data_type,Polypeptide)> aa
                   <?MIELSE> bp
                   <?/MIBLOCK>
                <?/MIBLOCK>
            </nobr>
          </TD>
          <TD align=center>
             <?MISQL SQL="select WebExplode(object,'seqt_acc=$acc_num&seqt_acc_len=$dblink_length&seqt_acc_type=$data_type&seqt_acc_db=$db_name') from webPages where ID='aa-sequence_tools.apg';">$1<?/MISQL>
          </TD>
        </TR>

        <?MIVAR NAME=pre_data_type>$data_type<?/MIVAR>

        <?MIBLOCK COND="$(EC,$row_color,$highlight)">
          <?MIVAR NAME=row_color>$highlight<?/MIVAR>
        <?MIELSE>
          <?MIVAR NAME=row_color>$highlight<?/MIVAR>
        <?/MIBLOCK>

      <?/MISQL>

      </TABLE>

<?/MIBLOCK>

<?MICOMMENT>
  Unset the Update variable.
  Relationship data is updated from the associated data page.
<?/MICOMMENT>
<?MIVAR>$(UNSETVAR,$UPDATE)<?/MIVAR>

<?MICOMMENT> create a list of chimeric clones <?/MICOMMENT>
<?MIVAR NAME=chimeric_clone_list><?/MIVAR>
<?MISQL SQL="select clone_mrkr_zdb_id from clone where clone_is_chimeric = 't';">
  $(VECAPPEND,$chimeric_clone_list,$1)
<?/MISQL>
<?MIVAR NAME=chimeric_clone_list>$(SEPARATE,$chimeric_clone_list,"','")<?/MIVAR>

<?MICOMMENT> -------- ENCODES -------- <?/MICOMMENT>


      <?MISQL SQL="
        select distinct mrel_mrkr_2_zdb_id, mrkr_abbrev, mrkrtype_type_display, mrkrtype_significance, mrel_zdb_id
        from marker_relationship, marker, foreign_db_contains, marker_types, db_link
        where mrel_mrkr_1_zdb_id = '$OID'
          and mrel_type in ('gene encodes small segment',
                            'gene contains small segment',
	                    'clone contains small segment')
          and mrel_mrkr_2_zdb_id = mrkr_zdb_id
          and mrkr_type = marker_type
          and mrkr_zdb_id = dblink_linked_recid
          and dblink_fdbcont_zdb_id = fdbcont_zdb_id
          and fdbcont_fdbdt_super_type = 'sequence'
          and mrkr_zdb_id not in ('$chimeric_clone_list')
        order by mrkrtype_significance, mrkrtype_type_display desc, mrkr_abbrev
      ;">

        <?MIVAR COND=$(NXST,$encodes_mrkr_abbrev)>
          <p>
          <b>$link_backto_OID Encodes:</b>
          <TABLE width=100% border=0 bgcolor=$highlight>
            <TR bgcolor=#ccccccc>
              <TD width=20%><B>Marker</B></TD>
              <TD width=10%><B>Type</B></TD>
              <TD width=40%><B>Accession #</B></TD>
              <TD align=right width=10%><B>Length</B></TD>
              <TD align=center width=20%><A HREF="javascript:start_help()"><b>Analysis</b></A></TD>
            </TR>
        <?/MIVAR>

        <?MIVAR NAME=encodes_zdb_id>$1<?/MIVAR>
        <?MIVAR NAME=encodes_mrkr_abbrev>$2<?/MIVAR>
        <?MIVAR NAME=encodes_mrkr_type>$3<?/MIVAR>
        <?MIVAR NAME=encodes_mrel_zdb_id>$5<?/MIVAR>

        <TR>
          <TD>
            [$encodes_mrkr_type]
            <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markerview.apg&OID=$encodes_zdb_id"
            >$encodes_mrkr_abbrev</A>
            <?MISQL SQL="
              select WebExplode(object,'dataId=$encodes_mrel_zdb_id&type=recattrib&info=standard')
              from webPages
              where ID='aa-miniref_display.apg';">
              $1
            <?/MISQL>
          </TD>

          <?MIVAR NAME=previous_data_type><?/MIVAR>

      <?MISQL SQL="
        select fdbcont_fdbdt_data_type, dblink_length, fdbcont_fdb_db_name,
               fdb_db_query || dblink_acc_num || (case fdb_url_suffix when NULL then '' else fdb_url_suffix end),
               dblink_acc_num_display, dblink_zdb_id,
               fdb_db_significance, fdbdt_display_order
        from db_link, foreign_DB, foreign_db_contains, foreign_db_data_type
        where dblink_linked_recid = '$encodes_zdb_id'
          and dblink_fdbcont_zdb_id = fdbcont_zdb_id
          and fdbcont_fdb_db_name = fdb_db_name
          and fdbcont_fdbdt_super_type = 'sequence'
          and fdbcont_fdbdt_super_type = fdbdt_super_type
          and fdbcont_fdbdt_data_type = fdbdt_data_type
          and fdb_db_name != 'BLAST'
          order by fdbdt_display_order, fdbcont_fdbdt_data_type, dblink_length desc, fdb_db_significance
      ;">

        <?MIVAR NAME=data_type>$1<?/MIVAR>
        <?MIVAR NAME=dblink_length>$2<?/MIVAR>
        <?MIVAR NAME=db_name>$3<?/MIVAR>
        <?MIVAR NAME=link_url>$4<?/MIVAR>
        <?MIVAR NAME=acc_num>$5<?/MIVAR>
        <?MIVAR NAME=dataId>$6<?/MIVAR>
        <?MIVAR NAME=$MI_NULL><?/MIVAR>

          <?MIBLOCK COND=$(XST,$encodes_data_type)>
            <TR style="height:2.25em;"><TD>&nbsp;</TD>
          <?/MIBLOCK>

          <TD>
            $(IF,$(AND,$(XST,$encodes_data_type),$(EC,$data_type,$encodes_data_type)),&nbsp;,$data_type)
          </TD>
          <TD>
            <A HREF="$link_url">$db_name:$acc_num</A>
            <?MISQL SQL="
              select WebExplode(object,'dataId=$dataId&type=recattrib&info=standard')
              from webPages
              where ID='aa-miniref_display.apg';">
              $1
            <?/MISQL>
          </TD>
          <TD align=right>
            <nobr>
                <?MIVAR>$dblink_length<?/MIVAR>
                <?MIBLOCK COND=$(NC,$dblink_length,)>
                   <?MIBLOCK COND=$(EQ,$data_type,Polypeptide)> aa
                   <?MIELSE> bp
                   <?/MIBLOCK>
                <?/MIBLOCK>
            </nobr>
          </TD>
          <TD align=center>
            <?MICOMMENT>bizzare kludge to prevent seqt_acc_len from being undefined after the first webexplode &seqt_acc_len=$dblink_length<?/MICOMMENT>
            <?MIVAR NAME=seqt_acc_len>$dblink_length<?/MIVAR>
             <?MISQL SQL="select WebExplode(object,'seqt_acc=$acc_num&seqt_acc_type=$data_type&seqt_acc_db=$db_name') from webPages where ID='aa-sequence_tools.apg';">$1<?/MISQL>
          </TD>
        </TR>

        <?MIVAR NAME=encodes_data_type>$data_type<?/MIVAR>

      <?/MISQL>


      $(UNSETVAR,$encodes_data_type)

      <?/MISQL>

      <?MIVAR COND="$(XST,$encodes_zdb_id)"></TABLE><?/MIVAR>


<?MICOMMENT> -------- CONTAINS -------- <?/MICOMMENT>

      <?MISQL SQL="
        select mrel_mrkr_1_zdb_id, mrkr_abbrev, mrkrtype_type_display, mrkrtype_significance, mrel_zdb_id
        from marker_relationship, marker, foreign_db_contains, marker_types, db_link
        where mrel_mrkr_2_zdb_id = '$OID'
          and mrel_type = 'clone contains gene'
          and mrel_mrkr_1_zdb_id = mrkr_zdb_id
          and mrkr_type = marker_type
          and mrkr_zdb_id = dblink_linked_recid
          and dblink_fdbcont_zdb_id = fdbcont_zdb_id
          and fdbcont_fdbdt_super_type = 'sequence'
          and mrkr_zdb_id not in ('$chimeric_clone_list')
        order by mrkrtype_significance, mrkrtype_type_display desc, mrkr_abbrev
      ;">

        <?MIVAR COND=$(NXST,$contains_mrkr_abbrev)>
          <p>
          <b>$link_backto_OID Contained in:</b><br>
          <TABLE width=100% border=0 bgcolor=$highlight>
            <TR bgcolor=#ccccccc>
              <TD width=20%><B>Marker</B></TD>
              <TD width=10%><B>Type</B></TD>
              <TD width=40%><B>Accession #</B></TD>
              <TD align=right width=10%><B>Length</B></TD>
              <TD align=center width=20%><A HREF="javascript:start_help()"><b>Analysis</b></A></TD>
            </TR>
        <?/MIVAR>

        <?MIVAR NAME=contains_zdb_id>$1<?/MIVAR>
        <?MIVAR NAME=contains_mrkr_abbrev>$2<?/MIVAR>
        <?MIVAR NAME=contains_mrkr_type>$3<?/MIVAR>
        <?MIVAR NAME=contains_mrel_zdb_id>$5<?/MIVAR>

        <TR>
          <TD>
            [$contains_mrkr_type]
            <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markerview.apg&OID=$contains_zdb_id"
            > $contains_mrkr_abbrev</A>
            <?MISQL SQL="
              select WebExplode(object,'dataId=$contains_mrel_zdb_id&type=recattrib&info=standard')
              from webPages
              where ID='aa-miniref_display.apg';">
              $1
            <?/MISQL>
          </TD>

          <?MIVAR NAME=previous_data_type><?/MIVAR>

      <?MISQL SQL="
        select fdbcont_fdbdt_data_type, dblink_length, fdbcont_fdb_db_name,
               fdb_db_query || dblink_acc_num || (case fdb_url_suffix when NULL then '' else fdb_url_suffix end),
               dblink_acc_num_display, dblink_zdb_id,
               fdb_db_significance, fdbdt_display_order
        from db_link, foreign_DB, foreign_db_contains, foreign_db_data_type
        where dblink_linked_recid = '$contains_zdb_id'
          and dblink_fdbcont_zdb_id = fdbcont_zdb_id
          and fdbcont_fdb_db_name = fdb_db_name
          and fdbcont_fdbdt_super_type = 'sequence'
          and fdbcont_fdbdt_super_type = fdbdt_super_type
          and fdbcont_fdbdt_data_type = fdbdt_data_type
          and fdb_db_name != 'BLAST'
          order by fdbdt_display_order, fdbcont_fdbdt_data_type, dblink_length desc, fdb_db_significance
      ;">

        <?MIVAR NAME=data_type>$1<?/MIVAR>
        <?MIVAR NAME=dblink_length>$2<?/MIVAR>
        <?MIVAR NAME=db_name>$3<?/MIVAR>
        <?MIVAR NAME=link_url>$4<?/MIVAR>
        <?MIVAR NAME=acc_num>$5<?/MIVAR>
        <?MIVAR NAME=dataId>$6<?/MIVAR>

          <?MIBLOCK COND=$(XST,$contains_data_type)>
            <TR style="height:2.25em;"><TD>&nbsp;</TD>
          <?/MIBLOCK>

          <TD>
            $(IF,$(AND,$(XST,$contains_data_type),$(EC,$data_type,$contains_data_type)),&nbsp;,$data_type)
          </TD>
          <TD>
            <A HREF="$link_url">$db_name:$acc_num</A>
            <?MISQL SQL="
              select WebExplode(object,'dataId=$dataId&type=recattrib&info=standard')
              from webPages
              where ID='aa-miniref_display.apg';">
              $1
            <?/MISQL>
          </TD>
          <TD align=right>
            <nobr>
                <?MIVAR>$dblink_length<?/MIVAR>
                <?MIBLOCK COND=$(NC,$dblink_length,)>
                   <?MIBLOCK COND=$(EQ,$data_type,Polypeptide)> aa
                   <?MIELSE> bp
                   <?/MIBLOCK>
                <?/MIBLOCK>
            </nobr>
          </TD>
          <TD align=center>
            <?MICOMMENT>bizzare kludge to prevent seqt_acc_len from being undefined after the first webexplode &seqt_acc_len=$dblink_length<?/MICOMMENT>
            <?MIVAR NAME=seqt_acc_len>$dblink_length<?/MIVAR>
             <?MISQL SQL="select WebExplode(object,'seqt_acc=$acc_num&seqt_acc_type=$data_type&seqt_acc_db=$db_name') from webPages where ID='aa-sequence_tools.apg';">$1<?/MISQL>
          </TD>
        </TR>
        <?MIVAR NAME=contains_data_type>$data_type<?/MIVAR>

      <?/MISQL>

        $(UNSETVAR,$contains_data_type)

      <?/MISQL>

      <?MIVAR COND="$(XST,$contained_zdb_id)"></TABLE><?/MIVAR>

    </form>

  <?/MIBLOCK> <!-- authorized -->

<?/MIBLOCK> <!-- name NC novalue and romwcount > 0 -->

<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpagefooter.apg';">$1<?/MISQL>

</HTML>
