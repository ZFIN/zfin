<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
  <title>ZFIN Gene Expression Index Entry Form</title>
  </head>

<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpageheader.apg';">$1<?/MISQL>
<body>
<basefont size = 2>
<?MIVAR name=$highlight><!--|HIGHLIGHT_COLOR|--><?/MIVAR>
<?MIVAR NAME=$MI_NOVALUE><?/MIVAR>
<?MIVAR NAME=$MI_NULL><?/MIVAR>

<?MIBLOCK COND="$(NXST,$OID)">
  <p>
  ERROR -- something bad happened -- no OID passed in!
<?/MIBLOCK>

<?MIVAR NAME=$pubid>$OID<?/MIVAR>
<?MISQL SQL="select zdb_id from publication where zdb_id='$OID';"><?/MISQL>
<?MIVAR NAME=$pubid>$1<?/MIVAR>


<SCRIPT>

 function edit_rec(xpatid) {
     helpwin=open("/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-xpatedit.apg&OID="+xpatid,"helpwindow","scrollbars=yes,width=700,height=480")
 }

 function call_reset() {
    window.alert
    document.newdata.locus.value='';
    document.newdata.gene.value='';
    document.newdata.mut.value=document.newdata.mut[0].value;
    document.newdata.stage.value=document.newdata.stage[0].value;
    document.newdata.assay.value=document.newdata.assay[0].value;
 }

 function call_refresh() {
       newdata.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-xpatentry.apg&OID=$OID')
 }

 function new_xpat(pubid) {
       var gene = document.newdata.gene.value;
       var mutind = document.newdata.mut.selectedIndex;
       var mut = document.newdata.mut[mutind].value; 
       var locus = document.newdata.locus.value;
       var stageind = document.newdata.stage.selectedIndex;
       var stage = document.newdata.stage[stageind].value; 
       var assayind = document.newdata.assay.selectedIndex;
       var assay = document.newdata.assay[assayind].value;
       for ( var i=0; i<document.newdata.detected_bool.length; i++ )
        {
           if ( document.newdata.detected_bool[i].checked == true )
           {
              var detected = document.newdata.detected_bool[i].value;
           }
        }
 
       window.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-xindexupdate.apg&OID='+pubid+'&gene_name='+gene+'&mut_name='+mut+'&locus_name='+locus+'&stage_name='+stage+'&detected_bool='+detected+'&assay_name='+assay);
 }

</SCRIPT>  
<?MIBLOCK COND="$(XST,$OID)">
  <?MIVAR>

  <form name=newdata method = post>
  <INPUT TYPE="hidden" name="MIval" value="aa-xpatentry.apg">
  <INPUT TYPE=hidden name=OID value=$OID>
  <center> <input type=button align = "center" value ="Done updating. Back to Viewing!" onclick="document.location.replace('/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-pubview2.apg&OID=$OID')"></center>

  <table border=0 width = 60% cellspacing=10 cellpadding=0>

  <tr><td width = 10%>
  <b>Publication ID:</b> </td>
  <?MIVAR><td align = "left"><b><A HREF = "/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-pubview2.apg&OID=$OID">$pubid</A></b></td><?/MIVAR>
  <tr>
    <td> 
    <b>Gene Symbol: </b></td>
    <td></td> 
    <td width = 40% align = "center"><b>   Wild Type</td>
    <td width = 40% align = "center"><b>Mutant</b></td>   
  <tr>
    <td width = 10%> <input type=text 
	NAME = "gene" size = "30" 
    <?MIBLOCK COND="$(XST,$gene)">value=<?MIVAR>$gene<?/MIVAR>><?/MIBLOCK> 
    </td>
       <td width = 10% align = "right"> <b>Expression In..</b></td>
       <td width = 20%> 
	<SELECT name = mut>
	  <?MISQL SQL="select name from fish where line_type = 'wild type' and name <>''  order by name desc"><option value="$1">    $1<?/MISQL></SELECT>
       </td>
       <td width = 30%><b> OR</b>       <input type = text NAME = "locus"  size = "23" <?MIBLOCK COND="$(XST,$locus)">value=<?MIVAR>$locus<?/MIVAR>><?/MIBLOCK> 
  <tr>
     <td colspan = 3 width = 20% font size = -1><b>Expression</b>
      <input type="radio" name="detected_bool" value="yes" checked> 
      <b>Detected</b>
      <input type="radio" name="detected_bool" value ="no" > 
      <b>Not Detected</b>
      </font> 
      </td>
  <tr>
     <td width = 10%><b>Stage Name (Time):</b>
     <td width = 20%><SELECT name = stage><option select value = NULL>Stage<?MISQL SQL="
select unique stg_name, stg_hours_start, stg_hours_end, stg_zdb_id
		from stage, anatomy_display
		where stg_zdb_id = anatdisp_stg_zdb_id
		order by stg_hours_start, stg_hours_end desc
;"><option value ="$1">$1($2h-$3h)<?/MISQL>

</SELECT></td>
     <td width = 10% align = "right"><b>Assay:</b>
     <td><SELECT name = assay><?MISQL SQL="select xpatassay_name,xpatassay_display_order from expression_pattern_assay order by xpatassay_display_order"><option value ="$1">$1<?/MISQL></SELECT></td>
</table>
<p>
&nbsp;&nbsp;
<input type=button name=addnew value="Add" size = "10" align = center onClick=new_xpat('$pubid')>

<input type =button name = clear value = "Clear" size = "10" align = "center" onClick=call_reset()>
<p>

<hr>


<table border = 0 cellspacing = 5 width = 100% cellpadding = 0>
<tr><td width = 10%><b>Gene</b>
<td width = 10%><b>Fish</b>
<td width = 10%><b>Expression<br><img src="/images/fill_green_ball.gif" border = 0 height = 10>  Detected</b> <br> <img src="/images/green_ball.gif" border = 0 height = 10><b>       Not Detected</b></td>
<td width = 10%><b>Stage</b>
<td width = 10%><b>Assay</b>
<td width = 10></td>

<?MISQL SQL="
select m.mrkr_abbrev, f.abbrev, xpat.xpat_assay_name, xpatstg.xpatstg_expression_found, stg.stg_name, 
       xpat.xpat_zdb_id, xpat.xpat_direct_submission_date, f.abbrev 
from marker m, record_attribution r, expression_pattern xpat, fish f, stage stg, expression_pattern_stage xpatstg 
where r.recattrib_source_zdb_id = '$OID'
  and r.recattrib_data_zdb_id = xpat.xpat_zdb_id 
  and xpat.xpat_gene_zdb_id = m.mrkr_zdb_id 
  and xpat.xpat_stock_zdb_id = f.zdb_id 
  and xpatstg.xpatstg_xpat_zdb_id = xpat.xpat_zdb_id 
  and xpatstg.xpatstg_start_stg_zdb_id = stg.stg_zdb_id 

union 

select mrkr_abbrev, abbrev, xpat_assay_name, xpatstg_expression_found, stg_name, xpat_zdb_id, 
       xpat_direct_submission_date, abbrev 
from marker, expression_pattern, expression_pattern_stage, locus, record_attribution, stage 
where recattrib_source_zdb_id = '$OID'
  and xpat_stock_zdb_id = zdb_id 
  and xpatstg_xpat_zdb_id = xpat_zdb_id 
  and xpatstg_start_stg_zdb_id = stg_zdb_id 
  and xpat_gene_zdb_id = mrkr_zdb_id 
  and recattrib_data_zdb_id = xpat_zdb_id 

order by 7 desc;">

<?MIVAR NAME=$mkrabbrev>$1<?/MIVAR>
<tr><td><i>$mkrabbrev</i></td>
<?MIVAR NAME=$mutall>$2<?/MIVAR>
<td width = 10%><i>$mutall</i></td>
<?MIVAR NAME=$detected>$4<?/MIVAR>
<?MIBLOCK COND="$(EQ,t,$detected)">
    <td>&nbsp;&nbsp;&nbsp;&nbsp;   <img src ="/images/fill_green_ball.gif" border = 0 height=10 align = "center"></td>
<?MIELSE>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;   <img src ="/images/green_ball.gif" border = 0 height=10 align = "center"></td>
<?/MIBLOCK>
<?MIVAR NAME=$stagename>$5<?/MIVAR>
<?MIVAR NAME=$assayname>$3<?/MIVAR>
<td>$stagename</td>
<td>$assayname</td>

<?MIVAR NAME=$xpatid>$6<?/MIVAR>
<td width = 10%><input type = button value = "Edit" name = edit onClick=edit_rec('$xpatid')>
<?/MISQL>
</table>
<hr>
<p>
<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpagefooter.apg';">$1<?/MISQL>

</form>
<?/MIVAR>

<?/MIBLOCK>
