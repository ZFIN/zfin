<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<?MIBLOCK COND="$(NXST,$OID)">
<p>
ERROR -- something bad happened -- no OID passed in!
<?/MIBLOCK>
<?mivar name=$caller>$(SUBSTR,$OID,5,3)<?/mivar>
  <head>
  <title>ZFIN Gene Expression Literature Index Report for<?MIVAR> $OID<?/MIVAR></title>
  </head>

 
<?MIBLOCK COND="$(XST,$OID)">
     <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpageheader.apg';">$1<?/MISQL>

    
  <?MIBLOCK COND="$(NC,GEN,$caller)">

     <?MISQL COND="$(NXST,$UPDATE)" SQL="select WebExplode(object,'rtype=geli') from webPages where ID='aa-data_mgr.apg';">$1<?/MISQL>
     <?MISQL SQL="select title, authors, year(pub_date), source, keywords, accession_no, jtype,pub_abstract from publication where zdb_id='$OID';"><?/MISQL>

    <?MIVAR NAME=$title>$1<?/MIVAR>
    <?MIVAR NAME=$authors>$2<?/MIVAR>
    <?MIVAR NAME=$year>$3<?/MIVAR>
    <?MIVAR NAME=$source>$4<?/MIVAR>
    <?MIVAR NAME=$keywords>$5<?/MIVAR>
    <?MIVAR NAME=$jtype>$7<?/MIVAR>
    <?MIVAR NAME=$accession_no>$6<?/MIVAR>
    <?MIVAR NAME=$abstract>$8<?/MIVAR>
    
    <?MIVAR>

      <center> <p>  <FONT SIZE=+2> $title </FONT> <P>
      <B>$authors</B> <P>
      </center>
      <P>

      <TABLE width=100%>
      <TR>
      <TD><B>DATE:</B> $year  </TD>
      <TD><B>SOURCE:</B> $source ($jtype)</TD>
      </TR>
      </TABLE>
    <?/MIVAR>
    <TABLE width=100%>
    <TR>
    <TD>
     <B>CONTACTS:</B>
     <?MIBLOCK COND="$(EC,$authors,ZFIN Staff)">
       <?MISQL SQL="select name, zdb_id from lab where name = 'ZFIN Database Team'">
       <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-labview.apg&OID=$2">$1</A>
       <?/MISQL>
     <?MIELSE>
       <?MISQL SQL="select a.full_name,a.zdb_id from person a, int_person_pub b where source_id=a.zdb_id and target_id='$OID' order by a.full_name;">
       <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-persview.apg&OID=$2">$1</A>
       <?/MISQL>

      <?/MIBLOCK>
     </TD>

     <?MIVAR>
     <TD align=right>
     <form>
     </form>
     </TD>
     <?/MIVAR>
    </TR>
    </TABLE>    

    <?MIVAR COND="$(NC,$keywords,NULL)"><B>KEYWORDS:</B> $keywords <p><?/MIVAR>

    <?MIVAR COND="$(NC,$accession_no,NULL)">
    <b>PubMed:</B> <A HREF=http://www.ncbi.nlm.nih.gov:80/entrez/query.fcgi?cmd=search&db=PubMed&dopt=Abstract&term=$accession_no>$accession_no</A>
    <?/MIVAR>

    <p>
    <?MIVAR COND="$(NC,$abstract,)"><b><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-pubview2.apg&OID=$OID">ABSTRACT AND ADDITIONAL INFORMATION</b></A><?/MIVAR>

    <p>

    <table border = 0 cellspacing = 5 width = 100% cellpadding = 0>
      <TR><TD bgcolor=#ccccccc><b><center><font size=+1>Gene Expression Reported in this Publication :</font></center></b></td></tr>
    </table>

    <table border = 0 cellspacing = 0 border = 0 width = 100% cellpadding = 3>
      <tr><td width = 10%><b>Gene</size></b>
      <td width = 10%><b>Fish</size></b>
      <?MICOMMENT> <--- the dots have fallen out of favor, so goodbye dots --->
      <td width = 10%><b>Expression<br><img src="/images/fill_green_ball.gif" border = 0 height = 10>  Detected</b> <br> <img src="/images/green_ball.gif" border = 0 height = 10><b>       Not Detected</b></size></td>
      <?/MICOMMENT>
      <td width = 10%><b>Stage</size></b>
      <td width = 10%><b>Assay</size></b>

      <?MIVAR name=$highlight><!--|HIGHLIGHT_COLOR|--><?/MIVAR>
      <?MIVAR name=$row_color>$highlight<?/MIVAR>
      <?MISQL SQL="
	select m.mrkr_abbrev, f.abbrev, xpat.xpat_assay_name, xpatstg.xpatstg_expression_found,
	       stg.stg_name,xpat.xpat_zdb_id, xpat.xpat_direct_submission_date, lower(f.abbrev),
	       stg.stg_hours_start, stg.stg_hours_end, m.mrkr_zdb_id, f.zdb_id,stg.stg_name_long  

	from marker m, record_attribution r, expression_pattern xpat, fish f, stage stg,
	     expression_pattern_stage xpatstg 

	where r.recattrib_source_zdb_id= '$OID'
	  and r.recattrib_data_zdb_id=xpat.xpat_zdb_id 
	  and xpat.xpat_gene_zdb_id=m.mrkr_zdb_id 
	  and xpat.xpat_stock_zdb_id=f.zdb_id 
	  and xpatstg.xpatstg_xpat_zdb_id=xpat.xpat_zdb_id 
	  and xpatstg.xpatstg_start_stg_zdb_id=stg.stg_zdb_id 

	union 

	select mrkr_abbrev, abbrev, xpat_assay_name, xpatstg_expression_found,
	       stg_name, xpat_zdb_id, xpat_direct_submission_date, lower(abbrev),
	       stg_hours_start, stg_hours_end, mrkr_zdb_id, zdb_id, stg_name_long 

	from marker, expression_pattern, expression_pattern_stage, locus, record_attribution, stage 

	where recattrib_source_zdb_id = '$OID' 
	  and xpat_stock_zdb_id = zdb_id 
	  and xpatstg_xpat_zdb_id = xpat_zdb_id 
	  and xpatstg_start_stg_zdb_id = stg_zdb_id 
	  and xpat_gene_zdb_id = mrkr_zdb_id 
	  and recattrib_data_zdb_id=xpat_zdb_id 

	order by 1,9,10">

	<tr bgcolor=<?MIVAR>$row_color<?/MIVAR>>
	  <?MIVAR>
	     <td><i><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markerview.apg&OID=$11">$1</i></a></td>
	  <?/MIVAR>
	<?MIVAR NAME=$mutall>$2<?/MIVAR>
	<?MIVAR NAME=$fishid>$12<?/MIVAR>
	<?MIBLOCK COND="$(>,$(POSITION,$12,FISH),0)">
	  <td><i><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-fishview.apg&OID=<?MIVAR>$fishid<?/MIVAR>"><?MIVAR>$mutall<?/MIVAR></i></a></td>
	<?MIELSE>
	  <td><i><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-locusview.apg&OID=<?MIVAR>$fishid<?/MIVAR>"><?MIVAR>$mutall<?/MIVAR></i></a></td>
	<?/MIBLOCK>

	<?MICOMMENT> <--- the green balls will bounce no more -->
	<?MIVAR NAME=$detected>$4<?/MIVAR>
	<?MIBLOCK COND="$(EQ,t,$detected)">
	    <td>&nbsp;&nbsp;&nbsp;&nbsp;   <img src ="/images/fill_green_ball.gif" border = 0 height=10 align = "center"></td>
	<?MIELSE>
	    <td>&nbsp;&nbsp;&nbsp;&nbsp;   <img src ="/images/green_ball.gif" border = 0 height=10 align = "center"></td>
	<?/MIBLOCK>
	<?/MICOMMENT>

	<td>$13</td>
	<td>$3</td>
	</TR>
	<?MIVAR NAME=$row_color>$(IF,$(EC,$row_color,$highlight),#FFFFFF,$highlight)<?/MIVAR>
      <?/MISQL>
    </table>
    <p>

  <?MIELSE>
    <table border = 0 cellspacing = 5 width = 100% cellpadding = 0>
    <TR><TD bgcolor=#ccccccc><b><center><font size=+1>Click on a Publication to view Gene Expression reported </font></center></b></td></tr></table>

    <?MIVAR name=$highlight><!--|HIGHLIGHT_COLOR|--><?/MIVAR>
    <?MIVAR name=$row_color>$highlight<?/MIVAR>

    <table border = 0  width = 100% border = 0 cellspacing=0 cellpadding=3>
    <td><b> Gene</b>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>Publication</b>
    <?MISQL SQL="
      select distinct p.pub_mini_ref, p.source, m.mrkr_abbrev, p.zdb_id 
	from marker m, publication p, expression_pattern xpat, record_attribution r 
	where xpat.xpat_gene_zdb_id = '$OID'
	  and xpat.xpat_gene_zdb_id = m.mrkr_zdb_id 
	  and xpat.xpat_zdb_id = r.recattrib_data_zdb_id 
	  and r.recattrib_source_zdb_id = p.zdb_id">
    <?MIVAR NAME=$pubid>$4<?/MIVAR>
    <p>
    <tr bgcolor=<?MIVAR>$row_color<?/MIVAR>>
    <td>$3</td>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-xpatindexview.apg&OID=$pubid">$1 $2 </td>
    <p><p>
    </TR>
    <?MIVAR NAME=$row_color>$(IF,$(EC,$row_color,$highlight),#FFFFFF,$highlight)<?/MIVAR>
    <?/MISQL>
    </table>
  <?/MIBLOCK>

  <hr>
  <p>
  <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpagefooter.apg';">$1<?/MISQL>


<?/MIBLOCK>
