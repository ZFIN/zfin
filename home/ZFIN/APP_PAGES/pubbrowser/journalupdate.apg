<HTML>
<?MIERROR>
  <?MIVAR COND=$(XST,$MI_SQL)>
    SQL: $MI_SQL<br><br>
  <?/MIVAR>

  Code:    $MI_ERRORCODE <br>
  State:   $MI_ERRORSTATE <br>
  Message: $MI_ERRORMSG <br>

<?/MIERROR>

<?MICOMMENT>
***
FILE: journalupdate.apg
PREFIX: jrnlu_

This page implements a viewer of the column to be updated in a 
journal record.  It gets the jrnl_column from journalview.apg in
the typical $attr, $attr_type manner.  It passes the new values and
the attr, attr_type, OID to do-journal-update.apg on Submit.

INPUT VARS:
$attr: the column needing update
$OID: the zdb_id of the journal record
$print name: the name displayed of the column needing update
$attr_type: text, selection, or text_area.  For this apg, only text makes 
  sense.

OUTPUT VARS:
$attr: column name in journal table
$attr_type: for this page, only text makes sense.
$MIval: the name of the page to direct to
$comments: any comments/reasons for update
$old_value: the current value of the column being updated
$new_value: the value of the column on submit, may or may not be
  different from $old_value.

OUTPUT:
 calls do-jrnlupdate.apg on submit

EFFECTS:
 none.

<?/MICOMMENT>

<?MISQL SQL="select WebExplode(object,'page_title=Update Journal') from webPages where ID='aa-secure_navigation.apg';">$1<?/MISQL>

<?MIBLOCK COND="$(NC,$AUTHORIZED,root)">
  <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpageheader.apg';">$1<?/MISQL>
    	ERROR -- you are not authorized to view this page.
<?/MIBLOCK>

<?MIVAR NAME=$MI_NULL><?/MIVAR>
<?MIVAR NAME=$MI_NOVALUE><?/MIVAR>

<?MIBLOCK COND="$(NC,$AUTHORIZED,false)">
 <?MIBLOCK COND="$(EC,$AUTHORIZED,root)">

  <?MIBLOCK COND="$(NXST,$OID)">
	ERROR in UPDATE! No OID passed in!
  <?/MIBLOCK>

  <?MICOMMENT> *** Display the correct header for the update window 
	*** <?/MICOMMENT>

  <?MIBLOCK COND="$(EC,$attr_type,text)">

	<?MIBLOCK COND="$(EC,$attr,jrnl_name)">
		<?MIVAR NAME=$updjrnl_column>Name<?/MIVAR>
	<?/MIBLOCK>

	<?MIBLOCK COND="$(EC,$attr,jrnl_abbrev)">
		<?MIVAR NAME=$updjrnl_column>Abbrev<?/MIVAR>
	<?/MIBLOCK>

	<?MIBLOCK COND="$(EC,$attr,jrnl_publisher)">
		<?MIVAR NAME=$updjrnl_column>Publisher<?/MIVAR>
	<?/MIBLOCK>

	<?MIBLOCK COND="$(EC,$attr,jrnl_is_nice)">
		<?MIVAR NAME=$updjrnl_column>Permission to Reproduce Images<?/MIVAR>
	<?/MIBLOCK>


  <?MISQL SQL="select $attr from journal where jrnl_zdb_id='$OID';"><?/MISQL>

    <?MIVAR NAME=$current_value>$1<?/MIVAR>

    <?MIVAR>
      <title>
	ZFIN Updating: $updjrnl_column: $print_name
     </title>

      <center>
	<font size=6>Update $updjrnl_column: $current_value 
      </center>
 
    <?/MIVAR>
    <p>

    <FORM ACTION="/cgi-bin/webdriver" METHOD=post ENCTYPE="multipart/form-data">

    <?MIVAR>
      <INPUT TYPE=hidden name=MIval Value=aa-do-jrnlupdate.apg>
      <INPUT TYPE=hidden name=OID Value=$OID>
      <INPUT TYPE=hidden name=old_value Value=$current_value>
      <INPUT TYPE=hidden name=attr Value=$attr>
      <INPUT TYPE=hidden name=attr_type Value=$attr_type>
    <?/MIVAR>

     <table width=100%>
      <tr>
       <?MIVAR>
         <td><b>$(UPPER,$updjrnl_column)</b>:</td>
         <td>
            <INPUT TYPE=text name="new_value" VALUE='$current_value' SIZE=80>
         </td>
       <?/MIVAR>
     </tr>
    </table>
     <hr>
      <p>
       <b>Comments and/or reasons for update:</B> 
        <center>
         <textarea name="comments" rows=5 cols=60></textarea>
        </center>
      <p>

    <?MICOMMENT> *** Toss up action buttons <?/MICOMMENT>

     <table width=100%>
       <tr align=center>
	<td>
    	  <INPUT TYPE=submit name=s_change value="SUBMIT this new value">
    	</td>
    	<td>
     	   <INPUT TYPE=button name=veto value="CANCEL" onClick="window.history.go(-1)">
     	</td>
       </tr>
     </table>
   </form>

  <?/MIBLOCK>  <?MICOMMENT> *** ends cond attr_type not= selection *** 
			<?/MICOMMENT>

 <?/MIBLOCK>  <?MICOMMENT> *** ends if user is root *** <?/MICOMMENT>

<?/MIBLOCK>
