<HTML>

<SCRIPT>
<?MIVAR>
function do_curation(act) {
   if (top.curator && !top.curator.closed) {top.curator.focus()};
   if(act=='new') {
     top.curator=open("/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-curatepub.apg&OID=$OID","helpwindow","scrollbars=no,width=550,height=300");
   } else {
     top.curator=open("/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-curatepub.apg&OID=$OID&curation="+act,"helpwindow","scrollbars=no,width=550,height=300");
   }
}
<?/MIVAR>
</SCRIPT>

<?MIBLOCK COND="$(NXST,$abbrev)">
<?MIVAR NAME=$abbrev><?/MIVAR>
<?/MIBLOCK>
<?MIBLOCK COND="$(NXST,$fdbname)">
<?MIVAR NAME=$fdbname><?/MIVAR>
<?/MIBLOCK>
<?MIBLOCK COND="$(NXST,$geneid)">
<?MIVAR NAME=$geneid><?/MIVAR>
<?/MIBLOCK>
<?MIBLOCK COND="$(NXST,$OID)">
<p>
ERROR -- something bad happened -- no OID passed in!
<?/MIBLOCK>


<?MIBLOCK COND="$(XST,$OID)">

<?MISQL SQL="select WebExplode(object,'page_title=View Pub') from webPages where ID='aa-secure_navigation.apg';">$1<?/MISQL>


<?MISQL SQL="select title, authors, year(pub_date), source, keywords, abstract, accession_no, errata_and_notes,jtype, pub_file, pub_completion_date from publication where zdb_id='$OID';"><?/MISQL>
<?MIVAR NAME=$title>$1<?/MIVAR>
<?MIVAR NAME=$authors>$2<?/MIVAR>
<?MIVAR NAME=$year>$3<?/MIVAR>
<?MIVAR NAME=$source>$4<?/MIVAR>
<?MIVAR NAME=$keywords>$5<?/MIVAR>
<?MIVAR NAME=$abstract>$6<?/MIVAR>
<?MIVAR NAME=$accession_no>$7<?/MIVAR>
<?MIVAR NAME=$errata_and_notes>$8<?/MIVAR>
<?MIVAR NAME=$jtype>$9<?/MIVAR>
<?MIVAR NAME=$pub_file>$10<?/MIVAR>
<?MIVAR NAME=$pub_completion_date>$11<?/MIVAR>

<?MIVAR NAME=$rec_title>PUB:$(SUBSTR,$title,1,10)...<?/MIVAR>

<?MIBLOCK COND="$(EC,$title,$MI_NOVALUE)">
<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpageheader.apg';">$1<?/MISQL>
<form><center><font size=+2>
<b>Requested ID not found in ZFIN.</font>
</form>
<?/MIBLOCK>


<?MIBLOCK COND="$(NC,$title,$MI_NOVALUE)">

    <?MIVAR>
      <TITLE>ZFIN View Pub:$title </TITLE>
    <?/MIVAR>

<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpageheader.apg';">$1<?/MISQL>

<!-- If VIEWING, THROW UP THE ZDB DATA MANAGER FOR THE RECORD -->
<?MISQL COND="$(NXST,$UPDATE)" SQL="select WebExplode(object,'rtype=publication') from webPages where ID='aa-data_mgr.apg';">$1<?/MISQL>

<BODY BASEFONT=2>

<!-- NOW JUST TOSS OUT THE RETRIEVED DATA IN A TABLE -->
<?MIVAR NAME=$MI_NOVALUE><?/MIVAR>
<?MIVAR NAME=$MI_NULL> <?/MIVAR>

<?MIVAR>

<center> <p>  <FONT SIZE=+2> $title </FONT> <P>
<B>$authors</B> <P>
</center>
<P>

<TABLE width=100%>
<TR>
<TD><B>DATE:</B> $year  </TD>
<TD><B>SOURCE:</B> $source ($jtype)</TD>
</TR>
</TABLE>
<?/MIVAR>

<TABLE width=100%>
<TR>
<TD>
<B>CONTACTS:</B>
<?MIBLOCK COND="$(EC,$authors,ZFIN Staff)">
<?MISQL SQL=" select name, zdb_id from lab where name = 'ZFIN Database Team'">
<A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-labview.apg&OID=$2">$1</A>
<?/MISQL>

<?MIELSE>
<?MISQL SQL="select a.full_name,a.zdb_id from person a, int_person_pub b where source_id=a.zdb_id and target_id='$OID' order by a.full_name;">

 <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-persview.apg&OID=$2">$1</A>,  
<?/MISQL>

<?/MIBLOCK>
</TD>

<?MIVAR>
<TD align=right>
<form method=post  action="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->">
<input type=hidden name=MIval value=aa-pubprintable.apg>
<input type=hidden name=constraint value="where zdb_id='$OID'">
<input type=submit name=printable value="Generate reference">
</form>
</TD>
<?/MIVAR>

</TR></TABLE>

<?MIVAR COND="$(NC,$keywords,NULL)"><B>KEYWORDS:</B> $keywords <p><?/MIVAR>


<?MIVAR COND="$(NC,$accession_no,NULL)">
<b>MEDLINE:</B> <A HREF=http://www.ncbi.nlm.nih.gov:80/entrez/query.fcgi?cmd=search&db=PubMed&dopt=Abstract&term=$accession_no>$accession_no</A>
<p>
<?/MIVAR>

<?MIVAR COND="$(AND,$(EC,$AUTHORIZED,root),$(NC,$pub_file,NULL))">
  <B>FILE:</B>
  <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?LO=$pub_file&MItypeObj=application/pdf" target=$OID>PDF</A>
  <P>
<?/MIVAR>

<B>ABSTRACT:</B> 
<?MIVAR COND="$(NC,$abstract,NULL)"><br>  $abstract  <?/MIVAR>


<?MIBLOCK COND="$(AND,$(NC,$abbrev,$MI_NOVALUE),$(NC,$fdbname,$MI_NOVALUE),$(NC,$geneid,$MI_NOVALUE))">
  <p>
  <b>DETAILS:</b>
  <p>
  <?MIVAR NAME=first>1<?/MIVAR>	
  <?MISQL SQL="select goterm_name from go_term
	       where goterm_go_id = '$goid';">		
  The GO term <?MIVAR><i><b>$1</b></i><?/MIVAR> associated with <?MIVAR><i><b>$abbrev</b></i><?/MIVAR> was derived from <?MIVAR>$fdbname<?/MIVAR> record (
  <?/MISQL>
  <?MISQL SQL="select conc(conc(b.DB_query,a.acc_num),b.url_suffix),a.acc_num 
                from db_link a, foreign_db b
	        where linked_recid='$geneid' and a.db_name='$fdbname'
                      and a.db_name=b.db_name;
	        ">	
  <?MIVAR>
  $(IF,$first,$(SETVAR,$first,0),",")<?/MIVAR>	
  <?MIVAR><A HREF="$1"> $2</A> <?/MIVAR>
  <?/MISQl>
  ).	

<?/MIBLOCK>

<p>

<B>ADDITIONAL INFORMATION: </B>
<ul>
<?MISQL SQL="
      select recattrib_data_zdb_id as zdb_id
	from  record_attribution
	where recattrib_source_zdb_id = '$OID'
	and  recattrib_data_zdb_id like 'ZDB-GENE%'
	union 
	select mrel_mrkr_2_zdb_id as zdb_id
	from  record_attribution, marker_relationship
	where recattrib_source_zdb_id = '$OID'
	and  recattrib_data_zdb_id = mrel_mrkr_1_zdb_id
	and mrel_mrkr_2_zdb_id like 'ZDB-GENE-%'		 
	union 
	select mrel_mrkr_1_zdb_id as zdb_id
	from  record_attribution, marker_relationship
	where recattrib_source_zdb_id = '$OID'
	and  recattrib_data_zdb_id = mrel_mrkr_2_zdb_id
	and mrel_mrkr_1_zdb_id like 'ZDB-GENE-%'; ">
<?/MISQL> 
<?MIVAR COND="$(>,$MI_ROWCOUNT,0)">
<li><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-geneselect.apg&pubId=$OID&type=gene">Genes</a> &nbsp; ($MI_ROWCOUNT)
<?/MIVAR> 

<?MISQL SQL="
	select count(recattrib_data_zdb_id)
	 from  record_attribution
	 where recattrib_source_zdb_id = '$OID'
	  and  recattrib_data_zdb_id[1,8] in ('ZDB-EST-','ZDB-SSLP','ZDB-RAPD','ZDB-STS-','ZDB-BAC-','ZDB-PAC-','ZDB-SNP-')
          ;
	">
<?/MISQL> 
<?MIVAR COND="$(>,$1,0)">
<li><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-msegselect.apg&pubId=$OID">Molecular Segments</a> &nbsp; ($(FIX,$1))
<?/MIVAR>


<?MISQL SQL="
	select count(recattrib_data_zdb_id)
	 from  record_attribution
	 where recattrib_source_zdb_id = '$OID'
	  and  recattrib_data_zdb_id like 'ZDB-XPAT-%';
	">
<?/MISQL> 
<?MIVAR COND="$(>,$1,0)">
<li><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-xpatselect.apg&pubId=$OID">Gene Expression Data</a> &nbsp; ($(FIX,$1))
<?/MIVAR>


<?MISQL SQL="
	select count(distinct lnkgmem_member_zdb_id)
	  from record_attribution, linkage_member
	 where recattrib_source_zdb_id = '$OID'
	  and  recattrib_data_zdb_id like 'ZDB-LINK-%'
	  and  recattrib_data_zdb_id = lnkgmem_linkage_zdb_id
	  ;">
<?/MISQL>

<?MIVAR COND="$(>,$1,0)">
<li><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markerselect.apg&pubId=$OID">Mapping Data</a> &nbsp; ($(FIX,$1))
<?/MIVAR>


<?MISQL SQL="
	select count(recattrib_data_zdb_id)
	 from  record_attribution
	 where recattrib_source_zdb_id = '$OID'
	  and  (recattrib_data_zdb_id like 'ZDB-FISH-%'
	      or recattrib_data_zdb_id like 'ZDB-LOCUS-%');
	">
<?/MISQL> 
<?MIVAR COND="$(>,$1,0)">
<li><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-fishselect.apg&pubId=$OID">Phenotype Alleles</a> &nbsp; ($(FIX,$1))
<?/MIVAR>
 


<?MISQL SQL="
	select count(recattrib_data_zdb_id)
	 from  record_attribution
	 where recattrib_source_zdb_id = '$OID'
	  and  recattrib_data_zdb_id like 'ZDB-OEVDISP-%';
	">
<?/MISQL> 
<?MIVAR COND="$(>,$1,0)">
<li><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-ortholist.apg&pubId=$OID">Orthology</a> &nbsp;
<?/MIVAR>

</ul>

<p>
<B>ERRATA and NOTES:</B> 
<?MIVAR COND="$(NC,$errata_and_notes,NULL)"><br>  $errata_and_notes  <?/MIVAR>


<?/MIBLOCK>  <!-- ends cond oid xst -->
<?/MIBLOCK>  <!-- ends rowcount gt 0 -->

<?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpagefooter.apg';">$1<?/MISQL>

</HTML>



