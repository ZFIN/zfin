<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>

<?MISQL SQL="
  select WebExplode(object,'') 
    from webPages 
    where ID='aa-chromoscripts.apg';">
  $1
<?/MISQL>


<?MIVAR name=page_name>ZFIN Gene $(IF,$(XST,$query_results),List,Select)<?/MIVAR>

<?MIVAR>
  <title>$page_name</title>
<?/MIVAR>

<SCRIPT>
function form_submit() {
document.critform.submit();
}

function call_reset() {

document.critform.name.value = "";
document.critform.refcross.selectedIndex = 0;
document.critform.lg.selectedIndex = 0;
document.critform.knownloci.checked = false;
document.critform.searchtype.selectedIndex = 1;
document.critform.WINSIZE.value = 20;
document.critform.START.value = "";
}

</SCRIPT>

  </head>

<?MIBLOCK COND="$(NXST,$accession)">
  <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpageheader.apg';">$1<?/MISQL>
<?/MIBLOCK>

<?MIVAR NAME=$knownloci COND="$(NXST,$knownloci)">NULL<?/MIVAR>

<?MIBLOCK COND="$(XST,$query_results)">

<?MIVAR NAME=$private>NULL<?/MIVAR>
<?MIVAR NAME=$MI_NULL><?/MIVAR>


<!-- THIS NEXT PART IS EXECUTED AFTER THE PERSON ENTERS SOME CRITERIA -->

<!-- First note that they have searched persons-->

<?MISQL SQL="
  select WebExplode(object,'') 
    from webPages 
    where ID='aa-identify.apg';">
  $1
<?/MISQL>

<a name=results></a>

<!-- set userid to ZDB_ID of user or GUEST to be used by the map viewer -->
<?MIVAR NAME=$userid>GUEST<?/MIVAR>
<?MIBLOCK COND="$(NOT,$(EQ,$(SUBSTR,$ZDB_name,1,5),GUEST))">
  <?MIVAR NAME=$userid>$ZDB_ident<?/MIVAR>
<?/MIBLOCK>


<!-- This next part builds up a query piece by piece, based on which criteria 
  -- were passed in, an inner constraint must be used to account for the 
  -- the possibility that the user leaves all fields blank; in that instance 
  -- the constraint isn't set, thus an error results when the inner query
  -- attempts to append an additional constraint to a non-existant constraint. 
  -->

<?MIVAR NAME=$lead_wildcard><?/MIVAR>
<?MIVAR COND="$(NC,$searchtype,begins)" NAME=$lead_wildcard>%<?/MIVAR>

<?MIVAR NAME=$constraint COND="$(NXST,$constraint)"> <?/MIVAR>
<?MIVAR NAME=$lg COND="$(NXST,$lg)">0<?/MIVAR>
<?MIVAR NAME=$refcross COND="$(NXST,$refcross)">NULL<?/MIVAR>
<?MIVAR NAME=$all_map_names><?/MIVAR>
<?MIVAR NAME=$allmapnm_significance><?/MIVAR>
<?MIVAR NAME=$allmapnm_significance_colno><?/MIVAR>

<?MIBLOCK COND="$(OR,$(XST,$name),$(NC,$lg,0),$(NC,$refcross,NULL),$(NC,$knownloci,NULL),$(AND,$(XST,$within_cm),$(XST,$wm_name)))">

  <!-- First filter name for apostrophes! -->
  <?MIVAR COND="$(XST,$name)" NAME=$name DELIMIT="'" REPLACE="''">$name<?/MIVAR>

  <!-- NOW BUILD UP THE CONSTRAINT CLAUSE -->

  <?MIVAR NAME=$previous> <?/MIVAR>
  <?MIVAR NAME=$constraint> where <?/MIVAR>

  <?MIBLOCK COND="$(XST,$name)">
    <?MIVAR NAME=$all_map_names>, all_map_names<?/MIVAR>
    <?MIVAR NAME=$allmapnm_significance>, min(allmapnm_significance)<?/MIVAR>
    <?MIVAR NAME=$allmapnm_significance_colno>6, <?/MIVAR>

    <?MIVAR NAME=$constraint>$constraint 
          a.zdb_id = allmapnm_zdb_id 
      and allmapnm_name like '$lead_wildcard$(LOWER,$name)%' 
    <?/MIVAR>
  <?/MIBLOCK> 

  <?MIVAR NAME=$previous COND="$(XST,$name)"> and <?/MIVAR>

  <?MIVAR NAME=$constraint COND="$(NC,$lg,0)">$constraint $previous (OR_lg='$lg' and private='f')<?/MIVAR>

  <?MIVAR NAME=$previous COND="$(NC,$lg,0)"> and <?/MIVAR>

  <?MIVAR NAME=$constraint COND="$(NC,$refcross,NULL)">$constraint $previous (panel_id='$refcross')<?/MIVAR>

  <?MIVAR NAME=$previous COND="$(NC,$refcross,NULL)"> and <?/MIVAR>

  <?MIVAR NAME=$constraint COND="$(NC,$knownloci,NULL)">$constraint $previous (locus_name is not null)<?/MIVAR>

  <?MIVAR NAME=$previous COND="$(NC,$knownloci,NULL)"> and <?/MIVAR>

<?/MIBLOCK> <!-- ends cond any constraints specified -->

<?MIVAR NAME=$order_col>allgene_abbrev_order as abbrev_order<?/MIVAR>
<?MIVAR NAME=$group_col>allgene_abbrev_order<?/MIVAR>
<?MIVAR NAME=$order_clause>order by $allmapnm_significance_colno abbrev_order<?/MIVAR>

<?MIVAR NAME=$target_table>all_genes a <?/MIVAR>


<!-- NOW JUST RETRIEVE AND DISPLAY ALL MATCHING ENTRIES. -->


<!-- Stuff to control retrieval volume -->
<form method=post action="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->"  name=genelister>
  <?MIVAR>
    <input type=hidden name=MIval value=aa-geneselect.apg>
    <input type=hidden name=constraint value="$constraint">
    <input type=hidden name=searchtype value="$searchtype">
   
    <?MIVAR COND="$(XST,$name)"> 
      <input type=hidden name=name value="$name">
    <?/MIVAR>
    <?MIVAR COND="$(XST,$lg)"> 
      <input type=hidden name=lg value="$lg">
    <?/MIVAR>
    <?MIVAR COND="$(XST,$refcross)"> 
      <input type=hidden name=refcross value="$refcross">
    <?/MIVAR>
    <?MIVAR COND="$(XST,$knowloci)"> 
      <input type=hidden name=knowloci value="$knowloci">
    <?/MIVAR>
  <?/MIVAR>

</form>


<!-- Query database and construct table based on user constraints. -->

<!-- Count the number of gene names that will be returned. -->
<!-- query count(*) -->
<?MISQL SQL="
  select count(distinct gene_name)::integer, count(*)::integer 
    from $target_table $all_map_names
    $constraint;">
<?/MISQL>

<?MIVAR NAME=$num_recs>$1<?/MIVAR>
<?MIVAR NAME=$true_count>$2<?/MIVAR>
<?MIVAR> 
  <!-- QUERY: $MI_SQL -->
<?/MIVAR>

<?MIBLOCK COND="$(=,$num_recs,0)">
    
  <!-- look to see if replaced zdb_id -->

  <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-zdb_history.apg';">$1<?/MISQL>

<?/MIBLOCK>

<?MIBLOCK COND="$(NXST,$new_oid)">    
<table width=100%>
  <tr>
    <td width=20%>&nbsp;</td>
    <td width=60% align=center>
      <?MIVAR>
        <font size="+1">
          Gene Search Results (<b>$num_recs</b> records found.)
        </font>
      <?/MIVAR>
    </td>
    <td width=20% align=center>
      <a href=#modify>Modify Search</a>
      <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-input_button_generic.apg';">$1<?/MISQL>
    </td>
  </tr>
</table>
<?/MIBLOCK>    

<br>

<?MIBLOCK COND="$(>,$num_recs,0)">

  <?MIVAR COND="$(NC,$lg,0)">
    <p><font color="red">PLEASE NOTE:</font> <font size=2> Because you 
    have constrained this search to a specific linkage group, the results 
    shown below <b>do not</b> include confidential mapping results. This is 
    to avoid tacitly giving away linkage group information for these markers.
    </font></p>
  <?/MIVAR>

  <TABLE width=100% border=0 cellspacing=0>
    <TR>
      <TD></TD>
      <TD align=left>
	<b>Gene symbol - name</b>
	<br>[previous names / orthologues]
      </TD>
      <TD align=left><B>Expression</B></TD>
      <TD align=left><B>Mutant Locus</b></TD>
      <TD align=left><B>Map<b></TD>
    </TR>

    <!-- DEBUGGING <?MIVAR>  constraint=$constraint <?/MIVAR> -->

    <!-- Outer SQL contains WW, retrieves gene names. -->
    <?MIVAR NAME=WINSIZE DEFAULT=25>$WINSIZE<?/MIVAR>
    <?MIVAR NAME=BEGIN DEFAULT=1>$START<?/MIVAR>


    <!--- DEFINITION OF RANGES --->
    <?MIVAR NAME=BEGIN>$(IF,$(<,$BEGIN,1),1,$BEGIN)<?/MIVAR> 
    <?MIVAR NAME=END>$(+,$BEGIN,$WINSIZE)<?/MIVAR>


    <!--- EXECUTION --->
    <!-- set row_color to green -->
    <?MIVAR name=$highlight><!--|HIGHLIGHT_COLOR|--><?/MIVAR>
    <?MIVAR name=row_color>$highlight<?/MIVAR>
    <?MIVAR NAME=$ok_view_map>0<?/MIVAR>
    <?MIVAR NAME=$rowNUM>$BEGIN<?/MIVAR>


    <!--- Query Database --->
    <!-- NOTE: if you change the select list, you may also need to update
      --       the allmapnm_significance_colno variable, which is part of
      --       the order_clause.  -->
    <?MIBLOCK COND="$(EC,foo,bar)"> <?MIVAR><pre>
      select gene_name, zdb_id, abbrev $allmapnm_significance , $order_col , locus_name, locus_zdb_id
    	FROM $target_table $all_map_names
    	$constraint 
	group by gene_name, zdb_id, abbrev, $group_col
    	$order_clause;
    </pre><?/MIVAR><?/MIBLOCK>

    <?MISQL WINSTART=$BEGIN WINSIZE=$WINSIZE SQL="
      select gene_name, zdb_id, locus_name, locus_zdb_id, abbrev $allmapnm_significance , $order_col 
    	FROM $target_table $all_map_names
    	$constraint 
	group by gene_name, zdb_id, abbrev, locus_name, locus_zdb_id, $group_col
    	$order_clause;">

      <?MIVAR NAME=$gene_name>$1<?/MIVAR>
      <?MIVAR NAME=$OID>$2<?/MIVAR>
      <?MIVAR name=$marker_name>$5<?/MIVAR>
      <?MIVAR name=$locus_name>$3<?/MIVAR>
      <?MIVAR name=$locus_zdb_id>$4<?/MIVAR>
      <?MIVAR name=$xpat> <?/MIVAR>
      <?MIVAR NAME=$XPAT_COUNT>0<?/MIVAR>

      <!--  GENE EXPRESSION QUERY  -->
      <?MISQL COND="$(EC,$(SUBSTR,$OID,5,3),EST)" SQL="
          select count(*)
          from expression_pattern
          where '$OID' = xpat_probe_zdb_id;">
        <?MIVAR NAME=$XPAT_COUNT>$1<?/MIVAR>
      <?/MISQL>

      <?MISQL COND="$(EC,$(SUBSTR,$OID,5,4),GENE)" SQL="
          select count(*)
          from expression_pattern, marker_relationship
          where '$OID' = mrel_mrkr_1_zdb_id
            and mrel_mrkr_2_zdb_id = xpat_probe_zdb_id 
          ;">
        <?MIVAR NAME=$XPAT_COUNT>$1<?/MIVAR>
      <?/MISQL>

      <?MIVAR NAME=$xpat COND="$(>,$XPAT_COUNT,0)">
        <font size=2><A HREF=/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-xpatselect.apg&query_results=exists&gene_name=$marker_name>assays</A></font>
      <?/MIVAR>




	<?MIVAR name=$first_row>1<?/MIVAR>

	  <!-- start new row and column -->
	  <TR <?MIVAR>bgcolor="$row_color"<?/MIVAR> >
	    <TD>&nbsp;</TD>
	    <?MIBLOCK COND="$(EC,$first_row,1)">
	      
	        <?MIVAR>
		  <?MIBLOCK COND="$(>,$(POSITION,$OID,GENE),0)">
                    <?MIVAR NAME=$GENE_LINK>
                     $(IF,$(XST,$return_rec),<A HREF=/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-select.apg&return_rec=$return_rec&new_oid=$OID>SELECT</A>)
                      <i><a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markerview.apg&OID=$OID">$marker_name</a> &nbsp;&nbsp;- $gene_name</i>
                    <?/MIVAR>
                    <?MIVAR name=$GENE_TYPE>GENE<?/MIVAR>
	            <?MIVAR name=$aliases> <?/MIVAR>
		  <?MIELSE>
                    <?MIVAR NAME=$GENE_LINK>
                      $(IF,$(XST,$return_rec),<A HREF=/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-do-select.apg&return_rec=$return_rec&new_oid=$OID>SELECT</A>)
	              <a href="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-markerview.apg&OID=$OID">$marker_name</a> <!-- &nbsp;&nbsp; - $gene_name -->
                    <?/MIVAR>
                    <?MIVAR name=$GENE_TYPE>EST<?/MIVAR>
		    <?MIVAR name=$aliases> <?/MIVAR>
                  <?/MIBLOCK>
	        <?/MIVAR>

		<?MISQL SQL="
		  select dalias_alias, dalias_data_zdb_id
		    from data_alias 
		    where dalias_data_zdb_id = '$OID'
		  union 
		  select putgene_putative_gene_name,putgene_pub_zdb_id
		    from putative_non_zfin_gene
		    where putgene_mrkr_zdb_id = '$OID';">
		  <?MIVAR NAME=$alias>$(IF,$(=,$(POSITION,$2,GENE),0),$1,<i>$1</i>)<?/MIVAR>
		  <?MIVAR NAME=$aliases>$(IF,$(=,$MI_CURRENTROW,1),$aliases $alias,$aliases; $alias)<?/MIVAR>
		<?/MISQL>

		<?MISQL SQL="
		  select distinct ortho_name, ortho_abbrev 
		    from orthologue 
		    where c_gene_id = '$OID' 
		      and (   lower(ortho_name) <> '$(LOWER,$gene_name')
			   or lower(ortho_abbrev) <> '$(LOWER,$marker_name'));">

		  <?MIVAR NAME=$ortho_name>$1<?/MIVAR>
		  <?MIVAR NAME=$ortho_abbrev>$2<?/MIVAR>
		  <?MIBLOCK COND="$(=,$MI_CURRENTROW,1)">
		    <?MIVAR NAME=$aliases>$aliases / <?/MIVAR>
		  <?MIELSE>
		    <?MIVAR NAME=$aliases>$aliases; <?/MIVAR>
		  <?/MIBLOCK>
		  <?MIVAR NAME=$aliases>$aliases $ortho_name ($ortho_abbrev)<?/MIVAR>
		<?/MISQL>
		<?MIBLOCK COND="$(NE,$aliases, )">
		  <?MIBLOCK COND="$(>,$(POSITION,$OID,GENE),0)">
		    <?MIVAR name=$aliases>
		      [$aliases]
		    <?/MIVAR>
		  <?MIELSE>
		    <?MIVAR name=$aliases>
		      [$aliases]
		    <?/MIVAR>
		  <?/MIBLOCK>
		<?MIELSE>
		  <?MIVAR name=$aliases>
                    []
                  <?/MIVAR>
		<?/MIBLOCK>

              <?MIVAR>
        <TD>
          $GENE_TYPE:$GENE_LINK $aliases
        </TD>
              <?/MIVAR>

            <?/MIBLOCK> <!-- first row -->

	    <?MIBLOCK COND="$(EC,$first_row,0)">
              <TD>&nbsp;</TD>
	    <?/MIBLOCK>

	    <?MIVAR><TD>$xpat &nbsp;</TD><?/MIVAR>
	    
            <TD><FONT SIZE=2>
	      $(IF,$(OR,$(ISNULL,$locus_zdb_id),$(EC,$locus_zdb_id,"")),
	        "Unknown",
	        "<A HREF=/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-locusview.apg&OID="$locus_zdb_id">"<i>$locus_name</i>"</A>")
	    </TD>

	    <TD width=250>
              <?MISQL SQL="select WebExplode(object,'&mapdetails_mode=mini&split=break&hide_empty=t') from webPages where ID='aa-mappingdetail.apg';">$1<?/MISQL>
	    </TD>


</TR>
	<!--    change row_color    -->
	
<?MIBLOCK>
  <?MIBLOCK COND="$(EC,$row_color,white)">     
    <?MIVAR name=$row_color>$highlight<?/MIVAR><!--#cc9900 orange-->
    <?MIVAR>$(EXIT,3)<?/MIVAR>
  <?/MIBLOCK>

  <?MIVAR COND="$(EC,$row_color,$highlight)">      
    <?MIVAR name=$row_color>white<?/MIVAR>
  <?/MIVAR>
<?/MIBLOCK>    



      <!-- end gene_name SQL -->
    <?/MISQL>

  </TABLE>

  <BR>

  <Center>
  <Table width="70%" border="0">
    <tr>
      <td width="45%" align=right valign=top>&nbsp;

	<?MIVAR name=comment>  Build array of user data  <?/MIVAR>

	<!-- to be used by walking windows -->
	<!-- want GET string as short as possible - append only when variable 
	  -- exists, buffer overflow may cause segmentation fault -->

	<?MIVAR name=selector>MIval=aa-geneselect.apg&WINSIZE=$WINSIZE<?/MIVAR>
        <?MIVAR name=$UserInput><?/MIVAR>
	<?MIVAR name=$UserInput COND=$(XST,$lg)>$UserInput&lg=$lg<?/MIVAR>
	<?MIVAR name=$UserInput COND=$(XST,$refcross)>$UserInput&refcross=$refcross<?/MIVAR>
	<?MIVAR name=$UserInput COND=$(XST,$knownloci)>$UserInput&knownloci=$knownloci<?/MIVAR>
	<?MIVAR name=$UserInput COND=$(XST,$searchtype)>$UserInput&searchtype=$searchtype<?/MIVAR>
	<?MIVAR name=$UserInput COND=$(XST,$return_rec)>$UserInput&return_rec=$return_rec<?/MIVAR>
	<?MIVAR name=UserInput COND=$(XST,$name)>$UserInput&name=$(URLENCODE,$name)<?/MIVAR>
        <?MIVAR name=UserInput COND=$(XST,$query_results)>$UserInput&query_results=$(URLENCODE,$query_results)<?/MIVAR>

	<!--- Return to the previous set of Rows --->
	<?MIBLOCK COND="$(>,$BEGIN,1)">
	
	  <?MIVAR>
	    <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?START=$(-,$BEGIN,$WINSIZE)&BEGIN=$BEGIN&$selector$UserInput">Prev</A>&nbsp;&nbsp;&nbsp;&nbsp;<br>

	    <!-- If current not First Page, create link to first page. -->
	    <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?START=1&BEGIN=1&$selector$UserInput">First Page</A>
	  <?/MIVAR>

	<?/MIBLOCK>

      </td>


      <!-- Calculate 3 pages before and 3 pages after current page. -->
      <?MIVAR name=$CURRENT>$(FIX,$(+,$(/,$BEGIN,$WINSIZE),1))<?/MIVAR>

      <?MIBLOCK COND="$(>=,$(-,$BEGIN,$(*,$WINSIZE,3)),0)">
        <td valign=top>
	  <?MIVAR><A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?$selector$UserInput&START=$(-,$BEGIN,$(*,$WINSIZE,3))"> $(-,$CURRENT,3)</A> <?/MIVAR>
	</td>
      <?/MIBLOCK>

      <?MIBLOCK COND="$(>=,$(-,$BEGIN,$(*,$WINSIZE,2)),0)">
	<td valign=top>
	  <?MIVAR><A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?$selector$UserInput&START=$(-,$BEGIN,$(*,$WINSIZE,2))"> $(-,$CURRENT,2)</A><?/MIVAR>
	</td>
      <?/MIBLOCK>

      <?MIBLOCK COND="$(>=,$(-,$BEGIN,$(*,$WINSIZE,1)),0)">
	<td valign=top>
	  <?MIVAR><A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?$selector$UserInput&START=$(-,$BEGIN,$(*,$WINSIZE,1))"> $(-,$CURRENT,1)</A><?/MIVAR>
	</td>
      <?/MIBLOCK>

      <?MIBLOCK COND="$(>,$num_recs,$WINSIZE)">
	<td align=center valign=top>
	  <?MIVAR>  $CURRENT <?/MIVAR>
	</td>
      <?/MIBLOCK>

      <?MIVAR COND="$(<=,$(+,$BEGIN,$(*,$WINSIZE,1)),$num_recs)">
	<td valign=top>
	  <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?$selector$UserInput&START=$END"> $(+,$CURRENT,1)</A>
	</td>
      <?/MIVAR>

      <?MIVAR COND="$(<=,$(+,$BEGIN,$(*,$WINSIZE,2)),$num_recs)">
	<td valign=top>
	  <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?$selector$UserInput&START=$(+,$BEGIN,$(*,$WINSIZE,2))"> $(+,$CURRENT,2)</A>
	</td>
      <?/MIVAR>

      <?MIVAR COND="$(<=,$(+,$BEGIN,$(*,$WINSIZE,3)),$num_recs)">
	<td valign=top>
	  <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?$selector$UserInput&START=$(+,$BEGIN,$(*,$WINSIZE,3))"> $(+,$CURRENT,3)</A>
	</td>
      <?/MIVAR>

      <td width="45%" align=left valign=top>&nbsp;

	<!--- Get the next set of Rows --->
	<?MIBLOCK COND="$(<=,$(+,$BEGIN,$WINSIZE),$num_recs)">
	  <?MIVAR>
	    <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?START=$END&BEGIN=$BEGIN&$selector$UserInput">Next</A><br>
	  <?/MIVAR>

	  <!-- Calculate last page -->
	  <?MIVAR name=$START COND="$(=,$(MOD,$num_recs,$WINSIZE),0)">$(+,$(*,$(-,$(/,$num_recs,$WINSIZE),1),$WINSIZE),1)<?/MIVAR>


	  <?MIVAR name=$START COND="$(!=,$(MOD,$num_recs,$WINSIZE),0)">$(+,$(*,$(FIX,$(/,$num_recs,$WINSIZE)),$WINSIZE),1)<?/MIVAR>

	  <?MIVAR>
	    <A HREF="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->?START=$START&$selector$UserInput">Last Page</A>
	  <?/MIVAR>
	<?/MIBLOCK>

      </td>
    </tr>
  </Table>
  </Center>

<?/MIBLOCK>  <!-- num_rec gt 0 -->

<?MIVAR><!-- SQL: $MI_SQL --><?/MIVAR>

<?MIVAR COND=$(EQ,$MI_ROWCOUNT,0)>No matching records found<?/MIVAR>


<?/MIBLOCK> <!-- xst query_results -->


<?MIBLOCK COND="$(NXST,$accession)">  <!-- don't want modify search result if come from accessionalister -->

    <Table class=search width="100%" border=0 cellpadding=1 cellspacing=0>
      <TR>
	<td class=titlebar>
          &nbsp;&nbsp;

  <?MIBLOCK COND="$(NXST,$query_results)">
	  <b>Search for GENES</b>
  <?MIELSE>
          <a name=modify></a><b>Modify your search</b>
  <?/MIBLOCK>

        </td>
        <td class=titlebar align=right>
        <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-input_button_generic.apg';">$1<?/MISQL>          
        </td>
      </tr>

    <?MIVAR COND="$(NXST,$START)" NAME=$START>1<?/MIVAR>

  <form name=critform method=post action="/<!--|WEBDRIVER_PATH_FROM_ROOT|-->">

    <input type=hidden name=MIval value=aa-geneselect.apg>
    <input type=hidden name=query_results value="exist">
    <input type=hidden name=START value=1>

  <?MIVAR COND="$(NXST,$refcross)" NAME=$refcross>NULL<?/MIVAR>
  <?MIVAR COND="$(XST,$gnslct_rfcrss)" NAME=$refcross>$gnslct_rfcrss<?/MIVAR>
  <?MIVAR COND="$(NXST,$searchtype)" NAME=$searchtype>contains<?/MIVAR>
  <?MIVAR COND="$(XST,$gnslct_srchtyp)" NAME=$searchtype>$gnslct_srchtyp<?/MIVAR>
  <?MIVAR COND="$(NXST,$lg)" NAME=$lg>0<?/MIVAR>
  <?MIVAR COND="$(XST,$gnslct_lg)" NAME=$lg>gnslct_lg<?/MIVAR>

  <?MIVAR>

    <TR>
      <TD class="halfwidth">
	  <font size=2>
	  <b>Name 
	  <SELECT name=searchtype onChange='document.critform.START.value = "";'>
	    <option $(IF,$(EC,$searchtype,begins),SELECTED) value=begins>begins with
	    <option $(IF,$(EC,$searchtype,contains),SELECTED) value=contains>contains
	  </select>:
	  </b> 
	  <input type=text name=name size=25 $(IF,$(XST,$gnslct_name), value=$gnslct_name) onChange='document.critform.START.value = ""' $(IF,$(XST,$name),value='$name')>
	  </font>
      </TD>
      <TD class="halfwidth">
	  <b>Mapping panel:</b> 
	  <SELECT NAME=refcross onChange='document.critform.START.value = "";'>
	  <option <?MIVAR COND="$(EC,$refcross,NULL)">SELECTED<?/MIVAR> value=NULL>Any
	  <?MISQL SQL="select zdb_id,abbrev,ptype from panels order by ptype, abbrev;">
	  <option $(IF,$(EC,$refcross,$1),SELECTED) value=$1>$2($3)
	  <?/MISQL>
	  </SELECT>
  <?/MIVAR>
  <?MIVAR>
	  <b>LG:</b> 
	  <select NAME=lg onChange='document.critform.START.value = "";'>
	  <?MISQL SQL="select distinct lg_name,lg_order from linkage_group order by lg_order"> 
	    <option value="$1" $(IF,$(EC,$lg,$1),SELECTED) >$(IF,$(EC,$1,0),any,$1)
	  <?/MISQL>
	  </SELECT>
  <?/MIVAR>
     </TD>
   </TR>
   <TR>
     <TD> 
       <input type=checkbox name=knownloci onChange='document.critform.START.value = "";'> Show only genes with known mutant loci<br>
     </TD>

     <?MIBLOCK COND="$(NC,$knownloci,NULL)">
       <SCRIPT> 
         document.critform.knownloci.checked = true 
       </SCRIPT>
     <?/MIBLOCK>

   </TR>
   <TR>
     <TD class="resultcount" colspan=2>
	   Display results in groups of 
	  <?MIVAR><input type="text" name="WINSIZE" size="3" onChange='document.critform.START.value = "";' $(IF,$(XST,$WINSIZE),value='$WINSIZE',value="20")>.<?/MIVAR>
	  <?MIBLOCK COND="$(AND,$(NOT,$(ISNULL,$WINSIZE)),$(XST,$WINSIZE))">
	   <?MIVAR> 
	    <SCRIPT> 
	      document.critform.WINSIZE.value = "$WINSIZE" 
	    </SCRIPT>
	  <?/MIVAR> 
	<?/MIBLOCK> 
      </TD>
     </TR>
     <TR>
      <TD class="submitbar" colspan=2 align="right">
	  <input type=submit name=action value="SEARCH" onSubmit="document.critform.submit();">
	  <input type=button value="RESET" onClick="call_reset();">
      </TD>
     </TR>
  </TABLE>
  <p>

    <input type=hidden NAME="START" value=1>



  <!-- This next little block executes only if we are using the browser as a
  selector. That is we want user to ultimately CHOOSE a browsed value. All
  we have to do at this point is pass the return record along to the markerlister.
  -->
  <?MIVAR COND=$(XST,$return_rec)>
  <input type=hidden NAME="return_rec" value=$return_rec>
  <?/MIVAR>


  </form>
<?/MIBLOCK>  <!-- nxst accession -->

<?MIBLOCK COND="$(XST,$query_results)">
    </TD>
  </TR>
</TABLE>
<?MIELSE>
  <!-- Put the cursor in the NAMES criterion box -->
  <SCRIPT>document.critform.name.focus();</SCRIPT>
<?/MIBLOCK>


<?MIBLOCK COND="$(NXST,$accession)">
  <?MISQL SQL="select WebExplode(object,'') from webPages where ID='aa-htmlpagefooter.apg';">$1<?/MISQL>  
<?/MIBLOCK>
