<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.jboss.org/dtd/hibernate/hibernate-mapping-3.0.dtd">

<!-- Alwyas include the full package in each class.name attribute. This allows refactoring to identify
     the class and include them. Otherwise a refactoring of a class reference here is not recognized and
     could potentially break the code (e.g. moving a clas  into a different package. -->
<hibernate-mapping package="org.zfin.anatomy">


    <typedef class="org.zfin.framework.StringEnumValueUserType" name="statisticsType">
        <param name="enumClassname">org.zfin.anatomy.AnatomyStatistics$Type</param>
    </typedef>

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="dataAliasGroup">
        <param name="enumClassname">org.zfin.infrastructure.DataAlias$Group</param>
    </typedef>

    <class name="org.zfin.anatomy.DevelopmentStage" table="stage" mutable="false" lazy="true" proxy="DevelopmentStage">
        <cache usage="read-only"/>
        <id name="zdbID">
            <column name="stg_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">STAGE</param>
            </generator>
        </id>

        <property name="name" column="stg_name" not-null="false"/>
        <property name="nameLong" column="stg_name_long" not-null="false"/>
        <property name="hoursStart" column="stg_hours_start" not-null="true"/>
        <property name="hoursEnd" column="stg_hours_end" not-null="false"/>
        <property name="otherFeature" column="stg_other_features" not-null="false"/>
        <property name="abbreviation" column="stg_abbrev" not-null="false"/>
        <property name="timeString" column="stg_name_ext"/>
        <property name="oboID" column="stg_obo_id"/>

    </class>

    <class name="org.zfin.anatomy.AnatomyStatistics" table="anatomy_stats">
        <composite-id>
            <key-property name="zdbID" column="anatstat_term_zdb_id"/>
            <key-property name="type" column="anatstat_object_type" type="statisticsType" access="field"/>
        </composite-id>

        <property name="numberOfObjects">
            <column name="anatstat_object_count" not-null="false"/>
        </property>

        <property name="numberOfTotalDistinctObjects">
            <column name="anatstat_total_distinct_count" not-null="false"/>
        </property>

        <property name="numberOfSynonyms">
            <column name="anatstat_synonym_count" not-null="false"/>
        </property>

        <!-- do not do fetch="join" -->
        <many-to-one name="term" class="org.zfin.ontology.GenericTerm"
                     column="anatstat_term_zdb_id" insert="false" update="false" fetch="join" lazy="false"/>

    </class>


    <class name="org.zfin.anatomy.AnatomyTreeInfo" table="anatomy_display">
        <composite-id>
            <key-property name="zdbID" column="anatdisp_stg_zdb_id"/>
            <key-many-to-one name="item" class="org.zfin.ontology.GenericTerm" column="anatdisp_item_zdb_id"/>
        </composite-id>

        <property name="indent">
            <column name="anatdisp_indent" not-null="true"/>
        </property>

        <property name="sequenceNumber">
            <column name="anatdisp_seq_num" not-null="true"/>
        </property>

    </class>


    <class name="org.zfin.audit.AuditLogItem" table="updates">
        <id name="auditLogID" type="long">
            <column name="upd_pk_id" not-null="false"/>
            <generator class="native"/>
        </id>

        <property name="zdbID">
            <column name="rec_id" not-null="false"/>
        </property>

        <property name="oldValue">
            <column name="old_value" not-null="false"/>
        </property>

        <property name="newValue">
            <column name="new_value" not-null="true"/>
        </property>

        <property name="fieldName">
            <column name="field_name" not-null="true"/>
        </property>

        <property name="comment">
            <column name="comments" not-null="true"/>
        </property>

        <property name="dateUpdated">
            <column name="when" not-null="true"/>
        </property>

        <many-to-one name="owner" class="org.zfin.profile.Person" column="submitter_id" insert="false"
                     update="false"/>
    </class>

    <class name="org.zfin.framework.presentation.AnatomyFact" table="feature_stats" entity-name="AnatomyFact">
        <id name="zdbID">
            <column name="fstat_pk_id" not-null="true"/>
            <generator class="identity"/>
        </id>

        <discriminator type="string"
                       formula="(CASE fstat_type
                                    WHEN 'Antibody'           THEN 'Antibody'
                                    WHEN 'High-Quality-Probe' THEN 'HQProbe '
                                    ELSE             'other'
                                 END)"/>

        <many-to-one name="expressionResult" column="fstat_xpatres_zdb_id" lazy="proxy"/>
        <many-to-one name="superterm" column="fstat_superterm_zdb_id" lazy="proxy"/>
        <many-to-one name="figure" column="fstat_fig_zdb_id" lazy="proxy"/>
        <many-to-one name="subterm" column="fstat_subterm_zdb_id" lazy="proxy"/>
        <many-to-one name="publication" column="fstat_pub_zdb_id" lazy="proxy"/>

        <many-to-one name="gene" column="fstat_gene_zdb_id" lazy="proxy"/>
        <many-to-one name="image" column="fstat_img_zdb_id" lazy="proxy"/>
        <property name="type" column="fstat_type"/>

        <subclass name="org.zfin.antibody.presentation.AntibodyAOStatistics" discriminator-value="Antibody">
            <many-to-one name="antibody" column="fstat_feat_zdb_id" insert="false" update="false"/>
        </subclass>

        <subclass name="org.zfin.marker.presentation.HighQualityProbeAOStatistics" discriminator-value="HQProbe ">
            <many-to-one name="probe" column="fstat_feat_zdb_id" insert="false" update="false"/>
        </subclass>

    </class>

</hibernate-mapping>

