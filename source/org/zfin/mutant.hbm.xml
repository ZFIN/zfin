<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<!-- Alwyas include the full package in each class.name attribute. This allows refactoring to identify
     the class and include them. Otherwise a refactoring of a class reference here is not recognized and
     the class and include them. Otherwise a refactoring of a class reference here is not recognized and
     could potentially break the code (e.g. moving a clas  into a different package. -->
<hibernate-mapping package="org.zfin.mutant">

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="featureHistoryReason">
        <param name="enumClassname">org.zfin.feature.FeatureHistory$Reason</param>
    </typedef>
    <typedef class="org.zfin.framework.StringEnumValueUserType" name="featAssayMutagen">
        <param name="enumClassname">org.zfin.gwt.root.dto.Mutagen</param>
    </typedef>
    <typedef class="org.zfin.framework.StringEnumValueUserType" name="featAssayMutagee">
        <param name="enumClassname">org.zfin.gwt.root.dto.Mutagee</param>
    </typedef>

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="goEvidenceCode">
        <param name="enumClassname">org.zfin.gwt.root.dto.GoEvidenceCodeEnum</param>
    </typedef>

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="goFlag">
        <param name="enumClassname">org.zfin.gwt.root.dto.GoEvidenceQualifier</param>
    </typedef>
    <typedef class="org.zfin.framework.StringEnumNameUserType" name="featureType">
        <param name="enumClassname">org.zfin.gwt.root.dto.FeatureTypeEnum</param>
    </typedef>

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="featureMarkerRelationshipType">
        <param name="enumClassname">org.zfin.feature.FeatureMarkerRelationship$Type</param>
    </typedef>


    <class name="org.zfin.mutant.Genotype" table="genotype">
        <id name="zdbID" type="string">
            <column name="geno_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">GENO</param>
            </generator>
        </id>

        <property name="name" column="geno_display_name"/>
        <property name="nameOrder" column="geno_name_order"/>
        <property name="handle" column="geno_handle"/>
        <property name="wildtype" column="geno_is_wildtype"/>
        <property name="extinct" column="geno_is_extinct"/>
        <property name="nickname" column="geno_nickname"/>

        <set name="genotypeExperiments" lazy="true">
            <key column="genox_geno_zdb_id"/>
            <one-to-many class="org.zfin.mutant.GenotypeExperiment"/>
        </set>

        <set name="associatedGenotypes" lazy="true" table="genotype_background" access="field">
            <key column="genoback_geno_zdb_id"/>
            <many-to-many class="org.zfin.mutant.Genotype" column="genoback_background_zdb_id"/>
        </set>

        <set name="genotypeFeatures" lazy="true">
            <key column="genofeat_geno_zdb_id"/>
            <one-to-many class="org.zfin.mutant.GenotypeFeature"/>
        </set>
        
        <set name="externalNotes" lazy="true">
            <key column="extnote_data_zdb_id" />
            <one-to-many class="org.zfin.mutant.GenotypeExternalNote" />
        </set>        

        <set name="dataNotes" lazy="true">
            <key column="dnote_data_zdb_id"/>
            <one-to-many class="org.zfin.infrastructure.DataNote"/>
        </set>

        <set name="suppliers">
            <key column="idsup_data_zdb_id" update="false"/>
            <one-to-many class="org.zfin.people.GenotypeSupplier" />
        </set>

        <set name="aliases" lazy="true" table="data_alias" order-by="dalias_alias_lower" inverse="false">
            <key column="dalias_data_zdb_id"/>
            <one-to-many class="org.zfin.mutant.GenotypeAlias"/>
        </set>

    </class>

    <class name="org.zfin.mutant.GoEvidenceCode" table="go_evidence_code" mutable="false">
        <id name="code" column="goev_code" type="string"/>
        <property name="name" column="goev_name"/>
        <property name="order" column="goev_display_order"/>
    </class>

    <class name="org.zfin.mutant.GoFlag" table="go_flag" mutable="false">
        <id column="gflag_name" name="name" type="string"/>
        <property name="displayOrder" column="gflag_display_order" type="integer"/>
    </class>

    <class name="org.zfin.mutant.MarkerGoTermEvidence" table="marker_go_term_evidence">
        <id name="zdbID" type="string">
            <column name="mrkrgoev_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">MRKRGOEV</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>
        <many-to-one name="marker" column="mrkrgoev_mrkr_zdb_id" not-null="true"/>
        <many-to-one name="source" column="mrkrgoev_source_zdb_id" not-null="true"/>
        <many-to-one name="goTerm" column="mrkrgoev_term_zdb_id" not-null="true"/>
        <property name="note" column="mrkrgoev_notes" not-null="false"/>
        <many-to-one name="evidenceCode" column="mrkrgoev_evidence_code" class="org.zfin.mutant.GoEvidenceCode"
                     not-null="true"/>

        <property name="createdBy" column="mrkrgoev_contributed_by" not-null="false"/>
        <property name="createdWhen" column="mrkrgoev_date_entered" not-null="true"/>
        <property name="modifiedBy" column="mrkrgoev_modified_by" not-null="false"/>
        <property name="modifiedWhen" column="mrkrgoev_date_modified" not-null="true"/>

        <property name="flag" column="mrkrgoev_gflag_name" not-null="false" type="goFlag"/>

        <set name="inferredFrom" lazy="false" inverse="true">
            <key column="infgrmem_mrkrgoev_zdb_id"/>
            <one-to-many class="InferenceGroupMember"/>
        </set>

    </class>

    <class name="InferenceGroupMember" table="inference_group_member">
        <composite-id>
            <key-property name="markerGoTermEvidenceZdbID" column="infgrmem_mrkrgoev_zdb_id"/>
            <key-property name="inferredFrom" column="infgrmem_inferred_from"/>
        </composite-id>
    </class>


    <class name="org.zfin.mutant.GenotypeFeature" table="genotype_feature">
        <id name="zdbID" type="string">
            <column name="genofeat_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">GENOFEAT</param>
            </generator>
        </id>

        <many-to-one name="zygosity" class="org.zfin.mutant.Zygosity" column="genofeat_zygocity"
                     insert="false"
                     update="false"/>

        <many-to-one name="dadZygosity" class="org.zfin.mutant.Zygosity" column="genofeat_dad_zygocity"
                     insert="false"
                     update="false"/>

        <many-to-one name="momZygosity" class="org.zfin.mutant.Zygosity" column="genofeat_mom_zygocity"
                     insert="false"
                     update="false"/>

        <many-to-one name="genotype" class="org.zfin.mutant.Genotype">
            <column name="genofeat_geno_zdb_id"/>
        </many-to-one>

        <many-to-one name="feature" class="org.zfin.feature.Feature">
            <column name="genofeat_feature_zdb_id"/>
        </many-to-one>

    </class>

    <class name="org.zfin.mutant.GenotypeExperiment" table="genotype_experiment">
        <id name="zdbID">
            <column name="genox_zdb_id"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">GENOX</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>

        <many-to-one name="experiment" class="org.zfin.expression.Experiment">
            <column name="genox_exp_zdb_id"/>
        </many-to-one>

        <many-to-one name="genotype" class="org.zfin.mutant.Genotype">
            <column name="genox_geno_zdb_id"/>
        </many-to-one>

        <set name="phenotypes" lazy="true" inverse="true">
            <key column="apato_genox_zdb_id"/>
            <one-to-many class="org.zfin.mutant.Phenotype"/>
        </set>

        <set name="expressionExperiments" lazy="true">
            <key column="xpatex_genox_zdb_id"/>
            <one-to-many class="org.zfin.expression.ExpressionExperiment"/>
        </set>
    </class>

    <class name="org.zfin.mutant.Phenotype" table="atomic_phenotype">
        <id name="zdbID" type="string">
            <column name="apato_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">APATO</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>

        <many-to-one name="genotypeExperiment" class="org.zfin.mutant.GenotypeExperiment">
            <column name="apato_genox_zdb_id"/>
        </many-to-one>

        <!--
                <property name="patoSuperTermzdbID" column="apato_superterm_zdb_id"/>
        -->
        <many-to-one name="superterm" column="apato_superterm_zdb_id"/>
        <many-to-one name="subterm" column="apato_subterm_zdb_id"/>
        <many-to-one name="term" column="apato_quality_zdb_id"/>
        <many-to-one name="publication" column="apato_pub_zdb_id"/>
        <many-to-one name="startStage" column="apato_start_stg_zdb_id"/>
        <many-to-one name="endStage" column="apato_end_stg_zdb_id"/>
        <!--
        ToDo: mark tag as phenotypeTag type when this col is cleaned up
        -->
        <property name="tag" column="apato_tag"/>

        <set name="figures" lazy="true" table="apato_figure">
            <key column="apatofig_apato_zdb_id"/>
            <many-to-many class="org.zfin.expression.Figure" column="apatofig_fig_zdb_id"/>
        </set>

    </class>

    <class name="org.zfin.feature.Feature" table="feature">
       <id name="zdbID" type="string">
            <column name="feature_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">ALT</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>
        <property name="name" column="feature_name" not-null="true"/>
        <property name="abbreviation" column="feature_abbrev" not-null="true"/>
        <property name="abbreviationOrder" column="feature_abbrev_order" not-null="true"/>
        <property name="nameOrder" column="feature_name_order" not-null="true"/>
        <!--<property name="ftrTypeString" column="feature_type" not-null="true"/>-->
        <property name="transgenicSuffix" column="feature_tg_suffix"/>
        <property name="lineNumber" column="feature_line_number"/>
        <property name="dominantFeature"  column="feature_dominant" type="boolean"/>
        <property name="unspecifiedFeature"  column="feature_unspecified" type="boolean"/>
        <property name="knownInsertionSite"  column="feature_known_insertion_site" type="boolean"/>
        <property name="publicComments" column="feature_comments"/>


        <!--<property name="labPrefix" column="feature_lab_prefix_id" type="integer"/>-->
        <many-to-one name="featurePrefix" column="feature_lab_prefix_id" class="org.zfin.feature.FeaturePrefix"/>

        <set name="featureMarkerRelations" lazy="true">
	            <key column="fmrel_ftr_zdb_id"/>
	            <one-to-many class="org.zfin.feature.FeatureMarkerRelationship"/>
        </set>
        <set name="genotypeFeatures" lazy="true">
	            <key column="genofeat_feature_zdb_id"/>
	            <one-to-many class="org.zfin.mutant.GenotypeFeature"/>
        </set>
        <set name="sources">
            <key column="ids_data_zdb_id" update="false"/>
            <one-to-many class="org.zfin.people.FeatureSource"/>
        </set>
        <property name="type" column="feature_type" type="featureType" not-null="true" />

        <set name="aliases" lazy="true" table="data_alias" order-by="dalias_alias_lower" inverse="false">
            <key column="dalias_data_zdb_id"/>
            <one-to-many class="org.zfin.feature.FeatureAlias"/>
        </set>


        <set name="suppliers">
            <key column="idsup_data_zdb_id" update="false"/>
            <one-to-many class="org.zfin.people.FeatureSupplier" />
        </set>

        <set name="dataNotes" lazy="true">
            <key column="dnote_data_zdb_id"/>
            <one-to-many class="org.zfin.infrastructure.DataNote"/>
        </set>
        <set name="publications" lazy="true" cascade="all">
            <key column="recattrib_data_zdb_id"/>
            <one-to-many class="org.zfin.infrastructure.PublicationAttribution"/>
        </set>
        <join table="feature_assay" optional="true" inverse="true">
            <key column="featassay_feature_zdb_id"/>
            <component name="featureAssay">
                <property name="mutagen" type="featAssayMutagen">
                    <column name="featassay_mutagen"/>
                </property>
                <property name="mutagee" type="featAssayMutagee">
                    <column name="featassay_mutagee"/>
                </property>
            </component>
        </join>

    </class>


    <class name="org.zfin.feature.FeatureMarkerRelationship" table="feature_marker_relationship">
        <!--<id name="zdbID" column="fmrel_zdb_id"/>-->
        <id name="zdbID" type="string">
            <column name="fmrel_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">FMREL</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>
        <property name="type" column="fmrel_type" type="featureMarkerRelationshipType"/>


        <many-to-one name="featureMarkerRelationshipType" column="fmrel_type" insert="false" update="false"
                     foreign-key="fmrel_type" class="org.zfin.feature.FeatureMarkerRelationshipType"/>
        <many-to-one name="feature" class="org.zfin.feature.Feature" column="fmrel_ftr_zdb_id"  />
        <many-to-one name="marker" class="org.zfin.marker.Marker" column="fmrel_mrkr_zdb_id"  />


        <set name="publications" lazy="true" cascade="all">
            <key column="recattrib_data_zdb_id"/>
            <one-to-many class="org.zfin.infrastructure.PublicationAttribution"/>
        </set>

    </class>


    <class name="org.zfin.expression.ExperimentCondition" table="experiment_condition">

        <id name="zdbID" type="string">
            <column name="expcond_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">EXPCOND</param>
            </generator>
        </id>

        <property name="value" column="expcond_value"/>

        <many-to-one name="experiment" class="org.zfin.expression.Experiment">
            <column name="expcond_exp_zdb_id"/>
        </many-to-one>


        <many-to-one name="unit" class="org.zfin.expression.ExperimentUnit">
            <column name="expcond_expunit_zdb_id"/>
        </many-to-one>

        <many-to-one name="morpholino" class="org.zfin.marker.Marker">
            <column name="expcond_mrkr_zdb_id"/>
        </many-to-one>

    </class>

    <class name="org.zfin.expression.ExperimentUnit" table="experiment_unit">
        <id name="zdbID" type="string">
            <column name="expunit_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">EXPUNIT</param>
            </generator>
        </id>

        <property name="name" column="expunit_name"/>
        <property name="group" column="expunit_condition_group"/>
    </class>

    <class name="org.zfin.feature.FeatureHistory" table="feature_history">
        <id name="zdbID">
            <column name="fhist_zdb_id"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">NOMEN</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>
        <property name="reason" type="featureHistoryReason">
            <column name="fhist_reason"/>
        </property>
        <property name="event">
            <column name="fhist_event"/>
        </property>
        <property name="name">
            <column name="fhist_ftr_name_on_fhist_date"/>
        </property>
        <property name="abbreviation">
            <column name="fhist_ftr_abbrev_on_fhist_date"/>
        </property>
        <property name="date">
            <column name="fhist_date"/>
        </property>

        <!-- todo: figure out if this should be one to one -->
        <many-to-one name="featureAlias" column="fhist_dalias_zdb_id" class="org.zfin.feature.FeatureAlias"/>

        <many-to-one name="feature" column="fhist_ftr_zdb_id" class="org.zfin.feature.Feature"/>
    </class>

    <class name="org.zfin.feature.FeatureAssay" table="feature_assay">

         <id name="pkid" type="int">
            <column name="featassay_pk_id" not-null="true"/>
            <generator class="increment"/>
        </id>
        <property name="featzdbID">
            <column name="featassay_feature_zdb_id"/>
        </property>

        <property name="mutagen" type="featAssayMutagen">
            <column name="featassay_mutagen"/>
        </property>
        <property name="mutagee" type="featAssayMutagee">
            <column name="featassay_mutagee"/>
        </property>

    </class>


    <!--This is here solely for the purpose of hql query to allow ordering by significane.-->
    <!--This is also mapped by FeatureTypeEnum, which should be used primarily.-->
    <class name="org.zfin.feature.FeatureType" table="feature_type">
        <id name="name">
            <column name="ftrtype_name"/>
        </id>
        <property name="significance">
            <column name="ftrtype_significance"/>
        </property>
        <property name="dispName">
            <column name="ftrtype_type_display"/>
        </property>
    </class>

    <class name="org.zfin.feature.FeaturePrefix" table="feature_prefix">
        <id name="featurePkID" type ="integer">
            <column name="fp_pk_id" />
        </id>
        <property name="prefixString" column="fp_prefix"/>
        <property name="institute" column="fp_institute_display"/>

    </class>


    <class name="org.zfin.feature.FeatureTypeGroup" table="feature_type_group">
        <cache usage="read-only"/>
        <id name="name">
            <column name="ftrgrp_name"/>
        </id>
        <property name="comment" column="ftrgrp_comments"/>
        <set name="typeStrings" table="feature_type_group_member">
            <key column="ftrgrpmem_ftr_type_group"/>
            <element column="ftrgrpmem_ftr_type" type="string"/>
        </set>

    </class>
    <class name="org.zfin.feature.FeatureMarkerRelationshipType" table="feature_marker_relationship_type">
        <id name="name">
            <column name="fmreltype_name"/>
        </id>
        <many-to-one name="featureTypeGroup" column="fmreltype_ftr_type_group"
                     foreign-key="fmreltype_ftr_type_group" class="org.zfin.feature.FeatureTypeGroup"/>
        <many-to-one name="markerTypeGroup" column="fmreltype_mrkr_type_group"
                     foreign-key="fmreltype_mrkr_type_group" class="org.zfin.marker.MarkerTypeGroup"/>
        <property name="affectedMarkerFlag" type="boolean">
            <column name="fmreltype_produces_affected_marker"/>
        </property>
        <property name="firstToSecondLabel" column="fmreltype_1_to_2_comments"/>
        <property name="secondToFirstLabel" column="fmreltype_2_to_1_comments"/>
    </class>


    <class name="org.zfin.mutant.GenotypeFigure" table="genotype_figure_fast_search">
        <id name="id" type="int">
            <column name="gffs_serial_id" not-null="true"/>
            <generator class="identity"/>
        </id>
        <many-to-one name="genotype" class="org.zfin.mutant.Genotype">
            <column name="gffs_geno_zdb_id" not-null="true"/>
        </many-to-one>
        <many-to-one name="figure" class="org.zfin.expression.Figure">
            <column name="gffs_fig_zdb_id" not-null="true"/>
        </many-to-one>
        <many-to-one name="superTerm" column="gffs_superterm_zdb_id"/>
        <many-to-one name="subTerm" column="gffs_subterm_zdb_id"/>
        <many-to-one name="qualityTerm" column="gffs_quality_zdb_id"/>

        <property name="tag" type="string" column="gffs_tag" not-null="true"/>
        <many-to-one name="morpholino" class="org.zfin.marker.Marker">
            <column name="gffs_morph_zdb_id" not-null="false"/>
        </many-to-one>
    </class>

    <class name="org.zfin.mutant.Zygosity" table="zygocity">
        <id name="zdbID" type="string">
            <column name="zyg_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">ZYG</param>
            </generator>
        </id>

        <property name="name" column="zyg_name"/>
        <property name="abbreviation" column="zyg_abbrev"/>
        <property name="definition" column="zyg_definition"/>
        <property name="alleleDisplay" column="zyg_allele_display"/>

    </class>

    <class name="org.zfin.mutant.PhenotypeStructure" table="apato_infrastructure">
        <id name="zdbID" type="string">
            <column name="api_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">API</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>
        <many-to-one name="publication" column="api_pub_zdb_id"/>
        <many-to-one name="person" column="api_curator_zdb_id"/>
        <property name="date" column="api_date"/>
        <!--<property name="tag" column="api_tag" type="phenotypeTag"/>-->
        <many-to-one name="superterm" column="api_superterm_zdb_id"/>
        <many-to-one name="subterm" column="api_subterm_zdb_id"/>
        <many-to-one name="quality" column="api_quality_zdb_id"/>

    </class>

</hibernate-mapping>

