<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="org.zfin.marker">

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="markerRelationshipType">
        <param name="enumClassname">org.zfin.marker.MarkerRelationship$Type</param>
    </typedef>

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="markerHistoryReason">
        <param name="enumClassname">org.zfin.marker.MarkerHistory$Reason</param>
    </typedef>

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="dataAliasGroup">
        <param name="enumClassname">org.zfin.infrastructure.DataAlias$Group</param>
    </typedef>

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="antibodyType">
        <param name="enumClassname">org.zfin.antibody.AntibodyType</param>
    </typedef>

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="cloneProblemType">
        <param name="enumClassname">org.zfin.marker.Clone$ProblemType</param>
    </typedef>

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="transcriptType">
        <param name="enumClassname">org.zfin.marker.TranscriptType$Type</param>
    </typedef>

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="transcriptStatus">
        <param name="enumClassname">org.zfin.marker.TranscriptStatus$Status</param>
    </typedef>


    <class name="org.zfin.marker.MarkerRelationship" table="marker_relationship">
        <id name="zdbID" type="string">
            <column name="mrel_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">MREL</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>

        <property name="type" column="mrel_type" type="markerRelationshipType" />

        <many-to-one name="markerRelationshipType" column="mrel_type" insert="false" update="false"
                     foreign-key="mrel_type" class="MarkerRelationshipType"/>
        <many-to-one name="firstMarker" class="org.zfin.marker.Marker" column="mrel_mrkr_1_zdb_id" lazy="no-proxy"/>
        <many-to-one name="secondMarker" class="org.zfin.marker.Marker" column="mrel_mrkr_2_zdb_id" lazy="no-proxy"/>

        <set name="publications" lazy="true" cascade="all">
            <key column="recattrib_data_zdb_id" />
            <one-to-many class="org.zfin.infrastructure.PublicationAttribution" />
        </set>
    </class>

    <class name="org.zfin.marker.MarkerRelationshipType" table="marker_relationship_type" >
        <id name="name">
            <column name="mreltype_name"/>
        </id>
        <property name="firstToSecondLabel" column="mreltype_1_to_2_comments"/>
        <property name="secondToFirstLabel" column="mreltype_2_to_1_comments"/>
        <many-to-one name="firstMarkerTypeGroup" column="mreltype_mrkr_type_group_1"
            foreign-key="mreltype_mrkr_type_group_1" class="org.zfin.marker.MarkerTypeGroup"/>
        <many-to-one name="secondMarkerTypeGroup" column="mreltype_mrkr_type_group_2"
            foreign-key="mreltype_mrkr_type_group_2" class="org.zfin.marker.MarkerTypeGroup"/>
    </class>




    <class name="org.zfin.marker.Marker" table="marker">
        <id name="zdbID" type="string">
            <column name="mrkr_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="isMarker">true</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>

        <property name="name">
            <column name="mrkr_name" not-null="true"/>
        </property>

        <property name="abbreviation">
            <column name="mrkr_abbrev" not-null="true"/>
        </property>
        <many-to-one name="owner" column="mrkr_owner"
                     class="org.zfin.people.Person"
                     not-null="true"/>

        <many-to-one name="markerType" column="mrkr_type"
                     foreign-key="mrkr_type" not-null="true"
                     class="org.zfin.marker.MarkerType"/>

        <property name="abbreviationOrder">
            <column name="mrkr_abbrev_order"/>
        </property>

        <property name="publicComments">
            <column name="mrkr_comments"/>
        </property>


        <set name="probeExpressionExperiments" lazy="true">
            <key column="xpatex_probe_feature_zdb_id"/>
            <one-to-many class="org.zfin.expression.ExpressionExperiment"/>
        </set>

        <set name="orthologues" lazy="true">
            <key column="c_gene_id"/>
            <one-to-many class="org.zfin.orthology.Orthologue"/>
        </set>

        <set name="firstMarkerRelationships" lazy="true">
            <key column="mrel_mrkr_1_zdb_id"/>
            <one-to-many class="org.zfin.marker.MarkerRelationship"/>
        </set>

        <set name="secondMarkerRelationships" lazy="true">
            <key column="mrel_mrkr_2_zdb_id"/>
            <one-to-many class="org.zfin.marker.MarkerRelationship"/>
        </set>
       

        <set name="dataNotes" lazy="true">
            <key column="dnote_data_zdb_id"/>
            <one-to-many class="org.zfin.infrastructure.DataNote"/>
        </set>

        <set name="markerHistory" lazy="true">
            <key column="mhist_mrkr_zdb_id"/>
            <one-to-many class="org.zfin.marker.MarkerHistory"/>
        </set>

        <set name="directPanelMappings" lazy="true">
            <key column="marker_id"/>
            <one-to-many class="org.zfin.mapping.MappedMarker"/>
        </set>

        <!-- ToDo: This should be mapped as a many-to-one or even better part of a Gene class -->
        <set name="familyName" lazy="true" table="genedom_family_member">
            <key column="gfammem_mrkr_zdb_id"/>
            <many-to-many column="gfammem_gfam_name" class="org.zfin.marker.MarkerFamilyName"/>
        </set>

        <set name="suppliers">
            <key column="idsup_data_zdb_id" update="false"/>
            <one-to-many class="org.zfin.people.MarkerSupplier" />
        </set>

        <set name="aliases" lazy="true" table="data_alias"  order-by="dalias_alias_lower" inverse="false">
            <key column="dalias_data_zdb_id" />
            <one-to-many class="org.zfin.marker.MarkerAlias" />
        </set>

        <set name="publications" lazy="true">
            <key column="recattrib_data_zdb_id" />
            <one-to-many class="org.zfin.infrastructure.PublicationAttribution" />
        </set>

        <set name="dbLinks" lazy="true">
            <key column="dblink_linked_recid"/>
            <one-to-many class="org.zfin.sequence.MarkerDBLink"/>
        </set>

        <set name="orthologyNotes" lazy="true">
            <key column="extnote_data_zdb_id" />
            <one-to-many class="org.zfin.marker.OrthologyNote" />
        </set>

        <joined-subclass name="org.zfin.antibody.Antibody" table="antibody">
            <key column="atb_zdb_id" />

            <property name="clonalType" column="atb_type"/>

            <property name="immunogenSpecies" column="atb_immun_organism" />

            <property name="hostSpecies" column="atb_host_organism" />

            <property name="heavyChainIsotype" column="atb_hviso_name" />

            <property name="lightChainIsotype" column="atb_ltiso_name" />

            <set name="antibodyLabelings" lazy="true">
                <key column="xpatex_atb_zdb_id" />
                <one-to-many class="org.zfin.expression.ExpressionExperiment" />
            </set>

            <set name="externalNotes" lazy="true">
                <key column="extnote_data_zdb_id" />
                <one-to-many class="org.zfin.antibody.AntibodyExternalNote" />
            </set>

        </joined-subclass>

        <joined-subclass name="org.zfin.marker.Clone" table="clone">
            <key column="clone_mrkr_zdb_id"/>
            
            <property name="rating" column="clone_rating" not-null="false"/>
            <property name="problem" column="clone_problem_type" not-null="false" type="cloneProblemType" />
            <property name="digest" column="clone_digest" not-null="false" />
            <property name="insertSize" column="clone_insert_size" not-null="false"  />
            <property name="polymeraseName" column="clone_polymerase_name" not-null="false"  />
            <property name="pcrAmplification" column="clone_pcr_amplification" not-null="false"  />
            <property name="cloneComments" column="clone_comments" not-null="false"  />
            <property name="cloningSite" column="clone_cloning_site" not-null="false"  />

            <many-to-one name="vector" column="clone_vector_name" not-null="false" class="org.zfin.marker.Vector" />
            <many-to-one name="probeLibrary" column="clone_probelib_zdb_id" not-null="false" class="org.zfin.marker.ProbeLibrary"  />

            <set name="expressionExperiments" lazy="true">
                <key column="xpatex_probe_feature_zdb_id"/>
                <one-to-many class="org.zfin.expression.ExpressionExperiment"/>
            </set>
        </joined-subclass>

        <joined-subclass name="org.zfin.marker.Transcript" table="transcript">
            <key column="tscript_mrkr_zdb_id" />
            <many-to-one name="transcriptType" column="tscript_type_id" class="TranscriptType" not-null="true"/>
            <many-to-one name="status" column="tscript_status_id" class="TranscriptStatus" not-null="false"/>

            <set name="transcriptDBLinks" lazy="true">
                <key column="dblink_linked_recid"/>
                <one-to-many class="org.zfin.sequence.TranscriptDBLink"/>
            </set>
        </joined-subclass>

        <joined-subclass name="org.zfin.marker.MarkerSequenceMarker" table="marker_sequence">
            <key column="mrkrseq_mrkr_zdb_id" />
            <set name="sequences" lazy="true">
                <key column="mrkrseq_mrkr_zdb_id"/>
                <one-to-many class="org.zfin.sequence.MarkerSequence"/>
            </set>

        </joined-subclass>
    </class>

    <class name="org.zfin.marker.Vector" table="vector">
        <id name="name" type="string">
            <column name="vector_name" not-null="true"/>
        </id>
        <property name="type" column="vector_type_name"/>
    </class>

    <class name="ProbeLibrary" table="probe_library">
        <id name="zdbID" type="string">
            <column name="probelib_zdb_id" not-null="true"/>
        </id>
        <property name="host" column="probelib_host"/>
        <property name="name" column="probelib_name"/>
        <property name="nonZfinStrain" column="probelib_non_zfin_strain_name"/>
        <property name="nonZfinTissue" column="probelib_non_zfin_tissue_name"/>
        <property name="restrictionSites" column="probelib_restriction_sites"/>
        <property name="sex" column="probelib_sex"/>
        <!--<many-to-one name="species" column="probelib_species" class="org.zfin.Species"/>-->
        <many-to-one name="strain" column="probelib_strain_zdb_id" class="org.zfin.mutant.Genotype"/>
        <property name="species" column="probelib_species"/>
        <many-to-one name="tissue" column="probelib_tissue_zdb_id" class="org.zfin.anatomy.AnatomyItem"/>
        <property name="url" column="probelib_url"/>

    </class>

    <class name="MarkerFamilyName" table="genedom_family_name">
        <id name="markerFamilyName" length="30">
            <column name="gfam_name" not-null="true"/>
            <generator class="native"/>
        </id>
    </class>

    <class name="org.zfin.marker.MarkerType" table="marker_types">
        <cache usage="read-only"/>
        <id name="name">
            <column name="marker_type"/>
        </id>
        <property name="displayName" column="mrkrtype_type_display"/>
        <set name="typeGroupStrings" table="marker_type_group_member">
            <key column="mtgrpmem_mrkr_type"/>
            <element column="mtgrpmem_mrkr_type_group" type="string"/>
        </set>
    </class>

    <class name="org.zfin.marker.TranscriptType" table="transcript_type">
        <id name = "id">
            <column name="tscriptt_pk_id"/>
        </id>
        <property name="type" column="tscriptt_type" type="transcriptType" not-null="true"/>
        <property name="display" column="tscriptt_display" not-null="true"/>
        <property name="order" column="tscriptt_order" not-null="true"/>
        <property name="definition" column="tscriptt_definition" not-null="false"/>
        <property name="indented" column="tscriptt_indent" type="boolean" not-null="true"/>
    </class>

    <class name="org.zfin.marker.TranscriptStatus" table="transcript_status">
        <id name = "id">
            <column name="tscripts_pk_id"/>
        </id>
        <property name="status" column="tscripts_status"  type="transcriptStatus" not-null="true"/>
        <property name="display" column="tscripts_display" not-null="true"/>
        <property name="order" column="tscripts_order" not-null="true"/>
    </class>

    <class name="TranscriptTypeStatusDefinition" table="tscript_type_status_definition">
        <id name="id">
            <column name="ttsdef_pk_id"/>
        </id>
        <many-to-one name="status" class="TranscriptStatus" column="ttsdef_tscript_status_id"/>
        <many-to-one name="type" class="TranscriptType" column="ttsdef_tscript_type_id"/>
        <property name="definition" column="ttsdef_definition"/>
    </class>


    <class name="org.zfin.marker.MarkerTypeGroup" table="marker_type_group">
        <cache usage="read-only"/>
        <id name="name">
            <column name="mtgrp_name"/>
        </id>
        <property name="comment" column="mtgrp_comments"/>
        <set name="typeStrings" table="marker_type_group_member">
            <key column="mtgrpmem_mrkr_type_group"/>
            <element column="mtgrpmem_mrkr_type" type="string"/>
        </set>
    </class>

    <!-- this should be replaced with a full fledged mapping of gene or go away -->
    <class name="org.zfin.marker.Gene" table="marker">
        <id name="zdbID">
            <column name="mrkr_zdb_id"/>
        </id>
        <property name="symbol">
            <column name="mrkr_abbrev"/>
        </property>
        <property name="name">
            <column name="mrkr_name"/>
        </property>
    </class>

    <class name="org.zfin.marker.MarkerHistory" table="marker_history">
        <id name="zdbID">
            <column name="mhist_zdb_id"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">NOMEN</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>
        <property name="reason" type="markerHistoryReason">
            <column name="mhist_reason"/>
        </property>
        <property name="event">
            <column name="mhist_event"/>
        </property>
        <property name="name">
            <column name="mhist_mrkr_name_on_mhist_date"/>
        </property>
        <property name="abbreviation">
            <column name="mhist_mrkr_abbrev_on_mhist_date"/>
        </property>
        <property name="date">
            <column name="mhist_date"/>
        </property>

        <!-- todo: figure out if this should be one to one -->
        <many-to-one name="markerAlias" column="mhist_dalias_zdb_id" class="org.zfin.marker.MarkerAlias"/>

        <many-to-one name="marker" column="mhist_mrkr_zdb_id" class="org.zfin.marker.Marker"/>
    </class>

    <sql-query name="markerNamesFastSearchUpdate" callable="true">
        {call regen_names_marker(:markerZdbID)}
    </sql-query>
</hibernate-mapping>

