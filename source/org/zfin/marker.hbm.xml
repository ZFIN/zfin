<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="org.zfin.marker">

    <typedef class="org.zfin.database.StringEnumUserType" name="markerRelationshipType">
        <param name="enumClassname">org.zfin.marker.MarkerRelationship$Type</param>
    </typedef>

    <typedef class="org.zfin.database.StringEnumUserType" name="markerHistoryReason">
        <param name="enumClassname">org.zfin.marker.MarkerHistory$Reason</param>
    </typedef>

    <typedef class="org.zfin.database.StringEnumUserType" name="dataAliasGroup">
        <param name="enumClassname">org.zfin.infrastructure.DataAlias$Group</param>
    </typedef>

    <typedef class="org.zfin.database.StringEnumUserType" name="cloneProblemType">
        <param name="enumClassname">org.zfin.marker.Clone$ProblemType</param>
    </typedef>

    <class name="org.zfin.marker.Clone" table="clone">
        <id name="zdbID" type="string">
            <column name="clone_mrkr_zdb_id" not-null="true"/>
            <generator class="native"/>
        </id>

        <property name="rating">
            <column name="clone_rating" not-null="true"/>
        </property>


        <property name="problem">
            <column name="clone_problem_type" not-null="false"/>
        </property>


        <set name="expressionExperiments" lazy="true">
            <key column="xpatex_probe_feature_zdb_id"/>
            <one-to-many class="org.zfin.expression.ExpressionExperiment"/>
        </set>

    </class>

    <class name="org.zfin.marker.MarkerRelationship" table="marker_relationship">
        <id name="zdbID" type="string">
            <column name="mrel_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">MREL</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>

        <property name="type" column="mrel_type" type="markerRelationshipType"/>

        <many-to-one name="firstMarker" class="org.zfin.marker.Marker" column="mrel_mrkr_1_zdb_id" lazy="no-proxy"/>
        <many-to-one name="secondMarker" class="org.zfin.marker.Marker" column="mrel_mrkr_2_zdb_id" lazy="no-proxy"/>


    </class>


    <class name="org.zfin.marker.Marker" table="marker">
        <id name="zdbID" type="string">
            <column name="mrkr_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="isMarker">true</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>

        <property name="name">
            <column name="mrkr_name" not-null="true"/>
        </property>

        <property name="abbreviation">
            <column name="mrkr_abbrev" not-null="true"/>
        </property>
        <many-to-one name="owner" column="mrkr_owner"
                     class="org.zfin.people.Person"
                     not-null="true"/>


        <many-to-one name="markerType" column="mrkr_type"
                     foreign-key="mrkr_type" not-null="true"
                     class="org.zfin.marker.MarkerType"/>


        <property name="abbreviationOrder">
            <column name="mrkr_abbrev_order"/>
        </property>

        <property name="comments">
            <column name="mrkr_comments"/>
        </property>

        <set name="dbLinks" lazy="true">
            <key column="dblink_linked_recid"/>
            <one-to-many class="org.zfin.sequence.MarkerDBLink"/>
        </set>


        <set name="probeExpressionExperiments" lazy="true">
            <key column="xpatex_probe_feature_zdb_id"/>
            <one-to-many class="org.zfin.expression.ExpressionExperiment"/>
        </set>

        <set name="orthologues" lazy="true">
            <key column="c_gene_id"/>
            <one-to-many class="org.zfin.orthology.Orthologue"/>
        </set>

        <set name="firstMarkerRelationships" lazy="true">
            <key column="mrel_mrkr_1_zdb_id"/>
            <one-to-many class="org.zfin.marker.MarkerRelationship"/>
        </set>

        <set name="secondMarkerRelationships" lazy="true">
            <key column="mrel_mrkr_2_zdb_id"/>
            <one-to-many class="org.zfin.marker.MarkerRelationship"/>
        </set>

        <set name="dataNotes" lazy="true">
            <key column="dnote_data_zdb_id"/>
            <one-to-many class="org.zfin.infrastructure.DataNote"/>
        </set>

        <set name="markerHistory" lazy="true">
            <key column="mhist_mrkr_zdb_id"/>
            <one-to-many class="org.zfin.marker.MarkerHistory"/>
        </set>

        <set name="directPanelMappings" lazy="true">
            <key column="marker_id"/>
            <one-to-many class="org.zfin.mapping.MappedMarker"/>
        </set>

        <!-- ToDo: This should be mapped as a many-to-one or even better part of a Gene class -->
        <set name="familyName" lazy="true" table="genedom_family_member">
            <key column="gfammem_mrkr_zdb_id"/>
            <many-to-many column="gfammem_gfam_name" class="org.zfin.marker.MarkerFamilyName"/>
        </set>
    </class>

    <class name="MarkerFamilyName" table="genedom_family_name">
        <id name="markerFamilyName" length="30">
            <column name="gfam_name" not-null="true"/>
            <generator class="native"/>
        </id>
    </class>

    <class name="org.zfin.marker.MarkerType" table="marker_types">
        <id name="name">
            <column name="marker_type"/>
        </id>
        <set name="typeGroupStrings" table="marker_type_group_member">
            <key column="mtgrpmem_mrkr_type"/>
            <element column="mtgrpmem_mrkr_type_group" type="string"/>
        </set>
    </class>


    <class name="org.zfin.marker.MarkerTypeGroup" table="marker_type_group">
        <id name="name">
            <column name="mtgrp_name"/>
        </id>
        <property name="comment" column="mtgrp_comments"/>
        <set name="typeStrings" table="marker_type_group_member">
            <key column="mtgrpmem_mrkr_type_group"/>
            <element column="mtgrpmem_mrkr_type" type="string"/>
        </set>
    </class>

    <!-- this should be replaced with a full fledged mapping of gene or go away -->
    <class name="org.zfin.marker.Gene" table="marker">
        <id name="zdbID">
            <column name="mrkr_zdb_id"/>
        </id>
        <property name="symbol">
            <column name="mrkr_abbrev"/>
        </property>
        <property name="name">
            <column name="mrkr_name"/>
        </property>
    </class>

    <class name="org.zfin.marker.MarkerHistory" table="marker_history">
        <id name="zdbID">
            <column name="mhist_zdb_id"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">NOMEN</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>
        <property name="reason" type="markerHistoryReason">
            <column name="mhist_reason"/>
        </property>
        <property name="event">
            <column name="mhist_event"/>
        </property>
        <property name="name">
            <column name="mhist_mrkr_name_on_mhist_date"/>
        </property>
        <property name="abbreviation">
            <column name="mhist_mrkr_abbrev_on_mhist_date"/>
        </property>
        <property name="date">
            <column name="mhist_date"/>
        </property>

        <!-- todo: figure out if this should be one to one -->
        <many-to-one name="markerAlias" column="mhist_dalias_zdb_id" class="org.zfin.marker.MarkerAlias"/>

        <many-to-one name="marker" column="mhist_mrkr_zdb_id" class="org.zfin.marker.Marker"/>
    </class>

    <!--
        <class name="org.zfin.marker.MarkerAlias" table="data_alias">
            <id name="zdbID">
                <column name="dalias_zdb_id"/>
                <generator class="org.zfin.database.ZdbIdGenerator">
                    <param name="type">DALIAS</param>
                    <param name="insertActiveData">true</param>
                </generator>
            </id>
            <property name="alias">
                <column name="dalias_alias"/>
            </property>
            <property name="group" type="dataAliasGroup">
                <column name="dalias_group"/>
            </property>
            <many-to-one name="marker" column="dalias_data_zdb_id" class="org.zfin.marker.Marker"/>
        </class>

    -->
    <sql-query name="markerNamesFastSearchUpdate" callable="true">
        {call regen_names_marker(:markerZdbID)}
    </sql-query>
</hibernate-mapping>

