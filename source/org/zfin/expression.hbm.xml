<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="org.zfin.expression">

    <class name="org.zfin.expression.Figure" table="figure">
        <id name="zdbID" type="string">
            <column name="fig_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">FIG</param>
            </generator>
        </id>

        <property name="caption">
            <column name="fig_caption"/>
        </property>

        <property name="comments">
            <column name="fig_comments"/>
        </property>

        <property name="label">
            <column name="fig_label"/>
        </property>

        <property name="orderingLabel">
            <column name="fig_full_label"/>
        </property>

        <set name="expressionResults" lazy="true" table="expression_pattern_figure">
            <key column="xpatfig_fig_zdb_id"/>
            <many-to-many class="org.zfin.expression.ExpressionResult" column="xpatfig_xpatres_zdb_id"/>
        </set>

        <set name="images" lazy="true">
            <key column="img_fig_zdb_id"/>
            <one-to-many class="org.zfin.expression.Image"/>
        </set>

        <many-to-one name="publication" class="org.zfin.publication.Publication" column="fig_source_zdb_id"
                     insert="false"
                     update="false"/>

    </class>

    <class name="org.zfin.expression.Image" table="image">

        <id name="zdbID" type="string">
            <column name="img_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">IMAGE</param>
            </generator>
        </id>

        <many-to-one name="figure" class="org.zfin.expression.Figure" column="img_fig_zdb_id"/>

        <property name="thumbnail">
            <column name="img_thumbnail"/>
        </property>
    </class>

    <class name="org.zfin.expression.ExpressionExperiment" table="expression_experiment">
        <id name="zdbID" type="string">
            <column name="xpatex_zdb_id" not-null="true"/>
            <generator class="native"/>
        </id>

        <property name="publicationID">
            <column name="xpatex_source_zdb_id" not-null="true"/>
        </property>

        <property name="cloneID">
            <column name="xpatex_probe_feature_zdb_id" not-null="true"/>
        </property>

        <property name="geneID">
            <column name="xpatex_gene_zdb_id" not-null="true"/>
        </property>

        <many-to-one name="publication" class="org.zfin.publication.Publication" column="xpatex_source_zdb_id"
                     insert="false"
                     update="false"/>

        <many-to-one name="marker" class="org.zfin.marker.Marker" column="xpatex_gene_zdb_id" insert="false"
                     update="false"/>

        <many-to-one name="probe" class="org.zfin.marker.Marker" column="xpatex_probe_feature_zdb_id" insert="false"
                     update="false"/>

        <many-to-one name="clone" class="org.zfin.marker.Clone" column="xpatex_probe_feature_zdb_id" insert="false"
                     update="false"/>

        <set name="expressionResults" lazy="true">
            <key column="xpatres_xpatex_zdb_id"/>
            <one-to-many class="org.zfin.expression.ExpressionResult"/>
        </set>

        <many-to-one name="genotypeExperiment" column="xpatex_genox_zdb_id"
                     class="org.zfin.mutant.GenotypeExperiment"/>

        <many-to-one name="assay" column="xpatex_assay_name" class="org.zfin.expression.ExpressionAssay"/>

        <many-to-one name="antibody" column="xpatex_atb_zdb_id" class="org.zfin.antibody.Antibody"/>
    </class>

    <class name="org.zfin.expression.ExpressionResult" table="expression_result">
        <id name="zdbID" type="string">
            <column name="xpatres_zdb_id" not-null="true"/>
            <generator class="native"/>
        </id>

        <property name="expressionFound">
            <column name="xpatres_expression_found"/>
        </property>

        <many-to-one name="expressionExperiment" class="org.zfin.expression.ExpressionExperiment"
                     column="xpatres_xpatex_zdb_id"
                     insert="false"
                     update="false"/>

        <many-to-one name="anatomyTerm" class="org.zfin.anatomy.AnatomyItem"
                     column="xpatres_anat_item_zdb_id"
                     insert="false"
                     update="false"/>
        <many-to-one name="startStage" class="org.zfin.anatomy.DevelopmentStage"
                     column="xpatres_start_stg_zdb_id"/>
        <many-to-one name="endStage" class="org.zfin.anatomy.DevelopmentStage"
                     column="xpatres_end_stg_zdb_id"/>

        <set name="figures" table="expression_pattern_figure">
            <key column="xpatfig_xpatres_zdb_id"/>
            <many-to-many class="org.zfin.expression.Figure"
                          column="xpatfig_fig_zdb_id"/>
        </set>

        <many-to-one name="goTerm" class="org.zfin.ontology.GoTerm" column="xpatres_go_term_zdb_id"/>

    </class>

    <class name="org.zfin.expression.Experiment" table="experiment">
        <id name="zdbID">
            <column name="exp_zdb_id"/>
        </id>

        <property name="name">
            <column name="exp_name"/>
        </property>

        <set name="experimentConditions" lazy="true">
            <key column="expcond_exp_zdb_id"/>
            <one-to-many class="org.zfin.expression.ExperimentCondition"/>
        </set>
    </class>

    <class name="org.zfin.expression.ExpressionAssay" table="expression_pattern_assay">
        <id name="name" column="xpatassay_name">
            <generator class="native"/>
        </id>

        <property name="abbreviation" column="xpatassay_abbrev"/>
        <property name="comments" column="xpatassay_comments"/>
        <property name="displayOrder" column="xpatassay_display_order"/>
      
    </class>


    <query name="stageanatomyfigure"><![CDATA[
        select stage, xpatres.anatomyTerm, xpatres.figures
        from org.zfin.anatomy.DevelopmentStage stage,
             org.zfin.expression.ExpressionResult xpatres,
             org.zfin.expression.ExpressionExperiment xpatex
        where xpatex.marker.zdbID = :geneZdbID
          and xpatres member of xpatex.expressionResults
          and xpatex.genotypeExperiment.experiment.name in ('_Standard','_Generic-control')
          and xpatex.genotypeExperiment.genotype.wildtype = true
          and xpatres.anatomyTerm.name <> :unspecified
          and xpatres.startStage.name <> :unknown
          and stage.hoursStart >= xpatres.startStage.hoursStart
          and stage.hoursEnd <= xpatres.endStage.hoursEnd
        order by stage.hoursStart, xpatres.anatomyTerm.nameOrder
       ]]>
    </query>       

</hibernate-mapping>
