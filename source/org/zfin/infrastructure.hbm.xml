<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.jboss.org/dtd/hibernate/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="org.zfin.infrastructure">

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="recordAttributionSourceType">
        <param name="enumClassname">org.zfin.infrastructure.RecordAttribution$SourceType</param>
    </typedef>

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="zdbFlagType">
        <param name="enumClassname">org.zfin.infrastructure.ZdbFlag$Type</param>
    </typedef>

    <typedef class="org.zfin.framework.StringEnumValueUserType" name="dataAliasGroup">
        <param name="enumClassname">org.zfin.infrastructure.DataAliasGroup$Group</param>
    </typedef>

    <typedef class="org.zfin.ontology.OntologyEnumUserType" name="ontologyEnumeration">
        <param name="enumClassname">org.zfin.ontology.Ontology</param>
    </typedef>

    <class name="org.zfin.infrastructure.DataAlias" table="DATA_ALIAS">
        <cache usage="nonstrict-read-write"/>
        <id name="zdbID">
            <column name="dalias_zdb_id"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">DALIAS</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>

        <discriminator type="string"
                       formula="(CASE get_obj_type(dalias_data_zdb_id)
                                    WHEN 'ANAT' THEN 'Anatom'
                                    WHEN 'GENE' THEN 'Marker'
                                    WHEN 'ATB' THEN  'Marker'
                                    WHEN 'TERM' THEN 'Term  '
                                    WHEN 'GENO' THEN 'Genoty'
                                    WHEN 'ALT'  THEN 'Featur'
                                    ELSE             'Marker'
                                 END)"/>

        <property name="alias" column="dalias_alias"/>
        <property name="aliasLowerCase" column="dalias_alias_lower"/>
        <property name="dataZdbID" column="dalias_data_zdb_id" update="false" insert="false"/>

        <many-to-one name="aliasGroup" class="org.zfin.infrastructure.DataAliasGroup" column="dalias_group_id"
                     not-null="true"/>

        <set name="sources" lazy="true" table="record_attribution">
            <key column="recattrib_data_zdb_id" foreign-key="recattrib_data_zdb_id"/>
            <many-to-many class="org.zfin.infrastructure.ActiveSource" column="recattrib_source_zdb_id"/>
        </set>

        <set name="publications" lazy="true" cascade="all">
            <key column="recattrib_data_zdb_id" update="false"/>
            <one-to-many class="org.zfin.infrastructure.PublicationAttribution"/>
        </set>

        <subclass name="org.zfin.marker.MarkerAlias" discriminator-value="Marker">
            <many-to-one name="marker" column="dalias_data_zdb_id" class="org.zfin.marker.Marker"/>
        </subclass>
        <subclass name="org.zfin.feature.FeatureAlias" discriminator-value="Featur">
            <many-to-one name="feature" column="dalias_data_zdb_id" class="org.zfin.feature.Feature"/>
        </subclass>

        <subclass name="org.zfin.ontology.TermAlias" discriminator-value="Term  ">
            <many-to-one name="term" column="dalias_data_zdb_id" class="org.zfin.ontology.GenericTerm"/>
        </subclass>

        <subclass name="org.zfin.mutant.GenotypeAlias" discriminator-value="Genoty">
            <many-to-one name="genotype" column="dalias_data_zdb_id" class="org.zfin.mutant.Genotype"/>
        </subclass>

    </class>

    <class name="org.zfin.infrastructure.AllNamesFastSearch" table="all_map_names">
        <id name="id" type="int">
            <column name="allmapnm_serial_id" not-null="true"/>
            <generator class="identity"/>
        </id>

        <discriminator type="string"
                       formula="(CASE get_obj_type(allmapnm_zdb_id)
                                    WHEN 'ALT'  THEN     'Alt---'
                                    WHEN 'GENO' THEN     'Geno--'
                                    WHEN 'MRPHLNO' THEN  'Morpho'
                                    ELSE                 'Marker'
                                 END)"/>

        <property name="name" column="allmapnm_name" type="string"/>
        <property name="nameLowerCase" column="allmapnm_name_lower" type="string"/>
        <property name="precedence" column="allmapnm_precedence" type="string"/>

        <subclass name="org.zfin.infrastructure.AllMarkerNamesFastSearch" discriminator-value="Marker">
            <many-to-one name="marker" class="org.zfin.marker.Marker" column="allmapnm_zdb_id"/>
        </subclass>
    </class>

    <class name="org.zfin.ontology.TermDefinitionReference" table="external_reference">
        <cache usage="read-only"/>
        <id name="ID" type="long">
            <column name="exref_pk_id" not-null="true"/>
        </id>

        <many-to-one name="term" column="exref_data_zdb_id" class="org.zfin.ontology.GenericTerm"/>
        <many-to-one name="foreignDB" column="exref_foreign_db_id" class="org.zfin.sequence.ForeignDB"/>
        <property name="reference" column="exref_reference"/>

    </class>

    <class name="org.zfin.ontology.TermExternalReference" table="term_xref">
        <cache usage="read-only"/>
        <id name="ID" type="long">
            <column name="tx_pk_id" not-null="true"/>
        </id>

        <many-to-one name="term" column="tx_term_zdb_id" class="org.zfin.ontology.GenericTerm"/>
        <many-to-one name="foreignDB" column="tx_fdb_db_id" class="org.zfin.sequence.ForeignDB"/>
        <property name="fullAccession" column="tx_full_accession"/>
        <property name="prefix" column="tx_prefix"/>
        <property name="accessionNumber" column="tx_accession"/>

        <set name="omimPhenotypes" lazy="true" table="omimp_termxref_mapping" access="field">
            <key column="otm_tx_id"/>
            <many-to-many class="org.zfin.mutant.OmimPhenotype" column="otm_omimp_id"/>
        </set>
    </class>

    <class name="org.zfin.ontology.GenericTerm" mutable="false" table="TERM" batch-size="10">
        <cache usage="read-only"/>
        <id name="zdbID" type="string">
            <column name="term_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">TERM</param>
            </generator>
        </id>

        <property name="termName" column="term_name"/>
        <property name="termNameOrder" column="term_name_order"/>
        <property name="oboID" column="term_ont_id"/>
        <property name="ontology" column="term_ontology" type="ontologyEnumeration"/>
        <property name="obsolete" column="term_is_obsolete"/>
        <property name="root" column="term_is_root"/>
        <property name="secondary" column="term_is_secondary"/>
        <property name="comment" column="term_comment"/>
        <property name="definition" column="term_definition" lazy="true"/>

        <set name="aliases" lazy="false" batch-size="10">
            <key column="dalias_data_zdb_id"/>
            <one-to-many class="org.zfin.ontology.TermAlias"/>
            <filter name="noSecondaryAliasesForAO"/>
        </set>

        <set name="images" lazy="true" table="int_image_term">
            <key column="iit_term_zdb_id"/>
            <many-to-many column="iit_img_zdb_id" class="org.zfin.expression.Image"/>
        </set>

        <set name="subsets" lazy="true" table="term_subset">
            <key column="termsub_term_zdb_id"/>
            <many-to-many column="termsub_subset_id" class="org.zfin.ontology.Subset"/>
        </set>

        <set name="childTermRelationships" lazy="true" table="term_relationship" inverse="true">
            <key column="termrel_term_1_zdb_id"/>
            <one-to-many class="org.zfin.ontology.GenericTermRelationship"/>
        </set>

        <set name="parentTermRelationships" lazy="true" table="term_relationship" inverse="true">
            <key column="termrel_term_2_zdb_id"/>
            <one-to-many class="org.zfin.ontology.GenericTermRelationship"/>
        </set>

        <set name="definitionReferences" lazy="true" table="external_reference" inverse="true">
            <key column="exref_data_zdb_id"/>
            <one-to-many class="org.zfin.ontology.TermDefinitionReference"/>
        </set>

        <set name="externalReferences" lazy="true" table="term_xref" inverse="true">
            <key column="tx_term_zdb_id"/>
            <one-to-many class="org.zfin.ontology.TermExternalReference"/>
        </set>

        <join table="term_stage" optional="true">
            <key column="ts_term_zdb_id"/>
            <many-to-one name="end" column="ts_end_stg_zdb_id" lazy="proxy"/>
        </join>

        <join table="term_stage" optional="true">
            <key column="ts_term_zdb_id"/>
            <many-to-one name="start" column="ts_start_stg_zdb_id" lazy="proxy"/>
        </join>

    </class>

    <class name="org.zfin.ontology.GenericTermRelationship" table="term_relationship">
        <id name="zdbId">
            <column name="termrel_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">TERMREL</param>
            </generator>
        </id>

        <property name="type" column="termrel_type"/>
        <many-to-one name="termOne" class="org.zfin.ontology.GenericTerm" column="termrel_term_1_zdb_id"/>
        <many-to-one name="termTwo" class="org.zfin.ontology.GenericTerm" column="termrel_term_2_zdb_id"/>

    </class>

    <class name="org.zfin.ontology.Subset" table="ONTOLOGY_SUBSET">
        <id name="id">
            <column name="osubset_pk_id" not-null="true"/>
        </id>
        <property name="internalName" column="osubset_subset_name"/>
        <property name="name" column="osubset_subset_definition"/>
        <many-to-one name="metaData" column="osubset_ont_id" not-null="false"/>
    </class>

    <class name="org.zfin.ontology.TransitiveClosure" table="all_term_contains">
        <composite-id>
            <key-many-to-one name="child" column="alltermcon_contained_zdb_id"/>
            <key-many-to-one name="root" column="alltermcon_container_zdb_id"/>
        </composite-id>

        <property name="distance" column="alltermcon_min_contain_distance"/>
    </class>

    <class name="org.zfin.ontology.OntologyMetadata" table="ontology">
        <id name="id">
            <column name="ont_pk_id" not-null="true"/>
        </id>

        <property name="name" column="ont_ontology_name"/>
        <property name="date" column="ont_current_date"/>
        <property name="dataVersion" column="ont_data_version"/>
        <property name="defaultNamespace" column="ont_default_namespace"/>
        <property name="generatedBy" column="ont_import"/>
        <property name="oboVersion" column="ont_format_version"/>
        <property name="order" column="ont_order"/>
        <property name="remark" column="ont_remark"/>
        <property name="savedBy" column="ont_saved_by"/>

        <set name="subsets" lazy="false" inverse="true">
            <key column="osubset_ont_id" not-null="false"/>
            <one-to-many class="org.zfin.ontology.Subset"/>
        </set>
    </class>


</hibernate-mapping>
