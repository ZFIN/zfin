<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="org.zfin.infrastructure">

    <typedef class="org.zfin.database.StringEnumUserType" name="recordAttributionSourceType">
        <param name="enumClassname">org.zfin.infrastructure.RecordAttribution$SourceType</param>
    </typedef>

    <typedef class="org.zfin.database.StringEnumUserType" name="zdbFlagType">
        <param name="enumClassname">org.zfin.infrastructure.ZdbFlag$Type</param>
    </typedef>

    <typedef class="org.zfin.database.StringEnumUserType" name="dataAliasGroup">
        <param name="enumClassname">org.zfin.infrastructure.DataAliasGroup$Group</param>
    </typedef>

    <typedef class="org.zfin.database.StringEnumUserType" name="ontologyEnumeration">
        <param name="enumClassname">org.zfin.ontology.Ontology</param>
    </typedef>

    <class name="org.zfin.infrastructure.ActiveData" table="zdb_active_data">
        <id name="zdbID" type="string">
            <column name="zactvd_zdb_id" not-null="true"/>
        </id>
    </class>

    <class name="org.zfin.infrastructure.ActiveSource" table="zdb_active_source">
        <id name="zdbID" type="string">
            <column name="zactvs_zdb_id" not-null="true"/>
        </id>
    </class>

    <class name="org.zfin.infrastructure.RecordAttribution" table="record_attribution">
        <composite-id>
            <key-property name="dataZdbID" column="recattrib_data_zdb_id" type="string"/>
            <key-property name="sourceZdbID" column="recattrib_source_zdb_id" type="string"/>
            <key-property name="sourceType" column="recattrib_source_type" type="recordAttributionSourceType"/>
        </composite-id>
        <discriminator type="string"
                       formula="(CASE get_obj_type(recattrib_source_zdb_id)
                                    WHEN 'PUB' THEN       'Pub    '
                                    WHEN 'PERS' THEN      'Person '
                                    WHEN 'COMPANY' THEN   'Company'
                                    WHEN 'JRNL' THEN      'Journal'
                                    ELSE                  'other'
                                 END)"/>

        <subclass name="org.zfin.infrastructure.PublicationAttribution" discriminator-value="Pub    ">
            <many-to-one name="publication" column="recattrib_source_zdb_id" insert="false" update="false"/>
        </subclass>

        <subclass name="org.zfin.infrastructure.PersonAttribution" discriminator-value="Person ">
            <many-to-one name="person" column="recattrib_source_zdb_id" insert="false" update="false"/>
        </subclass>

    </class>

    <class name="org.zfin.infrastructure.Updates" table="updates">
        <id name="ID" type="long">
            <column name="upd_pk_id" not-null="true"/>
            <generator class="identity"/>
        </id>
        <property name="submitterID" column="submitter_id" type="string"/>
        <property name="recID" column="rec_id" type="string"/>
        <property name="fieldName" column="field_name" type="string"/>
        <property name="newValue" column="new_value" type="string"/>
        <property name="oldValue" column="old_value" type="string"/>
        <property name="comments" column="comments" type="string"/>
        <property name="submitterName" column="submitter_name" type="string"/>
        <property name="whenUpdated" column="when" type="date"/>
    </class>

    <class name="org.zfin.infrastructure.DataNote" table="data_note">
        <id name="zdbID">
            <column name="dnote_zdb_id"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">DNOTE</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>
        <property name="dataZdbID">
            <column name="dnote_data_zdb_id"/>
        </property>
        <property name="note">
            <column name="dnote_text"/>
        </property>
        <property name="date">
            <column name="dnote_date"/>
        </property>
        <many-to-one name="curator" column="dnote_curator_zdb_id"
                     class="org.zfin.people.Person"/>
    </class>

    <class name="org.zfin.infrastructure.DataAliasGroup" table="alias_group">
        <cache usage="read-only"/>
        <id name="id" access="field">
            <column name="aliasgrp_pk_id"/>
        </id>
        <property name="name" column="aliasgrp_name"/>
        <property name="significance" column="aliasgrp_significance"/>
    </class>

    <class name="org.zfin.infrastructure.ZdbFlag" table="zdb_flag">
        <id name="type" column="zflag_name" type="zdbFlagType"/>
        <property name="systemUpdateDisabled" column="zflag_is_on"/>
        <property name="dateLastModified" column="zflag_last_modified"/>
    </class>

    <class name="org.zfin.infrastructure.DataAlias" table="DATA_ALIAS">
        <cache usage="nonstrict-read-write"/>
        <id name="zdbID">
            <column name="dalias_zdb_id"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">DALIAS</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>

        <discriminator type="string"
                       formula="(CASE get_obj_type(dalias_data_zdb_id)
                                    WHEN 'ANAT' THEN 'Anatom'
                                    WHEN 'GENE' THEN 'Marker'
                                    WHEN 'ATB' THEN  'Marker'
                                    WHEN 'TERM' THEN 'Term  '
                                    ELSE             'Marker'
                                 END)"/>

        <property name="alias" column="dalias_alias"/>
        <property name="aliasLowerCase" column="dalias_alias_lower"/>
        <property name="dataZdbID" column="dalias_data_zdb_id" update="false" insert="false"/>

        <many-to-one name="aliasGroup" class="org.zfin.infrastructure.DataAliasGroup" column="dalias_group_id"
                     not-null="true"/>

        <set name="sources" lazy="true" table="record_attribution">
            <key column="recattrib_data_zdb_id" foreign-key="recattrib_data_zdb_id"/>
            <many-to-many class="org.zfin.infrastructure.ActiveSource" column="recattrib_source_zdb_id"/>
        </set>

        <set name="publications" lazy="true" order-by="">
            <key column="recattrib_data_zdb_id"/>
            <one-to-many class="org.zfin.infrastructure.PublicationAttribution"/>
        </set>

        <subclass name="org.zfin.anatomy.AnatomySynonym" discriminator-value="Anatom">
            <many-to-one name="item" column="dalias_data_zdb_id" class="org.zfin.anatomy.AnatomyItem"/>
        </subclass>

        <subclass name="org.zfin.marker.MarkerAlias" discriminator-value="Marker">
            <many-to-one name="marker" column="dalias_data_zdb_id" class="org.zfin.marker.Marker"/>
        </subclass>
        <subclass name="org.zfin.mutant.FeatureAlias" discriminator-value="Feature">
            <many-to-one name="feature" column="dalias_data_zdb_id" class="org.zfin.mutant.Feature"/>
        </subclass>

        <subclass name="org.zfin.ontology.TermAlias" discriminator-value="Term  ">
            <many-to-one name="term" column="dalias_data_zdb_id" class="org.zfin.ontology.GenericTerm"/>
        </subclass>

    </class>

    <class name="org.zfin.ExternalNote" abstract="true" table="external_note">
        <id name="zdbID">
            <column name="extnote_zdb_id"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">EXTNOTE</param>
                <param name="insertActiveData">true</param>
            </generator>
        </id>

        <discriminator type="string"
                       formula="(CASE extnote_note_type
                                    WHEN 'antibody' THEN    'Antibody '
                                    WHEN 'orthology' THEN   'Orthology'
                                    ELSE                    'other    '
                                 END)"/>

        <property name="note" column="extnote_note"/>
        <property name="type" column="extnote_note_type"/>
        <property name="externalDataZdbID" column="extnote_data_zdb_id" insert="false" update="false"/>

        <set name="pubAttributions">
            <key>
                <column name="recattrib_data_zdb_id"/>
            </key>
            <one-to-many class="org.zfin.infrastructure.PublicationAttribution"/>
        </set>

        <set name="personAttributions">
            <key>
                <column name="recattrib_data_zdb_id"/>
            </key>
            <one-to-many class="org.zfin.infrastructure.PersonAttribution"/>
        </set>

        <subclass name="org.zfin.antibody.AntibodyExternalNote" discriminator-value="Antibody ">
            <many-to-one name="antibody" column="extnote_data_zdb_id"/>
        </subclass>

        <subclass name="org.zfin.marker.OrthologyNote" discriminator-value="Orthology">
            <many-to-one name="marker" column="extnote_data_zdb_id"/>
        </subclass>

    </class>

    <class name="org.zfin.infrastructure.AllNamesFastSearch" table="all_map_names">
        <id name="id" type="int">
            <column name="allmapnm_serial_id" not-null="true"/>
            <generator class="identity"/>
        </id>

        <discriminator type="string"
                       formula="(CASE get_obj_type(allmapnm_zdb_id)
                                    WHEN 'ALT'  THEN 'Alt---'
                                    WHEN 'GENO' THEN 'Geno--'
                                    ELSE             'Marker'
                                 END)"/>

        <property name="name" column="allmapnm_name" type="string"/>
        <property name="nameLowerCase" column="allmapnm_name_lower" type="string"/>
        <property name="precedence" column="allmapnm_precedence" type="string"/>

        <subclass name="org.zfin.infrastructure.AllMarkerNamesFastSearch" discriminator-value="Marker">
            <many-to-one name="marker" class="org.zfin.marker.Marker" column="allmapnm_zdb_id"/>
        </subclass>
    </class>

    <class name="org.zfin.infrastructure.ReplacementZdbID" table="zdb_replaced_data">
        <composite-id>
            <key-property name="oldZdbID" column="zrepld_old_zdb_id"/>
            <key-property name="replacementZdbID" column="zrepld_new_zdb_id"/>
        </composite-id>

        <property name="oldName" column="zrepld_old_name"/>
    </class>

    <class name="org.zfin.ontology.Term" table="TERM">

        <id name="ID" type="string">
            <column name="term_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">TERM</param>
            </generator>
        </id>

        <!--ToDO: Map ao and GO once they are moved into the TERM table -->
        <discriminator type="string"
                       formula="(CASE get_obj_type(term_zdb_id)
                                    WHEN 'TERM'  THEN 'Generic-Term'
                                    ELSE              'Generic-Term'
                                 END)"/>

        <property name="termName" column="term_name"/>
        <property name="oboID" column="term_ont_id"/>
        <property name="ontology" column="term_ontology" type="ontologyEnumeration"/>
        <property name="obsolete" column="term_is_obsolete"/>
        <property name="root" column="term_is_root"/>
        <property name="secondary" column="term_is_secondary"/>
        <property name="comment" column="term_comment"/>
        <property name="definition" column="term_definition"/>

        <set name="aliases" lazy="true">
            <key column="dalias_data_zdb_id"/>
            <one-to-many class="org.zfin.ontology.TermAlias"/>
        </set>

        <subclass name="org.zfin.ontology.GenericTerm" discriminator-value="Generic-Term"/>

    </class>

    <class name="org.zfin.ontology.TermDefinition" table="TERM_DEFINITION">

        <id name="ID" type="string">
            <column name="termdef_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">TERM</param>
            </generator>
        </id>

        <property name="definition" column="termdef_definition"/>

        <many-to-one name="term" class="org.zfin.ontology.GenericTerm" column="termdef_term_zdb_id"
                     insert="false" update="false"/>
    </class>

    <class name="org.zfin.ontology.TermRelationship" table="TERM_RELATIONSHIP">
        <id name="ID">
            <column name="termrel_zdb_id" not-null="true"/>
            <generator class="org.zfin.database.ZdbIdGenerator">
                <param name="type">TERMREL</param>
            </generator>
        </id>

        <property name="type" column="termrel_type" />
        <many-to-one name="termOne" class="org.zfin.ontology.GenericTerm" column="termrel_term_1_zdb_id" />
        <many-to-one name="termTwo" class="org.zfin.ontology.GenericTerm" column="termrel_term_2_zdb_id" />

    </class>

</hibernate-mapping>
