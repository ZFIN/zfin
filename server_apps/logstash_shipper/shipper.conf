input {
    file {
        path => '/var/log/httpd/zfin_access.json'
        type => 'apache'
        format => 'json_event'
        tags => 'zfin.org Apache'
    }
    file {
        #this currently needs to be set up manually in your /opt/zfin/apache_conf/vhosts/inc-host 
        path => '/var/log/httpd/@INSTANCE@_access.json'
        type => 'apache'
        format => 'json_event'
        tags => '@INSTANCE@ Apache'
    }

# todo: re-enable this once tomcat_memory is getting written somewhere again
#      file {
#     	   type => "tomcatMemory"
#	   path => "/research/zprod/logs/tomcat_memory.out"
#	   format => 'plain'
#	   tags => 'Tomcat Memory'
#      }
      file {
      	   path => '/opt/zfin/catalina_bases/zfin.org/logs/catalina.json'
	   format => 'json_event'
	   type => 'log4j'
	   tags => 'zfin.org'
      }
      exec {
          type => "system-loadavg"
          command => "cat /proc/loadavg | awk '{print $1,$2,$3}'"
          interval => 30
     }
}
filter {
  grok {
    type => "system-loadavg"
    pattern => "%{NUMBER:load_avg_1m:float} %{NUMBER:load_avg_5m:float} %{NUMBER:load_avg_15m:float}"
    named_captures_only => true
  }

  grok {
       type => "tomcatMemory"
       patterns_dir => "./patterns"
       pattern => "%{TOMCAT_MEMORY}"
  }
}
output {
 redis { host => "logger.zfin.org" data_type => "list" key => "logstash" }
# for debugging:
# stdout { debug => true debug_format => "json" }
}

