RewriteEngine On

RewriteMap viewmap txt:<!--|TARGETROOT|-->/server_apps/apache/view-page-url-map.txt

#ZDB-[TYPE]-000000-0 ids
RewriteRule ^/ZDB-([A-Za-z_]+)-([0-9]+)-([0-9]+)$ ${viewmap:$1}-$2-$3 [PT]

#[TYPE]:000000 ids
RewriteRule ^/([A-Za-z]+):([0-9]+)$ ${viewmap:$1}:$2 [PT]




#zirc "order this" redirects, I'm not sure if there are CDNAs or just ESTs...
RedirectMatch /zirc-order/ZDB-EST-(.*) http://zebrafish.org/zirc/est/estAll.php?OID=ZDB-EST-$1
RedirectMatch /zirc-order/ZDB-CDNA-(.*) http://zebrafish.org/zirc/est/estAll.php?OID=ZDB-CDNA-$1
RedirectMatch /zirc-order/ZDB-GENO-(.*) http://zebrafish.org/zirc/fish/lineAll.php?OID=ZDB-GENO-$1

#rss feed redirects
Redirect  /zf_info/news/jobs.rss https://wiki.zfin.org/spaces/createrssfeed.action?types=blogpost&spaces=jobs&title=Zebrafish+Jobs&publicFeed=true&maxResults=-1&sort=created&timeSpan=120
Redirect /zf_info/news/mtgs.rss https://wiki.zfin.org/spaces/createrssfeed.action?types=blogpost&spaces=meetings&title=Zebrafish+Meetings&publicFeed=true&maxResults=-1&sort=created&timeSpan=-1
Redirect /zf_info/news/siteNews.rss https://wiki.zfin.org/spaces/createrssfeed.action?types=blogpost&spaces=news&title=Zebrafish+News&publicFeed=true&maxResults=-1&sort=created&timeSpan=120

#version independent gbrowse link
RewriteRule ^/genome-browser    /cgi-perl/gbrowse/current  [NC,PT]

#Allow use of same cgi-bin/webdriver path on all dev sites
RewriteCond <!--|MUTANT_NAME|--> !=zfin.org
RewriteRule ^/cgi-bin/webdriver(.*) /<!--|MUTANT_NAME|-->/webdriver$1 

#Require https on some pages
RewriteCond %{HTTPS} =off
  # Enumerate all urls that require https here, [OR]
  # goes at the end of all but the last one
RewriteCond %{REQUEST_URI} ^/action/people/edit-user$ [OR]
RewriteCond %{REQUEST_URI} ^/action/login-redirect$
RewriteRule ^(.*)$ https://%{SERVER_NAME}/$1 [R=301,L]

#Remove extra stuff for home page url
RewriteCond <!--|MUTANT_NAME|--> !=zfin.org
RewriteRule ^/$ /<!--|MUTANT_NAME|-->/webdriver?MIval=aa-ZDB_home.apg [PT]
RewriteCond <!--|MUTANT_NAME|--> =zfin.org
RewriteRule ^/$ /cgi-bin/webdriver?MIval=aa-ZDB_home.apg [PT]

#lab designation page
RewriteRule ^/zf_info/zfbook/lab_desig.html /action/feature/line-designations [NC,R=301]

#wild-type lines
RewriteCond %{QUERY_STRING}     ^MIval=aa-wtlist.apg$    [NC]
RewriteRule ^/<!--|WEBDRIVER_PATH_FROM_ROOT|--> /action/feature/wildtype-list [NC,R=301]

# retired apg urls
RewriteCond %{QUERY_STRING}     ^Mival=aa-markerview.apg&OID=([\w-]+)$    [NC]
RewriteRule ^/<!--|WEBDRIVER_PATH_FROM_ROOT|--> /action/marker/view/%1? [NC,R=301]

RewriteCond %{QUERY_STRING}     ^Mival=aa-genotypeview.apg&OID=([\w-]+)$    [NC]
RewriteRule ^/<!--|WEBDRIVER_PATH_FROM_ROOT|--> /action/genotype/genotype-detail?zdbID=%1 [NC,R=301]

RewriteCond %{QUERY_STRING}     ^Mival=aa-anatomy_item.apg&OID=([\w-]+)$    [NC]
RewriteRule ^/<!--|WEBDRIVER_PATH_FROM_ROOT|--> /action/anatomy/anatomy-view/%1? [NC,R=301]

RewriteCond %{QUERY_STRING}     ^antibody.zdbID=([\w-]+)$    [NC]
RewriteRule ^/action/antibody/detail /action/marker/view/%1? [NC,R=301]

RewriteCond %{QUERY_STRING}     ^zdbID=([\w-]+)$    [NC]
RewriteRule ^/action/marker/transcript-view /action/marker/view/%1? [NC,R=301]

RewriteCond %{QUERY_STRING}    ^anatomyItem.zdbID=([\w-]+)$    [NC]
RewriteRule ^/action/anatomy/term-detail /action/anatomy/anatomy-view/%1? [NC,R=301]

RewriteCond %{QUERY_STRING}    ^MIval=aa-anatdict.apg
RewriteRule ^/<!--|WEBDRIVER_PATH_FROM_ROOT|--> /action/anatomy/anatomy-search? [NC,R=301]

#RewriteRule /action/anatomy/search    /action/anatomy/anatomy-search [NC,R=301]

#We have these strange ZFIN_jump search page links to support...

RewriteCond %{QUERY_STRING}     ^record=JUMPTOGENE$    [NC]
RewriteRule ^/cgi-bin/ZFIN_jump /<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-newmrkrselect.apg [NC,R=301]

RewriteCond %{QUERY_STRING}     ^record=JUMPTOLAB$    [NC]
RewriteRule ^/cgi-bin/ZFIN_jump /<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-labselect.apg [NC,R=301]

RewriteCond %{QUERY_STRING}     ^record=JUMPTOPERSON$    [NC]
RewriteRule ^/cgi-bin/ZFIN_jump /<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-quickfindpers.apg [NC,R=301]

RewriteCond %{QUERY_STRING}     ^record=JUMPTOPUB$    [NC]
RewriteRule ^/cgi-bin/ZFIN_jump /<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-pubselect2.apg [NC,R=301]

RewriteCond %{QUERY_STRING}     ^record=JUMPTOREFCROSS$    [NC]
RewriteRule ^/cgi-bin/ZFIN_jump /<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-refcrosslist.apg [NC,R=301]

RewriteCond %{QUERY_STRING}     ^record=JUMPTOEST$    [NC]
RewriteRule ^/cgi-bin/ZFIN_jump /<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-newmrkrselect.apg [NC,R=301]

RewriteCond %{QUERY_STRING}     ^record=JUMPTOXPAT$    [NC]
RewriteRule ^/cgi-bin/ZFIN_jump /<!--|WEBDRIVER_PATH_FROM_ROOT|-->?MIval=aa-xpatselect.apg [NC,R=301]


# normal ZFIN_jump requests
RewriteCond %{QUERY_STRING}     ^record=([\w-]+)$    [NC]
RewriteRule ^/cgi-bin/ZFIN_jump /%1? [NC,R=301]

# catch the jump-to.apg as well!
RewriteCond %{QUERY_STRING}     ^Mival=aa-jump_to.apg&record=([\w-]+)$    [NC]
RewriteRule ^/<!--|WEBDRIVER_PATH_FROM_ROOT|--> /%1? [NC,R=301]


#download page
RewriteRule ^/downloads/archive/(.*) /action/unload/downloads/archive/$1 [NC,L,PT]
RewriteRule ^/downloads/archive /action/unload/downloads/archive [NC,L,PT]
RewriteRule ^/downloads/(.*) /action/unload/downloads/$1 [NC,L,PT]
RewriteRule ^/downloads /action/unload/downloads [NC,PT]
RewriteRule ^/zf_info/downloads.html /downloads [NC,R=301]
RewriteRule ^/data_transfer/Downloads/(.*) /downloads/$1 [NC,R=301]
