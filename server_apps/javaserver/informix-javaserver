#!/bin/sh
# A script to start up the Java server for Illustra
# ted Feb. 28, 1998.
# Hacked on by clif 12/23/99

MACHINE_DIR=/research/zfin/chromix

# Note: The version of Java we run the Java Server under
#	must match the version we compiled the libMISQL.so library
#       under.  See the Makefile for the Java Server for details.
JDK_DIR=/local/apps/jdk-1.1

SERVER_HOME=$MACHINE_DIR/www/java/javaserver
cd $SERVER_HOME

INFORMIXDIR=$MACHINE_DIR/private/apps/Informix_B
INFORMIXSERVER=chrom_b
INFORMIXSQLHOSTS=$INFORMIXDIR/etc/sqlhosts.chrom

export INFORMIXDIR INFORMIXSERVER INFORMIXSQLHOSTS

case "$1" in 
  'start')

	#  The server will load a *.so file, so we need to tell loader where to find it
	LD_LIBRARY_PATH=$SERVER_HOME:$INFORMIXDIR/lib:$INFORMIXDIR/lib/esql:$INFORMIXDIR/lib/dmi
	#  Now that we're using SU, we don't gain anything from exporting this (see below),
	#  but I retained this statement to observe the form of the thing.
	export LD_LIBRARY_PATH

	#  Informix apprently won't allow root to connect as a client (strange, but apparently so).
	#  So we have to SU as zfinner to run the server.  And since SU won't allow the environment
	#  variable LD_LIBRARY_PATH to be exported into its subprocess (a security restriction),
	#  we must explicitly set the variable INSIDE the new subprocess.
	if [ ${USER} = root ] ; then 
	    su zfinner -c "runServer $LD_LIBRARY_PATH $JDK_DIR/bin/java Server" >> Server.out 2>&1 &
	else 
	    runServer $LD_LIBRARY_PATH $JDK_DIR/bin/java Server >> Server.out 2>&1 &
	fi
	;;

    'stop')
	kill -9 `cat javaServerPid`
	;;

    *)
	echo "usage: $0 {start|stop}"
 	;;
esac
